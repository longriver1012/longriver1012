import{K as O,r,j as c,D as R,aA as I,aB as m,aC as L,aD as V,aE as B,aF as G,aG as H}from"./index-Bb-7Eb0M.js";import{AssetPath as J}from"./index-BBNQXmCL.js";import{AssetItem as K}from"./index-CWAapfIN.js";import{CreateFolderDialog as q}from"./index-BGWvq3rj.js";import"./index-CsPyr0-t.js";import"./BaseInput-B7ce96x8.js";import"./useVariants-tvJGGS15.js";import"./EyeOutlined-VQzAg_-b.js";import"./SearchOutlined-C6AoyiIt.js";import"./index-FJVxShW2.js";import"./row-oUhK5knE.js";import"./index-4nTUrSXL.js";const z="_layout_15ck3_1",Q="_container_15ck3_6",U="_content_15ck3_24",f={layout:z,container:Q,content:U},W=[{label:"新建文件夹",key:"folder"},{label:"导入",key:"import"},{label:"导出",key:"export"}],X=["glb","jpg","jpeg","png","hdr","webp","ktx2","ogg","mp3","webm","cube","3dl"],lt=x=>{const{visible:b}=x,[y,w]=O.useMessage(),[D,k]=r.useState([]),[i,l]=r.useState(),[s,p]=r.useState(""),[a,d]=r.useState([]),[A,g]=r.useState(!1),n=r.useRef(null),o=async t=>{const e=await I(t);k(e)};r.useEffect(()=>{o("")},[]);const C=t=>{if(t!==s)if(l(void 0),!t)d([]),p(""),o("");else{const e=a.findIndex(u=>u.code===t);a.splice(e+1,a.length-1-e),d([...a]),p(t),o(t)}},h=async({key:t})=>{t==="folder"?g(!0):t==="export"?await m(s):t==="import"&&(await L(),await o(s))},j=t=>{t.preventDefault(),t.dataTransfer.dropEffect="copy",n.current.style.backgroundColor="#53515173",n.current.style.border="1px dashed springgreen"},v=t=>{t.preventDefault(),t.stopPropagation(),n.current.style.backgroundColor="unset",n.current.style.border="unset"},_=async t=>{t.preventDefault(),n.current.style.backgroundColor="unset",n.current.style.border="unset";const e=await V(t.dataTransfer);Object.keys(e).length<=0||(await B(e,s),await o(s),y.info("添加成功"))},S=t=>l(t),E=async t=>{t.type==="folder"&&(l(void 0),await o(t.code),a.push(t),d([...a]),p(t.code))},F=async(t,e)=>{await H(t.code,e),await o(s)},N=async t=>{await G(t.code),await o(s)},P=async t=>{await m(t.code)},M=(t,e)=>{const u={type:e.type,item:e};t.dataTransfer.setData("text",JSON.stringify(u))},T=async()=>{await o(s),y.info("添加成功")};return c.jsxs("div",{className:f.layout,style:{display:b?"flex":"none"},children:[w,c.jsx(J,{parent:s,parents:a,active:i,onClick:C}),c.jsx(R,{menu:{items:W,onClick:h},trigger:["contextMenu"],children:c.jsx("div",{ref:n,className:f.container,onDragOver:j,onDragLeave:v,onDrop:_,children:c.jsx("div",{className:f.content,children:D.map(t=>c.jsx(K,{asset:t,active:(i==null?void 0:i.code)===t.code,draggable:X.includes(t.type),onClick:S,onDoubleClick:E,onRename:F,onDelete:N,onExport:P,onDragStart:e=>M(e,t)},t.code))})})}),c.jsx(q,{parent:s,visible:A,setVsible:g,onConfirm:T})]})};export{lt as FileList};
