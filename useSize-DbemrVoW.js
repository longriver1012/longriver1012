var ST=Object.defineProperty;var MT=(r,t,e)=>t in r?ST(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var A=(r,t,e)=>MT(r,typeof t!="symbol"?t+"":t,e);import{bG as vi,bH as Dx,bI as TT,bJ as rr,r as F_}from"./index-B5G4TnQQ.js";import{n as Vd}from"./project-jyqb4lMp.js";const ET=async r=>(await(await vi).getAll("assets")).filter(n=>n.parent===r).reverse().sort(n=>n.type==="folder"?-1:1),wz=async(r,t)=>{const n=(await vi).transaction("assets","readwrite"),i=r.map(s=>{const o=Vd(),a=Date.now(),c=a,l={parent:t,code:o,name:s.name,createTime:a,updateTime:c,type:"file",file:s};return n.store.put(l,o)});await Promise.all(i)},zg=async r=>{const e=await(await vi).get("assets",r);return(e==null?void 0:e.type)==="file"&&(e.file=URL.createObjectURL(e.file)),e},Sz=async r=>{const t=await vi,e=await ET(r),n=t.transaction("assets","readwrite"),i=[];e.forEach(s=>i.push(n.store.delete(s.code))),i.push(n.store.delete(r),n.done),await Promise.all(i)},Mz=async(r,t)=>{const e=await vi,n=Vd(),i=Date.now(),o={parent:r,code:n,name:t,createTime:i,updateTime:i,type:"folder",file:void 0};await e.put("assets",o,n)},Tz=async(r,t)=>{const e=await vi,n=await e.get("assets",r);n&&(n.name=t,await e.put("assets",n,r))},AT=async r=>(await(await vi).getAll("models")).filter(n=>n.parent===r).reverse().sort(n=>n.type==="folder"?-1:1),Ez=async(r,t,e,n)=>{const i=await vi,s=Vd(),o=Date.now(),c={code:s,name:r,cover:t,createTime:o,updateTime:o,content:e,parent:n,type:"file"};return await i.put("models",c,s),s},CT=async r=>await(await vi).get("models",r),Az=async r=>{const t=await vi,e=await AT(r),n=t.transaction("models","readwrite"),i=[];e.forEach(s=>i.push(n.store.delete(s.code))),i.push(n.store.delete(r),n.done),await Promise.all(i)},Cz=async(r,t,e)=>{const n=await vi,i=await n.get("models",r);i&&(i.cover=t,i.content=e,await n.put("models",i,r))},Pz=async(r,t)=>{const e=await vi,n=Vd(),i=Date.now(),o={parent:r,code:n,name:t,createTime:i,updateTime:i,type:"folder",cover:"",content:""};await e.put("models",o,n)},Rz=async(r,t)=>{const e=await vi,n=await e.get("models",r);n&&(n.name=t,await e.put("models",n,r))},Lx=r=>r;/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const ah="170",Lo={ROTATE:0,DOLLY:1,PAN:2},Ba={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},PT=0,k_=1,RT=2,Ix=1,Ox=2,Bs=3,Bi=0,Vn=1,Sn=2,Vr=0,Ja=1,N_=2,U_=3,B_=4,DT=5,So=100,LT=101,IT=102,OT=103,FT=104,kT=200,NT=201,UT=202,BT=203,rm=204,om=205,zT=206,VT=207,HT=208,GT=209,jT=210,WT=211,XT=212,YT=213,qT=214,am=0,cm=1,lm=2,uc=3,hm=4,um=5,dm=6,fm=7,Hd=0,KT=1,ZT=2,Hr=0,QT=1,$T=2,JT=3,Fx=4,tE=5,eE=6,nE=7,z_="attached",iE="detached",kx=300,dc=301,fc=302,pc=303,pm=304,Gd=306,xs=1e3,di=1001,zl=1002,gn=1003,Vg=1004,za=1005,dn=1006,Ml=1007,Ji=1008,or=1009,Nx=1010,Ux=1011,Vl=1012,Hg=1013,Xr=1014,Tn=1015,Ks=1016,Gg=1017,jg=1018,mc=1020,Bx=35902,zx=1021,Vx=1022,zn=1023,Hx=1024,Gx=1025,tc=1026,gc=1027,Wg=1028,jd=1029,jx=1030,Xg=1031,Yg=1033,$u=33776,Ju=33777,td=33778,ed=33779,mm=35840,gm=35841,_m=35842,bm=35843,ym=36196,vm=37492,xm=37496,wm=37808,Sm=37809,Mm=37810,Tm=37811,Em=37812,Am=37813,Cm=37814,Pm=37815,Rm=37816,Dm=37817,Lm=37818,Im=37819,Om=37820,Fm=37821,nd=36492,km=36494,Nm=36495,Wx=36283,Um=36284,Bm=36285,zm=36286,Xx=2200,Yx=2201,qx=2202,_c=2300,bc=2301,Mf=2302,Va=2400,Ha=2401,pd=2402,qg=2500,sE=2501,rE=0,Kx=1,Vm=2,oE=3200,aE=3201,Wd=0,cE=1,Ir="",On="srgb",Dc="srgb-linear",Xd="linear",be="srgb",na=7680,V_=519,lE=512,hE=513,uE=514,Zx=515,dE=516,fE=517,pE=518,mE=519,Hm=35044,H_="300 es",Zs=2e3,md=2001;class Jr{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const s=i.indexOf(e);s!==-1&&i.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const n=this._listeners[t.type];if(n!==void 0){t.target=this;const i=n.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,t);t.target=null}}}const vn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let G_=1234567;const Tl=Math.PI/180,yc=180/Math.PI;function es(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(vn[r&255]+vn[r>>8&255]+vn[r>>16&255]+vn[r>>24&255]+"-"+vn[t&255]+vn[t>>8&255]+"-"+vn[t>>16&15|64]+vn[t>>24&255]+"-"+vn[e&63|128]+vn[e>>8&255]+"-"+vn[e>>16&255]+vn[e>>24&255]+vn[n&255]+vn[n>>8&255]+vn[n>>16&255]+vn[n>>24&255]).toLowerCase()}function Ke(r,t,e){return Math.max(t,Math.min(e,r))}function Kg(r,t){return(r%t+t)%t}function gE(r,t,e,n,i){return n+(r-t)*(i-n)/(e-t)}function _E(r,t,e){return r!==t?(e-r)/(t-r):0}function El(r,t,e){return(1-e)*r+e*t}function bE(r,t,e,n){return El(r,t,1-Math.exp(-e*n))}function yE(r,t=1){return t-Math.abs(Kg(r,t*2)-t)}function vE(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function xE(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function wE(r,t){return r+Math.floor(Math.random()*(t-r+1))}function SE(r,t){return r+Math.random()*(t-r)}function ME(r){return r*(.5-Math.random())}function TE(r){r!==void 0&&(G_=r);let t=G_+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function EE(r){return r*Tl}function AE(r){return r*yc}function CE(r){return(r&r-1)===0&&r!==0}function PE(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function RE(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function DE(r,t,e,n,i){const s=Math.cos,o=Math.sin,a=s(e/2),c=o(e/2),l=s((t+n)/2),h=o((t+n)/2),u=s((t-n)/2),d=o((t-n)/2),f=s((n-t)/2),m=o((n-t)/2);switch(i){case"XYX":r.set(a*h,c*u,c*d,a*l);break;case"YZY":r.set(c*d,a*h,c*u,a*l);break;case"ZXZ":r.set(c*u,c*d,a*h,a*l);break;case"XZX":r.set(a*h,c*m,c*f,a*l);break;case"YXY":r.set(c*f,a*h,c*m,a*l);break;case"ZYZ":r.set(c*m,c*f,a*h,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Qi(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function _e(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const Le={DEG2RAD:Tl,RAD2DEG:yc,generateUUID:es,clamp:Ke,euclideanModulo:Kg,mapLinear:gE,inverseLerp:_E,lerp:El,damp:bE,pingpong:yE,smoothstep:vE,smootherstep:xE,randInt:wE,randFloat:SE,randFloatSpread:ME,seededRandom:TE,degToRad:EE,radToDeg:AE,isPowerOfTwo:CE,ceilPowerOfTwo:PE,floorPowerOfTwo:RE,setQuaternionFromProperEuler:DE,normalize:_e,denormalize:Qi};class J{constructor(t=0,e=0){J.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Ke(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),s=this.x-t.x,o=this.y-t.y;return this.x=s*n-o*i+t.x,this.y=s*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Gt{constructor(t,e,n,i,s,o,a,c,l){Gt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,i,s,o,a,c,l)}set(t,e,n,i,s,o,a,c,l){const h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=s,h[5]=c,h[6]=n,h[7]=o,h[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,s=this.elements,o=n[0],a=n[3],c=n[6],l=n[1],h=n[4],u=n[7],d=n[2],f=n[5],m=n[8],_=i[0],g=i[3],p=i[6],b=i[1],y=i[4],v=i[7],x=i[2],S=i[5],T=i[8];return s[0]=o*_+a*b+c*x,s[3]=o*g+a*y+c*S,s[6]=o*p+a*v+c*T,s[1]=l*_+h*b+u*x,s[4]=l*g+h*y+u*S,s[7]=l*p+h*v+u*T,s[2]=d*_+f*b+m*x,s[5]=d*g+f*y+m*S,s[8]=d*p+f*v+m*T,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8];return e*o*h-e*a*l-n*s*h+n*a*c+i*s*l-i*o*c}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],u=h*o-a*l,d=a*c-h*s,f=l*s-o*c,m=e*u+n*d+i*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/m;return t[0]=u*_,t[1]=(i*l-h*n)*_,t[2]=(a*n-i*o)*_,t[3]=d*_,t[4]=(h*e-i*c)*_,t[5]=(i*s-a*e)*_,t[6]=f*_,t[7]=(n*c-l*e)*_,t[8]=(o*e-n*s)*_,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,s,o,a){const c=Math.cos(s),l=Math.sin(s);return this.set(n*c,n*l,-n*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Tf.makeScale(t,e)),this}rotate(t){return this.premultiply(Tf.makeRotation(-t)),this}translate(t,e){return this.premultiply(Tf.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Tf=new Gt;function Qx(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function Hl(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function LE(){const r=Hl("canvas");return r.style.display="block",r}const j_={};function _l(r){r in j_||(j_[r]=!0,console.warn(r))}function IE(r,t,e){return new Promise(function(n,i){function s(){switch(r.clientWaitSync(t,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:i();break;case r.TIMEOUT_EXPIRED:setTimeout(s,e);break;default:n()}}setTimeout(s,e)})}function OE(r){const t=r.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}function FE(r){const t=r.elements;t[11]===-1?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=-t[14]+1)}const ne={enabled:!0,workingColorSpace:Dc,spaces:{},convert:function(r,t,e){return this.enabled===!1||t===e||!t||!e||(this.spaces[t].transfer===be&&(r.r=tr(r.r),r.g=tr(r.g),r.b=tr(r.b)),this.spaces[t].primaries!==this.spaces[e].primaries&&(r.applyMatrix3(this.spaces[t].toXYZ),r.applyMatrix3(this.spaces[e].fromXYZ)),this.spaces[e].transfer===be&&(r.r=ec(r.r),r.g=ec(r.g),r.b=ec(r.b))),r},fromWorkingColorSpace:function(r,t){return this.convert(r,this.workingColorSpace,t)},toWorkingColorSpace:function(r,t){return this.convert(r,t,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===Ir?Xd:this.spaces[r].transfer},getLuminanceCoefficients:function(r,t=this.workingColorSpace){return r.fromArray(this.spaces[t].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,t,e){return r.copy(this.spaces[t].toXYZ).multiply(this.spaces[e].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace}};function tr(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function ec(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}const W_=[.64,.33,.3,.6,.15,.06],X_=[.2126,.7152,.0722],Y_=[.3127,.329],q_=new Gt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),K_=new Gt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ne.define({[Dc]:{primaries:W_,whitePoint:Y_,transfer:Xd,toXYZ:q_,fromXYZ:K_,luminanceCoefficients:X_,workingColorSpaceConfig:{unpackColorSpace:On},outputColorSpaceConfig:{drawingBufferColorSpace:On}},[On]:{primaries:W_,whitePoint:Y_,transfer:be,toXYZ:q_,fromXYZ:K_,luminanceCoefficients:X_,outputColorSpaceConfig:{drawingBufferColorSpace:On}}});let ia;class kE{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ia===void 0&&(ia=Hl("canvas")),ia.width=t.width,ia.height=t.height;const n=ia.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=ia}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Hl("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=tr(s[o]/255)*255;return n.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(tr(e[n]/255)*255):e[n]=tr(e[n]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let NE=0;class $x{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:NE++}),this.uuid=es(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(Ef(i[o].image)):s.push(Ef(i[o]))}else s=Ef(i);n.url=s}return e||(t.images[this.uuid]=n),n}}function Ef(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?kE.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let UE=0;class Ie extends Jr{constructor(t=Ie.DEFAULT_IMAGE,e=Ie.DEFAULT_MAPPING,n=di,i=di,s=dn,o=Ji,a=zn,c=or,l=Ie.DEFAULT_ANISOTROPY,h=Ir){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:UE++}),this.uuid=es(),this.name="",this.source=new $x(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new J(0,0),this.repeat=new J(1,1),this.center=new J(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Gt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==kx)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case xs:t.x=t.x-Math.floor(t.x);break;case di:t.x=t.x<0?0:1;break;case zl:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case xs:t.y=t.y-Math.floor(t.y);break;case di:t.y=t.y<0?0:1;break;case zl:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Ie.DEFAULT_IMAGE=null;Ie.DEFAULT_MAPPING=kx;Ie.DEFAULT_ANISOTROPY=1;class ie{constructor(t=0,e=0,n=0,i=1){ie.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,s=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*s,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*s,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*s,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*s,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,s;const c=t.elements,l=c[0],h=c[4],u=c[8],d=c[1],f=c[5],m=c[9],_=c[2],g=c[6],p=c[10];if(Math.abs(h-d)<.01&&Math.abs(u-_)<.01&&Math.abs(m-g)<.01){if(Math.abs(h+d)<.1&&Math.abs(u+_)<.1&&Math.abs(m+g)<.1&&Math.abs(l+f+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const y=(l+1)/2,v=(f+1)/2,x=(p+1)/2,S=(h+d)/4,T=(u+_)/4,E=(m+g)/4;return y>v&&y>x?y<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(y),i=S/n,s=T/n):v>x?v<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(v),n=S/i,s=E/i):x<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(x),n=T/s,i=E/s),this.set(n,i,s,e),this}let b=Math.sqrt((g-m)*(g-m)+(u-_)*(u-_)+(d-h)*(d-h));return Math.abs(b)<.001&&(b=1),this.x=(g-m)/b,this.y=(u-_)/b,this.z=(d-h)/b,this.w=Math.acos((l+f+p-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class BE extends Jr{constructor(t=1,e=1,n={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new ie(0,0,t,e),this.scissorTest=!1,this.viewport=new ie(0,0,t,e);const i={width:t,height:e,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:dn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const s=new Ie(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);s.flipY=!1,s.generateMipmaps=n.generateMipmaps,s.internalFormat=n.internalFormat,this.textures=[];const o=n.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let n=0,i=t.textures.length;n<i;n++)this.textures[n]=t.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new $x(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Bo extends BE{constructor(t=1,e=1,n={}){super(t,e,n),this.isWebGLRenderTarget=!0}}class Jx extends Ie{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=gn,this.minFilter=gn,this.wrapR=di,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class zE extends Ie{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=gn,this.minFilter=gn,this.wrapR=di,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class jt{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,s,o,a){let c=n[i+0],l=n[i+1],h=n[i+2],u=n[i+3];const d=s[o+0],f=s[o+1],m=s[o+2],_=s[o+3];if(a===0){t[e+0]=c,t[e+1]=l,t[e+2]=h,t[e+3]=u;return}if(a===1){t[e+0]=d,t[e+1]=f,t[e+2]=m,t[e+3]=_;return}if(u!==_||c!==d||l!==f||h!==m){let g=1-a;const p=c*d+l*f+h*m+u*_,b=p>=0?1:-1,y=1-p*p;if(y>Number.EPSILON){const x=Math.sqrt(y),S=Math.atan2(x,p*b);g=Math.sin(g*S)/x,a=Math.sin(a*S)/x}const v=a*b;if(c=c*g+d*v,l=l*g+f*v,h=h*g+m*v,u=u*g+_*v,g===1-a){const x=1/Math.sqrt(c*c+l*l+h*h+u*u);c*=x,l*=x,h*=x,u*=x}}t[e]=c,t[e+1]=l,t[e+2]=h,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,s,o){const a=n[i],c=n[i+1],l=n[i+2],h=n[i+3],u=s[o],d=s[o+1],f=s[o+2],m=s[o+3];return t[e]=a*m+h*u+c*f-l*d,t[e+1]=c*m+h*d+l*u-a*f,t[e+2]=l*m+h*f+a*d-c*u,t[e+3]=h*m-a*u-c*d-l*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,i=t._y,s=t._z,o=t._order,a=Math.cos,c=Math.sin,l=a(n/2),h=a(i/2),u=a(s/2),d=c(n/2),f=c(i/2),m=c(s/2);switch(o){case"XYZ":this._x=d*h*u+l*f*m,this._y=l*f*u-d*h*m,this._z=l*h*m+d*f*u,this._w=l*h*u-d*f*m;break;case"YXZ":this._x=d*h*u+l*f*m,this._y=l*f*u-d*h*m,this._z=l*h*m-d*f*u,this._w=l*h*u+d*f*m;break;case"ZXY":this._x=d*h*u-l*f*m,this._y=l*f*u+d*h*m,this._z=l*h*m+d*f*u,this._w=l*h*u-d*f*m;break;case"ZYX":this._x=d*h*u-l*f*m,this._y=l*f*u+d*h*m,this._z=l*h*m-d*f*u,this._w=l*h*u+d*f*m;break;case"YZX":this._x=d*h*u+l*f*m,this._y=l*f*u+d*h*m,this._z=l*h*m-d*f*u,this._w=l*h*u-d*f*m;break;case"XZY":this._x=d*h*u-l*f*m,this._y=l*f*u-d*h*m,this._z=l*h*m+d*f*u,this._w=l*h*u+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],s=e[8],o=e[1],a=e[5],c=e[9],l=e[2],h=e[6],u=e[10],d=n+a+u;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(h-c)*f,this._y=(s-l)*f,this._z=(o-i)*f}else if(n>a&&n>u){const f=2*Math.sqrt(1+n-a-u);this._w=(h-c)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(s+l)/f}else if(a>u){const f=2*Math.sqrt(1+a-n-u);this._w=(s-l)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(c+h)/f}else{const f=2*Math.sqrt(1+u-n-a);this._w=(o-i)/f,this._x=(s+l)/f,this._y=(c+h)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ke(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,s=t._z,o=t._w,a=e._x,c=e._y,l=e._z,h=e._w;return this._x=n*h+o*a+i*l-s*c,this._y=i*h+o*c+s*a-n*l,this._z=s*h+o*l+n*c-i*a,this._w=o*h-n*a-i*c-s*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,i=this._y,s=this._z,o=this._w;let a=o*t._w+n*t._x+i*t._y+s*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const f=1-e;return this._w=f*o+e*this._w,this._x=f*n+e*this._x,this._y=f*i+e*this._y,this._z=f*s+e*this._z,this.normalize(),this}const l=Math.sqrt(c),h=Math.atan2(l,a),u=Math.sin((1-e)*h)/l,d=Math.sin(e*h)/l;return this._w=o*u+this._w*d,this._x=n*u+this._x*d,this._y=i*u+this._y*d,this._z=s*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(t),i*Math.cos(t),s*Math.sin(e),s*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class C{constructor(t=0,e=0,n=0){C.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Z_.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Z_.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6]*i,this.y=s[1]*e+s[4]*n+s[7]*i,this.z=s[2]*e+s[5]*n+s[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,s=t.elements,o=1/(s[3]*e+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*e+s[4]*n+s[8]*i+s[12])*o,this.y=(s[1]*e+s[5]*n+s[9]*i+s[13])*o,this.z=(s[2]*e+s[6]*n+s[10]*i+s[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,s=t.x,o=t.y,a=t.z,c=t.w,l=2*(o*i-a*n),h=2*(a*e-s*i),u=2*(s*n-o*e);return this.x=e+c*l+o*u-a*h,this.y=n+c*h+a*l-s*u,this.z=i+c*u+s*h-o*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i,this.y=s[1]*e+s[5]*n+s[9]*i,this.z=s[2]*e+s[6]*n+s[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,s=t.z,o=e.x,a=e.y,c=e.z;return this.x=i*c-s*a,this.y=s*o-n*c,this.z=n*a-i*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Af.copy(this).projectOnVector(t),this.sub(Af)}reflect(t){return this.sub(Af.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Ke(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Af=new C,Z_=new jt;class xe{constructor(t=new C(1/0,1/0,1/0),e=new C(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(Gi.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(Gi.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Gi.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0){const s=n.getAttribute("position");if(e===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)t.isMesh===!0?t.getVertexPosition(o,Gi):Gi.fromBufferAttribute(s,o),Gi.applyMatrix4(t.matrixWorld),this.expandByPoint(Gi);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),xh.copy(t.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),xh.copy(n.boundingBox)),xh.applyMatrix4(t.matrixWorld),this.union(xh)}const i=t.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Gi),Gi.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Xc),wh.subVectors(this.max,Xc),sa.subVectors(t.a,Xc),ra.subVectors(t.b,Xc),oa.subVectors(t.c,Xc),_r.subVectors(ra,sa),br.subVectors(oa,ra),oo.subVectors(sa,oa);let e=[0,-_r.z,_r.y,0,-br.z,br.y,0,-oo.z,oo.y,_r.z,0,-_r.x,br.z,0,-br.x,oo.z,0,-oo.x,-_r.y,_r.x,0,-br.y,br.x,0,-oo.y,oo.x,0];return!Cf(e,sa,ra,oa,wh)||(e=[1,0,0,0,1,0,0,0,1],!Cf(e,sa,ra,oa,wh))?!1:(Sh.crossVectors(_r,br),e=[Sh.x,Sh.y,Sh.z],Cf(e,sa,ra,oa,wh))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Gi).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Gi).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Ls[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ls[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ls[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ls[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ls[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ls[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ls[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ls[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ls),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Ls=[new C,new C,new C,new C,new C,new C,new C,new C],Gi=new C,xh=new xe,sa=new C,ra=new C,oa=new C,_r=new C,br=new C,oo=new C,Xc=new C,wh=new C,Sh=new C,ao=new C;function Cf(r,t,e,n,i){for(let s=0,o=r.length-3;s<=o;s+=3){ao.fromArray(r,s);const a=i.x*Math.abs(ao.x)+i.y*Math.abs(ao.y)+i.z*Math.abs(ao.z),c=t.dot(ao),l=e.dot(ao),h=n.dot(ao);if(Math.max(-Math.max(c,l,h),Math.min(c,l,h))>a)return!1}return!0}const VE=new xe,Yc=new C,Pf=new C;class An{constructor(t=new C,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;e!==void 0?n.copy(e):VE.setFromPoints(t).getCenter(n);let i=0;for(let s=0,o=t.length;s<o;s++)i=Math.max(i,n.distanceToSquared(t[s]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Yc.subVectors(t,this.center);const e=Yc.lengthSq();if(e>this.radius*this.radius){const n=Math.sqrt(e),i=(n-this.radius)*.5;this.center.addScaledVector(Yc,i/n),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Pf.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Yc.copy(t.center).add(Pf)),this.expandByPoint(Yc.copy(t.center).sub(Pf))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Is=new C,Rf=new C,Mh=new C,yr=new C,Df=new C,Th=new C,Lf=new C;class Ko{constructor(t=new C,e=new C(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Is)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Is.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Is.copy(this.origin).addScaledVector(this.direction,e),Is.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){Rf.copy(t).add(e).multiplyScalar(.5),Mh.copy(e).sub(t).normalize(),yr.copy(this.origin).sub(Rf);const s=t.distanceTo(e)*.5,o=-this.direction.dot(Mh),a=yr.dot(this.direction),c=-yr.dot(Mh),l=yr.lengthSq(),h=Math.abs(1-o*o);let u,d,f,m;if(h>0)if(u=o*c-a,d=o*a-c,m=s*h,u>=0)if(d>=-m)if(d<=m){const _=1/h;u*=_,d*=_,f=u*(u+o*d+2*a)+d*(o*u+d+2*c)+l}else d=s,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*c)+l;else d=-s,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*c)+l;else d<=-m?(u=Math.max(0,-(-o*s+a)),d=u>0?-s:Math.min(Math.max(-s,-c),s),f=-u*u+d*(d+2*c)+l):d<=m?(u=0,d=Math.min(Math.max(-s,-c),s),f=d*(d+2*c)+l):(u=Math.max(0,-(o*s+a)),d=u>0?s:Math.min(Math.max(-s,-c),s),f=-u*u+d*(d+2*c)+l);else d=o>0?-s:s,u=Math.max(0,-(o*d+a)),f=-u*u+d*(d+2*c)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,u),i&&i.copy(Rf).addScaledVector(Mh,d),f}intersectSphere(t,e){Is.subVectors(t.center,this.origin);const n=Is.dot(this.direction),i=Is.dot(Is)-n*n,s=t.radius*t.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=n-o,c=n+o;return c<0?null:a<0?this.at(c,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,s,o,a,c;const l=1/this.direction.x,h=1/this.direction.y,u=1/this.direction.z,d=this.origin;return l>=0?(n=(t.min.x-d.x)*l,i=(t.max.x-d.x)*l):(n=(t.max.x-d.x)*l,i=(t.min.x-d.x)*l),h>=0?(s=(t.min.y-d.y)*h,o=(t.max.y-d.y)*h):(s=(t.max.y-d.y)*h,o=(t.min.y-d.y)*h),n>o||s>i||((s>n||isNaN(n))&&(n=s),(o<i||isNaN(i))&&(i=o),u>=0?(a=(t.min.z-d.z)*u,c=(t.max.z-d.z)*u):(a=(t.max.z-d.z)*u,c=(t.min.z-d.z)*u),n>c||a>i)||((a>n||n!==n)&&(n=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(n>=0?n:i,e)}intersectsBox(t){return this.intersectBox(t,Is)!==null}intersectTriangle(t,e,n,i,s){Df.subVectors(e,t),Th.subVectors(n,t),Lf.crossVectors(Df,Th);let o=this.direction.dot(Lf),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;yr.subVectors(this.origin,t);const c=a*this.direction.dot(Th.crossVectors(yr,Th));if(c<0)return null;const l=a*this.direction.dot(Df.cross(yr));if(l<0||c+l>o)return null;const h=-a*yr.dot(Lf);return h<0?null:this.at(h/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class lt{constructor(t,e,n,i,s,o,a,c,l,h,u,d,f,m,_,g){lt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,i,s,o,a,c,l,h,u,d,f,m,_,g)}set(t,e,n,i,s,o,a,c,l,h,u,d,f,m,_,g){const p=this.elements;return p[0]=t,p[4]=e,p[8]=n,p[12]=i,p[1]=s,p[5]=o,p[9]=a,p[13]=c,p[2]=l,p[6]=h,p[10]=u,p[14]=d,p[3]=f,p[7]=m,p[11]=_,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new lt().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/aa.setFromMatrixColumn(t,0).length(),s=1/aa.setFromMatrixColumn(t,1).length(),o=1/aa.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*s,e[5]=n[5]*s,e[6]=n[6]*s,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,s=t.z,o=Math.cos(n),a=Math.sin(n),c=Math.cos(i),l=Math.sin(i),h=Math.cos(s),u=Math.sin(s);if(t.order==="XYZ"){const d=o*h,f=o*u,m=a*h,_=a*u;e[0]=c*h,e[4]=-c*u,e[8]=l,e[1]=f+m*l,e[5]=d-_*l,e[9]=-a*c,e[2]=_-d*l,e[6]=m+f*l,e[10]=o*c}else if(t.order==="YXZ"){const d=c*h,f=c*u,m=l*h,_=l*u;e[0]=d+_*a,e[4]=m*a-f,e[8]=o*l,e[1]=o*u,e[5]=o*h,e[9]=-a,e[2]=f*a-m,e[6]=_+d*a,e[10]=o*c}else if(t.order==="ZXY"){const d=c*h,f=c*u,m=l*h,_=l*u;e[0]=d-_*a,e[4]=-o*u,e[8]=m+f*a,e[1]=f+m*a,e[5]=o*h,e[9]=_-d*a,e[2]=-o*l,e[6]=a,e[10]=o*c}else if(t.order==="ZYX"){const d=o*h,f=o*u,m=a*h,_=a*u;e[0]=c*h,e[4]=m*l-f,e[8]=d*l+_,e[1]=c*u,e[5]=_*l+d,e[9]=f*l-m,e[2]=-l,e[6]=a*c,e[10]=o*c}else if(t.order==="YZX"){const d=o*c,f=o*l,m=a*c,_=a*l;e[0]=c*h,e[4]=_-d*u,e[8]=m*u+f,e[1]=u,e[5]=o*h,e[9]=-a*h,e[2]=-l*h,e[6]=f*u+m,e[10]=d-_*u}else if(t.order==="XZY"){const d=o*c,f=o*l,m=a*c,_=a*l;e[0]=c*h,e[4]=-u,e[8]=l*h,e[1]=d*u+_,e[5]=o*h,e[9]=f*u-m,e[2]=m*u-f,e[6]=a*h,e[10]=_*u+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(HE,t,GE)}lookAt(t,e,n){const i=this.elements;return ai.subVectors(t,e),ai.lengthSq()===0&&(ai.z=1),ai.normalize(),vr.crossVectors(n,ai),vr.lengthSq()===0&&(Math.abs(n.z)===1?ai.x+=1e-4:ai.z+=1e-4,ai.normalize(),vr.crossVectors(n,ai)),vr.normalize(),Eh.crossVectors(ai,vr),i[0]=vr.x,i[4]=Eh.x,i[8]=ai.x,i[1]=vr.y,i[5]=Eh.y,i[9]=ai.y,i[2]=vr.z,i[6]=Eh.z,i[10]=ai.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,s=this.elements,o=n[0],a=n[4],c=n[8],l=n[12],h=n[1],u=n[5],d=n[9],f=n[13],m=n[2],_=n[6],g=n[10],p=n[14],b=n[3],y=n[7],v=n[11],x=n[15],S=i[0],T=i[4],E=i[8],w=i[12],M=i[1],P=i[5],L=i[9],I=i[13],F=i[2],z=i[6],N=i[10],Z=i[14],j=i[3],et=i[7],tt=i[11],at=i[15];return s[0]=o*S+a*M+c*F+l*j,s[4]=o*T+a*P+c*z+l*et,s[8]=o*E+a*L+c*N+l*tt,s[12]=o*w+a*I+c*Z+l*at,s[1]=h*S+u*M+d*F+f*j,s[5]=h*T+u*P+d*z+f*et,s[9]=h*E+u*L+d*N+f*tt,s[13]=h*w+u*I+d*Z+f*at,s[2]=m*S+_*M+g*F+p*j,s[6]=m*T+_*P+g*z+p*et,s[10]=m*E+_*L+g*N+p*tt,s[14]=m*w+_*I+g*Z+p*at,s[3]=b*S+y*M+v*F+x*j,s[7]=b*T+y*P+v*z+x*et,s[11]=b*E+y*L+v*N+x*tt,s[15]=b*w+y*I+v*Z+x*at,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],s=t[12],o=t[1],a=t[5],c=t[9],l=t[13],h=t[2],u=t[6],d=t[10],f=t[14],m=t[3],_=t[7],g=t[11],p=t[15];return m*(+s*c*u-i*l*u-s*a*d+n*l*d+i*a*f-n*c*f)+_*(+e*c*f-e*l*d+s*o*d-i*o*f+i*l*h-s*c*h)+g*(+e*l*u-e*a*f-s*o*u+n*o*f+s*a*h-n*l*h)+p*(-i*a*h-e*c*u+e*a*d+i*o*u-n*o*d+n*c*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],u=t[9],d=t[10],f=t[11],m=t[12],_=t[13],g=t[14],p=t[15],b=u*g*l-_*d*l+_*c*f-a*g*f-u*c*p+a*d*p,y=m*d*l-h*g*l-m*c*f+o*g*f+h*c*p-o*d*p,v=h*_*l-m*u*l+m*a*f-o*_*f-h*a*p+o*u*p,x=m*u*c-h*_*c-m*a*d+o*_*d+h*a*g-o*u*g,S=e*b+n*y+i*v+s*x;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/S;return t[0]=b*T,t[1]=(_*d*s-u*g*s-_*i*f+n*g*f+u*i*p-n*d*p)*T,t[2]=(a*g*s-_*c*s+_*i*l-n*g*l-a*i*p+n*c*p)*T,t[3]=(u*c*s-a*d*s-u*i*l+n*d*l+a*i*f-n*c*f)*T,t[4]=y*T,t[5]=(h*g*s-m*d*s+m*i*f-e*g*f-h*i*p+e*d*p)*T,t[6]=(m*c*s-o*g*s-m*i*l+e*g*l+o*i*p-e*c*p)*T,t[7]=(o*d*s-h*c*s+h*i*l-e*d*l-o*i*f+e*c*f)*T,t[8]=v*T,t[9]=(m*u*s-h*_*s-m*n*f+e*_*f+h*n*p-e*u*p)*T,t[10]=(o*_*s-m*a*s+m*n*l-e*_*l-o*n*p+e*a*p)*T,t[11]=(h*a*s-o*u*s-h*n*l+e*u*l+o*n*f-e*a*f)*T,t[12]=x*T,t[13]=(h*_*i-m*u*i+m*n*d-e*_*d-h*n*g+e*u*g)*T,t[14]=(m*a*i-o*_*i-m*n*c+e*_*c+o*n*g-e*a*g)*T,t[15]=(o*u*i-h*a*i+h*n*c-e*u*c-o*n*d+e*a*d)*T,this}scale(t){const e=this.elements,n=t.x,i=t.y,s=t.z;return e[0]*=n,e[4]*=i,e[8]*=s,e[1]*=n,e[5]*=i,e[9]*=s,e[2]*=n,e[6]*=i,e[10]*=s,e[3]*=n,e[7]*=i,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),s=1-n,o=t.x,a=t.y,c=t.z,l=s*o,h=s*a;return this.set(l*o+n,l*a-i*c,l*c+i*a,0,l*a+i*c,h*a+n,h*c-i*o,0,l*c-i*a,h*c+i*o,s*c*c+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,s,o){return this.set(1,n,s,0,t,1,o,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,s=e._x,o=e._y,a=e._z,c=e._w,l=s+s,h=o+o,u=a+a,d=s*l,f=s*h,m=s*u,_=o*h,g=o*u,p=a*u,b=c*l,y=c*h,v=c*u,x=n.x,S=n.y,T=n.z;return i[0]=(1-(_+p))*x,i[1]=(f+v)*x,i[2]=(m-y)*x,i[3]=0,i[4]=(f-v)*S,i[5]=(1-(d+p))*S,i[6]=(g+b)*S,i[7]=0,i[8]=(m+y)*T,i[9]=(g-b)*T,i[10]=(1-(d+_))*T,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let s=aa.set(i[0],i[1],i[2]).length();const o=aa.set(i[4],i[5],i[6]).length(),a=aa.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),t.x=i[12],t.y=i[13],t.z=i[14],ji.copy(this);const l=1/s,h=1/o,u=1/a;return ji.elements[0]*=l,ji.elements[1]*=l,ji.elements[2]*=l,ji.elements[4]*=h,ji.elements[5]*=h,ji.elements[6]*=h,ji.elements[8]*=u,ji.elements[9]*=u,ji.elements[10]*=u,e.setFromRotationMatrix(ji),n.x=s,n.y=o,n.z=a,this}makePerspective(t,e,n,i,s,o,a=Zs){const c=this.elements,l=2*s/(e-t),h=2*s/(n-i),u=(e+t)/(e-t),d=(n+i)/(n-i);let f,m;if(a===Zs)f=-(o+s)/(o-s),m=-2*o*s/(o-s);else if(a===md)f=-o/(o-s),m=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=u,c[12]=0,c[1]=0,c[5]=h,c[9]=d,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=m,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,n,i,s,o,a=Zs){const c=this.elements,l=1/(e-t),h=1/(n-i),u=1/(o-s),d=(e+t)*l,f=(n+i)*h;let m,_;if(a===Zs)m=(o+s)*u,_=-2*u;else if(a===md)m=s*u,_=-1*u;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-d,c[1]=0,c[5]=2*h,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=_,c[14]=-m,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const aa=new C,ji=new lt,HE=new C(0,0,0),GE=new C(1,1,1),vr=new C,Eh=new C,ai=new C,Q_=new lt,$_=new jt;class Me{constructor(t=0,e=0,n=0,i=Me.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,s=i[0],o=i[4],a=i[8],c=i[1],l=i[5],h=i[9],u=i[2],d=i[6],f=i[10];switch(e){case"XYZ":this._y=Math.asin(Ke(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Ke(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(Ke(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,f),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Ke(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(Ke(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-Ke(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-h,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Q_.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Q_,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return $_.setFromEuler(this),this.setFromQuaternion($_,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Me.DEFAULT_ORDER="XYZ";class Zg{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let jE=0;const J_=new C,ca=new jt,Os=new lt,Ah=new C,qc=new C,WE=new C,XE=new jt,tb=new C(1,0,0),eb=new C(0,1,0),nb=new C(0,0,1),ib={type:"added"},YE={type:"removed"},la={type:"childadded",child:null},If={type:"childremoved",child:null};class Bt extends Jr{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:jE++}),this.uuid=es(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Bt.DEFAULT_UP.clone();const t=new C,e=new Me,n=new jt,i=new C(1,1,1);function s(){n.setFromEuler(e,!1)}function o(){e.setFromQuaternion(n,void 0,!1)}e._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new lt},normalMatrix:{value:new Gt}}),this.matrix=new lt,this.matrixWorld=new lt,this.matrixAutoUpdate=Bt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Bt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Zg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ca.setFromAxisAngle(t,e),this.quaternion.multiply(ca),this}rotateOnWorldAxis(t,e){return ca.setFromAxisAngle(t,e),this.quaternion.premultiply(ca),this}rotateX(t){return this.rotateOnAxis(tb,t)}rotateY(t){return this.rotateOnAxis(eb,t)}rotateZ(t){return this.rotateOnAxis(nb,t)}translateOnAxis(t,e){return J_.copy(t).applyQuaternion(this.quaternion),this.position.add(J_.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(tb,t)}translateY(t){return this.translateOnAxis(eb,t)}translateZ(t){return this.translateOnAxis(nb,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Os.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Ah.copy(t):Ah.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),qc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Os.lookAt(qc,Ah,this.up):Os.lookAt(Ah,qc,this.up),this.quaternion.setFromRotationMatrix(Os),i&&(Os.extractRotation(i.matrixWorld),ca.setFromRotationMatrix(Os),this.quaternion.premultiply(ca.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(ib),la.child=t,this.dispatchEvent(la),la.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(YE),If.child=t,this.dispatchEvent(If),If.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Os.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Os.multiply(t.parent.matrixWorld)),t.applyMatrix4(Os),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(ib),la.child=t,this.dispatchEvent(la),la.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(t,e);if(o!==void 0)return o}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qc,t,WE),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qc,XE,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,h=c.length;l<h;l++){const u=c[l];s(t.shapes,u)}else s(t.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(s(t.materials,this.material[c]));i.material=a}else i.material=s(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(t.animations,c))}}if(e){const a=o(t.geometries),c=o(t.materials),l=o(t.textures),h=o(t.images),u=o(t.shapes),d=o(t.skeletons),f=o(t.animations),m=o(t.nodes);a.length>0&&(n.geometries=a),c.length>0&&(n.materials=c),l.length>0&&(n.textures=l),h.length>0&&(n.images=h),u.length>0&&(n.shapes=u),d.length>0&&(n.skeletons=d),f.length>0&&(n.animations=f),m.length>0&&(n.nodes=m)}return n.object=i,n;function o(a){const c=[];for(const l in a){const h=a[l];delete h.metadata,c.push(h)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){const i=t.children[n];this.add(i.clone())}return this}}Bt.DEFAULT_UP=new C(0,1,0);Bt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Bt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Wi=new C,Fs=new C,Of=new C,ks=new C,ha=new C,ua=new C,sb=new C,Ff=new C,kf=new C,Nf=new C,Uf=new ie,Bf=new ie,zf=new ie;class un{constructor(t=new C,e=new C,n=new C){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),Wi.subVectors(t,e),i.cross(Wi);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(t,e,n,i,s){Wi.subVectors(i,e),Fs.subVectors(n,e),Of.subVectors(t,e);const o=Wi.dot(Wi),a=Wi.dot(Fs),c=Wi.dot(Of),l=Fs.dot(Fs),h=Fs.dot(Of),u=o*l-a*a;if(u===0)return s.set(0,0,0),null;const d=1/u,f=(l*c-a*h)*d,m=(o*h-a*c)*d;return s.set(1-f-m,m,f)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,ks)===null?!1:ks.x>=0&&ks.y>=0&&ks.x+ks.y<=1}static getInterpolation(t,e,n,i,s,o,a,c){return this.getBarycoord(t,e,n,i,ks)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,ks.x),c.addScaledVector(o,ks.y),c.addScaledVector(a,ks.z),c)}static getInterpolatedAttribute(t,e,n,i,s,o){return Uf.setScalar(0),Bf.setScalar(0),zf.setScalar(0),Uf.fromBufferAttribute(t,e),Bf.fromBufferAttribute(t,n),zf.fromBufferAttribute(t,i),o.setScalar(0),o.addScaledVector(Uf,s.x),o.addScaledVector(Bf,s.y),o.addScaledVector(zf,s.z),o}static isFrontFacing(t,e,n,i){return Wi.subVectors(n,e),Fs.subVectors(t,e),Wi.cross(Fs).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Wi.subVectors(this.c,this.b),Fs.subVectors(this.a,this.b),Wi.cross(Fs).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return un.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return un.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,i,s){return un.getInterpolation(t,this.a,this.b,this.c,e,n,i,s)}containsPoint(t){return un.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return un.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,s=this.c;let o,a;ha.subVectors(i,n),ua.subVectors(s,n),Ff.subVectors(t,n);const c=ha.dot(Ff),l=ua.dot(Ff);if(c<=0&&l<=0)return e.copy(n);kf.subVectors(t,i);const h=ha.dot(kf),u=ua.dot(kf);if(h>=0&&u<=h)return e.copy(i);const d=c*u-h*l;if(d<=0&&c>=0&&h<=0)return o=c/(c-h),e.copy(n).addScaledVector(ha,o);Nf.subVectors(t,s);const f=ha.dot(Nf),m=ua.dot(Nf);if(m>=0&&f<=m)return e.copy(s);const _=f*l-c*m;if(_<=0&&l>=0&&m<=0)return a=l/(l-m),e.copy(n).addScaledVector(ua,a);const g=h*m-f*u;if(g<=0&&u-h>=0&&f-m>=0)return sb.subVectors(s,i),a=(u-h)/(u-h+(f-m)),e.copy(i).addScaledVector(sb,a);const p=1/(g+_+d);return o=_*p,a=d*p,e.copy(n).addScaledVector(ha,o).addScaledVector(ua,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const tw={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},xr={h:0,s:0,l:0},Ch={h:0,s:0,l:0};function Vf(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}class pt{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=On){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ne.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=ne.workingColorSpace){return this.r=t,this.g=e,this.b=n,ne.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=ne.workingColorSpace){if(t=Kg(t,1),e=Ke(e,0,1),n=Ke(n,0,1),e===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+e):n+e-n*e,o=2*n-s;this.r=Vf(o,s,t+1/3),this.g=Vf(o,s,t),this.b=Vf(o,s,t-1/3)}return ne.toWorkingColorSpace(this,i),this}setStyle(t,e=On){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=On){const n=tw[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=tr(t.r),this.g=tr(t.g),this.b=tr(t.b),this}copyLinearToSRGB(t){return this.r=ec(t.r),this.g=ec(t.g),this.b=ec(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=On){return ne.fromWorkingColorSpace(xn.copy(this),t),Math.round(Ke(xn.r*255,0,255))*65536+Math.round(Ke(xn.g*255,0,255))*256+Math.round(Ke(xn.b*255,0,255))}getHexString(t=On){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ne.workingColorSpace){ne.fromWorkingColorSpace(xn.copy(this),e);const n=xn.r,i=xn.g,s=xn.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let c,l;const h=(a+o)/2;if(a===o)c=0,l=0;else{const u=o-a;switch(l=h<=.5?u/(o+a):u/(2-o-a),o){case n:c=(i-s)/u+(i<s?6:0);break;case i:c=(s-n)/u+2;break;case s:c=(n-i)/u+4;break}c/=6}return t.h=c,t.s=l,t.l=h,t}getRGB(t,e=ne.workingColorSpace){return ne.fromWorkingColorSpace(xn.copy(this),e),t.r=xn.r,t.g=xn.g,t.b=xn.b,t}getStyle(t=On){ne.fromWorkingColorSpace(xn.copy(this),t);const e=xn.r,n=xn.g,i=xn.b;return t!==On?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,e,n){return this.getHSL(xr),this.setHSL(xr.h+t,xr.s+e,xr.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(xr),t.getHSL(Ch);const n=El(xr.h,Ch.h,e),i=El(xr.s,Ch.s,e),s=El(xr.l,Ch.l,e);return this.setHSL(n,i,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,s=t.elements;return this.r=s[0]*e+s[3]*n+s[6]*i,this.g=s[1]*e+s[4]*n+s[7]*i,this.b=s[2]*e+s[5]*n+s[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const xn=new pt;pt.NAMES=tw;let qE=0,Hn=class extends Jr{static get type(){return"Material"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:qE++}),this.uuid=es(),this.name="",this.blending=Ja,this.side=Bi,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=rm,this.blendDst=om,this.blendEquation=So,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new pt(0,0,0),this.blendAlpha=0,this.depthFunc=uc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=V_,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=na,this.stencilZFail=na,this.stencilZPass=na,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const n=t[e];if(n===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Ja&&(n.blending=this.blending),this.side!==Bi&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==rm&&(n.blendSrc=this.blendSrc),this.blendDst!==om&&(n.blendDst=this.blendDst),this.blendEquation!==So&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==uc&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==V_&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==na&&(n.stencilFail=this.stencilFail),this.stencilZFail!==na&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==na&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const o=[];for(const a in s){const c=s[a];delete c.metadata,o.push(c)}return o}if(e){const s=i(t.textures),o=i(t.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(e!==null){const i=e.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=e[s].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}};class en extends Hn{static get type(){return"MeshBasicMaterial"}constructor(t){super(),this.isMeshBasicMaterial=!0,this.color=new pt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Me,this.combine=Hd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Ys=KE();function KE(){const r=new ArrayBuffer(4),t=new Float32Array(r),e=new Uint32Array(r),n=new Uint32Array(512),i=new Uint32Array(512);for(let c=0;c<256;++c){const l=c-127;l<-27?(n[c]=0,n[c|256]=32768,i[c]=24,i[c|256]=24):l<-14?(n[c]=1024>>-l-14,n[c|256]=1024>>-l-14|32768,i[c]=-l-1,i[c|256]=-l-1):l<=15?(n[c]=l+15<<10,n[c|256]=l+15<<10|32768,i[c]=13,i[c|256]=13):l<128?(n[c]=31744,n[c|256]=64512,i[c]=24,i[c|256]=24):(n[c]=31744,n[c|256]=64512,i[c]=13,i[c|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let c=1;c<1024;++c){let l=c<<13,h=0;for(;!(l&8388608);)l<<=1,h-=8388608;l&=-8388609,h+=947912704,s[c]=l|h}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(a[c]=1024);return{floatView:t,uint32View:e,baseTable:n,shiftTable:i,mantissaTable:s,exponentTable:o,offsetTable:a}}function ZE(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=Ke(r,-65504,65504),Ys.floatView[0]=r;const t=Ys.uint32View[0],e=t>>23&511;return Ys.baseTable[e]+((t&8388607)>>Ys.shiftTable[e])}function QE(r){const t=r>>10;return Ys.uint32View[0]=Ys.mantissaTable[Ys.offsetTable[t]+(r&1023)]+Ys.exponentTable[t],Ys.floatView[0]}const Ph={toHalfFloat:ZE,fromHalfFloat:QE},Qe=new C,Rh=new J;class Pe{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=Hm,this.updateRanges=[],this.gpuType=Tn,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)Rh.fromBufferAttribute(this,e),Rh.applyMatrix3(t),this.setXY(e,Rh.x,Rh.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)Qe.fromBufferAttribute(this,e),Qe.applyMatrix3(t),this.setXYZ(e,Qe.x,Qe.y,Qe.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Qe.fromBufferAttribute(this,e),Qe.applyMatrix4(t),this.setXYZ(e,Qe.x,Qe.y,Qe.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Qe.fromBufferAttribute(this,e),Qe.applyNormalMatrix(t),this.setXYZ(e,Qe.x,Qe.y,Qe.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Qe.fromBufferAttribute(this,e),Qe.transformDirection(t),this.setXYZ(e,Qe.x,Qe.y,Qe.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Qi(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=_e(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Qi(e,this.array)),e}setX(t,e){return this.normalized&&(e=_e(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Qi(e,this.array)),e}setY(t,e){return this.normalized&&(e=_e(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Qi(e,this.array)),e}setZ(t,e){return this.normalized&&(e=_e(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Qi(e,this.array)),e}setW(t,e){return this.normalized&&(e=_e(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=_e(e,this.array),n=_e(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=_e(e,this.array),n=_e(n,this.array),i=_e(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,s){return t*=this.itemSize,this.normalized&&(e=_e(e,this.array),n=_e(n,this.array),i=_e(i,this.array),s=_e(s,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Hm&&(t.usage=this.usage),t}}class Qg extends Pe{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class ew extends Pe{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class Ot extends Pe{constructor(t,e,n){super(new Float32Array(t),e,n)}}let $E=0;const Si=new lt,Hf=new Bt,da=new C,ci=new xe,Kc=new xe,hn=new C;class Qt extends Jr{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:$E++}),this.uuid=es(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Qx(t)?ew:Qg)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Gt().getNormalMatrix(t);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Si.makeRotationFromQuaternion(t),this.applyMatrix4(Si),this}rotateX(t){return Si.makeRotationX(t),this.applyMatrix4(Si),this}rotateY(t){return Si.makeRotationY(t),this.applyMatrix4(Si),this}rotateZ(t){return Si.makeRotationZ(t),this.applyMatrix4(Si),this}translate(t,e,n){return Si.makeTranslation(t,e,n),this.applyMatrix4(Si),this}scale(t,e,n){return Si.makeScale(t,e,n),this.applyMatrix4(Si),this}lookAt(t){return Hf.lookAt(t),Hf.updateMatrix(),this.applyMatrix4(Hf.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(da).negate(),this.translate(da.x,da.y,da.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const n=[];for(let i=0,s=t.length;i<s;i++){const o=t[i];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new Ot(n,3))}else{for(let n=0,i=e.count;n<i;n++){const s=t[n];e.setXYZ(n,s.x,s.y,s.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new xe);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new C(-1/0,-1/0,-1/0),new C(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){const s=e[n];ci.setFromBufferAttribute(s),this.morphTargetsRelative?(hn.addVectors(this.boundingBox.min,ci.min),this.boundingBox.expandByPoint(hn),hn.addVectors(this.boundingBox.max,ci.max),this.boundingBox.expandByPoint(hn)):(this.boundingBox.expandByPoint(ci.min),this.boundingBox.expandByPoint(ci.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new An);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new C,1/0);return}if(t){const n=this.boundingSphere.center;if(ci.setFromBufferAttribute(t),e)for(let s=0,o=e.length;s<o;s++){const a=e[s];Kc.setFromBufferAttribute(a),this.morphTargetsRelative?(hn.addVectors(ci.min,Kc.min),ci.expandByPoint(hn),hn.addVectors(ci.max,Kc.max),ci.expandByPoint(hn)):(ci.expandByPoint(Kc.min),ci.expandByPoint(Kc.max))}ci.getCenter(n);let i=0;for(let s=0,o=t.count;s<o;s++)hn.fromBufferAttribute(t,s),i=Math.max(i,n.distanceToSquared(hn));if(e)for(let s=0,o=e.length;s<o;s++){const a=e[s],c=this.morphTargetsRelative;for(let l=0,h=a.count;l<h;l++)hn.fromBufferAttribute(a,l),c&&(da.fromBufferAttribute(t,l),hn.add(da)),i=Math.max(i,n.distanceToSquared(hn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.position,i=e.normal,s=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Pe(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let E=0;E<n.count;E++)a[E]=new C,c[E]=new C;const l=new C,h=new C,u=new C,d=new J,f=new J,m=new J,_=new C,g=new C;function p(E,w,M){l.fromBufferAttribute(n,E),h.fromBufferAttribute(n,w),u.fromBufferAttribute(n,M),d.fromBufferAttribute(s,E),f.fromBufferAttribute(s,w),m.fromBufferAttribute(s,M),h.sub(l),u.sub(l),f.sub(d),m.sub(d);const P=1/(f.x*m.y-m.x*f.y);isFinite(P)&&(_.copy(h).multiplyScalar(m.y).addScaledVector(u,-f.y).multiplyScalar(P),g.copy(u).multiplyScalar(f.x).addScaledVector(h,-m.x).multiplyScalar(P),a[E].add(_),a[w].add(_),a[M].add(_),c[E].add(g),c[w].add(g),c[M].add(g))}let b=this.groups;b.length===0&&(b=[{start:0,count:t.count}]);for(let E=0,w=b.length;E<w;++E){const M=b[E],P=M.start,L=M.count;for(let I=P,F=P+L;I<F;I+=3)p(t.getX(I+0),t.getX(I+1),t.getX(I+2))}const y=new C,v=new C,x=new C,S=new C;function T(E){x.fromBufferAttribute(i,E),S.copy(x);const w=a[E];y.copy(w),y.sub(x.multiplyScalar(x.dot(w))).normalize(),v.crossVectors(S,w);const P=v.dot(c[E])<0?-1:1;o.setXYZW(E,y.x,y.y,y.z,P)}for(let E=0,w=b.length;E<w;++E){const M=b[E],P=M.start,L=M.count;for(let I=P,F=P+L;I<F;I+=3)T(t.getX(I+0)),T(t.getX(I+1)),T(t.getX(I+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Pe(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let d=0,f=n.count;d<f;d++)n.setXYZ(d,0,0,0);const i=new C,s=new C,o=new C,a=new C,c=new C,l=new C,h=new C,u=new C;if(t)for(let d=0,f=t.count;d<f;d+=3){const m=t.getX(d+0),_=t.getX(d+1),g=t.getX(d+2);i.fromBufferAttribute(e,m),s.fromBufferAttribute(e,_),o.fromBufferAttribute(e,g),h.subVectors(o,s),u.subVectors(i,s),h.cross(u),a.fromBufferAttribute(n,m),c.fromBufferAttribute(n,_),l.fromBufferAttribute(n,g),a.add(h),c.add(h),l.add(h),n.setXYZ(m,a.x,a.y,a.z),n.setXYZ(_,c.x,c.y,c.z),n.setXYZ(g,l.x,l.y,l.z)}else for(let d=0,f=e.count;d<f;d+=3)i.fromBufferAttribute(e,d+0),s.fromBufferAttribute(e,d+1),o.fromBufferAttribute(e,d+2),h.subVectors(o,s),u.subVectors(i,s),h.cross(u),n.setXYZ(d+0,h.x,h.y,h.z),n.setXYZ(d+1,h.x,h.y,h.z),n.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)hn.fromBufferAttribute(t,e),hn.normalize(),t.setXYZ(e,hn.x,hn.y,hn.z)}toNonIndexed(){function t(a,c){const l=a.array,h=a.itemSize,u=a.normalized,d=new l.constructor(c.length*h);let f=0,m=0;for(let _=0,g=c.length;_<g;_++){a.isInterleavedBufferAttribute?f=c[_]*a.data.stride+a.offset:f=c[_]*h;for(let p=0;p<h;p++)d[m++]=l[f++]}return new Pe(d,h,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Qt,n=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=t(c,n);e.setAttribute(a,l)}const s=this.morphAttributes;for(const a in s){const c=[],l=s[a];for(let h=0,u=l.length;h<u;h++){const d=l[h],f=t(d,n);c.push(f)}e.morphAttributes[a]=c}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(t[l]=c[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const c in n){const l=n[c];t.data.attributes[c]=l.toJSON(t.data)}const i={};let s=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],h=[];for(let u=0,d=l.length;u<d;u++){const f=l[u];h.push(f.toJSON(t.data))}h.length>0&&(i[c]=h,s=!0)}s&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone(e));const i=t.attributes;for(const l in i){const h=i[l];this.setAttribute(l,h.clone(e))}const s=t.morphAttributes;for(const l in s){const h=[],u=s[l];for(let d=0,f=u.length;d<f;d++)h.push(u[d].clone(e));this.morphAttributes[l]=h}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let l=0,h=o.length;l<h;l++){const u=o[l];this.addGroup(u.start,u.count,u.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const rb=new lt,co=new Ko,Dh=new An,ob=new C,Lh=new C,Ih=new C,Oh=new C,Gf=new C,Fh=new C,ab=new C,kh=new C;class ct extends Bt{constructor(t=new Qt,e=new en){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(s&&a){Fh.set(0,0,0);for(let c=0,l=s.length;c<l;c++){const h=a[c],u=s[c];h!==0&&(Gf.fromBufferAttribute(u,t),o?Fh.addScaledVector(Gf,h):Fh.addScaledVector(Gf.sub(e),h))}e.add(Fh)}return e}raycast(t,e){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Dh.copy(n.boundingSphere),Dh.applyMatrix4(s),co.copy(t.ray).recast(t.near),!(Dh.containsPoint(co.origin)===!1&&(co.intersectSphere(Dh,ob)===null||co.origin.distanceToSquared(ob)>(t.far-t.near)**2))&&(rb.copy(s).invert(),co.copy(t.ray).applyMatrix4(rb),!(n.boundingBox!==null&&co.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(t,e,co)))}_computeIntersections(t,e,n){let i;const s=this.geometry,o=this.material,a=s.index,c=s.attributes.position,l=s.attributes.uv,h=s.attributes.uv1,u=s.attributes.normal,d=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(o))for(let m=0,_=d.length;m<_;m++){const g=d[m],p=o[g.materialIndex],b=Math.max(g.start,f.start),y=Math.min(a.count,Math.min(g.start+g.count,f.start+f.count));for(let v=b,x=y;v<x;v+=3){const S=a.getX(v),T=a.getX(v+1),E=a.getX(v+2);i=Nh(this,p,t,n,l,h,u,S,T,E),i&&(i.faceIndex=Math.floor(v/3),i.face.materialIndex=g.materialIndex,e.push(i))}}else{const m=Math.max(0,f.start),_=Math.min(a.count,f.start+f.count);for(let g=m,p=_;g<p;g+=3){const b=a.getX(g),y=a.getX(g+1),v=a.getX(g+2);i=Nh(this,o,t,n,l,h,u,b,y,v),i&&(i.faceIndex=Math.floor(g/3),e.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let m=0,_=d.length;m<_;m++){const g=d[m],p=o[g.materialIndex],b=Math.max(g.start,f.start),y=Math.min(c.count,Math.min(g.start+g.count,f.start+f.count));for(let v=b,x=y;v<x;v+=3){const S=v,T=v+1,E=v+2;i=Nh(this,p,t,n,l,h,u,S,T,E),i&&(i.faceIndex=Math.floor(v/3),i.face.materialIndex=g.materialIndex,e.push(i))}}else{const m=Math.max(0,f.start),_=Math.min(c.count,f.start+f.count);for(let g=m,p=_;g<p;g+=3){const b=g,y=g+1,v=g+2;i=Nh(this,o,t,n,l,h,u,b,y,v),i&&(i.faceIndex=Math.floor(g/3),e.push(i))}}}}function JE(r,t,e,n,i,s,o,a){let c;if(t.side===Vn?c=n.intersectTriangle(o,s,i,!0,a):c=n.intersectTriangle(i,s,o,t.side===Bi,a),c===null)return null;kh.copy(a),kh.applyMatrix4(r.matrixWorld);const l=e.ray.origin.distanceTo(kh);return l<e.near||l>e.far?null:{distance:l,point:kh.clone(),object:r}}function Nh(r,t,e,n,i,s,o,a,c,l){r.getVertexPosition(a,Lh),r.getVertexPosition(c,Ih),r.getVertexPosition(l,Oh);const h=JE(r,t,e,n,Lh,Ih,Oh,ab);if(h){const u=new C;un.getBarycoord(ab,Lh,Ih,Oh,u),i&&(h.uv=un.getInterpolatedAttribute(i,a,c,l,u,new J)),s&&(h.uv1=un.getInterpolatedAttribute(s,a,c,l,u,new J)),o&&(h.normal=un.getInterpolatedAttribute(o,a,c,l,u,new C),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const d={a,b:c,c:l,normal:new C,materialIndex:0};un.getNormal(Lh,Ih,Oh,d.normal),h.face=d,h.barycoord=u}return h}class Fn extends Qt{constructor(t=1,e=1,n=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],l=[],h=[],u=[];let d=0,f=0;m("z","y","x",-1,-1,n,e,t,o,s,0),m("z","y","x",1,-1,n,e,-t,o,s,1),m("x","z","y",1,1,t,n,e,i,o,2),m("x","z","y",1,-1,t,n,-e,i,o,3),m("x","y","z",1,-1,t,e,n,i,s,4),m("x","y","z",-1,-1,t,e,-n,i,s,5),this.setIndex(c),this.setAttribute("position",new Ot(l,3)),this.setAttribute("normal",new Ot(h,3)),this.setAttribute("uv",new Ot(u,2));function m(_,g,p,b,y,v,x,S,T,E,w){const M=v/T,P=x/E,L=v/2,I=x/2,F=S/2,z=T+1,N=E+1;let Z=0,j=0;const et=new C;for(let tt=0;tt<N;tt++){const at=tt*P-I;for(let dt=0;dt<z;dt++){const St=dt*M-L;et[_]=St*b,et[g]=at*y,et[p]=F,l.push(et.x,et.y,et.z),et[_]=0,et[g]=0,et[p]=S>0?1:-1,h.push(et.x,et.y,et.z),u.push(dt/T),u.push(1-tt/E),Z+=1}}for(let tt=0;tt<E;tt++)for(let at=0;at<T;at++){const dt=d+at+z*tt,St=d+at+z*(tt+1),O=d+(at+1)+z*(tt+1),it=d+(at+1)+z*tt;c.push(dt,St,it),c.push(St,O,it),j+=6}a.addGroup(f,j,w),f+=j,d+=Z}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Fn(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function vc(r){const t={};for(const e in r){t[e]={};for(const n in r[e]){const i=r[e][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][n]=null):t[e][n]=i.clone():Array.isArray(i)?t[e][n]=i.slice():t[e][n]=i}}return t}function Dn(r){const t={};for(let e=0;e<r.length;e++){const n=vc(r[e]);for(const i in n)t[i]=n[i]}return t}function t1(r){const t=[];for(let e=0;e<r.length;e++)t.push(r[e].clone());return t}function nw(r){const t=r.getRenderTarget();return t===null?r.outputColorSpace:t.isXRRenderTarget===!0?t.texture.colorSpace:ne.workingColorSpace}const e1={clone:vc,merge:Dn};var n1=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,i1=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ws extends Hn{static get type(){return"ShaderMaterial"}constructor(t){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=n1,this.fragmentShader=i1,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=vc(t.uniforms),this.uniformsGroups=t1(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?e.uniforms[i]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?e.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?e.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?e.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?e.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?e.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?e.uniforms[i]={type:"m4",value:o.toArray()}:e.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}class $g extends Bt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new lt,this.projectionMatrix=new lt,this.projectionMatrixInverse=new lt,this.coordinateSystem=Zs}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const wr=new C,cb=new J,lb=new J;class rn extends $g{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=yc*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Tl*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return yc*2*Math.atan(Math.tan(Tl*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){wr.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(wr.x,wr.y).multiplyScalar(-t/wr.z),wr.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(wr.x,wr.y).multiplyScalar(-t/wr.z)}getViewSize(t,e){return this.getViewBounds(t,cb,lb),e.subVectors(lb,cb)}setViewOffset(t,e,n,i,s,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(Tl*.5*this.fov)/this.zoom,n=2*e,i=this.aspect*n,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;s+=o.offsetX*i/c,e-=o.offsetY*n/l,i*=o.width/c,n*=o.height/l}const a=this.filmOffset;a!==0&&(s+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const fa=-90,pa=1;class s1 extends Bt{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new rn(fa,pa,t,e);i.layers=this.layers,this.add(i);const s=new rn(fa,pa,t,e);s.layers=this.layers,this.add(s);const o=new rn(fa,pa,t,e);o.layers=this.layers,this.add(o);const a=new rn(fa,pa,t,e);a.layers=this.layers,this.add(a);const c=new rn(fa,pa,t,e);c.layers=this.layers,this.add(c);const l=new rn(fa,pa,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,s,o,a,c]=e;for(const l of e)this.remove(l);if(t===Zs)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(t===md)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const l of e)this.add(l),l.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,c,l,h]=this.children,u=t.getRenderTarget(),d=t.getActiveCubeFace(),f=t.getActiveMipmapLevel(),m=t.xr.enabled;t.xr.enabled=!1;const _=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0,i),t.render(e,s),t.setRenderTarget(n,1,i),t.render(e,o),t.setRenderTarget(n,2,i),t.render(e,a),t.setRenderTarget(n,3,i),t.render(e,c),t.setRenderTarget(n,4,i),t.render(e,l),n.texture.generateMipmaps=_,t.setRenderTarget(n,5,i),t.render(e,h),t.setRenderTarget(u,d,f),t.xr.enabled=m,n.texture.needsPMREMUpdate=!0}}class iw extends Ie{constructor(t,e,n,i,s,o,a,c,l,h){t=t!==void 0?t:[],e=e!==void 0?e:dc,super(t,e,n,i,s,o,a,c,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class r1 extends Bo{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new iw(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:dn}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Fn(5,5,5),s=new ws({name:"CubemapFromEquirect",uniforms:vc(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Vn,blending:Vr});s.uniforms.tEquirect.value=e;const o=new ct(i,s),a=e.minFilter;return e.minFilter===Ji&&(e.minFilter=dn),new s1(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,n,i){const s=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,n,i);t.setRenderTarget(s)}}const jf=new C,o1=new C,a1=new Gt;class kn{constructor(t=new C(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=jf.subVectors(n,e).cross(o1.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(jf),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:e.copy(t.start).addScaledVector(n,s)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||a1.getNormalMatrix(t),i=this.coplanarPoint(jf).applyMatrix4(t),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const lo=new An,Uh=new C;class Yd{constructor(t=new kn,e=new kn,n=new kn,i=new kn,s=new kn,o=new kn){this.planes=[t,e,n,i,s,o]}set(t,e,n,i,s,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=Zs){const n=this.planes,i=t.elements,s=i[0],o=i[1],a=i[2],c=i[3],l=i[4],h=i[5],u=i[6],d=i[7],f=i[8],m=i[9],_=i[10],g=i[11],p=i[12],b=i[13],y=i[14],v=i[15];if(n[0].setComponents(c-s,d-l,g-f,v-p).normalize(),n[1].setComponents(c+s,d+l,g+f,v+p).normalize(),n[2].setComponents(c+o,d+h,g+m,v+b).normalize(),n[3].setComponents(c-o,d-h,g-m,v-b).normalize(),n[4].setComponents(c-a,d-u,g-_,v-y).normalize(),e===Zs)n[5].setComponents(c+a,d+u,g+_,v+y).normalize();else if(e===md)n[5].setComponents(a,u,_,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),lo.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),lo.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(lo)}intersectsSprite(t){return lo.center.set(0,0,0),lo.radius=.7071067811865476,lo.applyMatrix4(t.matrixWorld),this.intersectsSphere(lo)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let s=0;s<6;s++)if(e[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(Uh.x=i.normal.x>0?t.max.x:t.min.x,Uh.y=i.normal.y>0?t.max.y:t.min.y,Uh.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Uh)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function sw(){let r=null,t=!1,e=null,n=null;function i(s,o){e(s,o),n=r.requestAnimationFrame(i)}return{start:function(){t!==!0&&e!==null&&(n=r.requestAnimationFrame(i),t=!0)},stop:function(){r.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(s){e=s},setContext:function(s){r=s}}}function c1(r){const t=new WeakMap;function e(a,c){const l=a.array,h=a.usage,u=l.byteLength,d=r.createBuffer();r.bindBuffer(c,d),r.bufferData(c,l,h),a.onUploadCallback();let f;if(l instanceof Float32Array)f=r.FLOAT;else if(l instanceof Uint16Array)a.isFloat16BufferAttribute?f=r.HALF_FLOAT:f=r.UNSIGNED_SHORT;else if(l instanceof Int16Array)f=r.SHORT;else if(l instanceof Uint32Array)f=r.UNSIGNED_INT;else if(l instanceof Int32Array)f=r.INT;else if(l instanceof Int8Array)f=r.BYTE;else if(l instanceof Uint8Array)f=r.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)f=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:d,type:f,bytesPerElement:l.BYTES_PER_ELEMENT,version:a.version,size:u}}function n(a,c,l){const h=c.array,u=c.updateRanges;if(r.bindBuffer(l,a),u.length===0)r.bufferSubData(l,0,h);else{u.sort((f,m)=>f.start-m.start);let d=0;for(let f=1;f<u.length;f++){const m=u[d],_=u[f];_.start<=m.start+m.count+1?m.count=Math.max(m.count,_.start+_.count-m.start):(++d,u[d]=_)}u.length=d+1;for(let f=0,m=u.length;f<m;f++){const _=u[f];r.bufferSubData(l,_.start*h.BYTES_PER_ELEMENT,h,_.start,_.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),t.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=t.get(a);c&&(r.deleteBuffer(c.buffer),t.delete(a))}function o(a,c){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const h=t.get(a);(!h||h.version<a.version)&&t.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const l=t.get(a);if(l===void 0)t.set(a,e(a,c));else if(l.version<a.version){if(l.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(l.buffer,a,c),l.version=a.version}}return{get:i,remove:s,update:o}}class Nn extends Qt{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const s=t/2,o=e/2,a=Math.floor(n),c=Math.floor(i),l=a+1,h=c+1,u=t/a,d=e/c,f=[],m=[],_=[],g=[];for(let p=0;p<h;p++){const b=p*d-o;for(let y=0;y<l;y++){const v=y*u-s;m.push(v,-b,0),_.push(0,0,1),g.push(y/a),g.push(1-p/c)}}for(let p=0;p<c;p++)for(let b=0;b<a;b++){const y=b+l*p,v=b+l*(p+1),x=b+1+l*(p+1),S=b+1+l*p;f.push(y,v,S),f.push(v,x,S)}this.setIndex(f),this.setAttribute("position",new Ot(m,3)),this.setAttribute("normal",new Ot(_,3)),this.setAttribute("uv",new Ot(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Nn(t.width,t.height,t.widthSegments,t.heightSegments)}}var l1=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,h1=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,u1=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,d1=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,f1=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,p1=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,m1=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,g1=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,_1=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,b1=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,y1=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,v1=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,x1=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,w1=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,S1=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,M1=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,T1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,E1=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,A1=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,C1=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,P1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,R1=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,D1=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,L1=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,I1=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,O1=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,F1=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,k1=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,N1=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,U1=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,B1="gl_FragColor = linearToOutputTexel( gl_FragColor );",z1=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,V1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,H1=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,G1=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,j1=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,W1=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,X1=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Y1=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,q1=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,K1=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Z1=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Q1=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,$1=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,J1=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,tA=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,eA=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,nA=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,iA=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,sA=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,rA=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,oA=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,aA=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,cA=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lA=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,hA=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,uA=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,dA=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,fA=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,pA=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,mA=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,gA=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,_A=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,bA=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,yA=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,vA=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,xA=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,wA=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,SA=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,MA=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,TA=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,EA=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,AA=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,CA=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,PA=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,RA=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,DA=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,LA=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,IA=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,OA=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,FA=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,kA=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,NA=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,UA=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,BA=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,zA=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,VA=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,HA=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,GA=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,jA=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,WA=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,XA=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,YA=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,qA=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,KA=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,ZA=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,QA=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,$A=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,JA=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tC=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,eC=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,nC=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,iC=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,sC=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,rC=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,oC=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,aC=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const cC=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,lC=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,hC=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,uC=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dC=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fC=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,pC=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,mC=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,gC=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,_C=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,bC=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,yC=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vC=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xC=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,wC=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,SC=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MC=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,TC=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EC=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,AC=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CC=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,PC=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,RC=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,DC=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,LC=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,IC=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OC=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FC=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kC=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,NC=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,UC=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,BC=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,zC=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,VC=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,qt={alphahash_fragment:l1,alphahash_pars_fragment:h1,alphamap_fragment:u1,alphamap_pars_fragment:d1,alphatest_fragment:f1,alphatest_pars_fragment:p1,aomap_fragment:m1,aomap_pars_fragment:g1,batching_pars_vertex:_1,batching_vertex:b1,begin_vertex:y1,beginnormal_vertex:v1,bsdfs:x1,iridescence_fragment:w1,bumpmap_pars_fragment:S1,clipping_planes_fragment:M1,clipping_planes_pars_fragment:T1,clipping_planes_pars_vertex:E1,clipping_planes_vertex:A1,color_fragment:C1,color_pars_fragment:P1,color_pars_vertex:R1,color_vertex:D1,common:L1,cube_uv_reflection_fragment:I1,defaultnormal_vertex:O1,displacementmap_pars_vertex:F1,displacementmap_vertex:k1,emissivemap_fragment:N1,emissivemap_pars_fragment:U1,colorspace_fragment:B1,colorspace_pars_fragment:z1,envmap_fragment:V1,envmap_common_pars_fragment:H1,envmap_pars_fragment:G1,envmap_pars_vertex:j1,envmap_physical_pars_fragment:eA,envmap_vertex:W1,fog_vertex:X1,fog_pars_vertex:Y1,fog_fragment:q1,fog_pars_fragment:K1,gradientmap_pars_fragment:Z1,lightmap_pars_fragment:Q1,lights_lambert_fragment:$1,lights_lambert_pars_fragment:J1,lights_pars_begin:tA,lights_toon_fragment:nA,lights_toon_pars_fragment:iA,lights_phong_fragment:sA,lights_phong_pars_fragment:rA,lights_physical_fragment:oA,lights_physical_pars_fragment:aA,lights_fragment_begin:cA,lights_fragment_maps:lA,lights_fragment_end:hA,logdepthbuf_fragment:uA,logdepthbuf_pars_fragment:dA,logdepthbuf_pars_vertex:fA,logdepthbuf_vertex:pA,map_fragment:mA,map_pars_fragment:gA,map_particle_fragment:_A,map_particle_pars_fragment:bA,metalnessmap_fragment:yA,metalnessmap_pars_fragment:vA,morphinstance_vertex:xA,morphcolor_vertex:wA,morphnormal_vertex:SA,morphtarget_pars_vertex:MA,morphtarget_vertex:TA,normal_fragment_begin:EA,normal_fragment_maps:AA,normal_pars_fragment:CA,normal_pars_vertex:PA,normal_vertex:RA,normalmap_pars_fragment:DA,clearcoat_normal_fragment_begin:LA,clearcoat_normal_fragment_maps:IA,clearcoat_pars_fragment:OA,iridescence_pars_fragment:FA,opaque_fragment:kA,packing:NA,premultiplied_alpha_fragment:UA,project_vertex:BA,dithering_fragment:zA,dithering_pars_fragment:VA,roughnessmap_fragment:HA,roughnessmap_pars_fragment:GA,shadowmap_pars_fragment:jA,shadowmap_pars_vertex:WA,shadowmap_vertex:XA,shadowmask_pars_fragment:YA,skinbase_vertex:qA,skinning_pars_vertex:KA,skinning_vertex:ZA,skinnormal_vertex:QA,specularmap_fragment:$A,specularmap_pars_fragment:JA,tonemapping_fragment:tC,tonemapping_pars_fragment:eC,transmission_fragment:nC,transmission_pars_fragment:iC,uv_pars_fragment:sC,uv_pars_vertex:rC,uv_vertex:oC,worldpos_vertex:aC,background_vert:cC,background_frag:lC,backgroundCube_vert:hC,backgroundCube_frag:uC,cube_vert:dC,cube_frag:fC,depth_vert:pC,depth_frag:mC,distanceRGBA_vert:gC,distanceRGBA_frag:_C,equirect_vert:bC,equirect_frag:yC,linedashed_vert:vC,linedashed_frag:xC,meshbasic_vert:wC,meshbasic_frag:SC,meshlambert_vert:MC,meshlambert_frag:TC,meshmatcap_vert:EC,meshmatcap_frag:AC,meshnormal_vert:CC,meshnormal_frag:PC,meshphong_vert:RC,meshphong_frag:DC,meshphysical_vert:LC,meshphysical_frag:IC,meshtoon_vert:OC,meshtoon_frag:FC,points_vert:kC,points_frag:NC,shadow_vert:UC,shadow_frag:BC,sprite_vert:zC,sprite_frag:VC},gt={common:{diffuse:{value:new pt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Gt},alphaMap:{value:null},alphaMapTransform:{value:new Gt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Gt}},envmap:{envMap:{value:null},envMapRotation:{value:new Gt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Gt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Gt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Gt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Gt},normalScale:{value:new J(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Gt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Gt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Gt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Gt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new pt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new pt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Gt},alphaTest:{value:0},uvTransform:{value:new Gt}},sprite:{diffuse:{value:new pt(16777215)},opacity:{value:1},center:{value:new J(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Gt},alphaMap:{value:null},alphaMapTransform:{value:new Gt},alphaTest:{value:0}}},us={basic:{uniforms:Dn([gt.common,gt.specularmap,gt.envmap,gt.aomap,gt.lightmap,gt.fog]),vertexShader:qt.meshbasic_vert,fragmentShader:qt.meshbasic_frag},lambert:{uniforms:Dn([gt.common,gt.specularmap,gt.envmap,gt.aomap,gt.lightmap,gt.emissivemap,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.fog,gt.lights,{emissive:{value:new pt(0)}}]),vertexShader:qt.meshlambert_vert,fragmentShader:qt.meshlambert_frag},phong:{uniforms:Dn([gt.common,gt.specularmap,gt.envmap,gt.aomap,gt.lightmap,gt.emissivemap,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.fog,gt.lights,{emissive:{value:new pt(0)},specular:{value:new pt(1118481)},shininess:{value:30}}]),vertexShader:qt.meshphong_vert,fragmentShader:qt.meshphong_frag},standard:{uniforms:Dn([gt.common,gt.envmap,gt.aomap,gt.lightmap,gt.emissivemap,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.roughnessmap,gt.metalnessmap,gt.fog,gt.lights,{emissive:{value:new pt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:qt.meshphysical_vert,fragmentShader:qt.meshphysical_frag},toon:{uniforms:Dn([gt.common,gt.aomap,gt.lightmap,gt.emissivemap,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.gradientmap,gt.fog,gt.lights,{emissive:{value:new pt(0)}}]),vertexShader:qt.meshtoon_vert,fragmentShader:qt.meshtoon_frag},matcap:{uniforms:Dn([gt.common,gt.bumpmap,gt.normalmap,gt.displacementmap,gt.fog,{matcap:{value:null}}]),vertexShader:qt.meshmatcap_vert,fragmentShader:qt.meshmatcap_frag},points:{uniforms:Dn([gt.points,gt.fog]),vertexShader:qt.points_vert,fragmentShader:qt.points_frag},dashed:{uniforms:Dn([gt.common,gt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:qt.linedashed_vert,fragmentShader:qt.linedashed_frag},depth:{uniforms:Dn([gt.common,gt.displacementmap]),vertexShader:qt.depth_vert,fragmentShader:qt.depth_frag},normal:{uniforms:Dn([gt.common,gt.bumpmap,gt.normalmap,gt.displacementmap,{opacity:{value:1}}]),vertexShader:qt.meshnormal_vert,fragmentShader:qt.meshnormal_frag},sprite:{uniforms:Dn([gt.sprite,gt.fog]),vertexShader:qt.sprite_vert,fragmentShader:qt.sprite_frag},background:{uniforms:{uvTransform:{value:new Gt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:qt.background_vert,fragmentShader:qt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Gt}},vertexShader:qt.backgroundCube_vert,fragmentShader:qt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:qt.cube_vert,fragmentShader:qt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:qt.equirect_vert,fragmentShader:qt.equirect_frag},distanceRGBA:{uniforms:Dn([gt.common,gt.displacementmap,{referencePosition:{value:new C},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:qt.distanceRGBA_vert,fragmentShader:qt.distanceRGBA_frag},shadow:{uniforms:Dn([gt.lights,gt.fog,{color:{value:new pt(0)},opacity:{value:1}}]),vertexShader:qt.shadow_vert,fragmentShader:qt.shadow_frag}};us.physical={uniforms:Dn([us.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Gt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Gt},clearcoatNormalScale:{value:new J(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Gt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Gt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Gt},sheen:{value:0},sheenColor:{value:new pt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Gt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Gt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Gt},transmissionSamplerSize:{value:new J},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Gt},attenuationDistance:{value:0},attenuationColor:{value:new pt(0)},specularColor:{value:new pt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Gt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Gt},anisotropyVector:{value:new J},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Gt}}]),vertexShader:qt.meshphysical_vert,fragmentShader:qt.meshphysical_frag};const Bh={r:0,b:0,g:0},ho=new Me,HC=new lt;function GC(r,t,e,n,i,s,o){const a=new pt(0);let c=s===!0?0:1,l,h,u=null,d=0,f=null;function m(b){let y=b.isScene===!0?b.background:null;return y&&y.isTexture&&(y=(b.backgroundBlurriness>0?e:t).get(y)),y}function _(b){let y=!1;const v=m(b);v===null?p(a,c):v&&v.isColor&&(p(v,1),y=!0);const x=r.xr.getEnvironmentBlendMode();x==="additive"?n.buffers.color.setClear(0,0,0,1,o):x==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(r.autoClear||y)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function g(b,y){const v=m(y);v&&(v.isCubeTexture||v.mapping===Gd)?(h===void 0&&(h=new ct(new Fn(1,1,1),new ws({name:"BackgroundCubeMaterial",uniforms:vc(us.backgroundCube.uniforms),vertexShader:us.backgroundCube.vertexShader,fragmentShader:us.backgroundCube.fragmentShader,side:Vn,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(x,S,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),ho.copy(y.backgroundRotation),ho.x*=-1,ho.y*=-1,ho.z*=-1,v.isCubeTexture&&v.isRenderTargetTexture===!1&&(ho.y*=-1,ho.z*=-1),h.material.uniforms.envMap.value=v,h.material.uniforms.flipEnvMap.value=v.isCubeTexture&&v.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(HC.makeRotationFromEuler(ho)),h.material.toneMapped=ne.getTransfer(v.colorSpace)!==be,(u!==v||d!==v.version||f!==r.toneMapping)&&(h.material.needsUpdate=!0,u=v,d=v.version,f=r.toneMapping),h.layers.enableAll(),b.unshift(h,h.geometry,h.material,0,0,null)):v&&v.isTexture&&(l===void 0&&(l=new ct(new Nn(2,2),new ws({name:"BackgroundMaterial",uniforms:vc(us.background.uniforms),vertexShader:us.background.vertexShader,fragmentShader:us.background.fragmentShader,side:Bi,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=v,l.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,l.material.toneMapped=ne.getTransfer(v.colorSpace)!==be,v.matrixAutoUpdate===!0&&v.updateMatrix(),l.material.uniforms.uvTransform.value.copy(v.matrix),(u!==v||d!==v.version||f!==r.toneMapping)&&(l.material.needsUpdate=!0,u=v,d=v.version,f=r.toneMapping),l.layers.enableAll(),b.unshift(l,l.geometry,l.material,0,0,null))}function p(b,y){b.getRGB(Bh,nw(r)),n.buffers.color.setClear(Bh.r,Bh.g,Bh.b,y,o)}return{getClearColor:function(){return a},setClearColor:function(b,y=1){a.set(b),c=y,p(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(b){c=b,p(a,c)},render:_,addToRenderList:g}}function jC(r,t){const e=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},i=d(null);let s=i,o=!1;function a(M,P,L,I,F){let z=!1;const N=u(I,L,P);s!==N&&(s=N,l(s.object)),z=f(M,I,L,F),z&&m(M,I,L,F),F!==null&&t.update(F,r.ELEMENT_ARRAY_BUFFER),(z||o)&&(o=!1,v(M,P,L,I),F!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.get(F).buffer))}function c(){return r.createVertexArray()}function l(M){return r.bindVertexArray(M)}function h(M){return r.deleteVertexArray(M)}function u(M,P,L){const I=L.wireframe===!0;let F=n[M.id];F===void 0&&(F={},n[M.id]=F);let z=F[P.id];z===void 0&&(z={},F[P.id]=z);let N=z[I];return N===void 0&&(N=d(c()),z[I]=N),N}function d(M){const P=[],L=[],I=[];for(let F=0;F<e;F++)P[F]=0,L[F]=0,I[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:L,attributeDivisors:I,object:M,attributes:{},index:null}}function f(M,P,L,I){const F=s.attributes,z=P.attributes;let N=0;const Z=L.getAttributes();for(const j in Z)if(Z[j].location>=0){const tt=F[j];let at=z[j];if(at===void 0&&(j==="instanceMatrix"&&M.instanceMatrix&&(at=M.instanceMatrix),j==="instanceColor"&&M.instanceColor&&(at=M.instanceColor)),tt===void 0||tt.attribute!==at||at&&tt.data!==at.data)return!0;N++}return s.attributesNum!==N||s.index!==I}function m(M,P,L,I){const F={},z=P.attributes;let N=0;const Z=L.getAttributes();for(const j in Z)if(Z[j].location>=0){let tt=z[j];tt===void 0&&(j==="instanceMatrix"&&M.instanceMatrix&&(tt=M.instanceMatrix),j==="instanceColor"&&M.instanceColor&&(tt=M.instanceColor));const at={};at.attribute=tt,tt&&tt.data&&(at.data=tt.data),F[j]=at,N++}s.attributes=F,s.attributesNum=N,s.index=I}function _(){const M=s.newAttributes;for(let P=0,L=M.length;P<L;P++)M[P]=0}function g(M){p(M,0)}function p(M,P){const L=s.newAttributes,I=s.enabledAttributes,F=s.attributeDivisors;L[M]=1,I[M]===0&&(r.enableVertexAttribArray(M),I[M]=1),F[M]!==P&&(r.vertexAttribDivisor(M,P),F[M]=P)}function b(){const M=s.newAttributes,P=s.enabledAttributes;for(let L=0,I=P.length;L<I;L++)P[L]!==M[L]&&(r.disableVertexAttribArray(L),P[L]=0)}function y(M,P,L,I,F,z,N){N===!0?r.vertexAttribIPointer(M,P,L,F,z):r.vertexAttribPointer(M,P,L,I,F,z)}function v(M,P,L,I){_();const F=I.attributes,z=L.getAttributes(),N=P.defaultAttributeValues;for(const Z in z){const j=z[Z];if(j.location>=0){let et=F[Z];if(et===void 0&&(Z==="instanceMatrix"&&M.instanceMatrix&&(et=M.instanceMatrix),Z==="instanceColor"&&M.instanceColor&&(et=M.instanceColor)),et!==void 0){const tt=et.normalized,at=et.itemSize,dt=t.get(et);if(dt===void 0)continue;const St=dt.buffer,O=dt.type,it=dt.bytesPerElement,mt=O===r.INT||O===r.UNSIGNED_INT||et.gpuType===Hg;if(et.isInterleavedBufferAttribute){const ht=et.data,It=ht.stride,kt=et.offset;if(ht.isInstancedInterleavedBuffer){for(let zt=0;zt<j.locationSize;zt++)p(j.location+zt,ht.meshPerAttribute);M.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=ht.meshPerAttribute*ht.count)}else for(let zt=0;zt<j.locationSize;zt++)g(j.location+zt);r.bindBuffer(r.ARRAY_BUFFER,St);for(let zt=0;zt<j.locationSize;zt++)y(j.location+zt,at/j.locationSize,O,tt,It*it,(kt+at/j.locationSize*zt)*it,mt)}else{if(et.isInstancedBufferAttribute){for(let ht=0;ht<j.locationSize;ht++)p(j.location+ht,et.meshPerAttribute);M.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=et.meshPerAttribute*et.count)}else for(let ht=0;ht<j.locationSize;ht++)g(j.location+ht);r.bindBuffer(r.ARRAY_BUFFER,St);for(let ht=0;ht<j.locationSize;ht++)y(j.location+ht,at/j.locationSize,O,tt,at*it,at/j.locationSize*ht*it,mt)}}else if(N!==void 0){const tt=N[Z];if(tt!==void 0)switch(tt.length){case 2:r.vertexAttrib2fv(j.location,tt);break;case 3:r.vertexAttrib3fv(j.location,tt);break;case 4:r.vertexAttrib4fv(j.location,tt);break;default:r.vertexAttrib1fv(j.location,tt)}}}}b()}function x(){E();for(const M in n){const P=n[M];for(const L in P){const I=P[L];for(const F in I)h(I[F].object),delete I[F];delete P[L]}delete n[M]}}function S(M){if(n[M.id]===void 0)return;const P=n[M.id];for(const L in P){const I=P[L];for(const F in I)h(I[F].object),delete I[F];delete P[L]}delete n[M.id]}function T(M){for(const P in n){const L=n[P];if(L[M.id]===void 0)continue;const I=L[M.id];for(const F in I)h(I[F].object),delete I[F];delete L[M.id]}}function E(){w(),o=!0,s!==i&&(s=i,l(s.object))}function w(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:E,resetDefaultState:w,dispose:x,releaseStatesOfGeometry:S,releaseStatesOfProgram:T,initAttributes:_,enableAttribute:g,disableUnusedAttributes:b}}function WC(r,t,e){let n;function i(l){n=l}function s(l,h){r.drawArrays(n,l,h),e.update(h,n,1)}function o(l,h,u){u!==0&&(r.drawArraysInstanced(n,l,h,u),e.update(h,n,u))}function a(l,h,u){if(u===0)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,l,0,h,0,u);let f=0;for(let m=0;m<u;m++)f+=h[m];e.update(f,n,1)}function c(l,h,u,d){if(u===0)return;const f=t.get("WEBGL_multi_draw");if(f===null)for(let m=0;m<l.length;m++)o(l[m],h[m],d[m]);else{f.multiDrawArraysInstancedWEBGL(n,l,0,h,0,d,0,u);let m=0;for(let _=0;_<u;_++)m+=h[_]*d[_];e.update(m,n,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function XC(r,t,e,n){let i;function s(){if(i!==void 0)return i;if(t.has("EXT_texture_filter_anisotropic")===!0){const T=t.get("EXT_texture_filter_anisotropic");i=r.getParameter(T.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(T){return!(T!==zn&&n.convert(T)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(T){const E=T===Ks&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(T!==or&&n.convert(T)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&T!==Tn&&!E)}function c(T){if(T==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";T="mediump"}return T==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=e.precision!==void 0?e.precision:"highp";const h=c(l);h!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",h,"instead."),l=h);const u=e.logarithmicDepthBuffer===!0,d=e.reverseDepthBuffer===!0&&t.has("EXT_clip_control"),f=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),m=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=r.getParameter(r.MAX_TEXTURE_SIZE),g=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),p=r.getParameter(r.MAX_VERTEX_ATTRIBS),b=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),y=r.getParameter(r.MAX_VARYING_VECTORS),v=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),x=m>0,S=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:a,precision:l,logarithmicDepthBuffer:u,reverseDepthBuffer:d,maxTextures:f,maxVertexTextures:m,maxTextureSize:_,maxCubemapSize:g,maxAttributes:p,maxVertexUniforms:b,maxVaryings:y,maxFragmentUniforms:v,vertexTextures:x,maxSamples:S}}function YC(r){const t=this;let e=null,n=0,i=!1,s=!1;const o=new kn,a=new Gt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(u,d){const f=u.length!==0||d||n!==0||i;return i=d,n=u.length,f},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(u,d){e=h(u,d,0)},this.setState=function(u,d,f){const m=u.clippingPlanes,_=u.clipIntersection,g=u.clipShadows,p=r.get(u);if(!i||m===null||m.length===0||s&&!g)s?h(null):l();else{const b=s?0:n,y=b*4;let v=p.clippingState||null;c.value=v,v=h(m,d,y,f);for(let x=0;x!==y;++x)v[x]=e[x];p.clippingState=v,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=b}};function l(){c.value!==e&&(c.value=e,c.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(u,d,f,m){const _=u!==null?u.length:0;let g=null;if(_!==0){if(g=c.value,m!==!0||g===null){const p=f+_*4,b=d.matrixWorldInverse;a.getNormalMatrix(b),(g===null||g.length<p)&&(g=new Float32Array(p));for(let y=0,v=f;y!==_;++y,v+=4)o.copy(u[y]).applyMatrix4(b,a),o.normal.toArray(g,v),g[v+3]=o.constant}c.value=g,c.needsUpdate=!0}return t.numPlanes=_,t.numIntersection=0,g}}function qC(r){let t=new WeakMap;function e(o,a){return a===pc?o.mapping=dc:a===pm&&(o.mapping=fc),o}function n(o){if(o&&o.isTexture){const a=o.mapping;if(a===pc||a===pm)if(t.has(o)){const c=t.get(o).texture;return e(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const l=new r1(c.height);return l.fromEquirectangularTexture(r,o),t.set(o,l),o.addEventListener("dispose",i),e(l.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const c=t.get(a);c!==void 0&&(t.delete(a),c.dispose())}function s(){t=new WeakMap}return{get:n,dispose:s}}class ch extends $g{constructor(t=-1,e=1,n=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-t,o=n+t,a=i+e,c=i-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=l*this.view.offsetX,o=s+l*this.view.width,a-=h*this.view.offsetY,c=a-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const Ga=4,hb=[.125,.215,.35,.446,.526,.582],Mo=20,Wf=new ch,ub=new pt;let Xf=null,Yf=0,qf=0,Kf=!1;const xo=(1+Math.sqrt(5))/2,ma=1/xo,db=[new C(-xo,ma,0),new C(xo,ma,0),new C(-ma,0,xo),new C(ma,0,xo),new C(0,xo,-ma),new C(0,xo,ma),new C(-1,1,-1),new C(1,1,-1),new C(-1,1,1),new C(1,1,1)];class fb{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Xf=this._renderer.getRenderTarget(),Yf=this._renderer.getActiveCubeFace(),qf=this._renderer.getActiveMipmapLevel(),Kf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,n,i,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=gb(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=mb(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Xf,Yf,qf),this._renderer.xr.enabled=Kf,t.scissorTest=!1,zh(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===dc||t.mapping===fc?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Xf=this._renderer.getRenderTarget(),Yf=this._renderer.getActiveCubeFace(),qf=this._renderer.getActiveMipmapLevel(),Kf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:dn,minFilter:dn,generateMipmaps:!1,type:Ks,format:zn,colorSpace:Dc,depthBuffer:!1},i=pb(t,e,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=pb(t,e,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=KC(s)),this._blurMaterial=ZC(s,t,e)}return i}_compileMaterial(t){const e=new ct(this._lodPlanes[0],t);this._renderer.compile(e,Wf)}_sceneToCubeUV(t,e,n,i){const a=new rn(90,1,e,n),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],h=this._renderer,u=h.autoClear,d=h.toneMapping;h.getClearColor(ub),h.toneMapping=Hr,h.autoClear=!1;const f=new en({name:"PMREM.Background",side:Vn,depthWrite:!1,depthTest:!1}),m=new ct(new Fn,f);let _=!1;const g=t.background;g?g.isColor&&(f.color.copy(g),t.background=null,_=!0):(f.color.copy(ub),_=!0);for(let p=0;p<6;p++){const b=p%3;b===0?(a.up.set(0,c[p],0),a.lookAt(l[p],0,0)):b===1?(a.up.set(0,0,c[p]),a.lookAt(0,l[p],0)):(a.up.set(0,c[p],0),a.lookAt(0,0,l[p]));const y=this._cubeSize;zh(i,b*y,p>2?y:0,y,y),h.setRenderTarget(i),_&&h.render(m,a),h.render(t,a)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=d,h.autoClear=u,t.background=g}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===dc||t.mapping===fc;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=gb()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=mb());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new ct(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=t;const c=this._cubeSize;zh(e,0,0,3*c,2*c),n.setRenderTarget(e),n.render(o,Wf)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const o=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=db[(i-s-1)%db.length];this._blur(t,s-1,s,o,a)}e.autoClear=n}_blur(t,e,n,i,s){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,i,"latitudinal",s),this._halfBlur(o,t,n,n,i,"longitudinal",s)}_halfBlur(t,e,n,i,s,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,u=new ct(this._lodPlanes[i],l),d=l.uniforms,f=this._sizeLods[n]-1,m=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*Mo-1),_=s/m,g=isFinite(s)?1+Math.floor(h*_):Mo;g>Mo&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Mo}`);const p=[];let b=0;for(let T=0;T<Mo;++T){const E=T/_,w=Math.exp(-E*E/2);p.push(w),T===0?b+=w:T<g&&(b+=2*w)}for(let T=0;T<p.length;T++)p[T]=p[T]/b;d.envMap.value=t.texture,d.samples.value=g,d.weights.value=p,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:y}=this;d.dTheta.value=m,d.mipInt.value=y-n;const v=this._sizeLods[i],x=3*v*(i>y-Ga?i-y+Ga:0),S=4*(this._cubeSize-v);zh(e,x,S,3*v,2*v),c.setRenderTarget(e),c.render(u,Wf)}}function KC(r){const t=[],e=[],n=[];let i=r;const s=r-Ga+1+hb.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);e.push(a);let c=1/a;o>r-Ga?c=hb[o-r+Ga-1]:o===0&&(c=0),n.push(c);const l=1/(a-2),h=-l,u=1+l,d=[h,h,u,h,u,u,h,h,u,u,h,u],f=6,m=6,_=3,g=2,p=1,b=new Float32Array(_*m*f),y=new Float32Array(g*m*f),v=new Float32Array(p*m*f);for(let S=0;S<f;S++){const T=S%3*2/3-1,E=S>2?0:-1,w=[T,E,0,T+2/3,E,0,T+2/3,E+1,0,T,E,0,T+2/3,E+1,0,T,E+1,0];b.set(w,_*m*S),y.set(d,g*m*S);const M=[S,S,S,S,S,S];v.set(M,p*m*S)}const x=new Qt;x.setAttribute("position",new Pe(b,_)),x.setAttribute("uv",new Pe(y,g)),x.setAttribute("faceIndex",new Pe(v,p)),t.push(x),i>Ga&&i--}return{lodPlanes:t,sizeLods:e,sigmas:n}}function pb(r,t,e){const n=new Bo(r,t,e);return n.texture.mapping=Gd,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function zh(r,t,e,n,i){r.viewport.set(t,e,n,i),r.scissor.set(t,e,n,i)}function ZC(r,t,e){const n=new Float32Array(Mo),i=new C(0,1,0);return new ws({name:"SphericalGaussianBlur",defines:{n:Mo,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Jg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Vr,depthTest:!1,depthWrite:!1})}function mb(){return new ws({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Jg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Vr,depthTest:!1,depthWrite:!1})}function gb(){return new ws({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Jg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Vr,depthTest:!1,depthWrite:!1})}function Jg(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function QC(r){let t=new WeakMap,e=null;function n(a){if(a&&a.isTexture){const c=a.mapping,l=c===pc||c===pm,h=c===dc||c===fc;if(l||h){let u=t.get(a);const d=u!==void 0?u.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==d)return e===null&&(e=new fb(r)),u=l?e.fromEquirectangular(a,u):e.fromCubemap(a,u),u.texture.pmremVersion=a.pmremVersion,t.set(a,u),u.texture;if(u!==void 0)return u.texture;{const f=a.image;return l&&f&&f.height>0||h&&f&&i(f)?(e===null&&(e=new fb(r)),u=l?e.fromEquirectangular(a):e.fromCubemap(a),u.texture.pmremVersion=a.pmremVersion,t.set(a,u),a.addEventListener("dispose",s),u.texture):null}}}return a}function i(a){let c=0;const l=6;for(let h=0;h<l;h++)a[h]!==void 0&&c++;return c===l}function s(a){const c=a.target;c.removeEventListener("dispose",s);const l=t.get(c);l!==void 0&&(t.delete(c),l.dispose())}function o(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:n,dispose:o}}function $C(r){const t={};function e(n){if(t[n]!==void 0)return t[n];let i;switch(n){case"WEBGL_depth_texture":i=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=r.getExtension(n)}return t[n]=i,i}return{has:function(n){return e(n)!==null},init:function(){e("EXT_color_buffer_float"),e("WEBGL_clip_cull_distance"),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture"),e("WEBGL_render_shared_exponent")},get:function(n){const i=e(n);return i===null&&_l("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function JC(r,t,e,n){const i={},s=new WeakMap;function o(u){const d=u.target;d.index!==null&&t.remove(d.index);for(const m in d.attributes)t.remove(d.attributes[m]);for(const m in d.morphAttributes){const _=d.morphAttributes[m];for(let g=0,p=_.length;g<p;g++)t.remove(_[g])}d.removeEventListener("dispose",o),delete i[d.id];const f=s.get(d);f&&(t.remove(f),s.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,e.memory.geometries--}function a(u,d){return i[d.id]===!0||(d.addEventListener("dispose",o),i[d.id]=!0,e.memory.geometries++),d}function c(u){const d=u.attributes;for(const m in d)t.update(d[m],r.ARRAY_BUFFER);const f=u.morphAttributes;for(const m in f){const _=f[m];for(let g=0,p=_.length;g<p;g++)t.update(_[g],r.ARRAY_BUFFER)}}function l(u){const d=[],f=u.index,m=u.attributes.position;let _=0;if(f!==null){const b=f.array;_=f.version;for(let y=0,v=b.length;y<v;y+=3){const x=b[y+0],S=b[y+1],T=b[y+2];d.push(x,S,S,T,T,x)}}else if(m!==void 0){const b=m.array;_=m.version;for(let y=0,v=b.length/3-1;y<v;y+=3){const x=y+0,S=y+1,T=y+2;d.push(x,S,S,T,T,x)}}else return;const g=new(Qx(d)?ew:Qg)(d,1);g.version=_;const p=s.get(u);p&&t.remove(p),s.set(u,g)}function h(u){const d=s.get(u);if(d){const f=u.index;f!==null&&d.version<f.version&&l(u)}else l(u);return s.get(u)}return{get:a,update:c,getWireframeAttribute:h}}function tP(r,t,e){let n;function i(d){n=d}let s,o;function a(d){s=d.type,o=d.bytesPerElement}function c(d,f){r.drawElements(n,f,s,d*o),e.update(f,n,1)}function l(d,f,m){m!==0&&(r.drawElementsInstanced(n,f,s,d*o,m),e.update(f,n,m))}function h(d,f,m){if(m===0)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,f,0,s,d,0,m);let g=0;for(let p=0;p<m;p++)g+=f[p];e.update(g,n,1)}function u(d,f,m,_){if(m===0)return;const g=t.get("WEBGL_multi_draw");if(g===null)for(let p=0;p<d.length;p++)l(d[p]/o,f[p],_[p]);else{g.multiDrawElementsInstancedWEBGL(n,f,0,s,d,0,_,0,m);let p=0;for(let b=0;b<m;b++)p+=f[b]*_[b];e.update(p,n,1)}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=l,this.renderMultiDraw=h,this.renderMultiDrawInstances=u}function eP(r){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(e.calls++,o){case r.TRIANGLES:e.triangles+=a*(s/3);break;case r.LINES:e.lines+=a*(s/2);break;case r.LINE_STRIP:e.lines+=a*(s-1);break;case r.LINE_LOOP:e.lines+=a*s;break;case r.POINTS:e.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:i,update:n}}function nP(r,t,e){const n=new WeakMap,i=new ie;function s(o,a,c){const l=o.morphTargetInfluences,h=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,u=h!==void 0?h.length:0;let d=n.get(a);if(d===void 0||d.count!==u){let w=function(){T.dispose(),n.delete(a),a.removeEventListener("dispose",w)};d!==void 0&&d.texture.dispose();const f=a.morphAttributes.position!==void 0,m=a.morphAttributes.normal!==void 0,_=a.morphAttributes.color!==void 0,g=a.morphAttributes.position||[],p=a.morphAttributes.normal||[],b=a.morphAttributes.color||[];let y=0;f===!0&&(y=1),m===!0&&(y=2),_===!0&&(y=3);let v=a.attributes.position.count*y,x=1;v>t.maxTextureSize&&(x=Math.ceil(v/t.maxTextureSize),v=t.maxTextureSize);const S=new Float32Array(v*x*4*u),T=new Jx(S,v,x,u);T.type=Tn,T.needsUpdate=!0;const E=y*4;for(let M=0;M<u;M++){const P=g[M],L=p[M],I=b[M],F=v*x*4*M;for(let z=0;z<P.count;z++){const N=z*E;f===!0&&(i.fromBufferAttribute(P,z),S[F+N+0]=i.x,S[F+N+1]=i.y,S[F+N+2]=i.z,S[F+N+3]=0),m===!0&&(i.fromBufferAttribute(L,z),S[F+N+4]=i.x,S[F+N+5]=i.y,S[F+N+6]=i.z,S[F+N+7]=0),_===!0&&(i.fromBufferAttribute(I,z),S[F+N+8]=i.x,S[F+N+9]=i.y,S[F+N+10]=i.z,S[F+N+11]=I.itemSize===4?i.w:1)}}d={count:u,texture:T,size:new J(v,x)},n.set(a,d),a.addEventListener("dispose",w)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(r,"morphTexture",o.morphTexture,e);else{let f=0;for(let _=0;_<l.length;_++)f+=l[_];const m=a.morphTargetsRelative?1:1-f;c.getUniforms().setValue(r,"morphTargetBaseInfluence",m),c.getUniforms().setValue(r,"morphTargetInfluences",l)}c.getUniforms().setValue(r,"morphTargetsTexture",d.texture,e),c.getUniforms().setValue(r,"morphTargetsTextureSize",d.size)}return{update:s}}function iP(r,t,e,n){let i=new WeakMap;function s(c){const l=n.render.frame,h=c.geometry,u=t.get(c,h);if(i.get(u)!==l&&(t.update(u),i.set(u,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==l&&(e.update(c.instanceMatrix,r.ARRAY_BUFFER),c.instanceColor!==null&&e.update(c.instanceColor,r.ARRAY_BUFFER),i.set(c,l))),c.isSkinnedMesh){const d=c.skeleton;i.get(d)!==l&&(d.update(),i.set(d,l))}return u}function o(){i=new WeakMap}function a(c){const l=c.target;l.removeEventListener("dispose",a),e.remove(l.instanceMatrix),l.instanceColor!==null&&e.remove(l.instanceColor)}return{update:s,dispose:o}}class rw extends Ie{constructor(t,e,n,i,s,o,a,c,l,h=tc){if(h!==tc&&h!==gc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&h===tc&&(n=Xr),n===void 0&&h===gc&&(n=mc),super(null,i,s,o,a,c,h,n,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:gn,this.minFilter=c!==void 0?c:gn,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const ow=new Ie,_b=new rw(1,1),aw=new Jx,cw=new zE,lw=new iw,bb=[],yb=[],vb=new Float32Array(16),xb=new Float32Array(9),wb=new Float32Array(4);function Lc(r,t,e){const n=r[0];if(n<=0||n>0)return r;const i=t*e;let s=bb[i];if(s===void 0&&(s=new Float32Array(i),bb[i]=s),t!==0){n.toArray(s,0);for(let o=1,a=0;o!==t;++o)a+=e,r[o].toArray(s,a)}return s}function an(r,t){if(r.length!==t.length)return!1;for(let e=0,n=r.length;e<n;e++)if(r[e]!==t[e])return!1;return!0}function cn(r,t){for(let e=0,n=t.length;e<n;e++)r[e]=t[e]}function qd(r,t){let e=yb[t];e===void 0&&(e=new Int32Array(t),yb[t]=e);for(let n=0;n!==t;++n)e[n]=r.allocateTextureUnit();return e}function sP(r,t){const e=this.cache;e[0]!==t&&(r.uniform1f(this.addr,t),e[0]=t)}function rP(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(r.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(an(e,t))return;r.uniform2fv(this.addr,t),cn(e,t)}}function oP(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(r.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(r.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(an(e,t))return;r.uniform3fv(this.addr,t),cn(e,t)}}function aP(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(r.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(an(e,t))return;r.uniform4fv(this.addr,t),cn(e,t)}}function cP(r,t){const e=this.cache,n=t.elements;if(n===void 0){if(an(e,t))return;r.uniformMatrix2fv(this.addr,!1,t),cn(e,t)}else{if(an(e,n))return;wb.set(n),r.uniformMatrix2fv(this.addr,!1,wb),cn(e,n)}}function lP(r,t){const e=this.cache,n=t.elements;if(n===void 0){if(an(e,t))return;r.uniformMatrix3fv(this.addr,!1,t),cn(e,t)}else{if(an(e,n))return;xb.set(n),r.uniformMatrix3fv(this.addr,!1,xb),cn(e,n)}}function hP(r,t){const e=this.cache,n=t.elements;if(n===void 0){if(an(e,t))return;r.uniformMatrix4fv(this.addr,!1,t),cn(e,t)}else{if(an(e,n))return;vb.set(n),r.uniformMatrix4fv(this.addr,!1,vb),cn(e,n)}}function uP(r,t){const e=this.cache;e[0]!==t&&(r.uniform1i(this.addr,t),e[0]=t)}function dP(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(r.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(an(e,t))return;r.uniform2iv(this.addr,t),cn(e,t)}}function fP(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(r.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(an(e,t))return;r.uniform3iv(this.addr,t),cn(e,t)}}function pP(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(r.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(an(e,t))return;r.uniform4iv(this.addr,t),cn(e,t)}}function mP(r,t){const e=this.cache;e[0]!==t&&(r.uniform1ui(this.addr,t),e[0]=t)}function gP(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(r.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(an(e,t))return;r.uniform2uiv(this.addr,t),cn(e,t)}}function _P(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(r.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(an(e,t))return;r.uniform3uiv(this.addr,t),cn(e,t)}}function bP(r,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(r.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(an(e,t))return;r.uniform4uiv(this.addr,t),cn(e,t)}}function yP(r,t,e){const n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i);let s;this.type===r.SAMPLER_2D_SHADOW?(_b.compareFunction=Zx,s=_b):s=ow,e.setTexture2D(t||s,i)}function vP(r,t,e){const n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),e.setTexture3D(t||cw,i)}function xP(r,t,e){const n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),e.setTextureCube(t||lw,i)}function wP(r,t,e){const n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),e.setTexture2DArray(t||aw,i)}function SP(r){switch(r){case 5126:return sP;case 35664:return rP;case 35665:return oP;case 35666:return aP;case 35674:return cP;case 35675:return lP;case 35676:return hP;case 5124:case 35670:return uP;case 35667:case 35671:return dP;case 35668:case 35672:return fP;case 35669:case 35673:return pP;case 5125:return mP;case 36294:return gP;case 36295:return _P;case 36296:return bP;case 35678:case 36198:case 36298:case 36306:case 35682:return yP;case 35679:case 36299:case 36307:return vP;case 35680:case 36300:case 36308:case 36293:return xP;case 36289:case 36303:case 36311:case 36292:return wP}}function MP(r,t){r.uniform1fv(this.addr,t)}function TP(r,t){const e=Lc(t,this.size,2);r.uniform2fv(this.addr,e)}function EP(r,t){const e=Lc(t,this.size,3);r.uniform3fv(this.addr,e)}function AP(r,t){const e=Lc(t,this.size,4);r.uniform4fv(this.addr,e)}function CP(r,t){const e=Lc(t,this.size,4);r.uniformMatrix2fv(this.addr,!1,e)}function PP(r,t){const e=Lc(t,this.size,9);r.uniformMatrix3fv(this.addr,!1,e)}function RP(r,t){const e=Lc(t,this.size,16);r.uniformMatrix4fv(this.addr,!1,e)}function DP(r,t){r.uniform1iv(this.addr,t)}function LP(r,t){r.uniform2iv(this.addr,t)}function IP(r,t){r.uniform3iv(this.addr,t)}function OP(r,t){r.uniform4iv(this.addr,t)}function FP(r,t){r.uniform1uiv(this.addr,t)}function kP(r,t){r.uniform2uiv(this.addr,t)}function NP(r,t){r.uniform3uiv(this.addr,t)}function UP(r,t){r.uniform4uiv(this.addr,t)}function BP(r,t,e){const n=this.cache,i=t.length,s=qd(e,i);an(n,s)||(r.uniform1iv(this.addr,s),cn(n,s));for(let o=0;o!==i;++o)e.setTexture2D(t[o]||ow,s[o])}function zP(r,t,e){const n=this.cache,i=t.length,s=qd(e,i);an(n,s)||(r.uniform1iv(this.addr,s),cn(n,s));for(let o=0;o!==i;++o)e.setTexture3D(t[o]||cw,s[o])}function VP(r,t,e){const n=this.cache,i=t.length,s=qd(e,i);an(n,s)||(r.uniform1iv(this.addr,s),cn(n,s));for(let o=0;o!==i;++o)e.setTextureCube(t[o]||lw,s[o])}function HP(r,t,e){const n=this.cache,i=t.length,s=qd(e,i);an(n,s)||(r.uniform1iv(this.addr,s),cn(n,s));for(let o=0;o!==i;++o)e.setTexture2DArray(t[o]||aw,s[o])}function GP(r){switch(r){case 5126:return MP;case 35664:return TP;case 35665:return EP;case 35666:return AP;case 35674:return CP;case 35675:return PP;case 35676:return RP;case 5124:case 35670:return DP;case 35667:case 35671:return LP;case 35668:case 35672:return IP;case 35669:case 35673:return OP;case 5125:return FP;case 36294:return kP;case 36295:return NP;case 36296:return UP;case 35678:case 36198:case 36298:case 36306:case 35682:return BP;case 35679:case 36299:case 36307:return zP;case 35680:case 36300:case 36308:case 36293:return VP;case 36289:case 36303:case 36311:case 36292:return HP}}class jP{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.setValue=SP(e.type)}}class WP{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=GP(e.type)}}class XP{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(t,e[a.id],n)}}}const Zf=/(\w+)(\])?(\[|\.)?/g;function Sb(r,t){r.seq.push(t),r.map[t.id]=t}function YP(r,t,e){const n=r.name,i=n.length;for(Zf.lastIndex=0;;){const s=Zf.exec(n),o=Zf.lastIndex;let a=s[1];const c=s[2]==="]",l=s[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===i){Sb(e,l===void 0?new jP(a,r,t):new WP(a,r,t));break}else{let u=e.map[a];u===void 0&&(u=new XP(a),Sb(e,u)),e=u}}}class id{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const s=t.getActiveUniform(e,i),o=t.getUniformLocation(e,s.name);YP(s,o,this)}}setValue(t,e,n,i){const s=this.map[e];s!==void 0&&s.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];i!==void 0&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let s=0,o=e.length;s!==o;++s){const a=e[s],c=n[a.id];c.needsUpdate!==!1&&a.setValue(t,c.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,s=t.length;i!==s;++i){const o=t[i];o.id in e&&n.push(o)}return n}}function Mb(r,t,e){const n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n}const qP=37297;let KP=0;function ZP(r,t){const e=r.split(`
`),n=[],i=Math.max(t-6,0),s=Math.min(t+6,e.length);for(let o=i;o<s;o++){const a=o+1;n.push(`${a===t?">":" "} ${a}: ${e[o]}`)}return n.join(`
`)}const Tb=new Gt;function QP(r){ne._getMatrix(Tb,ne.workingColorSpace,r);const t=`mat3( ${Tb.elements.map(e=>e.toFixed(4))} )`;switch(ne.getTransfer(r)){case Xd:return[t,"LinearTransferOETF"];case be:return[t,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",r),[t,"LinearTransferOETF"]}}function Eb(r,t,e){const n=r.getShaderParameter(t,r.COMPILE_STATUS),i=r.getShaderInfoLog(t).trim();if(n&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return e.toUpperCase()+`

`+i+`

`+ZP(r.getShaderSource(t),o)}else return i}function $P(r,t){const e=QP(t);return[`vec4 ${r}( vec4 value ) {`,`	return ${e[1]}( vec4( value.rgb * ${e[0]}, value.a ) );`,"}"].join(`
`)}function JP(r,t){let e;switch(t){case QT:e="Linear";break;case $T:e="Reinhard";break;case JT:e="Cineon";break;case Fx:e="ACESFilmic";break;case eE:e="AgX";break;case nE:e="Neutral";break;case tE:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+r+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}const Vh=new C;function tR(){ne.getLuminanceCoefficients(Vh);const r=Vh.x.toFixed(4),t=Vh.y.toFixed(4),e=Vh.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${t}, ${e} );`,"	return dot( weights, rgb );","}"].join(`
`)}function eR(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(bl).join(`
`)}function nR(r){const t=[];for(const e in r){const n=r[e];n!==!1&&t.push("#define "+e+" "+n)}return t.join(`
`)}function iR(r,t){const e={},n=r.getProgramParameter(t,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=r.getActiveAttrib(t,i),o=s.name;let a=1;s.type===r.FLOAT_MAT2&&(a=2),s.type===r.FLOAT_MAT3&&(a=3),s.type===r.FLOAT_MAT4&&(a=4),e[o]={type:s.type,location:r.getAttribLocation(t,o),locationSize:a}}return e}function bl(r){return r!==""}function Ab(r,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Cb(r,t){return r.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const sR=/^[ \t]*#include +<([\w\d./]+)>/gm;function Gm(r){return r.replace(sR,oR)}const rR=new Map;function oR(r,t){let e=qt[t];if(e===void 0){const n=rR.get(t);if(n!==void 0)e=qt[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,n);else throw new Error("Can not resolve #include <"+t+">")}return Gm(e)}const aR=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Pb(r){return r.replace(aR,cR)}function cR(r,t,e,n){let i="";for(let s=parseInt(t);s<parseInt(e);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function Rb(r){let t=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?t+=`
#define HIGH_PRECISION`:r.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function lR(r){let t="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===Ix?t="SHADOWMAP_TYPE_PCF":r.shadowMapType===Ox?t="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Bs&&(t="SHADOWMAP_TYPE_VSM"),t}function hR(r){let t="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case dc:case fc:t="ENVMAP_TYPE_CUBE";break;case Gd:t="ENVMAP_TYPE_CUBE_UV";break}return t}function uR(r){let t="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case fc:t="ENVMAP_MODE_REFRACTION";break}return t}function dR(r){let t="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case Hd:t="ENVMAP_BLENDING_MULTIPLY";break;case KT:t="ENVMAP_BLENDING_MIX";break;case ZT:t="ENVMAP_BLENDING_ADD";break}return t}function fR(r){const t=r.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:n,maxMip:e}}function pR(r,t,e,n){const i=r.getContext(),s=e.defines;let o=e.vertexShader,a=e.fragmentShader;const c=lR(e),l=hR(e),h=uR(e),u=dR(e),d=fR(e),f=eR(e),m=nR(s),_=i.createProgram();let g,p,b=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(g=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m].filter(bl).join(`
`),g.length>0&&(g+=`
`),p=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m].filter(bl).join(`
`),p.length>0&&(p+=`
`)):(g=[Rb(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m,e.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",e.batching?"#define USE_BATCHING":"",e.batchingColor?"#define USE_BATCHING_COLOR":"",e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.instancingMorph?"#define USE_INSTANCING_MORPH":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+e.anisotropyMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+c:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(bl).join(`
`),p=[Rb(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,m,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+l:"",e.envMap?"#define "+h:"",e.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.dispersion?"#define USE_DISPERSION":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor||e.batchingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+c:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.numLightProbes>0?"#define USE_LIGHT_PROBES":"",e.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",e.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==Hr?"#define TONE_MAPPING":"",e.toneMapping!==Hr?qt.tonemapping_pars_fragment:"",e.toneMapping!==Hr?JP("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",qt.colorspace_pars_fragment,$P("linearToOutputTexel",e.outputColorSpace),tR(),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(bl).join(`
`)),o=Gm(o),o=Ab(o,e),o=Cb(o,e),a=Gm(a),a=Ab(a,e),a=Cb(a,e),o=Pb(o),a=Pb(a),e.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,g=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+g,p=["#define varying in",e.glslVersion===H_?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===H_?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const y=b+g+o,v=b+p+a,x=Mb(i,i.VERTEX_SHADER,y),S=Mb(i,i.FRAGMENT_SHADER,v);i.attachShader(_,x),i.attachShader(_,S),e.index0AttributeName!==void 0?i.bindAttribLocation(_,0,e.index0AttributeName):e.morphTargets===!0&&i.bindAttribLocation(_,0,"position"),i.linkProgram(_);function T(P){if(r.debug.checkShaderErrors){const L=i.getProgramInfoLog(_).trim(),I=i.getShaderInfoLog(x).trim(),F=i.getShaderInfoLog(S).trim();let z=!0,N=!0;if(i.getProgramParameter(_,i.LINK_STATUS)===!1)if(z=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,_,x,S);else{const Z=Eb(i,x,"vertex"),j=Eb(i,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(_,i.VALIDATE_STATUS)+`

Material Name: `+P.name+`
Material Type: `+P.type+`

Program Info Log: `+L+`
`+Z+`
`+j)}else L!==""?console.warn("THREE.WebGLProgram: Program Info Log:",L):(I===""||F==="")&&(N=!1);N&&(P.diagnostics={runnable:z,programLog:L,vertexShader:{log:I,prefix:g},fragmentShader:{log:F,prefix:p}})}i.deleteShader(x),i.deleteShader(S),E=new id(i,_),w=iR(i,_)}let E;this.getUniforms=function(){return E===void 0&&T(this),E};let w;this.getAttributes=function(){return w===void 0&&T(this),w};let M=e.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return M===!1&&(M=i.getProgramParameter(_,qP)),M},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(_),this.program=void 0},this.type=e.shaderType,this.name=e.shaderName,this.id=KP++,this.cacheKey=t,this.usedTimes=1,this.program=_,this.vertexShader=x,this.fragmentShader=S,this}let mR=0;class gR{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(t);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return n===void 0&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return n===void 0&&(n=new _R(t),e.set(t,n)),n}}class _R{constructor(t){this.id=mR++,this.code=t,this.usedTimes=0}}function bR(r,t,e,n,i,s,o){const a=new Zg,c=new gR,l=new Set,h=[],u=i.logarithmicDepthBuffer,d=i.vertexTextures;let f=i.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(w){return l.add(w),w===0?"uv":`uv${w}`}function g(w,M,P,L,I){const F=L.fog,z=I.geometry,N=w.isMeshStandardMaterial?L.environment:null,Z=(w.isMeshStandardMaterial?e:t).get(w.envMap||N),j=Z&&Z.mapping===Gd?Z.image.height:null,et=m[w.type];w.precision!==null&&(f=i.getMaxPrecision(w.precision),f!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",f,"instead."));const tt=z.morphAttributes.position||z.morphAttributes.normal||z.morphAttributes.color,at=tt!==void 0?tt.length:0;let dt=0;z.morphAttributes.position!==void 0&&(dt=1),z.morphAttributes.normal!==void 0&&(dt=2),z.morphAttributes.color!==void 0&&(dt=3);let St,O,it,mt;if(et){const me=us[et];St=me.vertexShader,O=me.fragmentShader}else St=w.vertexShader,O=w.fragmentShader,c.update(w),it=c.getVertexShaderID(w),mt=c.getFragmentShaderID(w);const ht=r.getRenderTarget(),It=r.state.buffers.depth.getReversed(),kt=I.isInstancedMesh===!0,zt=I.isBatchedMesh===!0,Fe=!!w.map,ce=!!w.matcap,je=!!Z,W=!!w.aoMap,xi=!!w.lightMap,re=!!w.bumpMap,oe=!!w.normalMap,Nt=!!w.displacementMap,Te=!!w.emissiveMap,Ft=!!w.metalnessMap,k=!!w.roughnessMap,R=w.anisotropy>0,X=w.clearcoat>0,st=w.dispersion>0,ot=w.iridescence>0,nt=w.sheen>0,Dt=w.transmission>0,bt=R&&!!w.anisotropyMap,Mt=X&&!!w.clearcoatMap,le=X&&!!w.clearcoatNormalMap,ut=X&&!!w.clearcoatRoughnessMap,Tt=ot&&!!w.iridescenceMap,Ut=ot&&!!w.iridescenceThicknessMap,Vt=nt&&!!w.sheenColorMap,Et=nt&&!!w.sheenRoughnessMap,ae=!!w.specularMap,Yt=!!w.specularColorMap,we=!!w.specularIntensityMap,V=Dt&&!!w.transmissionMap,_t=Dt&&!!w.thicknessMap,$=!!w.gradientMap,rt=!!w.alphaMap,xt=w.alphaTest>0,yt=!!w.alphaHash,Wt=!!w.extensions;let ze=Hr;w.toneMapped&&(ht===null||ht.isXRRenderTarget===!0)&&(ze=r.toneMapping);const yn={shaderID:et,shaderType:w.type,shaderName:w.name,vertexShader:St,fragmentShader:O,defines:w.defines,customVertexShaderID:it,customFragmentShaderID:mt,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:f,batching:zt,batchingColor:zt&&I._colorsTexture!==null,instancing:kt,instancingColor:kt&&I.instanceColor!==null,instancingMorph:kt&&I.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:ht===null?r.outputColorSpace:ht.isXRRenderTarget===!0?ht.texture.colorSpace:Dc,alphaToCoverage:!!w.alphaToCoverage,map:Fe,matcap:ce,envMap:je,envMapMode:je&&Z.mapping,envMapCubeUVHeight:j,aoMap:W,lightMap:xi,bumpMap:re,normalMap:oe,displacementMap:d&&Nt,emissiveMap:Te,normalMapObjectSpace:oe&&w.normalMapType===cE,normalMapTangentSpace:oe&&w.normalMapType===Wd,metalnessMap:Ft,roughnessMap:k,anisotropy:R,anisotropyMap:bt,clearcoat:X,clearcoatMap:Mt,clearcoatNormalMap:le,clearcoatRoughnessMap:ut,dispersion:st,iridescence:ot,iridescenceMap:Tt,iridescenceThicknessMap:Ut,sheen:nt,sheenColorMap:Vt,sheenRoughnessMap:Et,specularMap:ae,specularColorMap:Yt,specularIntensityMap:we,transmission:Dt,transmissionMap:V,thicknessMap:_t,gradientMap:$,opaque:w.transparent===!1&&w.blending===Ja&&w.alphaToCoverage===!1,alphaMap:rt,alphaTest:xt,alphaHash:yt,combine:w.combine,mapUv:Fe&&_(w.map.channel),aoMapUv:W&&_(w.aoMap.channel),lightMapUv:xi&&_(w.lightMap.channel),bumpMapUv:re&&_(w.bumpMap.channel),normalMapUv:oe&&_(w.normalMap.channel),displacementMapUv:Nt&&_(w.displacementMap.channel),emissiveMapUv:Te&&_(w.emissiveMap.channel),metalnessMapUv:Ft&&_(w.metalnessMap.channel),roughnessMapUv:k&&_(w.roughnessMap.channel),anisotropyMapUv:bt&&_(w.anisotropyMap.channel),clearcoatMapUv:Mt&&_(w.clearcoatMap.channel),clearcoatNormalMapUv:le&&_(w.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ut&&_(w.clearcoatRoughnessMap.channel),iridescenceMapUv:Tt&&_(w.iridescenceMap.channel),iridescenceThicknessMapUv:Ut&&_(w.iridescenceThicknessMap.channel),sheenColorMapUv:Vt&&_(w.sheenColorMap.channel),sheenRoughnessMapUv:Et&&_(w.sheenRoughnessMap.channel),specularMapUv:ae&&_(w.specularMap.channel),specularColorMapUv:Yt&&_(w.specularColorMap.channel),specularIntensityMapUv:we&&_(w.specularIntensityMap.channel),transmissionMapUv:V&&_(w.transmissionMap.channel),thicknessMapUv:_t&&_(w.thicknessMap.channel),alphaMapUv:rt&&_(w.alphaMap.channel),vertexTangents:!!z.attributes.tangent&&(oe||R),vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!z.attributes.color&&z.attributes.color.itemSize===4,pointsUvs:I.isPoints===!0&&!!z.attributes.uv&&(Fe||rt),fog:!!F,useFog:w.fog===!0,fogExp2:!!F&&F.isFogExp2,flatShading:w.flatShading===!0,sizeAttenuation:w.sizeAttenuation===!0,logarithmicDepthBuffer:u,reverseDepthBuffer:It,skinning:I.isSkinnedMesh===!0,morphTargets:z.morphAttributes.position!==void 0,morphNormals:z.morphAttributes.normal!==void 0,morphColors:z.morphAttributes.color!==void 0,morphTargetsCount:at,morphTextureStride:dt,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numLightProbes:M.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:w.dithering,shadowMapEnabled:r.shadowMap.enabled&&P.length>0,shadowMapType:r.shadowMap.type,toneMapping:ze,decodeVideoTexture:Fe&&w.map.isVideoTexture===!0&&ne.getTransfer(w.map.colorSpace)===be,decodeVideoTextureEmissive:Te&&w.emissiveMap.isVideoTexture===!0&&ne.getTransfer(w.emissiveMap.colorSpace)===be,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===Sn,flipSided:w.side===Vn,useDepthPacking:w.depthPacking>=0,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionClipCullDistance:Wt&&w.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Wt&&w.extensions.multiDraw===!0||zt)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:w.customProgramCacheKey()};return yn.vertexUv1s=l.has(1),yn.vertexUv2s=l.has(2),yn.vertexUv3s=l.has(3),l.clear(),yn}function p(w){const M=[];if(w.shaderID?M.push(w.shaderID):(M.push(w.customVertexShaderID),M.push(w.customFragmentShaderID)),w.defines!==void 0)for(const P in w.defines)M.push(P),M.push(w.defines[P]);return w.isRawShaderMaterial===!1&&(b(M,w),y(M,w),M.push(r.outputColorSpace)),M.push(w.customProgramCacheKey),M.join()}function b(w,M){w.push(M.precision),w.push(M.outputColorSpace),w.push(M.envMapMode),w.push(M.envMapCubeUVHeight),w.push(M.mapUv),w.push(M.alphaMapUv),w.push(M.lightMapUv),w.push(M.aoMapUv),w.push(M.bumpMapUv),w.push(M.normalMapUv),w.push(M.displacementMapUv),w.push(M.emissiveMapUv),w.push(M.metalnessMapUv),w.push(M.roughnessMapUv),w.push(M.anisotropyMapUv),w.push(M.clearcoatMapUv),w.push(M.clearcoatNormalMapUv),w.push(M.clearcoatRoughnessMapUv),w.push(M.iridescenceMapUv),w.push(M.iridescenceThicknessMapUv),w.push(M.sheenColorMapUv),w.push(M.sheenRoughnessMapUv),w.push(M.specularMapUv),w.push(M.specularColorMapUv),w.push(M.specularIntensityMapUv),w.push(M.transmissionMapUv),w.push(M.thicknessMapUv),w.push(M.combine),w.push(M.fogExp2),w.push(M.sizeAttenuation),w.push(M.morphTargetsCount),w.push(M.morphAttributeCount),w.push(M.numDirLights),w.push(M.numPointLights),w.push(M.numSpotLights),w.push(M.numSpotLightMaps),w.push(M.numHemiLights),w.push(M.numRectAreaLights),w.push(M.numDirLightShadows),w.push(M.numPointLightShadows),w.push(M.numSpotLightShadows),w.push(M.numSpotLightShadowsWithMaps),w.push(M.numLightProbes),w.push(M.shadowMapType),w.push(M.toneMapping),w.push(M.numClippingPlanes),w.push(M.numClipIntersection),w.push(M.depthPacking)}function y(w,M){a.disableAll(),M.supportsVertexTextures&&a.enable(0),M.instancing&&a.enable(1),M.instancingColor&&a.enable(2),M.instancingMorph&&a.enable(3),M.matcap&&a.enable(4),M.envMap&&a.enable(5),M.normalMapObjectSpace&&a.enable(6),M.normalMapTangentSpace&&a.enable(7),M.clearcoat&&a.enable(8),M.iridescence&&a.enable(9),M.alphaTest&&a.enable(10),M.vertexColors&&a.enable(11),M.vertexAlphas&&a.enable(12),M.vertexUv1s&&a.enable(13),M.vertexUv2s&&a.enable(14),M.vertexUv3s&&a.enable(15),M.vertexTangents&&a.enable(16),M.anisotropy&&a.enable(17),M.alphaHash&&a.enable(18),M.batching&&a.enable(19),M.dispersion&&a.enable(20),M.batchingColor&&a.enable(21),w.push(a.mask),a.disableAll(),M.fog&&a.enable(0),M.useFog&&a.enable(1),M.flatShading&&a.enable(2),M.logarithmicDepthBuffer&&a.enable(3),M.reverseDepthBuffer&&a.enable(4),M.skinning&&a.enable(5),M.morphTargets&&a.enable(6),M.morphNormals&&a.enable(7),M.morphColors&&a.enable(8),M.premultipliedAlpha&&a.enable(9),M.shadowMapEnabled&&a.enable(10),M.doubleSided&&a.enable(11),M.flipSided&&a.enable(12),M.useDepthPacking&&a.enable(13),M.dithering&&a.enable(14),M.transmission&&a.enable(15),M.sheen&&a.enable(16),M.opaque&&a.enable(17),M.pointsUvs&&a.enable(18),M.decodeVideoTexture&&a.enable(19),M.decodeVideoTextureEmissive&&a.enable(20),M.alphaToCoverage&&a.enable(21),w.push(a.mask)}function v(w){const M=m[w.type];let P;if(M){const L=us[M];P=e1.clone(L.uniforms)}else P=w.uniforms;return P}function x(w,M){let P;for(let L=0,I=h.length;L<I;L++){const F=h[L];if(F.cacheKey===M){P=F,++P.usedTimes;break}}return P===void 0&&(P=new pR(r,M,w,s),h.push(P)),P}function S(w){if(--w.usedTimes===0){const M=h.indexOf(w);h[M]=h[h.length-1],h.pop(),w.destroy()}}function T(w){c.remove(w)}function E(){c.dispose()}return{getParameters:g,getProgramCacheKey:p,getUniforms:v,acquireProgram:x,releaseProgram:S,releaseShaderCache:T,programs:h,dispose:E}}function yR(){let r=new WeakMap;function t(o){return r.has(o)}function e(o){let a=r.get(o);return a===void 0&&(a={},r.set(o,a)),a}function n(o){r.delete(o)}function i(o,a,c){r.get(o)[a]=c}function s(){r=new WeakMap}return{has:t,get:e,remove:n,update:i,dispose:s}}function vR(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.material.id!==t.material.id?r.material.id-t.material.id:r.z!==t.z?r.z-t.z:r.id-t.id}function Db(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?t.z-r.z:r.id-t.id}function Lb(){const r=[];let t=0;const e=[],n=[],i=[];function s(){t=0,e.length=0,n.length=0,i.length=0}function o(u,d,f,m,_,g){let p=r[t];return p===void 0?(p={id:u.id,object:u,geometry:d,material:f,groupOrder:m,renderOrder:u.renderOrder,z:_,group:g},r[t]=p):(p.id=u.id,p.object=u,p.geometry=d,p.material=f,p.groupOrder=m,p.renderOrder=u.renderOrder,p.z=_,p.group=g),t++,p}function a(u,d,f,m,_,g){const p=o(u,d,f,m,_,g);f.transmission>0?n.push(p):f.transparent===!0?i.push(p):e.push(p)}function c(u,d,f,m,_,g){const p=o(u,d,f,m,_,g);f.transmission>0?n.unshift(p):f.transparent===!0?i.unshift(p):e.unshift(p)}function l(u,d){e.length>1&&e.sort(u||vR),n.length>1&&n.sort(d||Db),i.length>1&&i.sort(d||Db)}function h(){for(let u=t,d=r.length;u<d;u++){const f=r[u];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:e,transmissive:n,transparent:i,init:s,push:a,unshift:c,finish:h,sort:l}}function xR(){let r=new WeakMap;function t(n,i){const s=r.get(n);let o;return s===void 0?(o=new Lb,r.set(n,[o])):i>=s.length?(o=new Lb,s.push(o)):o=s[i],o}function e(){r=new WeakMap}return{get:t,dispose:e}}function wR(){const r={};return{get:function(t){if(r[t.id]!==void 0)return r[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new C,color:new pt};break;case"SpotLight":e={position:new C,direction:new C,color:new pt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new C,color:new pt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new C,skyColor:new pt,groundColor:new pt};break;case"RectAreaLight":e={color:new pt,position:new C,halfWidth:new C,halfHeight:new C};break}return r[t.id]=e,e}}}function SR(){const r={};return{get:function(t){if(r[t.id]!==void 0)return r[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J};break;case"SpotLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J};break;case"PointLight":e={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new J,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[t.id]=e,e}}}let MR=0;function TR(r,t){return(t.castShadow?2:0)-(r.castShadow?2:0)+(t.map?1:0)-(r.map?1:0)}function ER(r){const t=new wR,e=SR(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)n.probe.push(new C);const i=new C,s=new lt,o=new lt;function a(l){let h=0,u=0,d=0;for(let w=0;w<9;w++)n.probe[w].set(0,0,0);let f=0,m=0,_=0,g=0,p=0,b=0,y=0,v=0,x=0,S=0,T=0;l.sort(TR);for(let w=0,M=l.length;w<M;w++){const P=l[w],L=P.color,I=P.intensity,F=P.distance,z=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)h+=L.r*I,u+=L.g*I,d+=L.b*I;else if(P.isLightProbe){for(let N=0;N<9;N++)n.probe[N].addScaledVector(P.sh.coefficients[N],I);T++}else if(P.isDirectionalLight){const N=t.get(P);if(N.color.copy(P.color).multiplyScalar(P.intensity),P.castShadow){const Z=P.shadow,j=e.get(P);j.shadowIntensity=Z.intensity,j.shadowBias=Z.bias,j.shadowNormalBias=Z.normalBias,j.shadowRadius=Z.radius,j.shadowMapSize=Z.mapSize,n.directionalShadow[f]=j,n.directionalShadowMap[f]=z,n.directionalShadowMatrix[f]=P.shadow.matrix,b++}n.directional[f]=N,f++}else if(P.isSpotLight){const N=t.get(P);N.position.setFromMatrixPosition(P.matrixWorld),N.color.copy(L).multiplyScalar(I),N.distance=F,N.coneCos=Math.cos(P.angle),N.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),N.decay=P.decay,n.spot[_]=N;const Z=P.shadow;if(P.map&&(n.spotLightMap[x]=P.map,x++,Z.updateMatrices(P),P.castShadow&&S++),n.spotLightMatrix[_]=Z.matrix,P.castShadow){const j=e.get(P);j.shadowIntensity=Z.intensity,j.shadowBias=Z.bias,j.shadowNormalBias=Z.normalBias,j.shadowRadius=Z.radius,j.shadowMapSize=Z.mapSize,n.spotShadow[_]=j,n.spotShadowMap[_]=z,v++}_++}else if(P.isRectAreaLight){const N=t.get(P);N.color.copy(L).multiplyScalar(I),N.halfWidth.set(P.width*.5,0,0),N.halfHeight.set(0,P.height*.5,0),n.rectArea[g]=N,g++}else if(P.isPointLight){const N=t.get(P);if(N.color.copy(P.color).multiplyScalar(P.intensity),N.distance=P.distance,N.decay=P.decay,P.castShadow){const Z=P.shadow,j=e.get(P);j.shadowIntensity=Z.intensity,j.shadowBias=Z.bias,j.shadowNormalBias=Z.normalBias,j.shadowRadius=Z.radius,j.shadowMapSize=Z.mapSize,j.shadowCameraNear=Z.camera.near,j.shadowCameraFar=Z.camera.far,n.pointShadow[m]=j,n.pointShadowMap[m]=z,n.pointShadowMatrix[m]=P.shadow.matrix,y++}n.point[m]=N,m++}else if(P.isHemisphereLight){const N=t.get(P);N.skyColor.copy(P.color).multiplyScalar(I),N.groundColor.copy(P.groundColor).multiplyScalar(I),n.hemi[p]=N,p++}}g>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=gt.LTC_FLOAT_1,n.rectAreaLTC2=gt.LTC_FLOAT_2):(n.rectAreaLTC1=gt.LTC_HALF_1,n.rectAreaLTC2=gt.LTC_HALF_2)),n.ambient[0]=h,n.ambient[1]=u,n.ambient[2]=d;const E=n.hash;(E.directionalLength!==f||E.pointLength!==m||E.spotLength!==_||E.rectAreaLength!==g||E.hemiLength!==p||E.numDirectionalShadows!==b||E.numPointShadows!==y||E.numSpotShadows!==v||E.numSpotMaps!==x||E.numLightProbes!==T)&&(n.directional.length=f,n.spot.length=_,n.rectArea.length=g,n.point.length=m,n.hemi.length=p,n.directionalShadow.length=b,n.directionalShadowMap.length=b,n.pointShadow.length=y,n.pointShadowMap.length=y,n.spotShadow.length=v,n.spotShadowMap.length=v,n.directionalShadowMatrix.length=b,n.pointShadowMatrix.length=y,n.spotLightMatrix.length=v+x-S,n.spotLightMap.length=x,n.numSpotLightShadowsWithMaps=S,n.numLightProbes=T,E.directionalLength=f,E.pointLength=m,E.spotLength=_,E.rectAreaLength=g,E.hemiLength=p,E.numDirectionalShadows=b,E.numPointShadows=y,E.numSpotShadows=v,E.numSpotMaps=x,E.numLightProbes=T,n.version=MR++)}function c(l,h){let u=0,d=0,f=0,m=0,_=0;const g=h.matrixWorldInverse;for(let p=0,b=l.length;p<b;p++){const y=l[p];if(y.isDirectionalLight){const v=n.directional[u];v.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),v.direction.sub(i),v.direction.transformDirection(g),u++}else if(y.isSpotLight){const v=n.spot[f];v.position.setFromMatrixPosition(y.matrixWorld),v.position.applyMatrix4(g),v.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),v.direction.sub(i),v.direction.transformDirection(g),f++}else if(y.isRectAreaLight){const v=n.rectArea[m];v.position.setFromMatrixPosition(y.matrixWorld),v.position.applyMatrix4(g),o.identity(),s.copy(y.matrixWorld),s.premultiply(g),o.extractRotation(s),v.halfWidth.set(y.width*.5,0,0),v.halfHeight.set(0,y.height*.5,0),v.halfWidth.applyMatrix4(o),v.halfHeight.applyMatrix4(o),m++}else if(y.isPointLight){const v=n.point[d];v.position.setFromMatrixPosition(y.matrixWorld),v.position.applyMatrix4(g),d++}else if(y.isHemisphereLight){const v=n.hemi[_];v.direction.setFromMatrixPosition(y.matrixWorld),v.direction.transformDirection(g),_++}}}return{setup:a,setupView:c,state:n}}function Ib(r){const t=new ER(r),e=[],n=[];function i(h){l.camera=h,e.length=0,n.length=0}function s(h){e.push(h)}function o(h){n.push(h)}function a(){t.setup(e)}function c(h){t.setupView(e,h)}const l={lightsArray:e,shadowsArray:n,camera:null,lights:t,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:o}}function AR(r){let t=new WeakMap;function e(i,s=0){const o=t.get(i);let a;return o===void 0?(a=new Ib(r),t.set(i,[a])):s>=o.length?(a=new Ib(r),o.push(a)):a=o[s],a}function n(){t=new WeakMap}return{get:e,dispose:n}}class CR extends Hn{static get type(){return"MeshDepthMaterial"}constructor(t){super(),this.isMeshDepthMaterial=!0,this.depthPacking=oE,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class PR extends Hn{static get type(){return"MeshDistanceMaterial"}constructor(t){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const RR=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,DR=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function LR(r,t,e){let n=new Yd;const i=new J,s=new J,o=new ie,a=new CR({depthPacking:aE}),c=new PR,l={},h=e.maxTextureSize,u={[Bi]:Vn,[Vn]:Bi,[Sn]:Sn},d=new ws({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new J},radius:{value:4}},vertexShader:RR,fragmentShader:DR}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const m=new Qt;m.setAttribute("position",new Pe(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new ct(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Ix;let p=this.type;this.render=function(S,T,E){if(g.enabled===!1||g.autoUpdate===!1&&g.needsUpdate===!1||S.length===0)return;const w=r.getRenderTarget(),M=r.getActiveCubeFace(),P=r.getActiveMipmapLevel(),L=r.state;L.setBlending(Vr),L.buffers.color.setClear(1,1,1,1),L.buffers.depth.setTest(!0),L.setScissorTest(!1);const I=p!==Bs&&this.type===Bs,F=p===Bs&&this.type!==Bs;for(let z=0,N=S.length;z<N;z++){const Z=S[z],j=Z.shadow;if(j===void 0){console.warn("THREE.WebGLShadowMap:",Z,"has no shadow.");continue}if(j.autoUpdate===!1&&j.needsUpdate===!1)continue;i.copy(j.mapSize);const et=j.getFrameExtents();if(i.multiply(et),s.copy(j.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(s.x=Math.floor(h/et.x),i.x=s.x*et.x,j.mapSize.x=s.x),i.y>h&&(s.y=Math.floor(h/et.y),i.y=s.y*et.y,j.mapSize.y=s.y)),j.map===null||I===!0||F===!0){const at=this.type!==Bs?{minFilter:gn,magFilter:gn}:{};j.map!==null&&j.map.dispose(),j.map=new Bo(i.x,i.y,at),j.map.texture.name=Z.name+".shadowMap",j.camera.updateProjectionMatrix()}r.setRenderTarget(j.map),r.clear();const tt=j.getViewportCount();for(let at=0;at<tt;at++){const dt=j.getViewport(at);o.set(s.x*dt.x,s.y*dt.y,s.x*dt.z,s.y*dt.w),L.viewport(o),j.updateMatrices(Z,at),n=j.getFrustum(),v(T,E,j.camera,Z,this.type)}j.isPointLightShadow!==!0&&this.type===Bs&&b(j,E),j.needsUpdate=!1}p=this.type,g.needsUpdate=!1,r.setRenderTarget(w,M,P)};function b(S,T){const E=t.update(_);d.defines.VSM_SAMPLES!==S.blurSamples&&(d.defines.VSM_SAMPLES=S.blurSamples,f.defines.VSM_SAMPLES=S.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new Bo(i.x,i.y)),d.uniforms.shadow_pass.value=S.map.texture,d.uniforms.resolution.value=S.mapSize,d.uniforms.radius.value=S.radius,r.setRenderTarget(S.mapPass),r.clear(),r.renderBufferDirect(T,null,E,d,_,null),f.uniforms.shadow_pass.value=S.mapPass.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,r.setRenderTarget(S.map),r.clear(),r.renderBufferDirect(T,null,E,f,_,null)}function y(S,T,E,w){let M=null;const P=E.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(P!==void 0)M=P;else if(M=E.isPointLight===!0?c:a,r.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){const L=M.uuid,I=T.uuid;let F=l[L];F===void 0&&(F={},l[L]=F);let z=F[I];z===void 0&&(z=M.clone(),F[I]=z,T.addEventListener("dispose",x)),M=z}if(M.visible=T.visible,M.wireframe=T.wireframe,w===Bs?M.side=T.shadowSide!==null?T.shadowSide:T.side:M.side=T.shadowSide!==null?T.shadowSide:u[T.side],M.alphaMap=T.alphaMap,M.alphaTest=T.alphaTest,M.map=T.map,M.clipShadows=T.clipShadows,M.clippingPlanes=T.clippingPlanes,M.clipIntersection=T.clipIntersection,M.displacementMap=T.displacementMap,M.displacementScale=T.displacementScale,M.displacementBias=T.displacementBias,M.wireframeLinewidth=T.wireframeLinewidth,M.linewidth=T.linewidth,E.isPointLight===!0&&M.isMeshDistanceMaterial===!0){const L=r.properties.get(M);L.light=E}return M}function v(S,T,E,w,M){if(S.visible===!1)return;if(S.layers.test(T.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&M===Bs)&&(!S.frustumCulled||n.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,S.matrixWorld);const I=t.update(S),F=S.material;if(Array.isArray(F)){const z=I.groups;for(let N=0,Z=z.length;N<Z;N++){const j=z[N],et=F[j.materialIndex];if(et&&et.visible){const tt=y(S,et,w,M);S.onBeforeShadow(r,S,T,E,I,tt,j),r.renderBufferDirect(E,null,I,tt,S,j),S.onAfterShadow(r,S,T,E,I,tt,j)}}}else if(F.visible){const z=y(S,F,w,M);S.onBeforeShadow(r,S,T,E,I,z,null),r.renderBufferDirect(E,null,I,z,S,null),S.onAfterShadow(r,S,T,E,I,z,null)}}const L=S.children;for(let I=0,F=L.length;I<F;I++)v(L[I],T,E,w,M)}function x(S){S.target.removeEventListener("dispose",x);for(const E in l){const w=l[E],M=S.target.uuid;M in w&&(w[M].dispose(),delete w[M])}}}const IR={[am]:cm,[lm]:dm,[hm]:fm,[uc]:um,[cm]:am,[dm]:lm,[fm]:hm,[um]:uc};function OR(r,t){function e(){let V=!1;const _t=new ie;let $=null;const rt=new ie(0,0,0,0);return{setMask:function(xt){$!==xt&&!V&&(r.colorMask(xt,xt,xt,xt),$=xt)},setLocked:function(xt){V=xt},setClear:function(xt,yt,Wt,ze,yn){yn===!0&&(xt*=ze,yt*=ze,Wt*=ze),_t.set(xt,yt,Wt,ze),rt.equals(_t)===!1&&(r.clearColor(xt,yt,Wt,ze),rt.copy(_t))},reset:function(){V=!1,$=null,rt.set(-1,0,0,0)}}}function n(){let V=!1,_t=!1,$=null,rt=null,xt=null;return{setReversed:function(yt){if(_t!==yt){const Wt=t.get("EXT_clip_control");_t?Wt.clipControlEXT(Wt.LOWER_LEFT_EXT,Wt.ZERO_TO_ONE_EXT):Wt.clipControlEXT(Wt.LOWER_LEFT_EXT,Wt.NEGATIVE_ONE_TO_ONE_EXT);const ze=xt;xt=null,this.setClear(ze)}_t=yt},getReversed:function(){return _t},setTest:function(yt){yt?ht(r.DEPTH_TEST):It(r.DEPTH_TEST)},setMask:function(yt){$!==yt&&!V&&(r.depthMask(yt),$=yt)},setFunc:function(yt){if(_t&&(yt=IR[yt]),rt!==yt){switch(yt){case am:r.depthFunc(r.NEVER);break;case cm:r.depthFunc(r.ALWAYS);break;case lm:r.depthFunc(r.LESS);break;case uc:r.depthFunc(r.LEQUAL);break;case hm:r.depthFunc(r.EQUAL);break;case um:r.depthFunc(r.GEQUAL);break;case dm:r.depthFunc(r.GREATER);break;case fm:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}rt=yt}},setLocked:function(yt){V=yt},setClear:function(yt){xt!==yt&&(_t&&(yt=1-yt),r.clearDepth(yt),xt=yt)},reset:function(){V=!1,$=null,rt=null,xt=null,_t=!1}}}function i(){let V=!1,_t=null,$=null,rt=null,xt=null,yt=null,Wt=null,ze=null,yn=null;return{setTest:function(me){V||(me?ht(r.STENCIL_TEST):It(r.STENCIL_TEST))},setMask:function(me){_t!==me&&!V&&(r.stencilMask(me),_t=me)},setFunc:function(me,Vi,Rs){($!==me||rt!==Vi||xt!==Rs)&&(r.stencilFunc(me,Vi,Rs),$=me,rt=Vi,xt=Rs)},setOp:function(me,Vi,Rs){(yt!==me||Wt!==Vi||ze!==Rs)&&(r.stencilOp(me,Vi,Rs),yt=me,Wt=Vi,ze=Rs)},setLocked:function(me){V=me},setClear:function(me){yn!==me&&(r.clearStencil(me),yn=me)},reset:function(){V=!1,_t=null,$=null,rt=null,xt=null,yt=null,Wt=null,ze=null,yn=null}}}const s=new e,o=new n,a=new i,c=new WeakMap,l=new WeakMap;let h={},u={},d=new WeakMap,f=[],m=null,_=!1,g=null,p=null,b=null,y=null,v=null,x=null,S=null,T=new pt(0,0,0),E=0,w=!1,M=null,P=null,L=null,I=null,F=null;const z=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let N=!1,Z=0;const j=r.getParameter(r.VERSION);j.indexOf("WebGL")!==-1?(Z=parseFloat(/^WebGL (\d)/.exec(j)[1]),N=Z>=1):j.indexOf("OpenGL ES")!==-1&&(Z=parseFloat(/^OpenGL ES (\d)/.exec(j)[1]),N=Z>=2);let et=null,tt={};const at=r.getParameter(r.SCISSOR_BOX),dt=r.getParameter(r.VIEWPORT),St=new ie().fromArray(at),O=new ie().fromArray(dt);function it(V,_t,$,rt){const xt=new Uint8Array(4),yt=r.createTexture();r.bindTexture(V,yt),r.texParameteri(V,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(V,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Wt=0;Wt<$;Wt++)V===r.TEXTURE_3D||V===r.TEXTURE_2D_ARRAY?r.texImage3D(_t,0,r.RGBA,1,1,rt,0,r.RGBA,r.UNSIGNED_BYTE,xt):r.texImage2D(_t+Wt,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,xt);return yt}const mt={};mt[r.TEXTURE_2D]=it(r.TEXTURE_2D,r.TEXTURE_2D,1),mt[r.TEXTURE_CUBE_MAP]=it(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),mt[r.TEXTURE_2D_ARRAY]=it(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),mt[r.TEXTURE_3D]=it(r.TEXTURE_3D,r.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),ht(r.DEPTH_TEST),o.setFunc(uc),re(!1),oe(k_),ht(r.CULL_FACE),W(Vr);function ht(V){h[V]!==!0&&(r.enable(V),h[V]=!0)}function It(V){h[V]!==!1&&(r.disable(V),h[V]=!1)}function kt(V,_t){return u[V]!==_t?(r.bindFramebuffer(V,_t),u[V]=_t,V===r.DRAW_FRAMEBUFFER&&(u[r.FRAMEBUFFER]=_t),V===r.FRAMEBUFFER&&(u[r.DRAW_FRAMEBUFFER]=_t),!0):!1}function zt(V,_t){let $=f,rt=!1;if(V){$=d.get(_t),$===void 0&&($=[],d.set(_t,$));const xt=V.textures;if($.length!==xt.length||$[0]!==r.COLOR_ATTACHMENT0){for(let yt=0,Wt=xt.length;yt<Wt;yt++)$[yt]=r.COLOR_ATTACHMENT0+yt;$.length=xt.length,rt=!0}}else $[0]!==r.BACK&&($[0]=r.BACK,rt=!0);rt&&r.drawBuffers($)}function Fe(V){return m!==V?(r.useProgram(V),m=V,!0):!1}const ce={[So]:r.FUNC_ADD,[LT]:r.FUNC_SUBTRACT,[IT]:r.FUNC_REVERSE_SUBTRACT};ce[OT]=r.MIN,ce[FT]=r.MAX;const je={[kT]:r.ZERO,[NT]:r.ONE,[UT]:r.SRC_COLOR,[rm]:r.SRC_ALPHA,[jT]:r.SRC_ALPHA_SATURATE,[HT]:r.DST_COLOR,[zT]:r.DST_ALPHA,[BT]:r.ONE_MINUS_SRC_COLOR,[om]:r.ONE_MINUS_SRC_ALPHA,[GT]:r.ONE_MINUS_DST_COLOR,[VT]:r.ONE_MINUS_DST_ALPHA,[WT]:r.CONSTANT_COLOR,[XT]:r.ONE_MINUS_CONSTANT_COLOR,[YT]:r.CONSTANT_ALPHA,[qT]:r.ONE_MINUS_CONSTANT_ALPHA};function W(V,_t,$,rt,xt,yt,Wt,ze,yn,me){if(V===Vr){_===!0&&(It(r.BLEND),_=!1);return}if(_===!1&&(ht(r.BLEND),_=!0),V!==DT){if(V!==g||me!==w){if((p!==So||v!==So)&&(r.blendEquation(r.FUNC_ADD),p=So,v=So),me)switch(V){case Ja:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case N_:r.blendFunc(r.ONE,r.ONE);break;case U_:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case B_:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",V);break}else switch(V){case Ja:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case N_:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case U_:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case B_:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",V);break}b=null,y=null,x=null,S=null,T.set(0,0,0),E=0,g=V,w=me}return}xt=xt||_t,yt=yt||$,Wt=Wt||rt,(_t!==p||xt!==v)&&(r.blendEquationSeparate(ce[_t],ce[xt]),p=_t,v=xt),($!==b||rt!==y||yt!==x||Wt!==S)&&(r.blendFuncSeparate(je[$],je[rt],je[yt],je[Wt]),b=$,y=rt,x=yt,S=Wt),(ze.equals(T)===!1||yn!==E)&&(r.blendColor(ze.r,ze.g,ze.b,yn),T.copy(ze),E=yn),g=V,w=!1}function xi(V,_t){V.side===Sn?It(r.CULL_FACE):ht(r.CULL_FACE);let $=V.side===Vn;_t&&($=!$),re($),V.blending===Ja&&V.transparent===!1?W(Vr):W(V.blending,V.blendEquation,V.blendSrc,V.blendDst,V.blendEquationAlpha,V.blendSrcAlpha,V.blendDstAlpha,V.blendColor,V.blendAlpha,V.premultipliedAlpha),o.setFunc(V.depthFunc),o.setTest(V.depthTest),o.setMask(V.depthWrite),s.setMask(V.colorWrite);const rt=V.stencilWrite;a.setTest(rt),rt&&(a.setMask(V.stencilWriteMask),a.setFunc(V.stencilFunc,V.stencilRef,V.stencilFuncMask),a.setOp(V.stencilFail,V.stencilZFail,V.stencilZPass)),Te(V.polygonOffset,V.polygonOffsetFactor,V.polygonOffsetUnits),V.alphaToCoverage===!0?ht(r.SAMPLE_ALPHA_TO_COVERAGE):It(r.SAMPLE_ALPHA_TO_COVERAGE)}function re(V){M!==V&&(V?r.frontFace(r.CW):r.frontFace(r.CCW),M=V)}function oe(V){V!==PT?(ht(r.CULL_FACE),V!==P&&(V===k_?r.cullFace(r.BACK):V===RT?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):It(r.CULL_FACE),P=V}function Nt(V){V!==L&&(N&&r.lineWidth(V),L=V)}function Te(V,_t,$){V?(ht(r.POLYGON_OFFSET_FILL),(I!==_t||F!==$)&&(r.polygonOffset(_t,$),I=_t,F=$)):It(r.POLYGON_OFFSET_FILL)}function Ft(V){V?ht(r.SCISSOR_TEST):It(r.SCISSOR_TEST)}function k(V){V===void 0&&(V=r.TEXTURE0+z-1),et!==V&&(r.activeTexture(V),et=V)}function R(V,_t,$){$===void 0&&(et===null?$=r.TEXTURE0+z-1:$=et);let rt=tt[$];rt===void 0&&(rt={type:void 0,texture:void 0},tt[$]=rt),(rt.type!==V||rt.texture!==_t)&&(et!==$&&(r.activeTexture($),et=$),r.bindTexture(V,_t||mt[V]),rt.type=V,rt.texture=_t)}function X(){const V=tt[et];V!==void 0&&V.type!==void 0&&(r.bindTexture(V.type,null),V.type=void 0,V.texture=void 0)}function st(){try{r.compressedTexImage2D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function ot(){try{r.compressedTexImage3D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function nt(){try{r.texSubImage2D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Dt(){try{r.texSubImage3D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function bt(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Mt(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function le(){try{r.texStorage2D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function ut(){try{r.texStorage3D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Tt(){try{r.texImage2D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Ut(){try{r.texImage3D.apply(r,arguments)}catch(V){console.error("THREE.WebGLState:",V)}}function Vt(V){St.equals(V)===!1&&(r.scissor(V.x,V.y,V.z,V.w),St.copy(V))}function Et(V){O.equals(V)===!1&&(r.viewport(V.x,V.y,V.z,V.w),O.copy(V))}function ae(V,_t){let $=l.get(_t);$===void 0&&($=new WeakMap,l.set(_t,$));let rt=$.get(V);rt===void 0&&(rt=r.getUniformBlockIndex(_t,V.name),$.set(V,rt))}function Yt(V,_t){const rt=l.get(_t).get(V);c.get(_t)!==rt&&(r.uniformBlockBinding(_t,rt,V.__bindingPointIndex),c.set(_t,rt))}function we(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),o.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),h={},et=null,tt={},u={},d=new WeakMap,f=[],m=null,_=!1,g=null,p=null,b=null,y=null,v=null,x=null,S=null,T=new pt(0,0,0),E=0,w=!1,M=null,P=null,L=null,I=null,F=null,St.set(0,0,r.canvas.width,r.canvas.height),O.set(0,0,r.canvas.width,r.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:ht,disable:It,bindFramebuffer:kt,drawBuffers:zt,useProgram:Fe,setBlending:W,setMaterial:xi,setFlipSided:re,setCullFace:oe,setLineWidth:Nt,setPolygonOffset:Te,setScissorTest:Ft,activeTexture:k,bindTexture:R,unbindTexture:X,compressedTexImage2D:st,compressedTexImage3D:ot,texImage2D:Tt,texImage3D:Ut,updateUBOMapping:ae,uniformBlockBinding:Yt,texStorage2D:le,texStorage3D:ut,texSubImage2D:nt,texSubImage3D:Dt,compressedTexSubImage2D:bt,compressedTexSubImage3D:Mt,scissor:Vt,viewport:Et,reset:we}}function Ob(r,t,e,n){const i=FR(n);switch(e){case zx:return r*t;case Hx:return r*t;case Gx:return r*t*2;case Wg:return r*t/i.components*i.byteLength;case jd:return r*t/i.components*i.byteLength;case jx:return r*t*2/i.components*i.byteLength;case Xg:return r*t*2/i.components*i.byteLength;case Vx:return r*t*3/i.components*i.byteLength;case zn:return r*t*4/i.components*i.byteLength;case Yg:return r*t*4/i.components*i.byteLength;case $u:case Ju:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*8;case td:case ed:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case gm:case bm:return Math.max(r,16)*Math.max(t,8)/4;case mm:case _m:return Math.max(r,8)*Math.max(t,8)/2;case ym:case vm:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*8;case xm:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case wm:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case Sm:return Math.floor((r+4)/5)*Math.floor((t+3)/4)*16;case Mm:return Math.floor((r+4)/5)*Math.floor((t+4)/5)*16;case Tm:return Math.floor((r+5)/6)*Math.floor((t+4)/5)*16;case Em:return Math.floor((r+5)/6)*Math.floor((t+5)/6)*16;case Am:return Math.floor((r+7)/8)*Math.floor((t+4)/5)*16;case Cm:return Math.floor((r+7)/8)*Math.floor((t+5)/6)*16;case Pm:return Math.floor((r+7)/8)*Math.floor((t+7)/8)*16;case Rm:return Math.floor((r+9)/10)*Math.floor((t+4)/5)*16;case Dm:return Math.floor((r+9)/10)*Math.floor((t+5)/6)*16;case Lm:return Math.floor((r+9)/10)*Math.floor((t+7)/8)*16;case Im:return Math.floor((r+9)/10)*Math.floor((t+9)/10)*16;case Om:return Math.floor((r+11)/12)*Math.floor((t+9)/10)*16;case Fm:return Math.floor((r+11)/12)*Math.floor((t+11)/12)*16;case nd:case km:case Nm:return Math.ceil(r/4)*Math.ceil(t/4)*16;case Wx:case Um:return Math.ceil(r/4)*Math.ceil(t/4)*8;case Bm:case zm:return Math.ceil(r/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${e} format.`)}function FR(r){switch(r){case or:case Nx:return{byteLength:1,components:1};case Vl:case Ux:case Ks:return{byteLength:2,components:1};case Gg:case jg:return{byteLength:2,components:4};case Xr:case Hg:case Tn:return{byteLength:4,components:1};case Bx:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}function kR(r,t,e,n,i,s,o){const a=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new J,h=new WeakMap;let u;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function m(k,R){return f?new OffscreenCanvas(k,R):Hl("canvas")}function _(k,R,X){let st=1;const ot=Ft(k);if((ot.width>X||ot.height>X)&&(st=X/Math.max(ot.width,ot.height)),st<1)if(typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&k instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&k instanceof ImageBitmap||typeof VideoFrame<"u"&&k instanceof VideoFrame){const nt=Math.floor(st*ot.width),Dt=Math.floor(st*ot.height);u===void 0&&(u=m(nt,Dt));const bt=R?m(nt,Dt):u;return bt.width=nt,bt.height=Dt,bt.getContext("2d").drawImage(k,0,0,nt,Dt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ot.width+"x"+ot.height+") to ("+nt+"x"+Dt+")."),bt}else return"data"in k&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ot.width+"x"+ot.height+")."),k;return k}function g(k){return k.generateMipmaps}function p(k){r.generateMipmap(k)}function b(k){return k.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:k.isWebGL3DRenderTarget?r.TEXTURE_3D:k.isWebGLArrayRenderTarget||k.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function y(k,R,X,st,ot=!1){if(k!==null){if(r[k]!==void 0)return r[k];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+k+"'")}let nt=R;if(R===r.RED&&(X===r.FLOAT&&(nt=r.R32F),X===r.HALF_FLOAT&&(nt=r.R16F),X===r.UNSIGNED_BYTE&&(nt=r.R8)),R===r.RED_INTEGER&&(X===r.UNSIGNED_BYTE&&(nt=r.R8UI),X===r.UNSIGNED_SHORT&&(nt=r.R16UI),X===r.UNSIGNED_INT&&(nt=r.R32UI),X===r.BYTE&&(nt=r.R8I),X===r.SHORT&&(nt=r.R16I),X===r.INT&&(nt=r.R32I)),R===r.RG&&(X===r.FLOAT&&(nt=r.RG32F),X===r.HALF_FLOAT&&(nt=r.RG16F),X===r.UNSIGNED_BYTE&&(nt=r.RG8)),R===r.RG_INTEGER&&(X===r.UNSIGNED_BYTE&&(nt=r.RG8UI),X===r.UNSIGNED_SHORT&&(nt=r.RG16UI),X===r.UNSIGNED_INT&&(nt=r.RG32UI),X===r.BYTE&&(nt=r.RG8I),X===r.SHORT&&(nt=r.RG16I),X===r.INT&&(nt=r.RG32I)),R===r.RGB_INTEGER&&(X===r.UNSIGNED_BYTE&&(nt=r.RGB8UI),X===r.UNSIGNED_SHORT&&(nt=r.RGB16UI),X===r.UNSIGNED_INT&&(nt=r.RGB32UI),X===r.BYTE&&(nt=r.RGB8I),X===r.SHORT&&(nt=r.RGB16I),X===r.INT&&(nt=r.RGB32I)),R===r.RGBA_INTEGER&&(X===r.UNSIGNED_BYTE&&(nt=r.RGBA8UI),X===r.UNSIGNED_SHORT&&(nt=r.RGBA16UI),X===r.UNSIGNED_INT&&(nt=r.RGBA32UI),X===r.BYTE&&(nt=r.RGBA8I),X===r.SHORT&&(nt=r.RGBA16I),X===r.INT&&(nt=r.RGBA32I)),R===r.RGB&&X===r.UNSIGNED_INT_5_9_9_9_REV&&(nt=r.RGB9_E5),R===r.RGBA){const Dt=ot?Xd:ne.getTransfer(st);X===r.FLOAT&&(nt=r.RGBA32F),X===r.HALF_FLOAT&&(nt=r.RGBA16F),X===r.UNSIGNED_BYTE&&(nt=Dt===be?r.SRGB8_ALPHA8:r.RGBA8),X===r.UNSIGNED_SHORT_4_4_4_4&&(nt=r.RGBA4),X===r.UNSIGNED_SHORT_5_5_5_1&&(nt=r.RGB5_A1)}return(nt===r.R16F||nt===r.R32F||nt===r.RG16F||nt===r.RG32F||nt===r.RGBA16F||nt===r.RGBA32F)&&t.get("EXT_color_buffer_float"),nt}function v(k,R){let X;return k?R===null||R===Xr||R===mc?X=r.DEPTH24_STENCIL8:R===Tn?X=r.DEPTH32F_STENCIL8:R===Vl&&(X=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):R===null||R===Xr||R===mc?X=r.DEPTH_COMPONENT24:R===Tn?X=r.DEPTH_COMPONENT32F:R===Vl&&(X=r.DEPTH_COMPONENT16),X}function x(k,R){return g(k)===!0||k.isFramebufferTexture&&k.minFilter!==gn&&k.minFilter!==dn?Math.log2(Math.max(R.width,R.height))+1:k.mipmaps!==void 0&&k.mipmaps.length>0?k.mipmaps.length:k.isCompressedTexture&&Array.isArray(k.image)?R.mipmaps.length:1}function S(k){const R=k.target;R.removeEventListener("dispose",S),E(R),R.isVideoTexture&&h.delete(R)}function T(k){const R=k.target;R.removeEventListener("dispose",T),M(R)}function E(k){const R=n.get(k);if(R.__webglInit===void 0)return;const X=k.source,st=d.get(X);if(st){const ot=st[R.__cacheKey];ot.usedTimes--,ot.usedTimes===0&&w(k),Object.keys(st).length===0&&d.delete(X)}n.remove(k)}function w(k){const R=n.get(k);r.deleteTexture(R.__webglTexture);const X=k.source,st=d.get(X);delete st[R.__cacheKey],o.memory.textures--}function M(k){const R=n.get(k);if(k.depthTexture&&(k.depthTexture.dispose(),n.remove(k.depthTexture)),k.isWebGLCubeRenderTarget)for(let st=0;st<6;st++){if(Array.isArray(R.__webglFramebuffer[st]))for(let ot=0;ot<R.__webglFramebuffer[st].length;ot++)r.deleteFramebuffer(R.__webglFramebuffer[st][ot]);else r.deleteFramebuffer(R.__webglFramebuffer[st]);R.__webglDepthbuffer&&r.deleteRenderbuffer(R.__webglDepthbuffer[st])}else{if(Array.isArray(R.__webglFramebuffer))for(let st=0;st<R.__webglFramebuffer.length;st++)r.deleteFramebuffer(R.__webglFramebuffer[st]);else r.deleteFramebuffer(R.__webglFramebuffer);if(R.__webglDepthbuffer&&r.deleteRenderbuffer(R.__webglDepthbuffer),R.__webglMultisampledFramebuffer&&r.deleteFramebuffer(R.__webglMultisampledFramebuffer),R.__webglColorRenderbuffer)for(let st=0;st<R.__webglColorRenderbuffer.length;st++)R.__webglColorRenderbuffer[st]&&r.deleteRenderbuffer(R.__webglColorRenderbuffer[st]);R.__webglDepthRenderbuffer&&r.deleteRenderbuffer(R.__webglDepthRenderbuffer)}const X=k.textures;for(let st=0,ot=X.length;st<ot;st++){const nt=n.get(X[st]);nt.__webglTexture&&(r.deleteTexture(nt.__webglTexture),o.memory.textures--),n.remove(X[st])}n.remove(k)}let P=0;function L(){P=0}function I(){const k=P;return k>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+k+" texture units while this GPU supports only "+i.maxTextures),P+=1,k}function F(k){const R=[];return R.push(k.wrapS),R.push(k.wrapT),R.push(k.wrapR||0),R.push(k.magFilter),R.push(k.minFilter),R.push(k.anisotropy),R.push(k.internalFormat),R.push(k.format),R.push(k.type),R.push(k.generateMipmaps),R.push(k.premultiplyAlpha),R.push(k.flipY),R.push(k.unpackAlignment),R.push(k.colorSpace),R.join()}function z(k,R){const X=n.get(k);if(k.isVideoTexture&&Nt(k),k.isRenderTargetTexture===!1&&k.version>0&&X.__version!==k.version){const st=k.image;if(st===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(st.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{O(X,k,R);return}}e.bindTexture(r.TEXTURE_2D,X.__webglTexture,r.TEXTURE0+R)}function N(k,R){const X=n.get(k);if(k.version>0&&X.__version!==k.version){O(X,k,R);return}e.bindTexture(r.TEXTURE_2D_ARRAY,X.__webglTexture,r.TEXTURE0+R)}function Z(k,R){const X=n.get(k);if(k.version>0&&X.__version!==k.version){O(X,k,R);return}e.bindTexture(r.TEXTURE_3D,X.__webglTexture,r.TEXTURE0+R)}function j(k,R){const X=n.get(k);if(k.version>0&&X.__version!==k.version){it(X,k,R);return}e.bindTexture(r.TEXTURE_CUBE_MAP,X.__webglTexture,r.TEXTURE0+R)}const et={[xs]:r.REPEAT,[di]:r.CLAMP_TO_EDGE,[zl]:r.MIRRORED_REPEAT},tt={[gn]:r.NEAREST,[Vg]:r.NEAREST_MIPMAP_NEAREST,[za]:r.NEAREST_MIPMAP_LINEAR,[dn]:r.LINEAR,[Ml]:r.LINEAR_MIPMAP_NEAREST,[Ji]:r.LINEAR_MIPMAP_LINEAR},at={[lE]:r.NEVER,[mE]:r.ALWAYS,[hE]:r.LESS,[Zx]:r.LEQUAL,[uE]:r.EQUAL,[pE]:r.GEQUAL,[dE]:r.GREATER,[fE]:r.NOTEQUAL};function dt(k,R){if(R.type===Tn&&t.has("OES_texture_float_linear")===!1&&(R.magFilter===dn||R.magFilter===Ml||R.magFilter===za||R.magFilter===Ji||R.minFilter===dn||R.minFilter===Ml||R.minFilter===za||R.minFilter===Ji)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(k,r.TEXTURE_WRAP_S,et[R.wrapS]),r.texParameteri(k,r.TEXTURE_WRAP_T,et[R.wrapT]),(k===r.TEXTURE_3D||k===r.TEXTURE_2D_ARRAY)&&r.texParameteri(k,r.TEXTURE_WRAP_R,et[R.wrapR]),r.texParameteri(k,r.TEXTURE_MAG_FILTER,tt[R.magFilter]),r.texParameteri(k,r.TEXTURE_MIN_FILTER,tt[R.minFilter]),R.compareFunction&&(r.texParameteri(k,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(k,r.TEXTURE_COMPARE_FUNC,at[R.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){if(R.magFilter===gn||R.minFilter!==za&&R.minFilter!==Ji||R.type===Tn&&t.has("OES_texture_float_linear")===!1)return;if(R.anisotropy>1||n.get(R).__currentAnisotropy){const X=t.get("EXT_texture_filter_anisotropic");r.texParameterf(k,X.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(R.anisotropy,i.getMaxAnisotropy())),n.get(R).__currentAnisotropy=R.anisotropy}}}function St(k,R){let X=!1;k.__webglInit===void 0&&(k.__webglInit=!0,R.addEventListener("dispose",S));const st=R.source;let ot=d.get(st);ot===void 0&&(ot={},d.set(st,ot));const nt=F(R);if(nt!==k.__cacheKey){ot[nt]===void 0&&(ot[nt]={texture:r.createTexture(),usedTimes:0},o.memory.textures++,X=!0),ot[nt].usedTimes++;const Dt=ot[k.__cacheKey];Dt!==void 0&&(ot[k.__cacheKey].usedTimes--,Dt.usedTimes===0&&w(R)),k.__cacheKey=nt,k.__webglTexture=ot[nt].texture}return X}function O(k,R,X){let st=r.TEXTURE_2D;(R.isDataArrayTexture||R.isCompressedArrayTexture)&&(st=r.TEXTURE_2D_ARRAY),R.isData3DTexture&&(st=r.TEXTURE_3D);const ot=St(k,R),nt=R.source;e.bindTexture(st,k.__webglTexture,r.TEXTURE0+X);const Dt=n.get(nt);if(nt.version!==Dt.__version||ot===!0){e.activeTexture(r.TEXTURE0+X);const bt=ne.getPrimaries(ne.workingColorSpace),Mt=R.colorSpace===Ir?null:ne.getPrimaries(R.colorSpace),le=R.colorSpace===Ir||bt===Mt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,R.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,R.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,R.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,le);let ut=_(R.image,!1,i.maxTextureSize);ut=Te(R,ut);const Tt=s.convert(R.format,R.colorSpace),Ut=s.convert(R.type);let Vt=y(R.internalFormat,Tt,Ut,R.colorSpace,R.isVideoTexture);dt(st,R);let Et;const ae=R.mipmaps,Yt=R.isVideoTexture!==!0,we=Dt.__version===void 0||ot===!0,V=nt.dataReady,_t=x(R,ut);if(R.isDepthTexture)Vt=v(R.format===gc,R.type),we&&(Yt?e.texStorage2D(r.TEXTURE_2D,1,Vt,ut.width,ut.height):e.texImage2D(r.TEXTURE_2D,0,Vt,ut.width,ut.height,0,Tt,Ut,null));else if(R.isDataTexture)if(ae.length>0){Yt&&we&&e.texStorage2D(r.TEXTURE_2D,_t,Vt,ae[0].width,ae[0].height);for(let $=0,rt=ae.length;$<rt;$++)Et=ae[$],Yt?V&&e.texSubImage2D(r.TEXTURE_2D,$,0,0,Et.width,Et.height,Tt,Ut,Et.data):e.texImage2D(r.TEXTURE_2D,$,Vt,Et.width,Et.height,0,Tt,Ut,Et.data);R.generateMipmaps=!1}else Yt?(we&&e.texStorage2D(r.TEXTURE_2D,_t,Vt,ut.width,ut.height),V&&e.texSubImage2D(r.TEXTURE_2D,0,0,0,ut.width,ut.height,Tt,Ut,ut.data)):e.texImage2D(r.TEXTURE_2D,0,Vt,ut.width,ut.height,0,Tt,Ut,ut.data);else if(R.isCompressedTexture)if(R.isCompressedArrayTexture){Yt&&we&&e.texStorage3D(r.TEXTURE_2D_ARRAY,_t,Vt,ae[0].width,ae[0].height,ut.depth);for(let $=0,rt=ae.length;$<rt;$++)if(Et=ae[$],R.format!==zn)if(Tt!==null)if(Yt){if(V)if(R.layerUpdates.size>0){const xt=Ob(Et.width,Et.height,R.format,R.type);for(const yt of R.layerUpdates){const Wt=Et.data.subarray(yt*xt/Et.data.BYTES_PER_ELEMENT,(yt+1)*xt/Et.data.BYTES_PER_ELEMENT);e.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,$,0,0,yt,Et.width,Et.height,1,Tt,Wt)}R.clearLayerUpdates()}else e.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,$,0,0,0,Et.width,Et.height,ut.depth,Tt,Et.data)}else e.compressedTexImage3D(r.TEXTURE_2D_ARRAY,$,Vt,Et.width,Et.height,ut.depth,0,Et.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Yt?V&&e.texSubImage3D(r.TEXTURE_2D_ARRAY,$,0,0,0,Et.width,Et.height,ut.depth,Tt,Ut,Et.data):e.texImage3D(r.TEXTURE_2D_ARRAY,$,Vt,Et.width,Et.height,ut.depth,0,Tt,Ut,Et.data)}else{Yt&&we&&e.texStorage2D(r.TEXTURE_2D,_t,Vt,ae[0].width,ae[0].height);for(let $=0,rt=ae.length;$<rt;$++)Et=ae[$],R.format!==zn?Tt!==null?Yt?V&&e.compressedTexSubImage2D(r.TEXTURE_2D,$,0,0,Et.width,Et.height,Tt,Et.data):e.compressedTexImage2D(r.TEXTURE_2D,$,Vt,Et.width,Et.height,0,Et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Yt?V&&e.texSubImage2D(r.TEXTURE_2D,$,0,0,Et.width,Et.height,Tt,Ut,Et.data):e.texImage2D(r.TEXTURE_2D,$,Vt,Et.width,Et.height,0,Tt,Ut,Et.data)}else if(R.isDataArrayTexture)if(Yt){if(we&&e.texStorage3D(r.TEXTURE_2D_ARRAY,_t,Vt,ut.width,ut.height,ut.depth),V)if(R.layerUpdates.size>0){const $=Ob(ut.width,ut.height,R.format,R.type);for(const rt of R.layerUpdates){const xt=ut.data.subarray(rt*$/ut.data.BYTES_PER_ELEMENT,(rt+1)*$/ut.data.BYTES_PER_ELEMENT);e.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,rt,ut.width,ut.height,1,Tt,Ut,xt)}R.clearLayerUpdates()}else e.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,ut.width,ut.height,ut.depth,Tt,Ut,ut.data)}else e.texImage3D(r.TEXTURE_2D_ARRAY,0,Vt,ut.width,ut.height,ut.depth,0,Tt,Ut,ut.data);else if(R.isData3DTexture)Yt?(we&&e.texStorage3D(r.TEXTURE_3D,_t,Vt,ut.width,ut.height,ut.depth),V&&e.texSubImage3D(r.TEXTURE_3D,0,0,0,0,ut.width,ut.height,ut.depth,Tt,Ut,ut.data)):e.texImage3D(r.TEXTURE_3D,0,Vt,ut.width,ut.height,ut.depth,0,Tt,Ut,ut.data);else if(R.isFramebufferTexture){if(we)if(Yt)e.texStorage2D(r.TEXTURE_2D,_t,Vt,ut.width,ut.height);else{let $=ut.width,rt=ut.height;for(let xt=0;xt<_t;xt++)e.texImage2D(r.TEXTURE_2D,xt,Vt,$,rt,0,Tt,Ut,null),$>>=1,rt>>=1}}else if(ae.length>0){if(Yt&&we){const $=Ft(ae[0]);e.texStorage2D(r.TEXTURE_2D,_t,Vt,$.width,$.height)}for(let $=0,rt=ae.length;$<rt;$++)Et=ae[$],Yt?V&&e.texSubImage2D(r.TEXTURE_2D,$,0,0,Tt,Ut,Et):e.texImage2D(r.TEXTURE_2D,$,Vt,Tt,Ut,Et);R.generateMipmaps=!1}else if(Yt){if(we){const $=Ft(ut);e.texStorage2D(r.TEXTURE_2D,_t,Vt,$.width,$.height)}V&&e.texSubImage2D(r.TEXTURE_2D,0,0,0,Tt,Ut,ut)}else e.texImage2D(r.TEXTURE_2D,0,Vt,Tt,Ut,ut);g(R)&&p(st),Dt.__version=nt.version,R.onUpdate&&R.onUpdate(R)}k.__version=R.version}function it(k,R,X){if(R.image.length!==6)return;const st=St(k,R),ot=R.source;e.bindTexture(r.TEXTURE_CUBE_MAP,k.__webglTexture,r.TEXTURE0+X);const nt=n.get(ot);if(ot.version!==nt.__version||st===!0){e.activeTexture(r.TEXTURE0+X);const Dt=ne.getPrimaries(ne.workingColorSpace),bt=R.colorSpace===Ir?null:ne.getPrimaries(R.colorSpace),Mt=R.colorSpace===Ir||Dt===bt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,R.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,R.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,R.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,Mt);const le=R.isCompressedTexture||R.image[0].isCompressedTexture,ut=R.image[0]&&R.image[0].isDataTexture,Tt=[];for(let rt=0;rt<6;rt++)!le&&!ut?Tt[rt]=_(R.image[rt],!0,i.maxCubemapSize):Tt[rt]=ut?R.image[rt].image:R.image[rt],Tt[rt]=Te(R,Tt[rt]);const Ut=Tt[0],Vt=s.convert(R.format,R.colorSpace),Et=s.convert(R.type),ae=y(R.internalFormat,Vt,Et,R.colorSpace),Yt=R.isVideoTexture!==!0,we=nt.__version===void 0||st===!0,V=ot.dataReady;let _t=x(R,Ut);dt(r.TEXTURE_CUBE_MAP,R);let $;if(le){Yt&&we&&e.texStorage2D(r.TEXTURE_CUBE_MAP,_t,ae,Ut.width,Ut.height);for(let rt=0;rt<6;rt++){$=Tt[rt].mipmaps;for(let xt=0;xt<$.length;xt++){const yt=$[xt];R.format!==zn?Vt!==null?Yt?V&&e.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,xt,0,0,yt.width,yt.height,Vt,yt.data):e.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,xt,ae,yt.width,yt.height,0,yt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Yt?V&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,xt,0,0,yt.width,yt.height,Vt,Et,yt.data):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,xt,ae,yt.width,yt.height,0,Vt,Et,yt.data)}}}else{if($=R.mipmaps,Yt&&we){$.length>0&&_t++;const rt=Ft(Tt[0]);e.texStorage2D(r.TEXTURE_CUBE_MAP,_t,ae,rt.width,rt.height)}for(let rt=0;rt<6;rt++)if(ut){Yt?V&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,0,0,0,Tt[rt].width,Tt[rt].height,Vt,Et,Tt[rt].data):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,0,ae,Tt[rt].width,Tt[rt].height,0,Vt,Et,Tt[rt].data);for(let xt=0;xt<$.length;xt++){const Wt=$[xt].image[rt].image;Yt?V&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,xt+1,0,0,Wt.width,Wt.height,Vt,Et,Wt.data):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,xt+1,ae,Wt.width,Wt.height,0,Vt,Et,Wt.data)}}else{Yt?V&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,0,0,0,Vt,Et,Tt[rt]):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,0,ae,Vt,Et,Tt[rt]);for(let xt=0;xt<$.length;xt++){const yt=$[xt];Yt?V&&e.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,xt+1,0,0,Vt,Et,yt.image[rt]):e.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+rt,xt+1,ae,Vt,Et,yt.image[rt])}}}g(R)&&p(r.TEXTURE_CUBE_MAP),nt.__version=ot.version,R.onUpdate&&R.onUpdate(R)}k.__version=R.version}function mt(k,R,X,st,ot,nt){const Dt=s.convert(X.format,X.colorSpace),bt=s.convert(X.type),Mt=y(X.internalFormat,Dt,bt,X.colorSpace),le=n.get(R),ut=n.get(X);if(ut.__renderTarget=R,!le.__hasExternalTextures){const Tt=Math.max(1,R.width>>nt),Ut=Math.max(1,R.height>>nt);ot===r.TEXTURE_3D||ot===r.TEXTURE_2D_ARRAY?e.texImage3D(ot,nt,Mt,Tt,Ut,R.depth,0,Dt,bt,null):e.texImage2D(ot,nt,Mt,Tt,Ut,0,Dt,bt,null)}e.bindFramebuffer(r.FRAMEBUFFER,k),oe(R)?a.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,st,ot,ut.__webglTexture,0,re(R)):(ot===r.TEXTURE_2D||ot>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&ot<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,st,ot,ut.__webglTexture,nt),e.bindFramebuffer(r.FRAMEBUFFER,null)}function ht(k,R,X){if(r.bindRenderbuffer(r.RENDERBUFFER,k),R.depthBuffer){const st=R.depthTexture,ot=st&&st.isDepthTexture?st.type:null,nt=v(R.stencilBuffer,ot),Dt=R.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,bt=re(R);oe(R)?a.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,bt,nt,R.width,R.height):X?r.renderbufferStorageMultisample(r.RENDERBUFFER,bt,nt,R.width,R.height):r.renderbufferStorage(r.RENDERBUFFER,nt,R.width,R.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,Dt,r.RENDERBUFFER,k)}else{const st=R.textures;for(let ot=0;ot<st.length;ot++){const nt=st[ot],Dt=s.convert(nt.format,nt.colorSpace),bt=s.convert(nt.type),Mt=y(nt.internalFormat,Dt,bt,nt.colorSpace),le=re(R);X&&oe(R)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,le,Mt,R.width,R.height):oe(R)?a.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,le,Mt,R.width,R.height):r.renderbufferStorage(r.RENDERBUFFER,Mt,R.width,R.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function It(k,R){if(R&&R.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(r.FRAMEBUFFER,k),!(R.depthTexture&&R.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const st=n.get(R.depthTexture);st.__renderTarget=R,(!st.__webglTexture||R.depthTexture.image.width!==R.width||R.depthTexture.image.height!==R.height)&&(R.depthTexture.image.width=R.width,R.depthTexture.image.height=R.height,R.depthTexture.needsUpdate=!0),z(R.depthTexture,0);const ot=st.__webglTexture,nt=re(R);if(R.depthTexture.format===tc)oe(R)?a.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,ot,0,nt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,ot,0);else if(R.depthTexture.format===gc)oe(R)?a.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,ot,0,nt):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,ot,0);else throw new Error("Unknown depthTexture format")}function kt(k){const R=n.get(k),X=k.isWebGLCubeRenderTarget===!0;if(R.__boundDepthTexture!==k.depthTexture){const st=k.depthTexture;if(R.__depthDisposeCallback&&R.__depthDisposeCallback(),st){const ot=()=>{delete R.__boundDepthTexture,delete R.__depthDisposeCallback,st.removeEventListener("dispose",ot)};st.addEventListener("dispose",ot),R.__depthDisposeCallback=ot}R.__boundDepthTexture=st}if(k.depthTexture&&!R.__autoAllocateDepthBuffer){if(X)throw new Error("target.depthTexture not supported in Cube render targets");It(R.__webglFramebuffer,k)}else if(X){R.__webglDepthbuffer=[];for(let st=0;st<6;st++)if(e.bindFramebuffer(r.FRAMEBUFFER,R.__webglFramebuffer[st]),R.__webglDepthbuffer[st]===void 0)R.__webglDepthbuffer[st]=r.createRenderbuffer(),ht(R.__webglDepthbuffer[st],k,!1);else{const ot=k.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,nt=R.__webglDepthbuffer[st];r.bindRenderbuffer(r.RENDERBUFFER,nt),r.framebufferRenderbuffer(r.FRAMEBUFFER,ot,r.RENDERBUFFER,nt)}}else if(e.bindFramebuffer(r.FRAMEBUFFER,R.__webglFramebuffer),R.__webglDepthbuffer===void 0)R.__webglDepthbuffer=r.createRenderbuffer(),ht(R.__webglDepthbuffer,k,!1);else{const st=k.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,ot=R.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,ot),r.framebufferRenderbuffer(r.FRAMEBUFFER,st,r.RENDERBUFFER,ot)}e.bindFramebuffer(r.FRAMEBUFFER,null)}function zt(k,R,X){const st=n.get(k);R!==void 0&&mt(st.__webglFramebuffer,k,k.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),X!==void 0&&kt(k)}function Fe(k){const R=k.texture,X=n.get(k),st=n.get(R);k.addEventListener("dispose",T);const ot=k.textures,nt=k.isWebGLCubeRenderTarget===!0,Dt=ot.length>1;if(Dt||(st.__webglTexture===void 0&&(st.__webglTexture=r.createTexture()),st.__version=R.version,o.memory.textures++),nt){X.__webglFramebuffer=[];for(let bt=0;bt<6;bt++)if(R.mipmaps&&R.mipmaps.length>0){X.__webglFramebuffer[bt]=[];for(let Mt=0;Mt<R.mipmaps.length;Mt++)X.__webglFramebuffer[bt][Mt]=r.createFramebuffer()}else X.__webglFramebuffer[bt]=r.createFramebuffer()}else{if(R.mipmaps&&R.mipmaps.length>0){X.__webglFramebuffer=[];for(let bt=0;bt<R.mipmaps.length;bt++)X.__webglFramebuffer[bt]=r.createFramebuffer()}else X.__webglFramebuffer=r.createFramebuffer();if(Dt)for(let bt=0,Mt=ot.length;bt<Mt;bt++){const le=n.get(ot[bt]);le.__webglTexture===void 0&&(le.__webglTexture=r.createTexture(),o.memory.textures++)}if(k.samples>0&&oe(k)===!1){X.__webglMultisampledFramebuffer=r.createFramebuffer(),X.__webglColorRenderbuffer=[],e.bindFramebuffer(r.FRAMEBUFFER,X.__webglMultisampledFramebuffer);for(let bt=0;bt<ot.length;bt++){const Mt=ot[bt];X.__webglColorRenderbuffer[bt]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,X.__webglColorRenderbuffer[bt]);const le=s.convert(Mt.format,Mt.colorSpace),ut=s.convert(Mt.type),Tt=y(Mt.internalFormat,le,ut,Mt.colorSpace,k.isXRRenderTarget===!0),Ut=re(k);r.renderbufferStorageMultisample(r.RENDERBUFFER,Ut,Tt,k.width,k.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+bt,r.RENDERBUFFER,X.__webglColorRenderbuffer[bt])}r.bindRenderbuffer(r.RENDERBUFFER,null),k.depthBuffer&&(X.__webglDepthRenderbuffer=r.createRenderbuffer(),ht(X.__webglDepthRenderbuffer,k,!0)),e.bindFramebuffer(r.FRAMEBUFFER,null)}}if(nt){e.bindTexture(r.TEXTURE_CUBE_MAP,st.__webglTexture),dt(r.TEXTURE_CUBE_MAP,R);for(let bt=0;bt<6;bt++)if(R.mipmaps&&R.mipmaps.length>0)for(let Mt=0;Mt<R.mipmaps.length;Mt++)mt(X.__webglFramebuffer[bt][Mt],k,R,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+bt,Mt);else mt(X.__webglFramebuffer[bt],k,R,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+bt,0);g(R)&&p(r.TEXTURE_CUBE_MAP),e.unbindTexture()}else if(Dt){for(let bt=0,Mt=ot.length;bt<Mt;bt++){const le=ot[bt],ut=n.get(le);e.bindTexture(r.TEXTURE_2D,ut.__webglTexture),dt(r.TEXTURE_2D,le),mt(X.__webglFramebuffer,k,le,r.COLOR_ATTACHMENT0+bt,r.TEXTURE_2D,0),g(le)&&p(r.TEXTURE_2D)}e.unbindTexture()}else{let bt=r.TEXTURE_2D;if((k.isWebGL3DRenderTarget||k.isWebGLArrayRenderTarget)&&(bt=k.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),e.bindTexture(bt,st.__webglTexture),dt(bt,R),R.mipmaps&&R.mipmaps.length>0)for(let Mt=0;Mt<R.mipmaps.length;Mt++)mt(X.__webglFramebuffer[Mt],k,R,r.COLOR_ATTACHMENT0,bt,Mt);else mt(X.__webglFramebuffer,k,R,r.COLOR_ATTACHMENT0,bt,0);g(R)&&p(bt),e.unbindTexture()}k.depthBuffer&&kt(k)}function ce(k){const R=k.textures;for(let X=0,st=R.length;X<st;X++){const ot=R[X];if(g(ot)){const nt=b(k),Dt=n.get(ot).__webglTexture;e.bindTexture(nt,Dt),p(nt),e.unbindTexture()}}}const je=[],W=[];function xi(k){if(k.samples>0){if(oe(k)===!1){const R=k.textures,X=k.width,st=k.height;let ot=r.COLOR_BUFFER_BIT;const nt=k.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Dt=n.get(k),bt=R.length>1;if(bt)for(let Mt=0;Mt<R.length;Mt++)e.bindFramebuffer(r.FRAMEBUFFER,Dt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Mt,r.RENDERBUFFER,null),e.bindFramebuffer(r.FRAMEBUFFER,Dt.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+Mt,r.TEXTURE_2D,null,0);e.bindFramebuffer(r.READ_FRAMEBUFFER,Dt.__webglMultisampledFramebuffer),e.bindFramebuffer(r.DRAW_FRAMEBUFFER,Dt.__webglFramebuffer);for(let Mt=0;Mt<R.length;Mt++){if(k.resolveDepthBuffer&&(k.depthBuffer&&(ot|=r.DEPTH_BUFFER_BIT),k.stencilBuffer&&k.resolveStencilBuffer&&(ot|=r.STENCIL_BUFFER_BIT)),bt){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,Dt.__webglColorRenderbuffer[Mt]);const le=n.get(R[Mt]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,le,0)}r.blitFramebuffer(0,0,X,st,0,0,X,st,ot,r.NEAREST),c===!0&&(je.length=0,W.length=0,je.push(r.COLOR_ATTACHMENT0+Mt),k.depthBuffer&&k.resolveDepthBuffer===!1&&(je.push(nt),W.push(nt),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,W)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,je))}if(e.bindFramebuffer(r.READ_FRAMEBUFFER,null),e.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),bt)for(let Mt=0;Mt<R.length;Mt++){e.bindFramebuffer(r.FRAMEBUFFER,Dt.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Mt,r.RENDERBUFFER,Dt.__webglColorRenderbuffer[Mt]);const le=n.get(R[Mt]).__webglTexture;e.bindFramebuffer(r.FRAMEBUFFER,Dt.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+Mt,r.TEXTURE_2D,le,0)}e.bindFramebuffer(r.DRAW_FRAMEBUFFER,Dt.__webglMultisampledFramebuffer)}else if(k.depthBuffer&&k.resolveDepthBuffer===!1&&c){const R=k.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[R])}}}function re(k){return Math.min(i.maxSamples,k.samples)}function oe(k){const R=n.get(k);return k.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&R.__useRenderToTexture!==!1}function Nt(k){const R=o.render.frame;h.get(k)!==R&&(h.set(k,R),k.update())}function Te(k,R){const X=k.colorSpace,st=k.format,ot=k.type;return k.isCompressedTexture===!0||k.isVideoTexture===!0||X!==Dc&&X!==Ir&&(ne.getTransfer(X)===be?(st!==zn||ot!==or)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",X)),R}function Ft(k){return typeof HTMLImageElement<"u"&&k instanceof HTMLImageElement?(l.width=k.naturalWidth||k.width,l.height=k.naturalHeight||k.height):typeof VideoFrame<"u"&&k instanceof VideoFrame?(l.width=k.displayWidth,l.height=k.displayHeight):(l.width=k.width,l.height=k.height),l}this.allocateTextureUnit=I,this.resetTextureUnits=L,this.setTexture2D=z,this.setTexture2DArray=N,this.setTexture3D=Z,this.setTextureCube=j,this.rebindTextures=zt,this.setupRenderTarget=Fe,this.updateRenderTargetMipmap=ce,this.updateMultisampleRenderTarget=xi,this.setupDepthRenderbuffer=kt,this.setupFrameBufferTexture=mt,this.useMultisampledRTT=oe}function NR(r,t){function e(n,i=Ir){let s;const o=ne.getTransfer(i);if(n===or)return r.UNSIGNED_BYTE;if(n===Gg)return r.UNSIGNED_SHORT_4_4_4_4;if(n===jg)return r.UNSIGNED_SHORT_5_5_5_1;if(n===Bx)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===Nx)return r.BYTE;if(n===Ux)return r.SHORT;if(n===Vl)return r.UNSIGNED_SHORT;if(n===Hg)return r.INT;if(n===Xr)return r.UNSIGNED_INT;if(n===Tn)return r.FLOAT;if(n===Ks)return r.HALF_FLOAT;if(n===zx)return r.ALPHA;if(n===Vx)return r.RGB;if(n===zn)return r.RGBA;if(n===Hx)return r.LUMINANCE;if(n===Gx)return r.LUMINANCE_ALPHA;if(n===tc)return r.DEPTH_COMPONENT;if(n===gc)return r.DEPTH_STENCIL;if(n===Wg)return r.RED;if(n===jd)return r.RED_INTEGER;if(n===jx)return r.RG;if(n===Xg)return r.RG_INTEGER;if(n===Yg)return r.RGBA_INTEGER;if(n===$u||n===Ju||n===td||n===ed)if(o===be)if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===$u)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ju)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===td)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===ed)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=t.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===$u)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ju)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===td)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===ed)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===mm||n===gm||n===_m||n===bm)if(s=t.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===mm)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===gm)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===_m)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===bm)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===ym||n===vm||n===xm)if(s=t.get("WEBGL_compressed_texture_etc"),s!==null){if(n===ym||n===vm)return o===be?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===xm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===wm||n===Sm||n===Mm||n===Tm||n===Em||n===Am||n===Cm||n===Pm||n===Rm||n===Dm||n===Lm||n===Im||n===Om||n===Fm)if(s=t.get("WEBGL_compressed_texture_astc"),s!==null){if(n===wm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Sm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Mm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Tm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Em)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Am)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Cm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Pm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Rm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Dm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Lm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Im)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Om)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Fm)return o===be?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===nd||n===km||n===Nm)if(s=t.get("EXT_texture_compression_bptc"),s!==null){if(n===nd)return o===be?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===km)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Nm)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Wx||n===Um||n===Bm||n===zm)if(s=t.get("EXT_texture_compression_rgtc"),s!==null){if(n===nd)return s.COMPRESSED_RED_RGTC1_EXT;if(n===Um)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Bm)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===zm)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===mc?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:e}}class UR extends rn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Li extends Bt{constructor(){super(),this.isGroup=!0,this.type="Group"}}const BR={type:"move"};class Qf{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Li,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Li,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new C,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new C),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Li,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new C,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new C),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let i=null,s=null,o=null;const a=this._targetRay,c=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){o=!0;for(const _ of t.hand.values()){const g=e.getJointPose(_,n),p=this._getHandJoint(l,_);g!==null&&(p.matrix.fromArray(g.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=g.radius),p.visible=g!==null}const h=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],d=h.position.distanceTo(u.position),f=.02,m=.005;l.inputState.pinching&&d>f+m?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&d<=f-m&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else c!==null&&t.gripSpace&&(s=e.getPose(t.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=e.getPose(t.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(BR)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),l!==null&&(l.visible=o!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const n=new Li;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}const zR=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,VR=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class HR{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,n){if(this.texture===null){const i=new Ie,s=t.properties.get(i);s.__webglTexture=e.texture,(e.depthNear!=n.depthNear||e.depthFar!=n.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(t){if(this.texture!==null&&this.mesh===null){const e=t.cameras[0].viewport,n=new ws({vertexShader:zR,fragmentShader:VR,uniforms:{depthColor:{value:this.texture},depthWidth:{value:e.z},depthHeight:{value:e.w}}});this.mesh=new ct(new Nn(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class GR extends Jr{constructor(t,e){super();const n=this;let i=null,s=1,o=null,a="local-floor",c=1,l=null,h=null,u=null,d=null,f=null,m=null;const _=new HR,g=e.getContextAttributes();let p=null,b=null;const y=[],v=[],x=new J;let S=null;const T=new rn;T.viewport=new ie;const E=new rn;E.viewport=new ie;const w=[T,E],M=new UR;let P=null,L=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(O){let it=y[O];return it===void 0&&(it=new Qf,y[O]=it),it.getTargetRaySpace()},this.getControllerGrip=function(O){let it=y[O];return it===void 0&&(it=new Qf,y[O]=it),it.getGripSpace()},this.getHand=function(O){let it=y[O];return it===void 0&&(it=new Qf,y[O]=it),it.getHandSpace()};function I(O){const it=v.indexOf(O.inputSource);if(it===-1)return;const mt=y[it];mt!==void 0&&(mt.update(O.inputSource,O.frame,l||o),mt.dispatchEvent({type:O.type,data:O.inputSource}))}function F(){i.removeEventListener("select",I),i.removeEventListener("selectstart",I),i.removeEventListener("selectend",I),i.removeEventListener("squeeze",I),i.removeEventListener("squeezestart",I),i.removeEventListener("squeezeend",I),i.removeEventListener("end",F),i.removeEventListener("inputsourceschange",z);for(let O=0;O<y.length;O++){const it=v[O];it!==null&&(v[O]=null,y[O].disconnect(it))}P=null,L=null,_.reset(),t.setRenderTarget(p),f=null,d=null,u=null,i=null,b=null,St.stop(),n.isPresenting=!1,t.setPixelRatio(S),t.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(O){s=O,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(O){a=O,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(O){l=O},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return u},this.getFrame=function(){return m},this.getSession=function(){return i},this.setSession=async function(O){if(i=O,i!==null){if(p=t.getRenderTarget(),i.addEventListener("select",I),i.addEventListener("selectstart",I),i.addEventListener("selectend",I),i.addEventListener("squeeze",I),i.addEventListener("squeezestart",I),i.addEventListener("squeezeend",I),i.addEventListener("end",F),i.addEventListener("inputsourceschange",z),g.xrCompatible!==!0&&await e.makeXRCompatible(),S=t.getPixelRatio(),t.getSize(x),i.renderState.layers===void 0){const it={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(i,e,it),i.updateRenderState({baseLayer:f}),t.setPixelRatio(1),t.setSize(f.framebufferWidth,f.framebufferHeight,!1),b=new Bo(f.framebufferWidth,f.framebufferHeight,{format:zn,type:or,colorSpace:t.outputColorSpace,stencilBuffer:g.stencil})}else{let it=null,mt=null,ht=null;g.depth&&(ht=g.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,it=g.stencil?gc:tc,mt=g.stencil?mc:Xr);const It={colorFormat:e.RGBA8,depthFormat:ht,scaleFactor:s};u=new XRWebGLBinding(i,e),d=u.createProjectionLayer(It),i.updateRenderState({layers:[d]}),t.setPixelRatio(1),t.setSize(d.textureWidth,d.textureHeight,!1),b=new Bo(d.textureWidth,d.textureHeight,{format:zn,type:or,depthTexture:new rw(d.textureWidth,d.textureHeight,mt,void 0,void 0,void 0,void 0,void 0,void 0,it),stencilBuffer:g.stencil,colorSpace:t.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1})}b.isXRRenderTarget=!0,this.setFoveation(c),l=null,o=await i.requestReferenceSpace(a),St.setContext(i),St.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return _.getDepthTexture()};function z(O){for(let it=0;it<O.removed.length;it++){const mt=O.removed[it],ht=v.indexOf(mt);ht>=0&&(v[ht]=null,y[ht].disconnect(mt))}for(let it=0;it<O.added.length;it++){const mt=O.added[it];let ht=v.indexOf(mt);if(ht===-1){for(let kt=0;kt<y.length;kt++)if(kt>=v.length){v.push(mt),ht=kt;break}else if(v[kt]===null){v[kt]=mt,ht=kt;break}if(ht===-1)break}const It=y[ht];It&&It.connect(mt)}}const N=new C,Z=new C;function j(O,it,mt){N.setFromMatrixPosition(it.matrixWorld),Z.setFromMatrixPosition(mt.matrixWorld);const ht=N.distanceTo(Z),It=it.projectionMatrix.elements,kt=mt.projectionMatrix.elements,zt=It[14]/(It[10]-1),Fe=It[14]/(It[10]+1),ce=(It[9]+1)/It[5],je=(It[9]-1)/It[5],W=(It[8]-1)/It[0],xi=(kt[8]+1)/kt[0],re=zt*W,oe=zt*xi,Nt=ht/(-W+xi),Te=Nt*-W;if(it.matrixWorld.decompose(O.position,O.quaternion,O.scale),O.translateX(Te),O.translateZ(Nt),O.matrixWorld.compose(O.position,O.quaternion,O.scale),O.matrixWorldInverse.copy(O.matrixWorld).invert(),It[10]===-1)O.projectionMatrix.copy(it.projectionMatrix),O.projectionMatrixInverse.copy(it.projectionMatrixInverse);else{const Ft=zt+Nt,k=Fe+Nt,R=re-Te,X=oe+(ht-Te),st=ce*Fe/k*Ft,ot=je*Fe/k*Ft;O.projectionMatrix.makePerspective(R,X,st,ot,Ft,k),O.projectionMatrixInverse.copy(O.projectionMatrix).invert()}}function et(O,it){it===null?O.matrixWorld.copy(O.matrix):O.matrixWorld.multiplyMatrices(it.matrixWorld,O.matrix),O.matrixWorldInverse.copy(O.matrixWorld).invert()}this.updateCamera=function(O){if(i===null)return;let it=O.near,mt=O.far;_.texture!==null&&(_.depthNear>0&&(it=_.depthNear),_.depthFar>0&&(mt=_.depthFar)),M.near=E.near=T.near=it,M.far=E.far=T.far=mt,(P!==M.near||L!==M.far)&&(i.updateRenderState({depthNear:M.near,depthFar:M.far}),P=M.near,L=M.far),T.layers.mask=O.layers.mask|2,E.layers.mask=O.layers.mask|4,M.layers.mask=T.layers.mask|E.layers.mask;const ht=O.parent,It=M.cameras;et(M,ht);for(let kt=0;kt<It.length;kt++)et(It[kt],ht);It.length===2?j(M,T,E):M.projectionMatrix.copy(T.projectionMatrix),tt(O,M,ht)};function tt(O,it,mt){mt===null?O.matrix.copy(it.matrixWorld):(O.matrix.copy(mt.matrixWorld),O.matrix.invert(),O.matrix.multiply(it.matrixWorld)),O.matrix.decompose(O.position,O.quaternion,O.scale),O.updateMatrixWorld(!0),O.projectionMatrix.copy(it.projectionMatrix),O.projectionMatrixInverse.copy(it.projectionMatrixInverse),O.isPerspectiveCamera&&(O.fov=yc*2*Math.atan(1/O.projectionMatrix.elements[5]),O.zoom=1)}this.getCamera=function(){return M},this.getFoveation=function(){if(!(d===null&&f===null))return c},this.setFoveation=function(O){c=O,d!==null&&(d.fixedFoveation=O),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=O)},this.hasDepthSensing=function(){return _.texture!==null},this.getDepthSensingMesh=function(){return _.getMesh(M)};let at=null;function dt(O,it){if(h=it.getViewerPose(l||o),m=it,h!==null){const mt=h.views;f!==null&&(t.setRenderTargetFramebuffer(b,f.framebuffer),t.setRenderTarget(b));let ht=!1;mt.length!==M.cameras.length&&(M.cameras.length=0,ht=!0);for(let kt=0;kt<mt.length;kt++){const zt=mt[kt];let Fe=null;if(f!==null)Fe=f.getViewport(zt);else{const je=u.getViewSubImage(d,zt);Fe=je.viewport,kt===0&&(t.setRenderTargetTextures(b,je.colorTexture,d.ignoreDepthValues?void 0:je.depthStencilTexture),t.setRenderTarget(b))}let ce=w[kt];ce===void 0&&(ce=new rn,ce.layers.enable(kt),ce.viewport=new ie,w[kt]=ce),ce.matrix.fromArray(zt.transform.matrix),ce.matrix.decompose(ce.position,ce.quaternion,ce.scale),ce.projectionMatrix.fromArray(zt.projectionMatrix),ce.projectionMatrixInverse.copy(ce.projectionMatrix).invert(),ce.viewport.set(Fe.x,Fe.y,Fe.width,Fe.height),kt===0&&(M.matrix.copy(ce.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),ht===!0&&M.cameras.push(ce)}const It=i.enabledFeatures;if(It&&It.includes("depth-sensing")){const kt=u.getDepthInformation(mt[0]);kt&&kt.isValid&&kt.texture&&_.init(t,kt,i.renderState)}}for(let mt=0;mt<y.length;mt++){const ht=v[mt],It=y[mt];ht!==null&&It!==void 0&&It.update(ht,it,l||o)}at&&at(O,it),it.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:it}),m=null}const St=new sw;St.setAnimationLoop(dt),this.setAnimationLoop=function(O){at=O},this.dispose=function(){}}}const uo=new Me,jR=new lt;function WR(r,t){function e(g,p){g.matrixAutoUpdate===!0&&g.updateMatrix(),p.value.copy(g.matrix)}function n(g,p){p.color.getRGB(g.fogColor.value,nw(r)),p.isFog?(g.fogNear.value=p.near,g.fogFar.value=p.far):p.isFogExp2&&(g.fogDensity.value=p.density)}function i(g,p,b,y,v){p.isMeshBasicMaterial||p.isMeshLambertMaterial?s(g,p):p.isMeshToonMaterial?(s(g,p),u(g,p)):p.isMeshPhongMaterial?(s(g,p),h(g,p)):p.isMeshStandardMaterial?(s(g,p),d(g,p),p.isMeshPhysicalMaterial&&f(g,p,v)):p.isMeshMatcapMaterial?(s(g,p),m(g,p)):p.isMeshDepthMaterial?s(g,p):p.isMeshDistanceMaterial?(s(g,p),_(g,p)):p.isMeshNormalMaterial?s(g,p):p.isLineBasicMaterial?(o(g,p),p.isLineDashedMaterial&&a(g,p)):p.isPointsMaterial?c(g,p,b,y):p.isSpriteMaterial?l(g,p):p.isShadowMaterial?(g.color.value.copy(p.color),g.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function s(g,p){g.opacity.value=p.opacity,p.color&&g.diffuse.value.copy(p.color),p.emissive&&g.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(g.map.value=p.map,e(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,e(p.alphaMap,g.alphaMapTransform)),p.bumpMap&&(g.bumpMap.value=p.bumpMap,e(p.bumpMap,g.bumpMapTransform),g.bumpScale.value=p.bumpScale,p.side===Vn&&(g.bumpScale.value*=-1)),p.normalMap&&(g.normalMap.value=p.normalMap,e(p.normalMap,g.normalMapTransform),g.normalScale.value.copy(p.normalScale),p.side===Vn&&g.normalScale.value.negate()),p.displacementMap&&(g.displacementMap.value=p.displacementMap,e(p.displacementMap,g.displacementMapTransform),g.displacementScale.value=p.displacementScale,g.displacementBias.value=p.displacementBias),p.emissiveMap&&(g.emissiveMap.value=p.emissiveMap,e(p.emissiveMap,g.emissiveMapTransform)),p.specularMap&&(g.specularMap.value=p.specularMap,e(p.specularMap,g.specularMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest);const b=t.get(p),y=b.envMap,v=b.envMapRotation;y&&(g.envMap.value=y,uo.copy(v),uo.x*=-1,uo.y*=-1,uo.z*=-1,y.isCubeTexture&&y.isRenderTargetTexture===!1&&(uo.y*=-1,uo.z*=-1),g.envMapRotation.value.setFromMatrix4(jR.makeRotationFromEuler(uo)),g.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=p.reflectivity,g.ior.value=p.ior,g.refractionRatio.value=p.refractionRatio),p.lightMap&&(g.lightMap.value=p.lightMap,g.lightMapIntensity.value=p.lightMapIntensity,e(p.lightMap,g.lightMapTransform)),p.aoMap&&(g.aoMap.value=p.aoMap,g.aoMapIntensity.value=p.aoMapIntensity,e(p.aoMap,g.aoMapTransform))}function o(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,p.map&&(g.map.value=p.map,e(p.map,g.mapTransform))}function a(g,p){g.dashSize.value=p.dashSize,g.totalSize.value=p.dashSize+p.gapSize,g.scale.value=p.scale}function c(g,p,b,y){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.size.value=p.size*b,g.scale.value=y*.5,p.map&&(g.map.value=p.map,e(p.map,g.uvTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,e(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function l(g,p){g.diffuse.value.copy(p.color),g.opacity.value=p.opacity,g.rotation.value=p.rotation,p.map&&(g.map.value=p.map,e(p.map,g.mapTransform)),p.alphaMap&&(g.alphaMap.value=p.alphaMap,e(p.alphaMap,g.alphaMapTransform)),p.alphaTest>0&&(g.alphaTest.value=p.alphaTest)}function h(g,p){g.specular.value.copy(p.specular),g.shininess.value=Math.max(p.shininess,1e-4)}function u(g,p){p.gradientMap&&(g.gradientMap.value=p.gradientMap)}function d(g,p){g.metalness.value=p.metalness,p.metalnessMap&&(g.metalnessMap.value=p.metalnessMap,e(p.metalnessMap,g.metalnessMapTransform)),g.roughness.value=p.roughness,p.roughnessMap&&(g.roughnessMap.value=p.roughnessMap,e(p.roughnessMap,g.roughnessMapTransform)),p.envMap&&(g.envMapIntensity.value=p.envMapIntensity)}function f(g,p,b){g.ior.value=p.ior,p.sheen>0&&(g.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),g.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(g.sheenColorMap.value=p.sheenColorMap,e(p.sheenColorMap,g.sheenColorMapTransform)),p.sheenRoughnessMap&&(g.sheenRoughnessMap.value=p.sheenRoughnessMap,e(p.sheenRoughnessMap,g.sheenRoughnessMapTransform))),p.clearcoat>0&&(g.clearcoat.value=p.clearcoat,g.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(g.clearcoatMap.value=p.clearcoatMap,e(p.clearcoatMap,g.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,e(p.clearcoatRoughnessMap,g.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(g.clearcoatNormalMap.value=p.clearcoatNormalMap,e(p.clearcoatNormalMap,g.clearcoatNormalMapTransform),g.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===Vn&&g.clearcoatNormalScale.value.negate())),p.dispersion>0&&(g.dispersion.value=p.dispersion),p.iridescence>0&&(g.iridescence.value=p.iridescence,g.iridescenceIOR.value=p.iridescenceIOR,g.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(g.iridescenceMap.value=p.iridescenceMap,e(p.iridescenceMap,g.iridescenceMapTransform)),p.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=p.iridescenceThicknessMap,e(p.iridescenceThicknessMap,g.iridescenceThicknessMapTransform))),p.transmission>0&&(g.transmission.value=p.transmission,g.transmissionSamplerMap.value=b.texture,g.transmissionSamplerSize.value.set(b.width,b.height),p.transmissionMap&&(g.transmissionMap.value=p.transmissionMap,e(p.transmissionMap,g.transmissionMapTransform)),g.thickness.value=p.thickness,p.thicknessMap&&(g.thicknessMap.value=p.thicknessMap,e(p.thicknessMap,g.thicknessMapTransform)),g.attenuationDistance.value=p.attenuationDistance,g.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(g.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(g.anisotropyMap.value=p.anisotropyMap,e(p.anisotropyMap,g.anisotropyMapTransform))),g.specularIntensity.value=p.specularIntensity,g.specularColor.value.copy(p.specularColor),p.specularColorMap&&(g.specularColorMap.value=p.specularColorMap,e(p.specularColorMap,g.specularColorMapTransform)),p.specularIntensityMap&&(g.specularIntensityMap.value=p.specularIntensityMap,e(p.specularIntensityMap,g.specularIntensityMapTransform))}function m(g,p){p.matcap&&(g.matcap.value=p.matcap)}function _(g,p){const b=t.get(p).light;g.referencePosition.value.setFromMatrixPosition(b.matrixWorld),g.nearDistance.value=b.shadow.camera.near,g.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function XR(r,t,e,n){let i={},s={},o=[];const a=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function c(b,y){const v=y.program;n.uniformBlockBinding(b,v)}function l(b,y){let v=i[b.id];v===void 0&&(m(b),v=h(b),i[b.id]=v,b.addEventListener("dispose",g));const x=y.program;n.updateUBOMapping(b,x);const S=t.render.frame;s[b.id]!==S&&(d(b),s[b.id]=S)}function h(b){const y=u();b.__bindingPointIndex=y;const v=r.createBuffer(),x=b.__size,S=b.usage;return r.bindBuffer(r.UNIFORM_BUFFER,v),r.bufferData(r.UNIFORM_BUFFER,x,S),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,y,v),v}function u(){for(let b=0;b<a;b++)if(o.indexOf(b)===-1)return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(b){const y=i[b.id],v=b.uniforms,x=b.__cache;r.bindBuffer(r.UNIFORM_BUFFER,y);for(let S=0,T=v.length;S<T;S++){const E=Array.isArray(v[S])?v[S]:[v[S]];for(let w=0,M=E.length;w<M;w++){const P=E[w];if(f(P,S,w,x)===!0){const L=P.__offset,I=Array.isArray(P.value)?P.value:[P.value];let F=0;for(let z=0;z<I.length;z++){const N=I[z],Z=_(N);typeof N=="number"||typeof N=="boolean"?(P.__data[0]=N,r.bufferSubData(r.UNIFORM_BUFFER,L+F,P.__data)):N.isMatrix3?(P.__data[0]=N.elements[0],P.__data[1]=N.elements[1],P.__data[2]=N.elements[2],P.__data[3]=0,P.__data[4]=N.elements[3],P.__data[5]=N.elements[4],P.__data[6]=N.elements[5],P.__data[7]=0,P.__data[8]=N.elements[6],P.__data[9]=N.elements[7],P.__data[10]=N.elements[8],P.__data[11]=0):(N.toArray(P.__data,F),F+=Z.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,L,P.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function f(b,y,v,x){const S=b.value,T=y+"_"+v;if(x[T]===void 0)return typeof S=="number"||typeof S=="boolean"?x[T]=S:x[T]=S.clone(),!0;{const E=x[T];if(typeof S=="number"||typeof S=="boolean"){if(E!==S)return x[T]=S,!0}else if(E.equals(S)===!1)return E.copy(S),!0}return!1}function m(b){const y=b.uniforms;let v=0;const x=16;for(let T=0,E=y.length;T<E;T++){const w=Array.isArray(y[T])?y[T]:[y[T]];for(let M=0,P=w.length;M<P;M++){const L=w[M],I=Array.isArray(L.value)?L.value:[L.value];for(let F=0,z=I.length;F<z;F++){const N=I[F],Z=_(N),j=v%x,et=j%Z.boundary,tt=j+et;v+=et,tt!==0&&x-tt<Z.storage&&(v+=x-tt),L.__data=new Float32Array(Z.storage/Float32Array.BYTES_PER_ELEMENT),L.__offset=v,v+=Z.storage}}}const S=v%x;return S>0&&(v+=x-S),b.__size=v,b.__cache={},this}function _(b){const y={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(y.boundary=4,y.storage=4):b.isVector2?(y.boundary=8,y.storage=8):b.isVector3||b.isColor?(y.boundary=16,y.storage=12):b.isVector4?(y.boundary=16,y.storage=16):b.isMatrix3?(y.boundary=48,y.storage=48):b.isMatrix4?(y.boundary=64,y.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),y}function g(b){const y=b.target;y.removeEventListener("dispose",g);const v=o.indexOf(y.__bindingPointIndex);o.splice(v,1),r.deleteBuffer(i[y.id]),delete i[y.id],delete s[y.id]}function p(){for(const b in i)r.deleteBuffer(i[b]);o=[],i={},s={}}return{bind:c,update:l,dispose:p}}class hw{constructor(t={}){const{canvas:e=LE(),context:n=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:l=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:u=!1,reverseDepthBuffer:d=!1}=t;this.isWebGLRenderer=!0;let f;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=n.getContextAttributes().alpha}else f=o;const m=new Uint32Array(4),_=new Int32Array(4);let g=null,p=null;const b=[],y=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=On,this.toneMapping=Hr,this.toneMappingExposure=1;const v=this;let x=!1,S=0,T=0,E=null,w=-1,M=null;const P=new ie,L=new ie;let I=null;const F=new pt(0);let z=0,N=e.width,Z=e.height,j=1,et=null,tt=null;const at=new ie(0,0,N,Z),dt=new ie(0,0,N,Z);let St=!1;const O=new Yd;let it=!1,mt=!1;const ht=new lt,It=new lt,kt=new C,zt=new ie,Fe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let ce=!1;function je(){return E===null?j:1}let W=n;function xi(D,H){return e.getContext(D,H)}try{const D={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:l,powerPreference:h,failIfMajorPerformanceCaveat:u};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${ah}`),e.addEventListener("webglcontextlost",rt,!1),e.addEventListener("webglcontextrestored",xt,!1),e.addEventListener("webglcontextcreationerror",yt,!1),W===null){const H="webgl2";if(W=xi(H,D),W===null)throw xi(H)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(D){throw console.error("THREE.WebGLRenderer: "+D.message),D}let re,oe,Nt,Te,Ft,k,R,X,st,ot,nt,Dt,bt,Mt,le,ut,Tt,Ut,Vt,Et,ae,Yt,we,V;function _t(){re=new $C(W),re.init(),Yt=new NR(W,re),oe=new XC(W,re,t,Yt),Nt=new OR(W,re),oe.reverseDepthBuffer&&d&&Nt.buffers.depth.setReversed(!0),Te=new eP(W),Ft=new yR,k=new kR(W,re,Nt,Ft,oe,Yt,Te),R=new qC(v),X=new QC(v),st=new c1(W),we=new jC(W,st),ot=new JC(W,st,Te,we),nt=new iP(W,ot,st,Te),Vt=new nP(W,oe,k),ut=new YC(Ft),Dt=new bR(v,R,X,re,oe,we,ut),bt=new WR(v,Ft),Mt=new xR,le=new AR(re),Ut=new GC(v,R,X,Nt,nt,f,c),Tt=new LR(v,nt,oe),V=new XR(W,Te,oe,Nt),Et=new WC(W,re,Te),ae=new tP(W,re,Te),Te.programs=Dt.programs,v.capabilities=oe,v.extensions=re,v.properties=Ft,v.renderLists=Mt,v.shadowMap=Tt,v.state=Nt,v.info=Te}_t();const $=new GR(v,W);this.xr=$,this.getContext=function(){return W},this.getContextAttributes=function(){return W.getContextAttributes()},this.forceContextLoss=function(){const D=re.get("WEBGL_lose_context");D&&D.loseContext()},this.forceContextRestore=function(){const D=re.get("WEBGL_lose_context");D&&D.restoreContext()},this.getPixelRatio=function(){return j},this.setPixelRatio=function(D){D!==void 0&&(j=D,this.setSize(N,Z,!1))},this.getSize=function(D){return D.set(N,Z)},this.setSize=function(D,H,q=!0){if($.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}N=D,Z=H,e.width=Math.floor(D*j),e.height=Math.floor(H*j),q===!0&&(e.style.width=D+"px",e.style.height=H+"px"),this.setViewport(0,0,D,H)},this.getDrawingBufferSize=function(D){return D.set(N*j,Z*j).floor()},this.setDrawingBufferSize=function(D,H,q){N=D,Z=H,j=q,e.width=Math.floor(D*q),e.height=Math.floor(H*q),this.setViewport(0,0,D,H)},this.getCurrentViewport=function(D){return D.copy(P)},this.getViewport=function(D){return D.copy(at)},this.setViewport=function(D,H,q,K){D.isVector4?at.set(D.x,D.y,D.z,D.w):at.set(D,H,q,K),Nt.viewport(P.copy(at).multiplyScalar(j).round())},this.getScissor=function(D){return D.copy(dt)},this.setScissor=function(D,H,q,K){D.isVector4?dt.set(D.x,D.y,D.z,D.w):dt.set(D,H,q,K),Nt.scissor(L.copy(dt).multiplyScalar(j).round())},this.getScissorTest=function(){return St},this.setScissorTest=function(D){Nt.setScissorTest(St=D)},this.setOpaqueSort=function(D){et=D},this.setTransparentSort=function(D){tt=D},this.getClearColor=function(D){return D.copy(Ut.getClearColor())},this.setClearColor=function(){Ut.setClearColor.apply(Ut,arguments)},this.getClearAlpha=function(){return Ut.getClearAlpha()},this.setClearAlpha=function(){Ut.setClearAlpha.apply(Ut,arguments)},this.clear=function(D=!0,H=!0,q=!0){let K=0;if(D){let G=!1;if(E!==null){const ft=E.texture.format;G=ft===Yg||ft===Xg||ft===jd}if(G){const ft=E.texture.type,vt=ft===or||ft===Xr||ft===Vl||ft===mc||ft===Gg||ft===jg,At=Ut.getClearColor(),Ct=Ut.getClearAlpha(),Ht=At.r,Xt=At.g,Pt=At.b;vt?(m[0]=Ht,m[1]=Xt,m[2]=Pt,m[3]=Ct,W.clearBufferuiv(W.COLOR,0,m)):(_[0]=Ht,_[1]=Xt,_[2]=Pt,_[3]=Ct,W.clearBufferiv(W.COLOR,0,_))}else K|=W.COLOR_BUFFER_BIT}H&&(K|=W.DEPTH_BUFFER_BIT),q&&(K|=W.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),W.clear(K)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",rt,!1),e.removeEventListener("webglcontextrestored",xt,!1),e.removeEventListener("webglcontextcreationerror",yt,!1),Mt.dispose(),le.dispose(),Ft.dispose(),R.dispose(),X.dispose(),nt.dispose(),we.dispose(),V.dispose(),Dt.dispose(),$.dispose(),$.removeEventListener("sessionstart",A_),$.removeEventListener("sessionend",C_),ro.stop()};function rt(D){D.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function xt(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const D=Te.autoReset,H=Tt.enabled,q=Tt.autoUpdate,K=Tt.needsUpdate,G=Tt.type;_t(),Te.autoReset=D,Tt.enabled=H,Tt.autoUpdate=q,Tt.needsUpdate=K,Tt.type=G}function yt(D){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",D.statusMessage)}function Wt(D){const H=D.target;H.removeEventListener("dispose",Wt),ze(H)}function ze(D){yn(D),Ft.remove(D)}function yn(D){const H=Ft.get(D).programs;H!==void 0&&(H.forEach(function(q){Dt.releaseProgram(q)}),D.isShaderMaterial&&Dt.releaseShaderCache(D))}this.renderBufferDirect=function(D,H,q,K,G,ft){H===null&&(H=Fe);const vt=G.isMesh&&G.matrixWorld.determinant()<0,At=vT(D,H,q,K,G);Nt.setMaterial(K,vt);let Ct=q.index,Ht=1;if(K.wireframe===!0){if(Ct=ot.getWireframeAttribute(q),Ct===void 0)return;Ht=2}const Xt=q.drawRange,Pt=q.attributes.position;let ue=Xt.start*Ht,Se=(Xt.start+Xt.count)*Ht;ft!==null&&(ue=Math.max(ue,ft.start*Ht),Se=Math.min(Se,(ft.start+ft.count)*Ht)),Ct!==null?(ue=Math.max(ue,0),Se=Math.min(Se,Ct.count)):Pt!=null&&(ue=Math.max(ue,0),Se=Math.min(Se,Pt.count));const Ee=Se-ue;if(Ee<0||Ee===1/0)return;we.setup(G,K,At,q,Ct);let Wn,de=Et;if(Ct!==null&&(Wn=st.get(Ct),de=ae,de.setIndex(Wn)),G.isMesh)K.wireframe===!0?(Nt.setLineWidth(K.wireframeLinewidth*je()),de.setMode(W.LINES)):de.setMode(W.TRIANGLES);else if(G.isLine){let Lt=K.linewidth;Lt===void 0&&(Lt=1),Nt.setLineWidth(Lt*je()),G.isLineSegments?de.setMode(W.LINES):G.isLineLoop?de.setMode(W.LINE_LOOP):de.setMode(W.LINE_STRIP)}else G.isPoints?de.setMode(W.POINTS):G.isSprite&&de.setMode(W.TRIANGLES);if(G.isBatchedMesh)if(G._multiDrawInstances!==null)de.renderMultiDrawInstances(G._multiDrawStarts,G._multiDrawCounts,G._multiDrawCount,G._multiDrawInstances);else if(re.get("WEBGL_multi_draw"))de.renderMultiDraw(G._multiDrawStarts,G._multiDrawCounts,G._multiDrawCount);else{const Lt=G._multiDrawStarts,Ds=G._multiDrawCounts,fe=G._multiDrawCount,Hi=Ct?st.get(Ct).bytesPerElement:1,ea=Ft.get(K).currentProgram.getUniforms();for(let oi=0;oi<fe;oi++)ea.setValue(W,"_gl_DrawID",oi),de.render(Lt[oi]/Hi,Ds[oi])}else if(G.isInstancedMesh)de.renderInstances(ue,Ee,G.count);else if(q.isInstancedBufferGeometry){const Lt=q._maxInstanceCount!==void 0?q._maxInstanceCount:1/0,Ds=Math.min(q.instanceCount,Lt);de.renderInstances(ue,Ee,Ds)}else de.render(ue,Ee)};function me(D,H,q){D.transparent===!0&&D.side===Sn&&D.forceSinglePass===!1?(D.side=Vn,D.needsUpdate=!0,vh(D,H,q),D.side=Bi,D.needsUpdate=!0,vh(D,H,q),D.side=Sn):vh(D,H,q)}this.compile=function(D,H,q=null){q===null&&(q=D),p=le.get(q),p.init(H),y.push(p),q.traverseVisible(function(G){G.isLight&&G.layers.test(H.layers)&&(p.pushLight(G),G.castShadow&&p.pushShadow(G))}),D!==q&&D.traverseVisible(function(G){G.isLight&&G.layers.test(H.layers)&&(p.pushLight(G),G.castShadow&&p.pushShadow(G))}),p.setupLights();const K=new Set;return D.traverse(function(G){if(!(G.isMesh||G.isPoints||G.isLine||G.isSprite))return;const ft=G.material;if(ft)if(Array.isArray(ft))for(let vt=0;vt<ft.length;vt++){const At=ft[vt];me(At,q,G),K.add(At)}else me(ft,q,G),K.add(ft)}),y.pop(),p=null,K},this.compileAsync=function(D,H,q=null){const K=this.compile(D,H,q);return new Promise(G=>{function ft(){if(K.forEach(function(vt){Ft.get(vt).currentProgram.isReady()&&K.delete(vt)}),K.size===0){G(D);return}setTimeout(ft,10)}re.get("KHR_parallel_shader_compile")!==null?ft():setTimeout(ft,10)})};let Vi=null;function Rs(D){Vi&&Vi(D)}function A_(){ro.stop()}function C_(){ro.start()}const ro=new sw;ro.setAnimationLoop(Rs),typeof self<"u"&&ro.setContext(self),this.setAnimationLoop=function(D){Vi=D,$.setAnimationLoop(D),D===null?ro.stop():ro.start()},$.addEventListener("sessionstart",A_),$.addEventListener("sessionend",C_),this.render=function(D,H){if(H!==void 0&&H.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(x===!0)return;if(D.matrixWorldAutoUpdate===!0&&D.updateMatrixWorld(),H.parent===null&&H.matrixWorldAutoUpdate===!0&&H.updateMatrixWorld(),$.enabled===!0&&$.isPresenting===!0&&($.cameraAutoUpdate===!0&&$.updateCamera(H),H=$.getCamera()),D.isScene===!0&&D.onBeforeRender(v,D,H,E),p=le.get(D,y.length),p.init(H),y.push(p),It.multiplyMatrices(H.projectionMatrix,H.matrixWorldInverse),O.setFromProjectionMatrix(It),mt=this.localClippingEnabled,it=ut.init(this.clippingPlanes,mt),g=Mt.get(D,b.length),g.init(),b.push(g),$.enabled===!0&&$.isPresenting===!0){const ft=v.xr.getDepthSensingMesh();ft!==null&&Sf(ft,H,-1/0,v.sortObjects)}Sf(D,H,0,v.sortObjects),g.finish(),v.sortObjects===!0&&g.sort(et,tt),ce=$.enabled===!1||$.isPresenting===!1||$.hasDepthSensing()===!1,ce&&Ut.addToRenderList(g,D),this.info.render.frame++,it===!0&&ut.beginShadows();const q=p.state.shadowsArray;Tt.render(q,D,H),it===!0&&ut.endShadows(),this.info.autoReset===!0&&this.info.reset();const K=g.opaque,G=g.transmissive;if(p.setupLights(),H.isArrayCamera){const ft=H.cameras;if(G.length>0)for(let vt=0,At=ft.length;vt<At;vt++){const Ct=ft[vt];R_(K,G,D,Ct)}ce&&Ut.render(D);for(let vt=0,At=ft.length;vt<At;vt++){const Ct=ft[vt];P_(g,D,Ct,Ct.viewport)}}else G.length>0&&R_(K,G,D,H),ce&&Ut.render(D),P_(g,D,H);E!==null&&(k.updateMultisampleRenderTarget(E),k.updateRenderTargetMipmap(E)),D.isScene===!0&&D.onAfterRender(v,D,H),we.resetDefaultState(),w=-1,M=null,y.pop(),y.length>0?(p=y[y.length-1],it===!0&&ut.setGlobalState(v.clippingPlanes,p.state.camera)):p=null,b.pop(),b.length>0?g=b[b.length-1]:g=null};function Sf(D,H,q,K){if(D.visible===!1)return;if(D.layers.test(H.layers)){if(D.isGroup)q=D.renderOrder;else if(D.isLOD)D.autoUpdate===!0&&D.update(H);else if(D.isLight)p.pushLight(D),D.castShadow&&p.pushShadow(D);else if(D.isSprite){if(!D.frustumCulled||O.intersectsSprite(D)){K&&zt.setFromMatrixPosition(D.matrixWorld).applyMatrix4(It);const vt=nt.update(D),At=D.material;At.visible&&g.push(D,vt,At,q,zt.z,null)}}else if((D.isMesh||D.isLine||D.isPoints)&&(!D.frustumCulled||O.intersectsObject(D))){const vt=nt.update(D),At=D.material;if(K&&(D.boundingSphere!==void 0?(D.boundingSphere===null&&D.computeBoundingSphere(),zt.copy(D.boundingSphere.center)):(vt.boundingSphere===null&&vt.computeBoundingSphere(),zt.copy(vt.boundingSphere.center)),zt.applyMatrix4(D.matrixWorld).applyMatrix4(It)),Array.isArray(At)){const Ct=vt.groups;for(let Ht=0,Xt=Ct.length;Ht<Xt;Ht++){const Pt=Ct[Ht],ue=At[Pt.materialIndex];ue&&ue.visible&&g.push(D,vt,ue,q,zt.z,Pt)}}else At.visible&&g.push(D,vt,At,q,zt.z,null)}}const ft=D.children;for(let vt=0,At=ft.length;vt<At;vt++)Sf(ft[vt],H,q,K)}function P_(D,H,q,K){const G=D.opaque,ft=D.transmissive,vt=D.transparent;p.setupLightsView(q),it===!0&&ut.setGlobalState(v.clippingPlanes,q),K&&Nt.viewport(P.copy(K)),G.length>0&&yh(G,H,q),ft.length>0&&yh(ft,H,q),vt.length>0&&yh(vt,H,q),Nt.buffers.depth.setTest(!0),Nt.buffers.depth.setMask(!0),Nt.buffers.color.setMask(!0),Nt.setPolygonOffset(!1)}function R_(D,H,q,K){if((q.isScene===!0?q.overrideMaterial:null)!==null)return;p.state.transmissionRenderTarget[K.id]===void 0&&(p.state.transmissionRenderTarget[K.id]=new Bo(1,1,{generateMipmaps:!0,type:re.has("EXT_color_buffer_half_float")||re.has("EXT_color_buffer_float")?Ks:or,minFilter:Ji,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ne.workingColorSpace}));const ft=p.state.transmissionRenderTarget[K.id],vt=K.viewport||P;ft.setSize(vt.z,vt.w);const At=v.getRenderTarget();v.setRenderTarget(ft),v.getClearColor(F),z=v.getClearAlpha(),z<1&&v.setClearColor(16777215,.5),v.clear(),ce&&Ut.render(q);const Ct=v.toneMapping;v.toneMapping=Hr;const Ht=K.viewport;if(K.viewport!==void 0&&(K.viewport=void 0),p.setupLightsView(K),it===!0&&ut.setGlobalState(v.clippingPlanes,K),yh(D,q,K),k.updateMultisampleRenderTarget(ft),k.updateRenderTargetMipmap(ft),re.has("WEBGL_multisampled_render_to_texture")===!1){let Xt=!1;for(let Pt=0,ue=H.length;Pt<ue;Pt++){const Se=H[Pt],Ee=Se.object,Wn=Se.geometry,de=Se.material,Lt=Se.group;if(de.side===Sn&&Ee.layers.test(K.layers)){const Ds=de.side;de.side=Vn,de.needsUpdate=!0,D_(Ee,q,K,Wn,de,Lt),de.side=Ds,de.needsUpdate=!0,Xt=!0}}Xt===!0&&(k.updateMultisampleRenderTarget(ft),k.updateRenderTargetMipmap(ft))}v.setRenderTarget(At),v.setClearColor(F,z),Ht!==void 0&&(K.viewport=Ht),v.toneMapping=Ct}function yh(D,H,q){const K=H.isScene===!0?H.overrideMaterial:null;for(let G=0,ft=D.length;G<ft;G++){const vt=D[G],At=vt.object,Ct=vt.geometry,Ht=K===null?vt.material:K,Xt=vt.group;At.layers.test(q.layers)&&D_(At,H,q,Ct,Ht,Xt)}}function D_(D,H,q,K,G,ft){D.onBeforeRender(v,H,q,K,G,ft),D.modelViewMatrix.multiplyMatrices(q.matrixWorldInverse,D.matrixWorld),D.normalMatrix.getNormalMatrix(D.modelViewMatrix),G.onBeforeRender(v,H,q,K,D,ft),G.transparent===!0&&G.side===Sn&&G.forceSinglePass===!1?(G.side=Vn,G.needsUpdate=!0,v.renderBufferDirect(q,H,K,G,D,ft),G.side=Bi,G.needsUpdate=!0,v.renderBufferDirect(q,H,K,G,D,ft),G.side=Sn):v.renderBufferDirect(q,H,K,G,D,ft),D.onAfterRender(v,H,q,K,G,ft)}function vh(D,H,q){H.isScene!==!0&&(H=Fe);const K=Ft.get(D),G=p.state.lights,ft=p.state.shadowsArray,vt=G.state.version,At=Dt.getParameters(D,G.state,ft,H,q),Ct=Dt.getProgramCacheKey(At);let Ht=K.programs;K.environment=D.isMeshStandardMaterial?H.environment:null,K.fog=H.fog,K.envMap=(D.isMeshStandardMaterial?X:R).get(D.envMap||K.environment),K.envMapRotation=K.environment!==null&&D.envMap===null?H.environmentRotation:D.envMapRotation,Ht===void 0&&(D.addEventListener("dispose",Wt),Ht=new Map,K.programs=Ht);let Xt=Ht.get(Ct);if(Xt!==void 0){if(K.currentProgram===Xt&&K.lightsStateVersion===vt)return I_(D,At),Xt}else At.uniforms=Dt.getUniforms(D),D.onBeforeCompile(At,v),Xt=Dt.acquireProgram(At,Ct),Ht.set(Ct,Xt),K.uniforms=At.uniforms;const Pt=K.uniforms;return(!D.isShaderMaterial&&!D.isRawShaderMaterial||D.clipping===!0)&&(Pt.clippingPlanes=ut.uniform),I_(D,At),K.needsLights=wT(D),K.lightsStateVersion=vt,K.needsLights&&(Pt.ambientLightColor.value=G.state.ambient,Pt.lightProbe.value=G.state.probe,Pt.directionalLights.value=G.state.directional,Pt.directionalLightShadows.value=G.state.directionalShadow,Pt.spotLights.value=G.state.spot,Pt.spotLightShadows.value=G.state.spotShadow,Pt.rectAreaLights.value=G.state.rectArea,Pt.ltc_1.value=G.state.rectAreaLTC1,Pt.ltc_2.value=G.state.rectAreaLTC2,Pt.pointLights.value=G.state.point,Pt.pointLightShadows.value=G.state.pointShadow,Pt.hemisphereLights.value=G.state.hemi,Pt.directionalShadowMap.value=G.state.directionalShadowMap,Pt.directionalShadowMatrix.value=G.state.directionalShadowMatrix,Pt.spotShadowMap.value=G.state.spotShadowMap,Pt.spotLightMatrix.value=G.state.spotLightMatrix,Pt.spotLightMap.value=G.state.spotLightMap,Pt.pointShadowMap.value=G.state.pointShadowMap,Pt.pointShadowMatrix.value=G.state.pointShadowMatrix),K.currentProgram=Xt,K.uniformsList=null,Xt}function L_(D){if(D.uniformsList===null){const H=D.currentProgram.getUniforms();D.uniformsList=id.seqWithValue(H.seq,D.uniforms)}return D.uniformsList}function I_(D,H){const q=Ft.get(D);q.outputColorSpace=H.outputColorSpace,q.batching=H.batching,q.batchingColor=H.batchingColor,q.instancing=H.instancing,q.instancingColor=H.instancingColor,q.instancingMorph=H.instancingMorph,q.skinning=H.skinning,q.morphTargets=H.morphTargets,q.morphNormals=H.morphNormals,q.morphColors=H.morphColors,q.morphTargetsCount=H.morphTargetsCount,q.numClippingPlanes=H.numClippingPlanes,q.numIntersection=H.numClipIntersection,q.vertexAlphas=H.vertexAlphas,q.vertexTangents=H.vertexTangents,q.toneMapping=H.toneMapping}function vT(D,H,q,K,G){H.isScene!==!0&&(H=Fe),k.resetTextureUnits();const ft=H.fog,vt=K.isMeshStandardMaterial?H.environment:null,At=E===null?v.outputColorSpace:E.isXRRenderTarget===!0?E.texture.colorSpace:Dc,Ct=(K.isMeshStandardMaterial?X:R).get(K.envMap||vt),Ht=K.vertexColors===!0&&!!q.attributes.color&&q.attributes.color.itemSize===4,Xt=!!q.attributes.tangent&&(!!K.normalMap||K.anisotropy>0),Pt=!!q.morphAttributes.position,ue=!!q.morphAttributes.normal,Se=!!q.morphAttributes.color;let Ee=Hr;K.toneMapped&&(E===null||E.isXRRenderTarget===!0)&&(Ee=v.toneMapping);const Wn=q.morphAttributes.position||q.morphAttributes.normal||q.morphAttributes.color,de=Wn!==void 0?Wn.length:0,Lt=Ft.get(K),Ds=p.state.lights;if(it===!0&&(mt===!0||D!==M)){const wi=D===M&&K.id===w;ut.setState(K,D,wi)}let fe=!1;K.version===Lt.__version?(Lt.needsLights&&Lt.lightsStateVersion!==Ds.state.version||Lt.outputColorSpace!==At||G.isBatchedMesh&&Lt.batching===!1||!G.isBatchedMesh&&Lt.batching===!0||G.isBatchedMesh&&Lt.batchingColor===!0&&G.colorTexture===null||G.isBatchedMesh&&Lt.batchingColor===!1&&G.colorTexture!==null||G.isInstancedMesh&&Lt.instancing===!1||!G.isInstancedMesh&&Lt.instancing===!0||G.isSkinnedMesh&&Lt.skinning===!1||!G.isSkinnedMesh&&Lt.skinning===!0||G.isInstancedMesh&&Lt.instancingColor===!0&&G.instanceColor===null||G.isInstancedMesh&&Lt.instancingColor===!1&&G.instanceColor!==null||G.isInstancedMesh&&Lt.instancingMorph===!0&&G.morphTexture===null||G.isInstancedMesh&&Lt.instancingMorph===!1&&G.morphTexture!==null||Lt.envMap!==Ct||K.fog===!0&&Lt.fog!==ft||Lt.numClippingPlanes!==void 0&&(Lt.numClippingPlanes!==ut.numPlanes||Lt.numIntersection!==ut.numIntersection)||Lt.vertexAlphas!==Ht||Lt.vertexTangents!==Xt||Lt.morphTargets!==Pt||Lt.morphNormals!==ue||Lt.morphColors!==Se||Lt.toneMapping!==Ee||Lt.morphTargetsCount!==de)&&(fe=!0):(fe=!0,Lt.__version=K.version);let Hi=Lt.currentProgram;fe===!0&&(Hi=vh(K,H,G));let ea=!1,oi=!1,jc=!1;const Ae=Hi.getUniforms(),as=Lt.uniforms;if(Nt.useProgram(Hi.program)&&(ea=!0,oi=!0,jc=!0),K.id!==w&&(w=K.id,oi=!0),ea||M!==D){Nt.buffers.depth.getReversed()?(ht.copy(D.projectionMatrix),OE(ht),FE(ht),Ae.setValue(W,"projectionMatrix",ht)):Ae.setValue(W,"projectionMatrix",D.projectionMatrix),Ae.setValue(W,"viewMatrix",D.matrixWorldInverse);const mr=Ae.map.cameraPosition;mr!==void 0&&mr.setValue(W,kt.setFromMatrixPosition(D.matrixWorld)),oe.logarithmicDepthBuffer&&Ae.setValue(W,"logDepthBufFC",2/(Math.log(D.far+1)/Math.LN2)),(K.isMeshPhongMaterial||K.isMeshToonMaterial||K.isMeshLambertMaterial||K.isMeshBasicMaterial||K.isMeshStandardMaterial||K.isShaderMaterial)&&Ae.setValue(W,"isOrthographic",D.isOrthographicCamera===!0),M!==D&&(M=D,oi=!0,jc=!0)}if(G.isSkinnedMesh){Ae.setOptional(W,G,"bindMatrix"),Ae.setOptional(W,G,"bindMatrixInverse");const wi=G.skeleton;wi&&(wi.boneTexture===null&&wi.computeBoneTexture(),Ae.setValue(W,"boneTexture",wi.boneTexture,k))}G.isBatchedMesh&&(Ae.setOptional(W,G,"batchingTexture"),Ae.setValue(W,"batchingTexture",G._matricesTexture,k),Ae.setOptional(W,G,"batchingIdTexture"),Ae.setValue(W,"batchingIdTexture",G._indirectTexture,k),Ae.setOptional(W,G,"batchingColorTexture"),G._colorsTexture!==null&&Ae.setValue(W,"batchingColorTexture",G._colorsTexture,k));const Wc=q.morphAttributes;if((Wc.position!==void 0||Wc.normal!==void 0||Wc.color!==void 0)&&Vt.update(G,q,Hi),(oi||Lt.receiveShadow!==G.receiveShadow)&&(Lt.receiveShadow=G.receiveShadow,Ae.setValue(W,"receiveShadow",G.receiveShadow)),K.isMeshGouraudMaterial&&K.envMap!==null&&(as.envMap.value=Ct,as.flipEnvMap.value=Ct.isCubeTexture&&Ct.isRenderTargetTexture===!1?-1:1),K.isMeshStandardMaterial&&K.envMap===null&&H.environment!==null&&(as.envMapIntensity.value=H.environmentIntensity),oi&&(Ae.setValue(W,"toneMappingExposure",v.toneMappingExposure),Lt.needsLights&&xT(as,jc),ft&&K.fog===!0&&bt.refreshFogUniforms(as,ft),bt.refreshMaterialUniforms(as,K,j,Z,p.state.transmissionRenderTarget[D.id]),id.upload(W,L_(Lt),as,k)),K.isShaderMaterial&&K.uniformsNeedUpdate===!0&&(id.upload(W,L_(Lt),as,k),K.uniformsNeedUpdate=!1),K.isSpriteMaterial&&Ae.setValue(W,"center",G.center),Ae.setValue(W,"modelViewMatrix",G.modelViewMatrix),Ae.setValue(W,"normalMatrix",G.normalMatrix),Ae.setValue(W,"modelMatrix",G.matrixWorld),K.isShaderMaterial||K.isRawShaderMaterial){const wi=K.uniformsGroups;for(let mr=0,gr=wi.length;mr<gr;mr++){const O_=wi[mr];V.update(O_,Hi),V.bind(O_,Hi)}}return Hi}function xT(D,H){D.ambientLightColor.needsUpdate=H,D.lightProbe.needsUpdate=H,D.directionalLights.needsUpdate=H,D.directionalLightShadows.needsUpdate=H,D.pointLights.needsUpdate=H,D.pointLightShadows.needsUpdate=H,D.spotLights.needsUpdate=H,D.spotLightShadows.needsUpdate=H,D.rectAreaLights.needsUpdate=H,D.hemisphereLights.needsUpdate=H}function wT(D){return D.isMeshLambertMaterial||D.isMeshToonMaterial||D.isMeshPhongMaterial||D.isMeshStandardMaterial||D.isShadowMaterial||D.isShaderMaterial&&D.lights===!0}this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(D,H,q){Ft.get(D.texture).__webglTexture=H,Ft.get(D.depthTexture).__webglTexture=q;const K=Ft.get(D);K.__hasExternalTextures=!0,K.__autoAllocateDepthBuffer=q===void 0,K.__autoAllocateDepthBuffer||re.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),K.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(D,H){const q=Ft.get(D);q.__webglFramebuffer=H,q.__useDefaultFramebuffer=H===void 0},this.setRenderTarget=function(D,H=0,q=0){E=D,S=H,T=q;let K=!0,G=null,ft=!1,vt=!1;if(D){const Ct=Ft.get(D);if(Ct.__useDefaultFramebuffer!==void 0)Nt.bindFramebuffer(W.FRAMEBUFFER,null),K=!1;else if(Ct.__webglFramebuffer===void 0)k.setupRenderTarget(D);else if(Ct.__hasExternalTextures)k.rebindTextures(D,Ft.get(D.texture).__webglTexture,Ft.get(D.depthTexture).__webglTexture);else if(D.depthBuffer){const Pt=D.depthTexture;if(Ct.__boundDepthTexture!==Pt){if(Pt!==null&&Ft.has(Pt)&&(D.width!==Pt.image.width||D.height!==Pt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");k.setupDepthRenderbuffer(D)}}const Ht=D.texture;(Ht.isData3DTexture||Ht.isDataArrayTexture||Ht.isCompressedArrayTexture)&&(vt=!0);const Xt=Ft.get(D).__webglFramebuffer;D.isWebGLCubeRenderTarget?(Array.isArray(Xt[H])?G=Xt[H][q]:G=Xt[H],ft=!0):D.samples>0&&k.useMultisampledRTT(D)===!1?G=Ft.get(D).__webglMultisampledFramebuffer:Array.isArray(Xt)?G=Xt[q]:G=Xt,P.copy(D.viewport),L.copy(D.scissor),I=D.scissorTest}else P.copy(at).multiplyScalar(j).floor(),L.copy(dt).multiplyScalar(j).floor(),I=St;if(Nt.bindFramebuffer(W.FRAMEBUFFER,G)&&K&&Nt.drawBuffers(D,G),Nt.viewport(P),Nt.scissor(L),Nt.setScissorTest(I),ft){const Ct=Ft.get(D.texture);W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_CUBE_MAP_POSITIVE_X+H,Ct.__webglTexture,q)}else if(vt){const Ct=Ft.get(D.texture),Ht=H||0;W.framebufferTextureLayer(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,Ct.__webglTexture,q||0,Ht)}w=-1},this.readRenderTargetPixels=function(D,H,q,K,G,ft,vt){if(!(D&&D.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let At=Ft.get(D).__webglFramebuffer;if(D.isWebGLCubeRenderTarget&&vt!==void 0&&(At=At[vt]),At){Nt.bindFramebuffer(W.FRAMEBUFFER,At);try{const Ct=D.texture,Ht=Ct.format,Xt=Ct.type;if(!oe.textureFormatReadable(Ht)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!oe.textureTypeReadable(Xt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}H>=0&&H<=D.width-K&&q>=0&&q<=D.height-G&&W.readPixels(H,q,K,G,Yt.convert(Ht),Yt.convert(Xt),ft)}finally{const Ct=E!==null?Ft.get(E).__webglFramebuffer:null;Nt.bindFramebuffer(W.FRAMEBUFFER,Ct)}}},this.readRenderTargetPixelsAsync=async function(D,H,q,K,G,ft,vt){if(!(D&&D.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let At=Ft.get(D).__webglFramebuffer;if(D.isWebGLCubeRenderTarget&&vt!==void 0&&(At=At[vt]),At){const Ct=D.texture,Ht=Ct.format,Xt=Ct.type;if(!oe.textureFormatReadable(Ht))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!oe.textureTypeReadable(Xt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(H>=0&&H<=D.width-K&&q>=0&&q<=D.height-G){Nt.bindFramebuffer(W.FRAMEBUFFER,At);const Pt=W.createBuffer();W.bindBuffer(W.PIXEL_PACK_BUFFER,Pt),W.bufferData(W.PIXEL_PACK_BUFFER,ft.byteLength,W.STREAM_READ),W.readPixels(H,q,K,G,Yt.convert(Ht),Yt.convert(Xt),0);const ue=E!==null?Ft.get(E).__webglFramebuffer:null;Nt.bindFramebuffer(W.FRAMEBUFFER,ue);const Se=W.fenceSync(W.SYNC_GPU_COMMANDS_COMPLETE,0);return W.flush(),await IE(W,Se,4),W.bindBuffer(W.PIXEL_PACK_BUFFER,Pt),W.getBufferSubData(W.PIXEL_PACK_BUFFER,0,ft),W.deleteBuffer(Pt),W.deleteSync(Se),ft}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(D,H=null,q=0){D.isTexture!==!0&&(_l("WebGLRenderer: copyFramebufferToTexture function signature has changed."),H=arguments[0]||null,D=arguments[1]);const K=Math.pow(2,-q),G=Math.floor(D.image.width*K),ft=Math.floor(D.image.height*K),vt=H!==null?H.x:0,At=H!==null?H.y:0;k.setTexture2D(D,0),W.copyTexSubImage2D(W.TEXTURE_2D,q,0,0,vt,At,G,ft),Nt.unbindTexture()},this.copyTextureToTexture=function(D,H,q=null,K=null,G=0){D.isTexture!==!0&&(_l("WebGLRenderer: copyTextureToTexture function signature has changed."),K=arguments[0]||null,D=arguments[1],H=arguments[2],G=arguments[3]||0,q=null);let ft,vt,At,Ct,Ht,Xt,Pt,ue,Se;const Ee=D.isCompressedTexture?D.mipmaps[G]:D.image;q!==null?(ft=q.max.x-q.min.x,vt=q.max.y-q.min.y,At=q.isBox3?q.max.z-q.min.z:1,Ct=q.min.x,Ht=q.min.y,Xt=q.isBox3?q.min.z:0):(ft=Ee.width,vt=Ee.height,At=Ee.depth||1,Ct=0,Ht=0,Xt=0),K!==null?(Pt=K.x,ue=K.y,Se=K.z):(Pt=0,ue=0,Se=0);const Wn=Yt.convert(H.format),de=Yt.convert(H.type);let Lt;H.isData3DTexture?(k.setTexture3D(H,0),Lt=W.TEXTURE_3D):H.isDataArrayTexture||H.isCompressedArrayTexture?(k.setTexture2DArray(H,0),Lt=W.TEXTURE_2D_ARRAY):(k.setTexture2D(H,0),Lt=W.TEXTURE_2D),W.pixelStorei(W.UNPACK_FLIP_Y_WEBGL,H.flipY),W.pixelStorei(W.UNPACK_PREMULTIPLY_ALPHA_WEBGL,H.premultiplyAlpha),W.pixelStorei(W.UNPACK_ALIGNMENT,H.unpackAlignment);const Ds=W.getParameter(W.UNPACK_ROW_LENGTH),fe=W.getParameter(W.UNPACK_IMAGE_HEIGHT),Hi=W.getParameter(W.UNPACK_SKIP_PIXELS),ea=W.getParameter(W.UNPACK_SKIP_ROWS),oi=W.getParameter(W.UNPACK_SKIP_IMAGES);W.pixelStorei(W.UNPACK_ROW_LENGTH,Ee.width),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,Ee.height),W.pixelStorei(W.UNPACK_SKIP_PIXELS,Ct),W.pixelStorei(W.UNPACK_SKIP_ROWS,Ht),W.pixelStorei(W.UNPACK_SKIP_IMAGES,Xt);const jc=D.isDataArrayTexture||D.isData3DTexture,Ae=H.isDataArrayTexture||H.isData3DTexture;if(D.isRenderTargetTexture||D.isDepthTexture){const as=Ft.get(D),Wc=Ft.get(H),wi=Ft.get(as.__renderTarget),mr=Ft.get(Wc.__renderTarget);Nt.bindFramebuffer(W.READ_FRAMEBUFFER,wi.__webglFramebuffer),Nt.bindFramebuffer(W.DRAW_FRAMEBUFFER,mr.__webglFramebuffer);for(let gr=0;gr<At;gr++)jc&&W.framebufferTextureLayer(W.READ_FRAMEBUFFER,W.COLOR_ATTACHMENT0,Ft.get(D).__webglTexture,G,Xt+gr),D.isDepthTexture?(Ae&&W.framebufferTextureLayer(W.DRAW_FRAMEBUFFER,W.COLOR_ATTACHMENT0,Ft.get(H).__webglTexture,G,Se+gr),W.blitFramebuffer(Ct,Ht,ft,vt,Pt,ue,ft,vt,W.DEPTH_BUFFER_BIT,W.NEAREST)):Ae?W.copyTexSubImage3D(Lt,G,Pt,ue,Se+gr,Ct,Ht,ft,vt):W.copyTexSubImage2D(Lt,G,Pt,ue,Se+gr,Ct,Ht,ft,vt);Nt.bindFramebuffer(W.READ_FRAMEBUFFER,null),Nt.bindFramebuffer(W.DRAW_FRAMEBUFFER,null)}else Ae?D.isDataTexture||D.isData3DTexture?W.texSubImage3D(Lt,G,Pt,ue,Se,ft,vt,At,Wn,de,Ee.data):H.isCompressedArrayTexture?W.compressedTexSubImage3D(Lt,G,Pt,ue,Se,ft,vt,At,Wn,Ee.data):W.texSubImage3D(Lt,G,Pt,ue,Se,ft,vt,At,Wn,de,Ee):D.isDataTexture?W.texSubImage2D(W.TEXTURE_2D,G,Pt,ue,ft,vt,Wn,de,Ee.data):D.isCompressedTexture?W.compressedTexSubImage2D(W.TEXTURE_2D,G,Pt,ue,Ee.width,Ee.height,Wn,Ee.data):W.texSubImage2D(W.TEXTURE_2D,G,Pt,ue,ft,vt,Wn,de,Ee);W.pixelStorei(W.UNPACK_ROW_LENGTH,Ds),W.pixelStorei(W.UNPACK_IMAGE_HEIGHT,fe),W.pixelStorei(W.UNPACK_SKIP_PIXELS,Hi),W.pixelStorei(W.UNPACK_SKIP_ROWS,ea),W.pixelStorei(W.UNPACK_SKIP_IMAGES,oi),G===0&&H.generateMipmaps&&W.generateMipmap(Lt),Nt.unbindTexture()},this.copyTextureToTexture3D=function(D,H,q=null,K=null,G=0){return D.isTexture!==!0&&(_l("WebGLRenderer: copyTextureToTexture3D function signature has changed."),q=arguments[0]||null,K=arguments[1]||null,D=arguments[2],H=arguments[3],G=arguments[4]||0),_l('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(D,H,q,K,G)},this.initRenderTarget=function(D){Ft.get(D).__webglFramebuffer===void 0&&k.setupRenderTarget(D)},this.initTexture=function(D){D.isCubeTexture?k.setTextureCube(D,0):D.isData3DTexture?k.setTexture3D(D,0):D.isDataArrayTexture||D.isCompressedArrayTexture?k.setTexture2DArray(D,0):k.setTexture2D(D,0),Nt.unbindTexture()},this.resetState=function(){S=0,T=0,E=null,Nt.reset(),we.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Zs}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorspace=ne._getDrawingBufferColorSpace(t),e.unpackColorSpace=ne._getUnpackColorSpace()}}class t0{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new pt(t),this.near=e,this.far=n}clone(){return new t0(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class xc extends Bt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Me,this.environmentIntensity=1,this.environmentRotation=new Me,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class uw{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Hm,this.updateRanges=[],this.version=0,this.uuid=es()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,s=this.stride;i<s;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=es()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=es()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Rn=new C;class Gl{constructor(t,e,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Rn.fromBufferAttribute(this,e),Rn.applyMatrix4(t),this.setXYZ(e,Rn.x,Rn.y,Rn.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Rn.fromBufferAttribute(this,e),Rn.applyNormalMatrix(t),this.setXYZ(e,Rn.x,Rn.y,Rn.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Rn.fromBufferAttribute(this,e),Rn.transformDirection(t),this.setXYZ(e,Rn.x,Rn.y,Rn.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=Qi(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=_e(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=_e(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=_e(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=_e(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=_e(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Qi(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Qi(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Qi(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Qi(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=_e(e,this.array),n=_e(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=_e(e,this.array),n=_e(n,this.array),i=_e(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=_e(e,this.array),n=_e(n,this.array),i=_e(i,this.array),s=_e(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=s,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[i+s])}return new Pe(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Gl(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)e.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class YR extends Hn{static get type(){return"SpriteMaterial"}constructor(t){super(),this.isSpriteMaterial=!0,this.color=new pt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let ga;const Zc=new C,_a=new C,ba=new C,ya=new J,Qc=new J,dw=new lt,Hh=new C,$c=new C,Gh=new C,Fb=new J,$f=new J,kb=new J;class Lz extends Bt{constructor(t=new YR){if(super(),this.isSprite=!0,this.type="Sprite",ga===void 0){ga=new Qt;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new uw(e,5);ga.setIndex([0,1,2,0,2,3]),ga.setAttribute("position",new Gl(n,3,0,!1)),ga.setAttribute("uv",new Gl(n,2,3,!1))}this.geometry=ga,this.material=t,this.center=new J(.5,.5)}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_a.setFromMatrixScale(this.matrixWorld),dw.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),ba.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_a.multiplyScalar(-ba.z);const n=this.material.rotation;let i,s;n!==0&&(s=Math.cos(n),i=Math.sin(n));const o=this.center;jh(Hh.set(-.5,-.5,0),ba,o,_a,i,s),jh($c.set(.5,-.5,0),ba,o,_a,i,s),jh(Gh.set(.5,.5,0),ba,o,_a,i,s),Fb.set(0,0),$f.set(1,0),kb.set(1,1);let a=t.ray.intersectTriangle(Hh,$c,Gh,!1,Zc);if(a===null&&(jh($c.set(-.5,.5,0),ba,o,_a,i,s),$f.set(0,1),a=t.ray.intersectTriangle(Hh,Gh,$c,!1,Zc),a===null))return;const c=t.ray.origin.distanceTo(Zc);c<t.near||c>t.far||e.push({distance:c,point:Zc.clone(),uv:un.getInterpolation(Zc,Hh,$c,Gh,Fb,$f,kb,new J),face:null,object:this})}copy(t,e){return super.copy(t,e),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}}function jh(r,t,e,n,i,s){ya.subVectors(r,e).addScalar(.5).multiply(n),i!==void 0?(Qc.x=s*ya.x-i*ya.y,Qc.y=i*ya.x+s*ya.y):Qc.copy(ya),r.copy(t),r.x+=Qc.x,r.y+=Qc.y,r.applyMatrix4(dw)}const Nb=new C,Ub=new ie,Bb=new ie,qR=new C,zb=new lt,Wh=new C,Jf=new An,Vb=new lt,tp=new Ko;class fw extends ct{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=z_,this.bindMatrix=new lt,this.bindMatrixInverse=new lt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new xe),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,Wh),this.boundingBox.expandByPoint(Wh)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new An),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)this.getVertexPosition(n,Wh),this.boundingSphere.expandByPoint(Wh)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Jf.copy(this.boundingSphere),Jf.applyMatrix4(i),t.ray.intersectsSphere(Jf)!==!1&&(Vb.copy(i).invert(),tp.copy(t.ray).applyMatrix4(Vb),!(this.boundingBox!==null&&tp.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,tp)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new ie,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const s=1/t.manhattanLength();s!==1/0?t.multiplyScalar(s):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===z_?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===iE?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const n=this.skeleton,i=this.geometry;Ub.fromBufferAttribute(i.attributes.skinIndex,t),Bb.fromBufferAttribute(i.attributes.skinWeight,t),Nb.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let s=0;s<4;s++){const o=Bb.getComponent(s);if(o!==0){const a=Ub.getComponent(s);zb.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),e.addScaledVector(qR.copy(Nb).applyMatrix4(zb),o)}}return e.applyMatrix4(this.bindMatrixInverse)}}class gd extends Bt{constructor(){super(),this.isBone=!0,this.type="Bone"}}class nc extends Ie{constructor(t=null,e=1,n=1,i,s,o,a,c,l=gn,h=gn,u,d){super(null,o,a,c,l,h,i,s,u,d),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Hb=new lt,KR=new lt;class Kd{constructor(t=[],e=[]){this.uuid=es(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new lt)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const n=new lt;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const n=this.bones[t];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let s=0,o=t.length;s<o;s++){const a=t[s]?t[s].matrixWorld:KR;Hb.multiplyMatrices(a,e[s]),Hb.toArray(n,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new Kd(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new nc(e,t,t,zn,Tn);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const s=t.bones[n];let o=e[s];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),o=new gd),this.bones.push(o),this.boneInverses.push(new lt().fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,s=e.length;i<s;i++){const o=e[i];t.bones.push(o.uuid);const a=n[i];t.boneInverses.push(a.toArray())}return t}}class jm extends Pe{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const va=new lt,Gb=new lt,Xh=[],jb=new xe,ZR=new lt,Jc=new ct,tl=new An;class QR extends ct{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new jm(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,ZR)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new xe),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,va),jb.copy(t.boundingBox).applyMatrix4(va),this.boundingBox.union(jb)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new An),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,va),tl.copy(t.boundingSphere).applyMatrix4(va),this.boundingSphere.union(tl)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const n=e.morphTargetInfluences,i=this.morphTexture.source.data.data,s=n.length+1,o=t*s+1;for(let a=0;a<n.length;a++)n[a]=i[o+a]}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Jc.geometry=this.geometry,Jc.material=this.material,Jc.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),tl.copy(this.boundingSphere),tl.applyMatrix4(n),t.ray.intersectsSphere(tl)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,va),Gb.multiplyMatrices(n,va),Jc.matrixWorld=Gb,Jc.raycast(t,Xh);for(let o=0,a=Xh.length;o<a;o++){const c=Xh[o];c.instanceId=s,c.object=this,e.push(c)}Xh.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new jm(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const n=e.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new nc(new Float32Array(i*this.count),i,this.count,Wg,Tn));const s=this.morphTexture.source.data.data;let o=0;for(let l=0;l<n.length;l++)o+=n[l];const a=this.geometry.morphTargetsRelative?1:1-o,c=i*t;s[c]=a,s.set(n,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function ep(r,t){return r-t}function $R(r,t){return r.z-t.z}function JR(r,t){return t.z-r.z}class tD{constructor(){this.index=0,this.pool=[],this.list=[]}push(t,e,n,i){const s=this.pool,o=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const a=s[this.index];o.push(a),this.index++,a.start=t,a.count=e,a.z=n,a.index=i}reset(){this.list.length=0,this.index=0}}const Xn=new lt,eD=new pt(1,1,1),np=new Yd,Yh=new xe,fo=new An,el=new C,Wb=new C,nD=new C,ip=new tD,wn=new ct,qh=[];function iD(r,t,e=0){const n=t.itemSize;if(r.isInterleavedBufferAttribute||r.array.constructor!==t.array.constructor){const i=r.count;for(let s=0;s<i;s++)for(let o=0;o<n;o++)t.setComponent(s+e,o,r.getComponent(s,o))}else t.array.set(r.array,e*n);t.needsUpdate=!0}function po(r,t){if(r.constructor!==t.constructor){const e=Math.min(r.length,t.length);for(let n=0;n<e;n++)t[n]=r[n]}else{const e=Math.min(r.length,t.length);t.set(new r.constructor(r.buffer,0,e))}}class sD extends ct{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(t,e,n=e*2,i){super(new Qt,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=t,this._maxVertexCount=e,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(t),this._multiDrawStarts=new Int32Array(t),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let t=Math.sqrt(this._maxInstanceCount*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4),n=new nc(e,t,t,zn,Tn);this._matricesTexture=n}_initIndirectTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Uint32Array(t*t),n=new nc(e,t,t,jd,Xr);this._indirectTexture=n}_initColorsTexture(){let t=Math.sqrt(this._maxInstanceCount);t=Math.ceil(t);const e=new Float32Array(t*t*4).fill(1),n=new nc(e,t,t,zn,Tn);n.colorSpace=ne.workingColorSpace,this._colorsTexture=n}_initializeGeometry(t){const e=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in t.attributes){const o=t.getAttribute(s),{array:a,itemSize:c,normalized:l}=o,h=new a.constructor(n*c),u=new Pe(h,c,l);e.setAttribute(s,u)}if(t.getIndex()!==null){const s=n>65535?new Uint32Array(i):new Uint16Array(i);e.setIndex(new Pe(s,1))}this._geometryInitialized=!0}}_validateGeometry(t){const e=this.geometry;if(!!t.getIndex()!=!!e.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const n in e.attributes){if(!t.hasAttribute(n))throw new Error(`BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=t.getAttribute(n),s=e.getAttribute(n);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(t){return this.customSort=t,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new xe);const t=this.boundingBox,e=this._instanceInfo;t.makeEmpty();for(let n=0,i=e.length;n<i;n++){if(e[n].active===!1)continue;const s=e[n].geometryIndex;this.getMatrixAt(n,Xn),this.getBoundingBoxAt(s,Yh).applyMatrix4(Xn),t.union(Yh)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new An);const t=this.boundingSphere,e=this._instanceInfo;t.makeEmpty();for(let n=0,i=e.length;n<i;n++){if(e[n].active===!1)continue;const s=e[n].geometryIndex;this.getMatrixAt(n,Xn),this.getBoundingSphereAt(s,fo).applyMatrix4(Xn),t.union(fo)}}addInstance(t){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:t};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ep),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=n):(i=this._instanceInfo.length,this._instanceInfo.push(n));const s=this._matricesTexture;Xn.identity().toArray(s.image.data,i*16),s.needsUpdate=!0;const o=this._colorsTexture;return o&&(eD.toArray(o.image.data,i*4),o.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(t,e=-1,n=-1){this._initializeGeometry(t),this._validateGeometry(t);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=e===-1?t.getAttribute("position").count:e;const o=t.getIndex();if(o!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=n===-1?o.count:n),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let c;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ep),c=this._availableGeometryIds.shift(),s[c]=i):(c=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(c,t),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,c}setGeometryAt(t,e){if(t>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(e);const n=this.geometry,i=n.getIndex()!==null,s=n.getIndex(),o=e.getIndex(),a=this._geometryInfo[t];if(i&&o.count>a.reservedIndexCount||e.attributes.position.count>a.reservedVertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const c=a.vertexStart,l=a.reservedVertexCount;a.vertexCount=e.getAttribute("position").count;for(const h in n.attributes){const u=e.getAttribute(h),d=n.getAttribute(h);iD(u,d,c);const f=u.itemSize;for(let m=u.count,_=l;m<_;m++){const g=c+m;for(let p=0;p<f;p++)d.setComponent(g,p,0)}d.needsUpdate=!0,d.addUpdateRange(c*f,l*f)}if(i){const h=a.indexStart,u=a.reservedIndexCount;a.indexCount=e.getIndex().count;for(let d=0;d<o.count;d++)s.setX(h+d,c+o.getX(d));for(let d=o.count,f=u;d<f;d++)s.setX(h+d,c);s.needsUpdate=!0,s.addUpdateRange(h,a.reservedIndexCount)}return a.start=i?a.indexStart:a.vertexStart,a.count=i?a.indexCount:a.vertexCount,a.boundingBox=null,e.boundingBox!==null&&(a.boundingBox=e.boundingBox.clone()),a.boundingSphere=null,e.boundingSphere!==null&&(a.boundingSphere=e.boundingSphere.clone()),this._visibilityChanged=!0,t}deleteGeometry(t){const e=this._geometryInfo;if(t>=e.length||e[t].active===!1)return this;const n=this._instanceInfo;for(let i=0,s=n.length;i<s;i++)n[i].geometryIndex===t&&this.deleteInstance(i);return e[t].active=!1,this._availableGeometryIds.push(t),this._visibilityChanged=!0,this}deleteInstance(t){const e=this._instanceInfo;return t>=e.length||e[t].active===!1?this:(e[t].active=!1,this._availableInstanceIds.push(t),this._visibilityChanged=!0,this)}optimize(){let t=0,e=0;const n=this._geometryInfo,i=n.map((o,a)=>a).sort((o,a)=>n[o].vertexStart-n[a].vertexStart),s=this.geometry;for(let o=0,a=n.length;o<a;o++){const c=i[o],l=n[c];if(l.active!==!1){if(s.index!==null){if(l.indexStart!==e){const{indexStart:h,vertexStart:u,reservedIndexCount:d}=l,f=s.index,m=f.array,_=t-u;for(let g=h;g<h+d;g++)m[g]=m[g]+_;f.array.copyWithin(e,h,h+d),f.addUpdateRange(e,d),l.indexStart=e}e+=l.reservedIndexCount}if(l.vertexStart!==t){const{vertexStart:h,reservedVertexCount:u}=l,d=s.attributes;for(const f in d){const m=d[f],{array:_,itemSize:g}=m;_.copyWithin(t*g,h*g,(h+u)*g),m.addUpdateRange(t*g,u*g)}l.vertexStart=t}t+=l.reservedVertexCount,l.start=s.index?l.indexStart:l.vertexStart,this._nextIndexStart=s.index?l.indexStart+l.reservedIndexCount:0,this._nextVertexStart=l.vertexStart+l.reservedVertexCount}}return this}getBoundingBoxAt(t,e){if(t>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[t];if(i.boundingBox===null){const s=new xe,o=n.index,a=n.attributes.position;for(let c=i.start,l=i.start+i.count;c<l;c++){let h=c;o&&(h=o.getX(h)),s.expandByPoint(el.fromBufferAttribute(a,h))}i.boundingBox=s}return e.copy(i.boundingBox),e}getBoundingSphereAt(t,e){if(t>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[t];if(i.boundingSphere===null){const s=new An;this.getBoundingBoxAt(t,Yh),Yh.getCenter(s.center);const o=n.index,a=n.attributes.position;let c=0;for(let l=i.start,h=i.start+i.count;l<h;l++){let u=l;o&&(u=o.getX(u)),el.fromBufferAttribute(a,u),c=Math.max(c,s.center.distanceToSquared(el))}s.radius=Math.sqrt(c),i.boundingSphere=s}return e.copy(i.boundingSphere),e}setMatrixAt(t,e){const n=this._instanceInfo,i=this._matricesTexture,s=this._matricesTexture.image.data;return t>=n.length||n[t].active===!1?this:(e.toArray(s,t*16),i.needsUpdate=!0,this)}getMatrixAt(t,e){const n=this._instanceInfo,i=this._matricesTexture.image.data;return t>=n.length||n[t].active===!1?null:e.fromArray(i,t*16)}setColorAt(t,e){this._colorsTexture===null&&this._initColorsTexture();const n=this._colorsTexture,i=this._colorsTexture.image.data,s=this._instanceInfo;return t>=s.length||s[t].active===!1?this:(e.toArray(i,t*4),n.needsUpdate=!0,this)}getColorAt(t,e){const n=this._colorsTexture.image.data,i=this._instanceInfo;return t>=i.length||i[t].active===!1?null:e.fromArray(n,t*4)}setVisibleAt(t,e){const n=this._instanceInfo;return t>=n.length||n[t].active===!1||n[t].visible===e?this:(n[t].visible=e,this._visibilityChanged=!0,this)}getVisibleAt(t){const e=this._instanceInfo;return t>=e.length||e[t].active===!1?!1:e[t].visible}setGeometryIdAt(t,e){const n=this._instanceInfo,i=this._geometryInfo;return t>=n.length||n[t].active===!1||e>=i.length||i[e].active===!1?null:(n[t].geometryIndex=e,this)}getGeometryIdAt(t){const e=this._instanceInfo;return t>=e.length||e[t].active===!1?-1:e[t].geometryIndex}getGeometryRangeAt(t,e={}){if(t<0||t>=this._geometryCount)return null;const n=this._geometryInfo[t];return e.vertexStart=n.vertexStart,e.vertexCount=n.vertexCount,e.reservedVertexCount=n.reservedVertexCount,e.indexStart=n.indexStart,e.indexCount=n.indexCount,e.reservedIndexCount=n.reservedIndexCount,e.start=n.start,e.count=n.count,e}setInstanceCount(t){const e=this._availableInstanceIds,n=this._instanceInfo;for(e.sort(ep);e[e.length-1]===n.length;)n.pop(),e.pop();if(t<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${t} are being used. Cannot shrink instance count.`);const i=new Int32Array(t),s=new Int32Array(t);po(this._multiDrawCounts,i),po(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=t;const o=this._indirectTexture,a=this._matricesTexture,c=this._colorsTexture;o.dispose(),this._initIndirectTexture(),po(o.image.data,this._indirectTexture.image.data),a.dispose(),this._initMatricesTexture(),po(a.image.data,this._matricesTexture.image.data),c&&(c.dispose(),this._initColorsTexture(),po(c.image.data,this._colorsTexture.image.data))}setGeometrySize(t,e){const n=[...this._geometryInfo].filter(a=>a.active);if(Math.max(...n.map(a=>a.vertexStart+a.reservedVertexCount))>t)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${e}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(c=>c.indexStart+c.reservedIndexCount))>e)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${e}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=t,this._maxIndexCount=e,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Qt,this._initializeGeometry(s));const o=this.geometry;s.index&&po(s.index.array,o.index.array);for(const a in s.attributes)po(s.attributes[a].array,o.attributes[a].array)}raycast(t,e){const n=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,o=this.geometry;wn.material=this.material,wn.geometry.index=o.index,wn.geometry.attributes=o.attributes,wn.geometry.boundingBox===null&&(wn.geometry.boundingBox=new xe),wn.geometry.boundingSphere===null&&(wn.geometry.boundingSphere=new An);for(let a=0,c=n.length;a<c;a++){if(!n[a].visible||!n[a].active)continue;const l=n[a].geometryIndex,h=i[l];wn.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(a,wn.matrixWorld).premultiply(s),this.getBoundingBoxAt(l,wn.geometry.boundingBox),this.getBoundingSphereAt(l,wn.geometry.boundingSphere),wn.raycast(t,qh);for(let u=0,d=qh.length;u<d;u++){const f=qh[u];f.object=this,f.batchId=a,e.push(f)}qh.length=0}wn.material=null,wn.geometry.index=null,wn.geometry.attributes={},wn.geometry.setDrawRange(0,1/0)}copy(t){return super.copy(t),this.geometry=t.geometry.clone(),this.perObjectFrustumCulled=t.perObjectFrustumCulled,this.sortObjects=t.sortObjects,this.boundingBox=t.boundingBox!==null?t.boundingBox.clone():null,this.boundingSphere=t.boundingSphere!==null?t.boundingSphere.clone():null,this._geometryInfo=t._geometryInfo.map(e=>({...e,boundingBox:e.boundingBox!==null?e.boundingBox.clone():null,boundingSphere:e.boundingSphere!==null?e.boundingSphere.clone():null})),this._instanceInfo=t._instanceInfo.map(e=>({...e})),this._maxInstanceCount=t._maxInstanceCount,this._maxVertexCount=t._maxVertexCount,this._maxIndexCount=t._maxIndexCount,this._geometryInitialized=t._geometryInitialized,this._geometryCount=t._geometryCount,this._multiDrawCounts=t._multiDrawCounts.slice(),this._multiDrawStarts=t._multiDrawStarts.slice(),this._matricesTexture=t._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=t._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(t,e,n,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=i.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,c=this._instanceInfo,l=this._multiDrawStarts,h=this._multiDrawCounts,u=this._geometryInfo,d=this.perObjectFrustumCulled,f=this._indirectTexture,m=f.image.data;d&&(Xn.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),np.setFromProjectionMatrix(Xn,t.coordinateSystem));let _=0;if(this.sortObjects){Xn.copy(this.matrixWorld).invert(),el.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Xn),Wb.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Xn);for(let b=0,y=c.length;b<y;b++)if(c[b].visible&&c[b].active){const v=c[b].geometryIndex;this.getMatrixAt(b,Xn),this.getBoundingSphereAt(v,fo).applyMatrix4(Xn);let x=!1;if(d&&(x=!np.intersectsSphere(fo)),!x){const S=u[v],T=nD.subVectors(fo.center,el).dot(Wb);ip.push(S.start,S.count,T,b)}}const g=ip.list,p=this.customSort;p===null?g.sort(s.transparent?JR:$R):p.call(this,g,n);for(let b=0,y=g.length;b<y;b++){const v=g[b];l[_]=v.start*a,h[_]=v.count,m[_]=v.index,_++}ip.reset()}else for(let g=0,p=c.length;g<p;g++)if(c[g].visible&&c[g].active){const b=c[g].geometryIndex;let y=!1;if(d&&(this.getMatrixAt(g,Xn),this.getBoundingSphereAt(b,fo).applyMatrix4(Xn),y=!np.intersectsSphere(fo)),!y){const v=u[b];l[_]=v.start*a,h[_]=v.count,m[_]=g,_++}}f.needsUpdate=!0,this._multiDrawCount=_,this._visibilityChanged=!1}onBeforeShadow(t,e,n,i,s,o){this.onBeforeRender(t,null,i,s,o)}}class Ui extends Hn{static get type(){return"LineBasicMaterial"}constructor(t){super(),this.isLineBasicMaterial=!0,this.color=new pt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const _d=new C,bd=new C,Xb=new lt,nl=new Ko,Kh=new An,sp=new C,Yb=new C;class Kt extends Bt{constructor(t=new Qt,e=new Ui){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,n=[0];for(let i=1,s=e.count;i<s;i++)_d.fromBufferAttribute(e,i-1),bd.fromBufferAttribute(e,i),n[i]=n[i-1],n[i]+=_d.distanceTo(bd);t.setAttribute("lineDistance",new Ot(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,s=t.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Kh.copy(n.boundingSphere),Kh.applyMatrix4(i),Kh.radius+=s,t.ray.intersectsSphere(Kh)===!1)return;Xb.copy(i).invert(),nl.copy(t.ray).applyMatrix4(Xb);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=this.isLineSegments?2:1,h=n.index,d=n.attributes.position;if(h!==null){const f=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let _=f,g=m-1;_<g;_+=l){const p=h.getX(_),b=h.getX(_+1),y=Zh(this,t,nl,c,p,b);y&&e.push(y)}if(this.isLineLoop){const _=h.getX(m-1),g=h.getX(f),p=Zh(this,t,nl,c,_,g);p&&e.push(p)}}else{const f=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count);for(let _=f,g=m-1;_<g;_+=l){const p=Zh(this,t,nl,c,_,_+1);p&&e.push(p)}if(this.isLineLoop){const _=Zh(this,t,nl,c,m-1,f);_&&e.push(_)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Zh(r,t,e,n,i,s){const o=r.geometry.attributes.position;if(_d.fromBufferAttribute(o,i),bd.fromBufferAttribute(o,s),e.distanceSqToSegment(_d,bd,sp,Yb)>n)return;sp.applyMatrix4(r.matrixWorld);const c=t.ray.origin.distanceTo(sp);if(!(c<t.near||c>t.far))return{distance:c,point:Yb.clone().applyMatrix4(r.matrixWorld),index:i,face:null,faceIndex:null,barycoord:null,object:r}}const qb=new C,Kb=new C;class zo extends Kt{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,n=[];for(let i=0,s=e.count;i<s;i+=2)qb.fromBufferAttribute(e,i),Kb.fromBufferAttribute(e,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+qb.distanceTo(Kb);t.setAttribute("lineDistance",new Ot(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class rD extends Kt{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class ja extends Hn{static get type(){return"PointsMaterial"}constructor(t){super(),this.isPointsMaterial=!0,this.color=new pt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Zb=new lt,Wm=new Ko,Qh=new An,$h=new C;class sd extends Bt{constructor(t=new Qt,e=new ja){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,s=t.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Qh.copy(n.boundingSphere),Qh.applyMatrix4(i),Qh.radius+=s,t.ray.intersectsSphere(Qh)===!1)return;Zb.copy(i).invert(),Wm.copy(t.ray).applyMatrix4(Zb);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=n.index,u=n.attributes.position;if(l!==null){const d=Math.max(0,o.start),f=Math.min(l.count,o.start+o.count);for(let m=d,_=f;m<_;m++){const g=l.getX(m);$h.fromBufferAttribute(u,g),Qb($h,g,c,i,t,e,this)}}else{const d=Math.max(0,o.start),f=Math.min(u.count,o.start+o.count);for(let m=d,_=f;m<_;m++)$h.fromBufferAttribute(u,m),Qb($h,m,c,i,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Qb(r,t,e,n,i,s,o){const a=Wm.distanceSqToPoint(r);if(a<e){const c=new C;Wm.closestPointToPoint(r,c),c.applyMatrix4(n);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:t,face:null,faceIndex:null,barycoord:null,object:o})}}class rp extends Ie{constructor(t,e,n,i,s,o,a,c,l,h,u,d){super(null,o,a,c,l,h,i,s,u,d),this.isCompressedTexture=!0,this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class Jh extends Ie{constructor(t,e,n,i,s,o,a,c,l){super(t,e,n,i,s,o,a,c,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class os{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),s=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),s+=n.distanceTo(i),e.push(s),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const s=n.length;let o;e?o=e:o=t*n[s-1];let a=0,c=s-1,l;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),l=n[i]-o,l<0)a=i+1;else if(l>0)c=i-1;else{c=i;break}if(i=c,n[i]===o)return i/(s-1);const h=n[i],d=n[i+1]-h,f=(o-h)/d;return(i+f)/(s-1)}getTangent(t,e){let i=t-1e-4,s=t+1e-4;i<0&&(i=0),s>1&&(s=1);const o=this.getPoint(i),a=this.getPoint(s),c=e||(o.isVector2?new J:new C);return c.copy(a).sub(o).normalize(),c}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new C,i=[],s=[],o=[],a=new C,c=new lt;for(let f=0;f<=t;f++){const m=f/t;i[f]=this.getTangentAt(m,new C)}s[0]=new C,o[0]=new C;let l=Number.MAX_VALUE;const h=Math.abs(i[0].x),u=Math.abs(i[0].y),d=Math.abs(i[0].z);h<=l&&(l=h,n.set(1,0,0)),u<=l&&(l=u,n.set(0,1,0)),d<=l&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],a),o[0].crossVectors(i[0],s[0]);for(let f=1;f<=t;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(i[f-1],i[f]),a.length()>Number.EPSILON){a.normalize();const m=Math.acos(Ke(i[f-1].dot(i[f]),-1,1));s[f].applyMatrix4(c.makeRotationAxis(a,m))}o[f].crossVectors(i[f],s[f])}if(e===!0){let f=Math.acos(Ke(s[0].dot(s[t]),-1,1));f/=t,i[0].dot(a.crossVectors(s[0],s[t]))>0&&(f=-f);for(let m=1;m<=t;m++)s[m].applyMatrix4(c.makeRotationAxis(i[m],f*m)),o[m].crossVectors(i[m],s[m])}return{tangents:i,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class e0 extends os{constructor(t=0,e=0,n=1,i=1,s=0,o=Math.PI*2,a=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=c}getPoint(t,e=new J){const n=e,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(o?s=0:s=i),this.aClockwise===!0&&!o&&(s===i?s=-i:s=s-i);const a=this.aStartAngle+t*s;let c=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),u=Math.sin(this.aRotation),d=c-this.aX,f=l-this.aY;c=d*h-f*u+this.aX,l=d*u+f*h+this.aY}return n.set(c,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class oD extends e0{constructor(t,e,n,i,s,o){super(t,e,n,n,i,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function n0(){let r=0,t=0,e=0,n=0;function i(s,o,a,c){r=s,t=a,e=-3*s+3*o-2*a-c,n=2*s-2*o+a+c}return{initCatmullRom:function(s,o,a,c,l){i(o,a,l*(a-s),l*(c-o))},initNonuniformCatmullRom:function(s,o,a,c,l,h,u){let d=(o-s)/l-(a-s)/(l+h)+(a-o)/h,f=(a-o)/h-(c-o)/(h+u)+(c-a)/u;d*=h,f*=h,i(o,a,d,f)},calc:function(s){const o=s*s,a=o*s;return r+t*s+e*o+n*a}}}const tu=new C,op=new n0,ap=new n0,cp=new n0;class aD extends os{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new C){const n=e,i=this.points,s=i.length,o=(s-(this.closed?0:1))*t;let a=Math.floor(o),c=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:c===0&&a===s-1&&(a=s-2,c=1);let l,h;this.closed||a>0?l=i[(a-1)%s]:(tu.subVectors(i[0],i[1]).add(i[0]),l=tu);const u=i[a%s],d=i[(a+1)%s];if(this.closed||a+2<s?h=i[(a+2)%s]:(tu.subVectors(i[s-1],i[s-2]).add(i[s-1]),h=tu),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let m=Math.pow(l.distanceToSquared(u),f),_=Math.pow(u.distanceToSquared(d),f),g=Math.pow(d.distanceToSquared(h),f);_<1e-4&&(_=1),m<1e-4&&(m=_),g<1e-4&&(g=_),op.initNonuniformCatmullRom(l.x,u.x,d.x,h.x,m,_,g),ap.initNonuniformCatmullRom(l.y,u.y,d.y,h.y,m,_,g),cp.initNonuniformCatmullRom(l.z,u.z,d.z,h.z,m,_,g)}else this.curveType==="catmullrom"&&(op.initCatmullRom(l.x,u.x,d.x,h.x,this.tension),ap.initCatmullRom(l.y,u.y,d.y,h.y,this.tension),cp.initCatmullRom(l.z,u.z,d.z,h.z,this.tension));return n.set(op.calc(c),ap.calc(c),cp.calc(c)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(new C().fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function $b(r,t,e,n,i){const s=(n-t)*.5,o=(i-e)*.5,a=r*r,c=r*a;return(2*e-2*n+s+o)*c+(-3*e+3*n-2*s-o)*a+s*r+e}function cD(r,t){const e=1-r;return e*e*t}function lD(r,t){return 2*(1-r)*r*t}function hD(r,t){return r*r*t}function Al(r,t,e,n){return cD(r,t)+lD(r,e)+hD(r,n)}function uD(r,t){const e=1-r;return e*e*e*t}function dD(r,t){const e=1-r;return 3*e*e*r*t}function fD(r,t){return 3*(1-r)*r*r*t}function pD(r,t){return r*r*r*t}function Cl(r,t,e,n,i){return uD(r,t)+dD(r,e)+fD(r,n)+pD(r,i)}class pw extends os{constructor(t=new J,e=new J,n=new J,i=new J){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new J){const n=e,i=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(Cl(t,i.x,s.x,o.x,a.x),Cl(t,i.y,s.y,o.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class i0 extends os{constructor(t=new C,e=new C,n=new C,i=new C){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new C){const n=e,i=this.v0,s=this.v1,o=this.v2,a=this.v3;return n.set(Cl(t,i.x,s.x,o.x,a.x),Cl(t,i.y,s.y,o.y,a.y),Cl(t,i.z,s.z,o.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class mw extends os{constructor(t=new J,e=new J){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new J){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new J){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class s0 extends os{constructor(t=new C,e=new C){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new C){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new C){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class gw extends os{constructor(t=new J,e=new J,n=new J){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new J){const n=e,i=this.v0,s=this.v1,o=this.v2;return n.set(Al(t,i.x,s.x,o.x),Al(t,i.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class _w extends os{constructor(t=new C,e=new C,n=new C){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new C){const n=e,i=this.v0,s=this.v1,o=this.v2;return n.set(Al(t,i.x,s.x,o.x),Al(t,i.y,s.y,o.y),Al(t,i.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class bw extends os{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new J){const n=e,i=this.points,s=(i.length-1)*t,o=Math.floor(s),a=s-o,c=i[o===0?o:o-1],l=i[o],h=i[o>i.length-2?i.length-1:o+1],u=i[o>i.length-3?i.length-1:o+2];return n.set($b(a,c.x,l.x,h.x,u.x),$b(a,c.y,l.y,h.y,u.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(new J().fromArray(i))}return this}}var Xm=Object.freeze({__proto__:null,ArcCurve:oD,CatmullRomCurve3:aD,CubicBezierCurve:pw,CubicBezierCurve3:i0,EllipseCurve:e0,LineCurve:mw,LineCurve3:s0,QuadraticBezierCurve:gw,QuadraticBezierCurve3:_w,SplineCurve:bw});class yw extends os{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Xm[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=n){const o=i[s]-n,a=this.curves[s],c=a.getLength(),l=c===0?0:1-o/c;return a.getPointAt(l,e)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,s=this.curves;i<s.length;i++){const o=s[i],a=o.isEllipseCurve?t*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?t*o.points.length:t,c=o.getPoints(a);for(let l=0;l<c.length;l++){const h=c[l];n&&n.equals(h)||(e.push(h),n=h)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const i=t.curves[e];this.curves.push(new Xm[i.type]().fromJSON(i))}return this}}class Iz extends yw{constructor(t){super(),this.type="Path",this.currentPoint=new J,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new mw(this.currentPoint.clone(),new J(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const s=new gw(this.currentPoint.clone(),new J(t,e),new J(n,i));return this.curves.push(s),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,s,o){const a=new pw(this.currentPoint.clone(),new J(t,e),new J(n,i),new J(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new bw(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,s,o){const a=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(t+a,e+c,n,i,s,o),this}absarc(t,e,n,i,s,o){return this.absellipse(t,e,n,n,i,s,o),this}ellipse(t,e,n,i,s,o,a,c){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+l,e+h,n,i,s,o,a,c),this}absellipse(t,e,n,i,s,o,a,c){const l=new e0(t,e,n,i,s,o,a,c);if(this.curves.length>0){const u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);const h=l.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Ln extends Qt{constructor(t=1,e=1,n=1,i=32,s=1,o=!1,a=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:c};const l=this;i=Math.floor(i),s=Math.floor(s);const h=[],u=[],d=[],f=[];let m=0;const _=[],g=n/2;let p=0;b(),o===!1&&(t>0&&y(!0),e>0&&y(!1)),this.setIndex(h),this.setAttribute("position",new Ot(u,3)),this.setAttribute("normal",new Ot(d,3)),this.setAttribute("uv",new Ot(f,2));function b(){const v=new C,x=new C;let S=0;const T=(e-t)/n;for(let E=0;E<=s;E++){const w=[],M=E/s,P=M*(e-t)+t;for(let L=0;L<=i;L++){const I=L/i,F=I*c+a,z=Math.sin(F),N=Math.cos(F);x.x=P*z,x.y=-M*n+g,x.z=P*N,u.push(x.x,x.y,x.z),v.set(z,T,N).normalize(),d.push(v.x,v.y,v.z),f.push(I,1-M),w.push(m++)}_.push(w)}for(let E=0;E<i;E++)for(let w=0;w<s;w++){const M=_[w][E],P=_[w+1][E],L=_[w+1][E+1],I=_[w][E+1];(t>0||w!==0)&&(h.push(M,P,I),S+=3),(e>0||w!==s-1)&&(h.push(P,L,I),S+=3)}l.addGroup(p,S,0),p+=S}function y(v){const x=m,S=new J,T=new C;let E=0;const w=v===!0?t:e,M=v===!0?1:-1;for(let L=1;L<=i;L++)u.push(0,g*M,0),d.push(0,M,0),f.push(.5,.5),m++;const P=m;for(let L=0;L<=i;L++){const F=L/i*c+a,z=Math.cos(F),N=Math.sin(F);T.x=w*N,T.y=g*M,T.z=w*z,u.push(T.x,T.y,T.z),d.push(0,M,0),S.x=z*.5+.5,S.y=N*.5*M+.5,f.push(S.x,S.y),m++}for(let L=0;L<i;L++){const I=x+L,F=P+L;v===!0?h.push(F,F+1,I):h.push(F+1,F,I),E+=3}l.addGroup(p,E,v===!0?1:2),p+=E}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ln(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class r0 extends Ln{constructor(t=1,e=1,n=32,i=1,s=!1,o=0,a=Math.PI*2){super(0,t,e,n,i,s,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(t){return new r0(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class o0 extends Qt{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const s=[],o=[];a(i),l(n),h(),this.setAttribute("position",new Ot(s,3)),this.setAttribute("normal",new Ot(s.slice(),3)),this.setAttribute("uv",new Ot(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const y=new C,v=new C,x=new C;for(let S=0;S<e.length;S+=3)f(e[S+0],y),f(e[S+1],v),f(e[S+2],x),c(y,v,x,b)}function c(b,y,v,x){const S=x+1,T=[];for(let E=0;E<=S;E++){T[E]=[];const w=b.clone().lerp(v,E/S),M=y.clone().lerp(v,E/S),P=S-E;for(let L=0;L<=P;L++)L===0&&E===S?T[E][L]=w:T[E][L]=w.clone().lerp(M,L/P)}for(let E=0;E<S;E++)for(let w=0;w<2*(S-E)-1;w++){const M=Math.floor(w/2);w%2===0?(d(T[E][M+1]),d(T[E+1][M]),d(T[E][M])):(d(T[E][M+1]),d(T[E+1][M+1]),d(T[E+1][M]))}}function l(b){const y=new C;for(let v=0;v<s.length;v+=3)y.x=s[v+0],y.y=s[v+1],y.z=s[v+2],y.normalize().multiplyScalar(b),s[v+0]=y.x,s[v+1]=y.y,s[v+2]=y.z}function h(){const b=new C;for(let y=0;y<s.length;y+=3){b.x=s[y+0],b.y=s[y+1],b.z=s[y+2];const v=g(b)/2/Math.PI+.5,x=p(b)/Math.PI+.5;o.push(v,1-x)}m(),u()}function u(){for(let b=0;b<o.length;b+=6){const y=o[b+0],v=o[b+2],x=o[b+4],S=Math.max(y,v,x),T=Math.min(y,v,x);S>.9&&T<.1&&(y<.2&&(o[b+0]+=1),v<.2&&(o[b+2]+=1),x<.2&&(o[b+4]+=1))}}function d(b){s.push(b.x,b.y,b.z)}function f(b,y){const v=b*3;y.x=t[v+0],y.y=t[v+1],y.z=t[v+2]}function m(){const b=new C,y=new C,v=new C,x=new C,S=new J,T=new J,E=new J;for(let w=0,M=0;w<s.length;w+=9,M+=6){b.set(s[w+0],s[w+1],s[w+2]),y.set(s[w+3],s[w+4],s[w+5]),v.set(s[w+6],s[w+7],s[w+8]),S.set(o[M+0],o[M+1]),T.set(o[M+2],o[M+3]),E.set(o[M+4],o[M+5]),x.copy(b).add(y).add(v).divideScalar(3);const P=g(x);_(S,M+0,b,P),_(T,M+2,y,P),_(E,M+4,v,P)}}function _(b,y,v,x){x<0&&b.x===1&&(o[y]=b.x-1),v.x===0&&v.z===0&&(o[y]=x/2/Math.PI+.5)}function g(b){return Math.atan2(b.z,-b.x)}function p(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new o0(t.vertices,t.indices,t.radius,t.details)}}class ls extends o0{constructor(t=1,e=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new ls(t.radius,t.detail)}}class dr extends Qt{constructor(t=1,e=32,n=16,i=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:s,thetaStart:o,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const c=Math.min(o+a,Math.PI);let l=0;const h=[],u=new C,d=new C,f=[],m=[],_=[],g=[];for(let p=0;p<=n;p++){const b=[],y=p/n;let v=0;p===0&&o===0?v=.5/e:p===n&&c===Math.PI&&(v=-.5/e);for(let x=0;x<=e;x++){const S=x/e;u.x=-t*Math.cos(i+S*s)*Math.sin(o+y*a),u.y=t*Math.cos(o+y*a),u.z=t*Math.sin(i+S*s)*Math.sin(o+y*a),m.push(u.x,u.y,u.z),d.copy(u).normalize(),_.push(d.x,d.y,d.z),g.push(S+v,1-y),b.push(l++)}h.push(b)}for(let p=0;p<n;p++)for(let b=0;b<e;b++){const y=h[p][b+1],v=h[p][b],x=h[p+1][b],S=h[p+1][b+1];(p!==0||o>0)&&f.push(y,v,S),(p!==n-1||c<Math.PI)&&f.push(v,x,S)}this.setIndex(f),this.setAttribute("position",new Ot(m,3)),this.setAttribute("normal",new Ot(_,3)),this.setAttribute("uv",new Ot(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new dr(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Wa extends Qt{constructor(t=1,e=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],c=[],l=[],h=new C,u=new C,d=new C;for(let f=0;f<=n;f++)for(let m=0;m<=i;m++){const _=m/i*s,g=f/n*Math.PI*2;u.x=(t+e*Math.cos(g))*Math.cos(_),u.y=(t+e*Math.cos(g))*Math.sin(_),u.z=e*Math.sin(g),a.push(u.x,u.y,u.z),h.x=t*Math.cos(_),h.y=t*Math.sin(_),d.subVectors(u,h).normalize(),c.push(d.x,d.y,d.z),l.push(m/i),l.push(f/n)}for(let f=1;f<=n;f++)for(let m=1;m<=i;m++){const _=(i+1)*f+m-1,g=(i+1)*(f-1)+m-1,p=(i+1)*(f-1)+m,b=(i+1)*f+m;o.push(_,g,b),o.push(g,p,b)}this.setIndex(o),this.setAttribute("position",new Ot(a,3)),this.setAttribute("normal",new Ot(c,3)),this.setAttribute("uv",new Ot(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Wa(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class a0 extends Qt{constructor(t=new _w(new C(-1,-1,0),new C(-1,1,0),new C(1,1,0)),e=64,n=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:s};const o=t.computeFrenetFrames(e,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new C,c=new C,l=new J;let h=new C;const u=[],d=[],f=[],m=[];_(),this.setIndex(m),this.setAttribute("position",new Ot(u,3)),this.setAttribute("normal",new Ot(d,3)),this.setAttribute("uv",new Ot(f,2));function _(){for(let y=0;y<e;y++)g(y);g(s===!1?e:0),b(),p()}function g(y){h=t.getPointAt(y/e,h);const v=o.normals[y],x=o.binormals[y];for(let S=0;S<=i;S++){const T=S/i*Math.PI*2,E=Math.sin(T),w=-Math.cos(T);c.x=w*v.x+E*x.x,c.y=w*v.y+E*x.y,c.z=w*v.z+E*x.z,c.normalize(),d.push(c.x,c.y,c.z),a.x=h.x+n*c.x,a.y=h.y+n*c.y,a.z=h.z+n*c.z,u.push(a.x,a.y,a.z)}}function p(){for(let y=1;y<=e;y++)for(let v=1;v<=i;v++){const x=(i+1)*(y-1)+(v-1),S=(i+1)*y+(v-1),T=(i+1)*y+v,E=(i+1)*(y-1)+v;m.push(x,S,E),m.push(S,T,E)}}function b(){for(let y=0;y<=e;y++)for(let v=0;v<=i;v++)l.x=y/e,l.y=v/i,f.push(l.x,l.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new a0(new Xm[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class lh extends Hn{static get type(){return"MeshStandardMaterial"}constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new pt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wd,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Me,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class As extends lh{static get type(){return"MeshPhysicalMaterial"}constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new J(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ke(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new pt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new pt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new pt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Gr extends Hn{static get type(){return"MeshPhongMaterial"}constructor(t){super(),this.isMeshPhongMaterial=!0,this.color=new pt(16777215),this.specular=new pt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wd,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Me,this.combine=Hd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class mD extends Hn{static get type(){return"MeshLambertMaterial"}constructor(t){super(),this.isMeshLambertMaterial=!0,this.color=new pt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Wd,this.normalScale=new J(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Me,this.combine=Hd,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}function eu(r,t,e){return!r||!e&&r.constructor===t?r:typeof t.BYTES_PER_ELEMENT=="number"?new t(r):Array.prototype.slice.call(r)}function gD(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function _D(r){function t(i,s){return r[i]-r[s]}const e=r.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort(t),n}function Jb(r,t,e){const n=r.length,i=new r.constructor(n);for(let s=0,o=0;o!==n;++s){const a=e[s]*t;for(let c=0;c!==t;++c)i[o++]=r[a+c]}return i}function vw(r,t,e,n){let i=1,s=r[0];for(;s!==void 0&&s[n]===void 0;)s=r[i++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(t.push(s.time),e.push.apply(e,o)),s=r[i++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(t.push(s.time),o.toArray(e,e.length)),s=r[i++];while(s!==void 0);else do o=s[n],o!==void 0&&(t.push(s.time),e.push(o)),s=r[i++];while(s!==void 0)}class hh{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],s=e[n-1];t:{e:{let o;n:{i:if(!(t<i)){for(let a=n+2;;){if(i===void 0){if(t<s)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=i,i=e[++n],t<i)break e}o=e.length;break n}if(!(t>=s)){const a=e[1];t<a&&(n=2,s=a);for(let c=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(i=s,s=e[--n-1],t>=s)break e}o=n,n=0;break n}break t}for(;n<o;){const a=n+o>>>1;t<e[a]?o=a:n=a+1}if(i=e[n],s=e[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=t*i;for(let o=0;o!==i;++o)e[o]=n[s+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class bD extends hh{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Va,endingEnd:Va}}intervalChanged_(t,e,n){const i=this.parameterPositions;let s=t-2,o=t+1,a=i[s],c=i[o];if(a===void 0)switch(this.getSettings_().endingStart){case Ha:s=t,a=2*e-n;break;case pd:s=i.length-2,a=e+i[s]-i[s+1];break;default:s=t,a=n}if(c===void 0)switch(this.getSettings_().endingEnd){case Ha:o=t,c=2*n-e;break;case pd:o=1,c=n+i[1]-i[0];break;default:o=t-1,c=e}const l=(n-e)*.5,h=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(c-n),this._offsetPrev=s*h,this._offsetNext=o*h}interpolate_(t,e,n,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=t*a,l=c-a,h=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,f=this._weightNext,m=(n-e)/(i-e),_=m*m,g=_*m,p=-d*g+2*d*_-d*m,b=(1+d)*g+(-1.5-2*d)*_+(-.5+d)*m+1,y=(-1-f)*g+(1.5+f)*_+.5*m,v=f*g-f*_;for(let x=0;x!==a;++x)s[x]=p*o[h+x]+b*o[l+x]+y*o[c+x]+v*o[u+x];return s}}class xw extends hh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=t*a,l=c-a,h=(n-e)/(i-e),u=1-h;for(let d=0;d!==a;++d)s[d]=o[l+d]*u+o[c+d]*h;return s}}class yD extends hh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Cs{constructor(t,e,n,i){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=eu(e,this.TimeBufferType),this.values=eu(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:eu(t.times,Array),values:eu(t.values,Array)};const i=t.getInterpolation();i!==t.DefaultInterpolation&&(n.interpolation=i)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new yD(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new xw(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new bD(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case _c:e=this.InterpolantFactoryMethodDiscrete;break;case bc:e=this.InterpolantFactoryMethodLinear;break;case Mf:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return _c;case this.InterpolantFactoryMethodLinear:return bc;case this.InterpolantFactoryMethodSmooth:return Mf}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let s=0,o=i-1;for(;s!==i&&n[s]<t;)++s;for(;o!==-1&&n[o]>e;)--o;if(++o,s!==0||o!==i){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let a=0;a!==s;a++){const c=n[a];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),t=!1;break}if(o!==null&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),t=!1;break}o=c}if(i!==void 0&&gD(i))for(let a=0,c=i.length;a!==c;++a){const l=i[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Mf,s=t.length-1;let o=1;for(let a=1;a<s;++a){let c=!1;const l=t[a],h=t[a+1];if(l!==h&&(a!==1||l!==t[0]))if(i)c=!0;else{const u=a*n,d=u-n,f=u+n;for(let m=0;m!==n;++m){const _=e[u+m];if(_!==e[d+m]||_!==e[f+m]){c=!0;break}}}if(c){if(a!==o){t[o]=t[a];const u=a*n,d=o*n;for(let f=0;f!==n;++f)e[d+f]=e[u+f]}++o}}if(s>0){t[o]=t[s];for(let a=s*n,c=o*n,l=0;l!==n;++l)e[c+l]=e[a+l];++o}return o!==t.length?(this.times=t.slice(0,o),this.values=e.slice(0,o*n)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),n=this.constructor,i=new n(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Cs.prototype.TimeBufferType=Float32Array;Cs.prototype.ValueBufferType=Float32Array;Cs.prototype.DefaultInterpolation=bc;class Ic extends Cs{constructor(t,e,n){super(t,e,n)}}Ic.prototype.ValueTypeName="bool";Ic.prototype.ValueBufferType=Array;Ic.prototype.DefaultInterpolation=_c;Ic.prototype.InterpolantFactoryMethodLinear=void 0;Ic.prototype.InterpolantFactoryMethodSmooth=void 0;class ww extends Cs{}ww.prototype.ValueTypeName="color";class Vo extends Cs{}Vo.prototype.ValueTypeName="number";class vD extends hh{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(n-e)/(i-e);let l=t*a;for(let h=l+a;l!==h;l+=4)jt.slerpFlat(s,0,o,l-a,o,l,c);return s}}class Ho extends Cs{InterpolantFactoryMethodLinear(t){return new vD(this.times,this.values,this.getValueSize(),t)}}Ho.prototype.ValueTypeName="quaternion";Ho.prototype.InterpolantFactoryMethodSmooth=void 0;class Oc extends Cs{constructor(t,e,n){super(t,e,n)}}Oc.prototype.ValueTypeName="string";Oc.prototype.ValueBufferType=Array;Oc.prototype.DefaultInterpolation=_c;Oc.prototype.InterpolantFactoryMethodLinear=void 0;Oc.prototype.InterpolantFactoryMethodSmooth=void 0;class Go extends Cs{}Go.prototype.ValueTypeName="vector";class jl{constructor(t="",e=-1,n=[],i=qg){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=es(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let o=0,a=n.length;o!==a;++o)e.push(wD(n[o]).scale(i));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let s=0,o=n.length;s!==o;++s)e.push(Cs.toJSON(n[s]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const s=e.length,o=[];for(let a=0;a<s;a++){let c=[],l=[];c.push((a+s-1)%s,a,(a+1)%s),l.push(0,1,0);const h=_D(c);c=Jb(c,1,h),l=Jb(l,1,h),!i&&c[0]===0&&(c.push(s),l.push(l[0])),o.push(new Vo(".morphTargetInfluences["+e[a].name+"]",c,l).scale(1/n))}return new this(t,-1,o)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const i=t;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,c=t.length;a<c;a++){const l=t[a],h=l.name.match(s);if(h&&h.length>1){const u=h[1];let d=i[u];d||(i[u]=d=[]),d.push(l)}}const o=[];for(const a in i)o.push(this.CreateFromMorphTargetSequence(a,i[a],e,n));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(u,d,f,m,_){if(f.length!==0){const g=[],p=[];vw(f,g,p,m),g.length!==0&&_.push(new u(d,g,p))}},i=[],s=t.name||"default",o=t.fps||30,a=t.blendMode;let c=t.length||-1;const l=t.hierarchy||[];for(let u=0;u<l.length;u++){const d=l[u].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let m;for(m=0;m<d.length;m++)if(d[m].morphTargets)for(let _=0;_<d[m].morphTargets.length;_++)f[d[m].morphTargets[_]]=-1;for(const _ in f){const g=[],p=[];for(let b=0;b!==d[m].morphTargets.length;++b){const y=d[m];g.push(y.time),p.push(y.morphTarget===_?1:0)}i.push(new Vo(".morphTargetInfluence["+_+"]",g,p))}c=f.length*o}else{const f=".bones["+e[u].name+"]";n(Go,f+".position",d,"pos",i),n(Ho,f+".quaternion",d,"rot",i),n(Go,f+".scale",d,"scl",i)}}return i.length===0?null:new this(s,c,i,a)}resetDuration(){const t=this.tracks;let e=0;for(let n=0,i=t.length;n!==i;++n){const s=this.tracks[n];e=Math.max(e,s.times[s.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function xD(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Vo;case"vector":case"vector2":case"vector3":case"vector4":return Go;case"color":return ww;case"quaternion":return Ho;case"bool":case"boolean":return Ic;case"string":return Oc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function wD(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=xD(r.type);if(r.times===void 0){const e=[],n=[];vw(r.keys,e,n,"value"),r.times=e,r.values=n}return t.parse!==void 0?t.parse(r):new t(r.name,r.times,r.values,r.interpolation)}const Fr={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(this.files[r]=t)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class SD{constructor(t,e,n){const i=this;let s=!1,o=0,a=0,c;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(h){a++,s===!1&&i.onStart!==void 0&&i.onStart(h,o,a),s=!0},this.itemEnd=function(h){o++,i.onProgress!==void 0&&i.onProgress(h,o,a),o===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return c?c(h):h},this.setURLModifier=function(h){return c=h,this},this.addHandler=function(h,u){return l.push(h,u),this},this.removeHandler=function(h){const u=l.indexOf(h);return u!==-1&&l.splice(u,2),this},this.getHandler=function(h){for(let u=0,d=l.length;u<d;u+=2){const f=l[u],m=l[u+1];if(f.global&&(f.lastIndex=0),f.test(h))return m}return null}}}const Sw=new SD;class Ps{constructor(t){this.manager=t!==void 0?t:Sw,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(i,s){n.load(t,i,e,s)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ps.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ns={};class MD extends Error{constructor(t,e){super(t),this.response=e}}class Fc extends Ps{constructor(t){super(t)}load(t,e,n,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Fr.get(t);if(s!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(s),this.manager.itemEnd(t)},0),s;if(Ns[t]!==void 0){Ns[t].push({onLoad:e,onProgress:n,onError:i});return}Ns[t]=[],Ns[t].push({onLoad:e,onProgress:n,onError:i});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const h=Ns[t],u=l.body.getReader(),d=l.headers.get("X-File-Size")||l.headers.get("Content-Length"),f=d?parseInt(d):0,m=f!==0;let _=0;const g=new ReadableStream({start(p){b();function b(){u.read().then(({done:y,value:v})=>{if(y)p.close();else{_+=v.byteLength;const x=new ProgressEvent("progress",{lengthComputable:m,loaded:_,total:f});for(let S=0,T=h.length;S<T;S++){const E=h[S];E.onProgress&&E.onProgress(x)}p.enqueue(v),b()}},y=>{p.error(y)})}}});return new Response(g)}else throw new MD(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(c){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return l.json();default:if(a===void 0)return l.text();{const u=/charset="?([^;"\s]*)"?/i.exec(a),d=u&&u[1]?u[1].toLowerCase():void 0,f=new TextDecoder(d);return l.arrayBuffer().then(m=>f.decode(m))}}}).then(l=>{Fr.add(t,l);const h=Ns[t];delete Ns[t];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onLoad&&f.onLoad(l)}}).catch(l=>{const h=Ns[t];if(h===void 0)throw this.manager.itemError(t),l;delete Ns[t];for(let u=0,d=h.length;u<d;u++){const f=h[u];f.onError&&f.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class TD extends Ps{constructor(t){super(t)}load(t,e,n,i){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,o=Fr.get(t);if(o!==void 0)return s.manager.itemStart(t),setTimeout(function(){e&&e(o),s.manager.itemEnd(t)},0),o;const a=Hl("img");function c(){h(),Fr.add(t,this),e&&e(this),s.manager.itemEnd(t)}function l(u){h(),i&&i(u),s.manager.itemError(t),s.manager.itemEnd(t)}function h(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(t),a.src=t,a}}class ED extends Ps{constructor(t){super(t)}load(t,e,n,i){const s=this,o=new nc,a=new Fc(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(t,function(c){let l;try{l=s.parse(c)}catch(h){if(i!==void 0)i(h);else{console.error(h);return}}l.image!==void 0?o.image=l.image:l.data!==void 0&&(o.image.width=l.width,o.image.height=l.height,o.image.data=l.data),o.wrapS=l.wrapS!==void 0?l.wrapS:di,o.wrapT=l.wrapT!==void 0?l.wrapT:di,o.magFilter=l.magFilter!==void 0?l.magFilter:dn,o.minFilter=l.minFilter!==void 0?l.minFilter:dn,o.anisotropy=l.anisotropy!==void 0?l.anisotropy:1,l.colorSpace!==void 0&&(o.colorSpace=l.colorSpace),l.flipY!==void 0&&(o.flipY=l.flipY),l.format!==void 0&&(o.format=l.format),l.type!==void 0&&(o.type=l.type),l.mipmaps!==void 0&&(o.mipmaps=l.mipmaps,o.minFilter=Ji),l.mipmapCount===1&&(o.minFilter=dn),l.generateMipmaps!==void 0&&(o.generateMipmaps=l.generateMipmaps),o.needsUpdate=!0,e&&e(o,l)},n,i),o}}class Zd extends Ps{constructor(t){super(t)}load(t,e,n,i){const s=new Ie,o=new TD(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(a){s.image=a,s.needsUpdate=!0,e!==void 0&&e(s)},n,i),s}}class uh extends Bt{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new pt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}class AD extends uh{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Bt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new pt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const lp=new lt,ty=new C,ey=new C;class c0{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new J(512,512),this.map=null,this.mapPass=null,this.matrix=new lt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Yd,this._frameExtents=new J(1,1),this._viewportCount=1,this._viewports=[new ie(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;ty.setFromMatrixPosition(t.matrixWorld),e.position.copy(ty),ey.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(ey),e.updateMatrixWorld(),lp.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(lp),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(lp)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class CD extends c0{constructor(){super(new rn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=yc*2*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;(n!==e.fov||i!==e.aspect||s!==e.far)&&(e.fov=n,e.aspect=i,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class l0 extends uh{constructor(t,e,n=0,i=Math.PI/3,s=0,o=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Bt.DEFAULT_UP),this.updateMatrix(),this.target=new Bt,this.distance=n,this.angle=i,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new CD}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const ny=new lt,il=new C,hp=new C;class PD extends c0{constructor(){super(new rn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new J(4,2),this._viewportCount=6,this._viewports=[new ie(2,1,1,1),new ie(0,1,1,1),new ie(3,1,1,1),new ie(1,1,1,1),new ie(3,0,1,1),new ie(1,0,1,1)],this._cubeDirections=[new C(1,0,0),new C(-1,0,0),new C(0,0,1),new C(0,0,-1),new C(0,1,0),new C(0,-1,0)],this._cubeUps=[new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,1,0),new C(0,0,1),new C(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,s=t.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),il.setFromMatrixPosition(t.matrixWorld),n.position.copy(il),hp.copy(n.position),hp.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(hp),n.updateMatrixWorld(),i.makeTranslation(-il.x,-il.y,-il.z),ny.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ny)}}class yd extends uh{constructor(t,e,n=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new PD}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class RD extends c0{constructor(){super(new ch(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class h0 extends uh{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Bt.DEFAULT_UP),this.updateMatrix(),this.target=new Bt,this.shadow=new RD}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Mw extends uh{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Io{static decodeText(t){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class DD extends Ps{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,o=Fr.get(t);if(o!==void 0){if(s.manager.itemStart(t),o.then){o.then(l=>{e&&e(l),s.manager.itemEnd(t)}).catch(l=>{i&&i(l)});return}return setTimeout(function(){e&&e(o),s.manager.itemEnd(t)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const c=fetch(t,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){return Fr.add(t,l),e&&e(l),s.manager.itemEnd(t),l}).catch(function(l){i&&i(l),Fr.remove(t),s.manager.itemError(t),s.manager.itemEnd(t)});Fr.add(t,c),s.manager.itemStart(t)}}class LD{constructor(t,e,n){this.binding=t,this.valueSize=n;let i,s,o;switch(e){case"quaternion":i=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,s=t*i+i;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==i;++a)n[s+a]=n[a];o=e}else{o+=e;const a=e/o;this._mixBufferRegion(n,s,0,a,i)}this.cumulativeWeight=o}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const c=e*this._origIndex;this._mixBufferRegion(n,i,c,1-s,e)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let c=e,l=e+e;c!==l;++c)if(n[c]!==n[c+e]){a.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let s=n,o=i;s!==o;++s)e[s]=e[i+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,s){if(i>=.5)for(let o=0;o!==s;++o)t[e+o]=t[n+o]}_slerp(t,e,n,i){jt.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,s){const o=this._workIndex*s;jt.multiplyQuaternionsFlat(t,o,t,e,t,n),jt.slerpFlat(t,e,t,e,t,o,i)}_lerp(t,e,n,i,s){const o=1-i;for(let a=0;a!==s;++a){const c=e+a;t[c]=t[c]*o+t[n+a]*i}}_lerpAdditive(t,e,n,i,s){for(let o=0;o!==s;++o){const a=e+o;t[a]=t[a]+t[n+o]*i}}}const u0="\\[\\]\\.:\\/",ID=new RegExp("["+u0+"]","g"),d0="[^"+u0+"]",OD="[^"+u0.replace("\\.","")+"]",FD=/((?:WC+[\/:])*)/.source.replace("WC",d0),kD=/(WCOD+)?/.source.replace("WCOD",OD),ND=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",d0),UD=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",d0),BD=new RegExp("^"+FD+kD+ND+UD+"$"),zD=["material","materials","bones","map"];class VD{constructor(t,e,n){const i=n||$t.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}class $t{constructor(t,e,n){this.path=e,this.parsedPath=n||$t.parseTrackName(e),this.node=$t.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new $t.Composite(t,e,n):new $t(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(ID,"")}static parseTrackName(t){const e=BD.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=n.nodeName.substring(i+1);zD.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(n!==void 0)return n}if(t.children){const n=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===e||a.uuid===e)return a;const c=n(a.children);if(c)return c}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let s=e.propertyIndex;if(t||(t=$t.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let l=e.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let h=0;h<t.length;h++)if(t[h].name===l){l=h;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(l!==void 0){if(t[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[l]}}const o=t[i];if(o===void 0){const l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+i+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[s]!==void 0&&(s=t.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(c=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}$t.Composite=VD;$t.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};$t.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};$t.prototype.GetterByBindingType=[$t.prototype._getValue_direct,$t.prototype._getValue_array,$t.prototype._getValue_arrayElement,$t.prototype._getValue_toArray];$t.prototype.SetterByBindingTypeAndVersioning=[[$t.prototype._setValue_direct,$t.prototype._setValue_direct_setNeedsUpdate,$t.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[$t.prototype._setValue_array,$t.prototype._setValue_array_setNeedsUpdate,$t.prototype._setValue_array_setMatrixWorldNeedsUpdate],[$t.prototype._setValue_arrayElement,$t.prototype._setValue_arrayElement_setNeedsUpdate,$t.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[$t.prototype._setValue_fromArray,$t.prototype._setValue_fromArray_setNeedsUpdate,$t.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class HD{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const s=e.tracks,o=s.length,a=new Array(o),c={endingStart:Va,endingEnd:Va};for(let l=0;l!==o;++l){const h=s[l].createInterpolant(null);a[l]=h,h.settings=c}this._interpolantSettings=c,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Yx,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const i=this._clip.duration,s=t._clip.duration,o=s/i,a=i/s;t.warp(1,o,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,s=i.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const c=a.parameterPositions,l=a.sampleValues;return c[0]=s,c[1]=s+n,l[0]=t/o,l[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled){this._updateWeight(t);return}const s=this._startTime;if(s!==null){const c=(t-s)*n;c<0||n===0?e=0:(this._startTime=null,e=n*c)}e*=this._updateTimeScale(t);const o=this._updateTime(e),a=this._updateWeight(t);if(a>0){const c=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case sE:for(let h=0,u=c.length;h!==u;++h)c[h].evaluate(o),l[h].accumulateAdditive(a);break;case qg:default:for(let h=0,u=c.length;h!==u;++h)c[h].evaluate(o),l[h].accumulate(i,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,s=this._loopCount;const o=n===qx;if(t===0)return s===-1?i:o&&(s&1)===1?e-i:i;if(n===Xx){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else if(i<0)i=0;else{this.time=i;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),i>=e||i<0){const a=Math.floor(i/e);i-=e*a,s+=Math.abs(a);const c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(c===1){const l=t<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(o&&(s&1)===1)return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=Ha,i.endingEnd=Ha):(t?i.endingStart=this.zeroSlopeAtStart?Ha:Va:i.endingStart=pd,e?i.endingEnd=this.zeroSlopeAtEnd?Ha:Va:i.endingEnd=pd)}_scheduleFading(t,e,n){const i=this._mixer,s=i.time;let o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=s,c[0]=e,a[1]=s+t,c[1]=n,this}}const GD=new Float32Array(1);class jD extends Jr{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,s=i.length,o=t._propertyBindings,a=t._interpolants,c=n.uuid,l=this._bindingsByRootAndName;let h=l[c];h===void 0&&(h={},l[c]=h);for(let u=0;u!==s;++u){const d=i[u],f=d.name;let m=h[f];if(m!==void 0)++m.referenceCount,o[u]=m;else{if(m=o[u],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,c,f));continue}const _=e&&e._propertyBindings[u].binding.parsedPath;m=new LD($t.create(n,f,_),d.ValueTypeName,d.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,c,f),o[u]=m}a[u].resultBuffer=m.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const n=(t._localRoot||this._root).uuid,i=t._clip.uuid,s=this._actionsByClip[i];this._bindAction(t,s&&s.knownActions[0]),this._addInactiveAction(t,i,n)}const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const s=e[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const s=e[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,s=this._actionsByClip;let o=s[e];if(o===void 0)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=o;else{const a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=i.length,i.push(t),o.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const s=t._clip.uuid,o=this._actionsByClip,a=o[s],c=a.knownActions,l=c[c.length-1],h=t._byClipCacheIndex;l._byClipCacheIndex=h,c[h]=l,c.pop(),t._byClipCacheIndex=null;const u=a.actionByRoot,d=(t._localRoot||this._root).uuid;delete u[d],c.length===0&&delete o[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const s=e[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,s=e[i];t._cacheIndex=i,e[i]=t,s._cacheIndex=n,e[n]=s}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,s=e[i];t._cacheIndex=i,e[i]=t,s._cacheIndex=n,e[n]=s}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,s=this._bindings;let o=i[e];o===void 0&&(o={},i[e]=o),o[n]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,a=o[i],c=e[e.length-1],l=t._cacheIndex;c._cacheIndex=l,e[l]=c,e.pop(),delete a[s],Object.keys(a).length===0&&delete o[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,s=e[i];t._cacheIndex=i,e[i]=t,s._cacheIndex=n,e[n]=s}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,s=e[i];t._cacheIndex=i,e[i]=t,s._cacheIndex=n,e[n]=s}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return n===void 0&&(n=new xw(new Float32Array(2),new Float32Array(2),1,GD),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,s=e[i];t.__cacheIndex=i,e[i]=t,s.__cacheIndex=n,e[n]=s}clipAction(t,e,n){const i=e||this._root,s=i.uuid;let o=typeof t=="string"?jl.findByName(i,t):t;const a=o!==null?o.uuid:t,c=this._actionsByClip[a];let l=null;if(n===void 0&&(o!==null?n=o.blendMode:n=qg),c!==void 0){const u=c.actionByRoot[s];if(u!==void 0&&u.blendMode===n)return u;l=c.knownActions[0],o===null&&(o=l._clip)}if(o===null)return null;const h=new HD(this,o,e,n);return this._bindAction(h,l),this._addInactiveAction(h,a,s),h}existingAction(t,e){const n=e||this._root,i=n.uuid,s=typeof t=="string"?jl.findByName(n,t):t,o=s?s.uuid:t,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[i]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let n=e-1;n>=0;--n)t[n].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,s=Math.sign(t),o=this._accuIndex^=1;for(let l=0;l!==n;++l)e[l]._update(i,t,s,o);const a=this._bindings,c=this._nActiveBindings;for(let l=0;l!==c;++l)a[l].apply(o);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,s=i[n];if(s!==void 0){const o=s.knownActions;for(let a=0,c=o.length;a!==c;++a){const l=o[a];this._deactivateAction(l);const h=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=h,e[h]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,c=a[e];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const i=this._bindingsByRootAndName,s=i[e];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(t,e){const n=this.existingAction(t,e);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class Or{constructor(t){this.value=t}clone(){return new Or(this.value.clone===void 0?this.value:this.value.clone())}}const iy=new lt;class to{constructor(t,e,n=0,i=1/0){this.ray=new Ko(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new Zg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return iy.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(iy),this}intersectObject(t,e=!0,n=[]){return Ym(t,this,n,e),n.sort(sy),n}intersectObjects(t,e=!0,n=[]){for(let i=0,s=t.length;i<s;i++)Ym(t[i],this,n,e);return n.sort(sy),n}}function sy(r,t){return r.distance-t.distance}function Ym(r,t,e,n){let i=!0;if(r.layers.test(t.layers)&&r.raycast(t,e)===!1&&(i=!1),i===!0&&n===!0){const s=r.children;for(let o=0,a=s.length;o<a;o++)Ym(s[o],t,e,!0)}}class ry{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(Ke(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const oy=new C,nu=new C;class er{constructor(t=new C,e=new C){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){oy.subVectors(t,this.start),nu.subVectors(this.end,this.start);const n=nu.dot(nu);let s=nu.dot(oy)/n;return e&&(s=Ke(s,0,1)),s}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const ay=new C;class WD extends Bt{constructor(t,e){super(),this.light=t,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new Qt,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,c=32;o<c;o++,a++){const l=o/c*Math.PI*2,h=a/c*Math.PI*2;i.push(Math.cos(l),Math.sin(l),1,Math.cos(h),Math.sin(h),1)}n.setAttribute("position",new Ot(i,3));const s=new Ui({fog:!1,toneMapped:!1});this.cone=new zo(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),ay.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ay),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}class XD extends ct{constructor(t,e,n){const i=new dr(e,4,2),s=new en({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const YD=new C,cy=new pt,ly=new pt;class qD extends Bt{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new ls(e);i.rotateY(Math.PI*.5),this.material=new en({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),o=new Float32Array(s.count*3);i.setAttribute("color",new Pe(o,3)),this.add(new ct(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");cy.copy(this.light.color),ly.copy(this.light.groundColor);for(let n=0,i=e.count;n<i;n++){const s=n<i/2?cy:ly;e.setXYZ(n,s.r,s.g,s.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(YD.setFromMatrixPosition(this.light.matrixWorld).negate())}}class qm extends zo{constructor(t=10,e=10,n=4473924,i=8947848){n=new pt(n),i=new pt(i);const s=e/2,o=t/e,a=t/2,c=[],l=[];for(let d=0,f=0,m=-a;d<=e;d++,m+=o){c.push(-a,0,m,a,0,m),c.push(m,0,-a,m,0,a);const _=d===s?n:i;_.toArray(l,f),f+=3,_.toArray(l,f),f+=3,_.toArray(l,f),f+=3,_.toArray(l,f),f+=3}const h=new Qt;h.setAttribute("position",new Ot(c,3)),h.setAttribute("color",new Ot(l,3));const u=new Ui({vertexColors:!0,toneMapped:!1});super(h,u),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const hy=new C,iu=new C,uy=new C;class KD extends Bt{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",e===void 0&&(e=1);let i=new Qt;i.setAttribute("position",new Ot([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const s=new Ui({fog:!1,toneMapped:!1});this.lightPlane=new Kt(i,s),this.add(this.lightPlane),i=new Qt,i.setAttribute("position",new Ot([0,0,0,0,0,1],3)),this.targetLine=new Kt(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),hy.setFromMatrixPosition(this.light.matrixWorld),iu.setFromMatrixPosition(this.light.target.matrixWorld),uy.subVectors(iu,hy),this.lightPlane.lookAt(iu),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(iu),this.targetLine.scale.z=uy.length()}}const su=new C,Ve=new $g;class ZD extends zo{constructor(t){const e=new Qt,n=new Ui({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(m,_){c(m),c(_)}function c(m){i.push(0,0,0),s.push(0,0,0),o[m]===void 0&&(o[m]=[]),o[m].push(i.length/3-1)}e.setAttribute("position",new Ot(i,3)),e.setAttribute("color",new Ot(s,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const l=new pt(16755200),h=new pt(16711680),u=new pt(43775),d=new pt(16777215),f=new pt(3355443);this.setColors(l,h,u,d,f)}setColors(t,e,n,i,s){const a=this.geometry.getAttribute("color");a.setXYZ(0,t.r,t.g,t.b),a.setXYZ(1,t.r,t.g,t.b),a.setXYZ(2,t.r,t.g,t.b),a.setXYZ(3,t.r,t.g,t.b),a.setXYZ(4,t.r,t.g,t.b),a.setXYZ(5,t.r,t.g,t.b),a.setXYZ(6,t.r,t.g,t.b),a.setXYZ(7,t.r,t.g,t.b),a.setXYZ(8,t.r,t.g,t.b),a.setXYZ(9,t.r,t.g,t.b),a.setXYZ(10,t.r,t.g,t.b),a.setXYZ(11,t.r,t.g,t.b),a.setXYZ(12,t.r,t.g,t.b),a.setXYZ(13,t.r,t.g,t.b),a.setXYZ(14,t.r,t.g,t.b),a.setXYZ(15,t.r,t.g,t.b),a.setXYZ(16,t.r,t.g,t.b),a.setXYZ(17,t.r,t.g,t.b),a.setXYZ(18,t.r,t.g,t.b),a.setXYZ(19,t.r,t.g,t.b),a.setXYZ(20,t.r,t.g,t.b),a.setXYZ(21,t.r,t.g,t.b),a.setXYZ(22,t.r,t.g,t.b),a.setXYZ(23,t.r,t.g,t.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap,n=1,i=1;Ve.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),We("c",e,t,Ve,0,0,-1),We("t",e,t,Ve,0,0,1),We("n1",e,t,Ve,-1,-1,-1),We("n2",e,t,Ve,n,-1,-1),We("n3",e,t,Ve,-1,i,-1),We("n4",e,t,Ve,n,i,-1),We("f1",e,t,Ve,-1,-1,1),We("f2",e,t,Ve,n,-1,1),We("f3",e,t,Ve,-1,i,1),We("f4",e,t,Ve,n,i,1),We("u1",e,t,Ve,n*.7,i*1.1,-1),We("u2",e,t,Ve,-1*.7,i*1.1,-1),We("u3",e,t,Ve,0,i*2,-1),We("cf1",e,t,Ve,-1,0,1),We("cf2",e,t,Ve,n,0,1),We("cf3",e,t,Ve,0,-1,1),We("cf4",e,t,Ve,0,i,1),We("cn1",e,t,Ve,-1,0,-1),We("cn2",e,t,Ve,n,0,-1),We("cn3",e,t,Ve,0,-1,-1),We("cn4",e,t,Ve,0,i,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function We(r,t,e,n,i,s,o){su.set(i,s,o).unproject(n);const a=t[r];if(a!==void 0){const c=e.getAttribute("position");for(let l=0,h=a.length;l<h;l++)c.setXYZ(a[l],su.x,su.y,su.z)}}class QD extends zo{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Qt;s.setIndex(new Pe(n,1)),s.setAttribute("position",new Ot(i,3)),super(s,new Ui({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class $D extends Jr{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:ah}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=ah);function JD(r){return{all:r=r||new Map,on:function(t,e){var n=r.get(t);n?n.push(e):r.set(t,[e])},off:function(t,e){var n=r.get(t);n&&(e?n.splice(n.indexOf(e)>>>0,1):r.set(t,[]))},emit:function(t,e){var n=r.get(t);n&&n.slice().map(function(i){i(e)}),(n=r.get("*"))&&n.slice().map(function(i){i(t,e)})}}}const dy={type:"change"},f0={type:"start"},Tw={type:"end"},ru=new Ko,fy=new kn,t2=Math.cos(70*Le.DEG2RAD),sn=new C,Yn=2*Math.PI,ye={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},up=1e-6;class Ew extends $D{constructor(t,e=null){super(t,e),this.state=ye.NONE,this.enabled=!0,this.target=new C,this.cursor=new C,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Lo.ROTATE,MIDDLE:Lo.DOLLY,RIGHT:Lo.PAN},this.touches={ONE:Ba.ROTATE,TWO:Ba.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new C,this._lastQuaternion=new jt,this._lastTargetPosition=new C,this._quat=new jt().setFromUnitVectors(t.up,new C(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new ry,this._sphericalDelta=new ry,this._scale=1,this._panOffset=new C,this._rotateStart=new J,this._rotateEnd=new J,this._rotateDelta=new J,this._panStart=new J,this._panEnd=new J,this._panDelta=new J,this._dollyStart=new J,this._dollyEnd=new J,this._dollyDelta=new J,this._dollyDirection=new C,this._mouse=new J,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=n2.bind(this),this._onPointerDown=e2.bind(this),this._onPointerUp=i2.bind(this),this._onContextMenu=h2.bind(this),this._onMouseWheel=o2.bind(this),this._onKeyDown=a2.bind(this),this._onTouchStart=c2.bind(this),this._onTouchMove=l2.bind(this),this._onMouseDown=s2.bind(this),this._onMouseMove=r2.bind(this),this._interceptControlDown=u2.bind(this),this._interceptControlUp=d2.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(dy),this.update(),this.state=ye.NONE}update(t=null){const e=this.object.position;sn.copy(e).sub(this.target),sn.applyQuaternion(this._quat),this._spherical.setFromVector3(sn),this.autoRotate&&this.state===ye.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(n)&&isFinite(i)&&(n<-Math.PI?n+=Yn:n>Math.PI&&(n-=Yn),i<-Math.PI?i+=Yn:i>Math.PI&&(i-=Yn),n<=i?this._spherical.theta=Math.max(n,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+i)/2?Math.max(n,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const o=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=o!=this._spherical.radius}if(sn.setFromSpherical(this._spherical),sn.applyQuaternion(this._quatInverse),e.copy(this.target).add(sn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let o=null;if(this.object.isPerspectiveCamera){const a=sn.length();o=this._clampDistance(a*this._scale);const c=a-o;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),s=!!c}else if(this.object.isOrthographicCamera){const a=new C(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=c!==this.object.zoom;const l=new C(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(a),this.object.updateMatrixWorld(),o=sn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;o!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(o).add(this.object.position):(ru.origin.copy(this.object.position),ru.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(ru.direction))<t2?this.object.lookAt(this.target):(fy.setFromNormalAndCoplanarPoint(this.object.up,this.target),ru.intersectPlane(fy,this.target))))}else if(this.object.isOrthographicCamera){const o=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),o!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>up||8*(1-this._lastQuaternion.dot(this.object.quaternion))>up||this._lastTargetPosition.distanceToSquared(this.target)>up?(this.dispatchEvent(dy),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?Yn/60*this.autoRotateSpeed*t:Yn/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){sn.setFromMatrixColumn(e,0),sn.multiplyScalar(-t),this._panOffset.add(sn)}_panUp(t,e){this.screenSpacePanning===!0?sn.setFromMatrixColumn(e,1):(sn.setFromMatrixColumn(e,0),sn.crossVectors(this.object.up,sn)),sn.multiplyScalar(t),this._panOffset.add(sn)}_pan(t,e){const n=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;sn.copy(i).sub(this.target);let s=sn.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*s/n.clientHeight,this.object.matrix),this._panUp(2*e*s/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),i=t-n.left,s=e-n.top,o=n.width,a=n.height;this._mouse.x=i/o*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(Yn*this._rotateDelta.x/e.clientHeight),this._rotateUp(Yn*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(Yn*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateUp(-Yn*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(Yn*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this._rotateLeft(-Yn*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),e=!0;break}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);this._rotateStart.set(n,i)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);this._panStart.set(n,i)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,i=t.pageY-e.y,s=Math.sqrt(n*n+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),i=.5*(t.pageX+n.x),s=.5*(t.pageY+n.y);this._rotateEnd.set(i,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(Yn*this._rotateDelta.x/e.clientHeight),this._rotateUp(Yn*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),i=.5*(t.pageY+e.y);this._panEnd.set(n,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,i=t.pageY-e.y,s=Math.sqrt(n*n+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const o=(t.pageX+e.x)*.5,a=(t.pageY+e.y)*.5;this._updateZoomParameters(o,a)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId){this._pointers.splice(e,1);return}}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];e===void 0&&(e=new J,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function e2(r){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(r.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(r)&&(this._addPointer(r),r.pointerType==="touch"?this._onTouchStart(r):this._onMouseDown(r)))}function n2(r){this.enabled!==!1&&(r.pointerType==="touch"?this._onTouchMove(r):this._onMouseMove(r))}function i2(r){switch(this._removePointer(r),this._pointers.length){case 0:this.domElement.releasePointerCapture(r.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(Tw),this.state=ye.NONE;break;case 1:const t=this._pointers[0],e=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:e.x,pageY:e.y});break}}function s2(r){let t;switch(r.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Lo.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(r),this.state=ye.DOLLY;break;case Lo.ROTATE:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=ye.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=ye.ROTATE}break;case Lo.PAN:if(r.ctrlKey||r.metaKey||r.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(r),this.state=ye.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(r),this.state=ye.PAN}break;default:this.state=ye.NONE}this.state!==ye.NONE&&this.dispatchEvent(f0)}function r2(r){switch(this.state){case ye.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(r);break;case ye.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(r);break;case ye.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(r);break}}function o2(r){this.enabled===!1||this.enableZoom===!1||this.state!==ye.NONE||(r.preventDefault(),this.dispatchEvent(f0),this._handleMouseWheel(this._customWheelEvent(r)),this.dispatchEvent(Tw))}function a2(r){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(r)}function c2(r){switch(this._trackPointer(r),this._pointers.length){case 1:switch(this.touches.ONE){case Ba.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(r),this.state=ye.TOUCH_ROTATE;break;case Ba.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(r),this.state=ye.TOUCH_PAN;break;default:this.state=ye.NONE}break;case 2:switch(this.touches.TWO){case Ba.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(r),this.state=ye.TOUCH_DOLLY_PAN;break;case Ba.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(r),this.state=ye.TOUCH_DOLLY_ROTATE;break;default:this.state=ye.NONE}break;default:this.state=ye.NONE}this.state!==ye.NONE&&this.dispatchEvent(f0)}function l2(r){switch(this._trackPointer(r),this.state){case ye.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(r),this.update();break;case ye.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(r),this.update();break;case ye.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(r),this.update();break;case ye.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(r),this.update();break;default:this.state=ye.NONE}}function h2(r){this.enabled!==!1&&r.preventDefault()}function u2(r){r.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function d2(r){r.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class f2 extends Bt{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new J(.5,.5),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}const xa=new C,py=new lt,my=new lt,gy=new C,_y=new C;class p2{constructor(t={}){const e=this;let n,i,s,o;const a={objects:new WeakMap},c=t.element!==void 0?t.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.getSize=function(){return{width:n,height:i}},this.render=function(m,_){m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),_.parent===null&&_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),py.copy(_.matrixWorldInverse),my.multiplyMatrices(_.projectionMatrix,py),h(m,m,_),f(m)},this.setSize=function(m,_){n=m,i=_,s=n/2,o=i/2,c.style.width=m+"px",c.style.height=_+"px"};function l(m){m.isCSS2DObject&&(m.element.style.display="none");for(let _=0,g=m.children.length;_<g;_++)l(m.children[_])}function h(m,_,g){if(m.visible===!1){l(m);return}if(m.isCSS2DObject){xa.setFromMatrixPosition(m.matrixWorld),xa.applyMatrix4(my);const p=xa.z>=-1&&xa.z<=1&&m.layers.test(g.layers)===!0,b=m.element;b.style.display=p===!0?"":"none",p===!0&&(m.onBeforeRender(e,_,g),b.style.transform="translate("+-100*m.center.x+"%,"+-100*m.center.y+"%)translate("+(xa.x*s+s)+"px,"+(-xa.y*o+o)+"px)",b.parentNode!==c&&c.appendChild(b),m.onAfterRender(e,_,g));const y={distanceToCameraSquared:u(g,m)};a.objects.set(m,y)}for(let p=0,b=m.children.length;p<b;p++)h(m.children[p],_,g)}function u(m,_){return gy.setFromMatrixPosition(m.matrixWorld),_y.setFromMatrixPosition(_.matrixWorld),gy.distanceToSquared(_y)}function d(m){const _=[];return m.traverseVisible(function(g){g.isCSS2DObject&&_.push(g)}),_}function f(m){const _=d(m).sort(function(p,b){if(p.renderOrder!==b.renderOrder)return b.renderOrder-p.renderOrder;const y=a.objects.get(p).distanceToCameraSquared,v=a.objects.get(b).distanceToCameraSquared;return y-v}),g=_.length;for(let p=0,b=_.length;p<b;p++)_[p].element.style.zIndex=g-p}}}const by=new C,m2=new jt,yy=new C;class g2 extends Bt{constructor(t=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(e){e.element instanceof e.element.ownerDocument.defaultView.Element&&e.element.parentNode!==null&&e.element.remove()})})}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this}}const cs=new lt,_2=new lt;class b2{constructor(t={}){const e=this;let n,i,s,o;const a={camera:{style:""},objects:new WeakMap},c=t.element!==void 0?t.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c;const l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",c.appendChild(l);const h=document.createElement("div");h.style.transformStyle="preserve-3d",l.appendChild(h),this.getSize=function(){return{width:n,height:i}},this.render=function(g,p){const b=p.projectionMatrix.elements[5]*o;p.view&&p.view.enabled?(l.style.transform=`translate( ${-p.view.offsetX*(n/p.view.width)}px, ${-p.view.offsetY*(i/p.view.height)}px )`,l.style.transform+=`scale( ${p.view.fullWidth/p.view.width}, ${p.view.fullHeight/p.view.height} )`):l.style.transform="",g.matrixWorldAutoUpdate===!0&&g.updateMatrixWorld(),p.parent===null&&p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld();let y,v;p.isOrthographicCamera&&(y=-(p.right+p.left)/2,v=(p.top+p.bottom)/2);const x=p.view&&p.view.enabled?p.view.height/p.view.fullHeight:1,S=p.isOrthographicCamera?`scale( ${x} )scale(`+b+")translate("+u(y)+"px,"+u(v)+"px)"+d(p.matrixWorldInverse):`scale( ${x} )translateZ(`+b+"px)"+d(p.matrixWorldInverse),E=(p.isPerspectiveCamera?"perspective("+b+"px) ":"")+S+"translate("+s+"px,"+o+"px)";a.camera.style!==E&&(h.style.transform=E,a.camera.style=E),_(g,g,p)},this.setSize=function(g,p){n=g,i=p,s=n/2,o=i/2,c.style.width=g+"px",c.style.height=p+"px",l.style.width=g+"px",l.style.height=p+"px",h.style.width=g+"px",h.style.height=p+"px"};function u(g){return Math.abs(g)<1e-10?0:g}function d(g){const p=g.elements;return"matrix3d("+u(p[0])+","+u(-p[1])+","+u(p[2])+","+u(p[3])+","+u(p[4])+","+u(-p[5])+","+u(p[6])+","+u(p[7])+","+u(p[8])+","+u(-p[9])+","+u(p[10])+","+u(p[11])+","+u(p[12])+","+u(-p[13])+","+u(p[14])+","+u(p[15])+")"}function f(g){const p=g.elements;return"translate(-50%,-50%)"+("matrix3d("+u(p[0])+","+u(p[1])+","+u(p[2])+","+u(p[3])+","+u(-p[4])+","+u(-p[5])+","+u(-p[6])+","+u(-p[7])+","+u(p[8])+","+u(p[9])+","+u(p[10])+","+u(p[11])+","+u(p[12])+","+u(p[13])+","+u(p[14])+","+u(p[15])+")")}function m(g){g.isCSS3DObject&&(g.element.style.display="none");for(let p=0,b=g.children.length;p<b;p++)m(g.children[p])}function _(g,p,b,y){if(g.visible===!1){m(g);return}if(g.isCSS3DObject){const v=g.layers.test(b.layers)===!0,x=g.element;if(x.style.display=v===!0?"":"none",v===!0){g.onBeforeRender(e,p,b);let S;g.isCSS3DSprite?(cs.copy(b.matrixWorldInverse),cs.transpose(),g.rotation2D!==0&&cs.multiply(_2.makeRotationZ(g.rotation2D)),g.matrixWorld.decompose(by,m2,yy),cs.setPosition(by),cs.scale(yy),cs.elements[3]=0,cs.elements[7]=0,cs.elements[11]=0,cs.elements[15]=1,S=f(cs)):S=f(g.matrixWorld);const T=a.objects.get(g);if(T===void 0||T.style!==S){x.style.transform=S;const E={style:S};a.objects.set(g,E)}x.parentNode!==h&&h.appendChild(x),g.onAfterRender(e,p,b)}}for(let v=0,x=g.children.length;v<x;v++)_(g.children[v],p,b)}}}const Aw=0,y2=1,v2=2,vy=2,dp=1.25,xy=1,Pl=6*4+4+4,Qd=65535,x2=Math.pow(2,-24),fp=Symbol("SKIP_GENERATION");function w2(r){return r.index?r.index.count:r.attributes.position.count}function kc(r){return w2(r)/3}function S2(r,t=ArrayBuffer){return r>65535?new Uint32Array(new t(4*r)):new Uint16Array(new t(2*r))}function M2(r,t){if(!r.index){const e=r.attributes.position.count,n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=S2(e,n);r.setIndex(new Pe(i,1));for(let s=0;s<e;s++)i[s]=s}}function Cw(r,t){const e=kc(r),n=t||r.drawRange,i=n.start/3,s=(n.start+n.count)/3,o=Math.max(0,i),a=Math.min(e,s)-o;return[{offset:Math.floor(o),count:Math.floor(a)}]}function Pw(r,t){if(!r.groups||!r.groups.length)return Cw(r,t);const e=[],n=new Set,i=t||r.drawRange,s=i.start/3,o=(i.start+i.count)/3;for(const c of r.groups){const l=c.start/3,h=(c.start+c.count)/3;n.add(Math.max(s,l)),n.add(Math.min(o,h))}const a=Array.from(n.values()).sort((c,l)=>c-l);for(let c=0;c<a.length-1;c++){const l=a[c],h=a[c+1];e.push({offset:Math.floor(l),count:Math.floor(h-l)})}return e}function T2(r,t){const e=kc(r),n=Pw(r,t).sort((o,a)=>o.offset-a.offset),i=n[n.length-1];i.count=Math.min(e-i.offset,i.count);let s=0;return n.forEach(({count:o})=>s+=o),e!==s}function pp(r,t,e,n,i){let s=1/0,o=1/0,a=1/0,c=-1/0,l=-1/0,h=-1/0,u=1/0,d=1/0,f=1/0,m=-1/0,_=-1/0,g=-1/0;for(let p=t*6,b=(t+e)*6;p<b;p+=6){const y=r[p+0],v=r[p+1],x=y-v,S=y+v;x<s&&(s=x),S>c&&(c=S),y<u&&(u=y),y>m&&(m=y);const T=r[p+2],E=r[p+3],w=T-E,M=T+E;w<o&&(o=w),M>l&&(l=M),T<d&&(d=T),T>_&&(_=T);const P=r[p+4],L=r[p+5],I=P-L,F=P+L;I<a&&(a=I),F>h&&(h=F),P<f&&(f=P),P>g&&(g=P)}n[0]=s,n[1]=o,n[2]=a,n[3]=c,n[4]=l,n[5]=h,i[0]=u,i[1]=d,i[2]=f,i[3]=m,i[4]=_,i[5]=g}function E2(r,t=null,e=null,n=null){const i=r.attributes.position,s=r.index?r.index.array:null,o=kc(r),a=i.normalized;let c;t===null?(c=new Float32Array(o*6),e=0,n=o):(c=t,e=e||0,n=n||o);const l=i.array,h=i.offset||0;let u=3;i.isInterleavedBufferAttribute&&(u=i.data.stride);const d=["getX","getY","getZ"];for(let f=e;f<e+n;f++){const m=f*3,_=f*6;let g=m+0,p=m+1,b=m+2;s&&(g=s[g],p=s[p],b=s[b]),a||(g=g*u+h,p=p*u+h,b=b*u+h);for(let y=0;y<3;y++){let v,x,S;a?(v=i[d[y]](g),x=i[d[y]](p),S=i[d[y]](b)):(v=l[g+y],x=l[p+y],S=l[b+y]);let T=v;x<T&&(T=x),S<T&&(T=S);let E=v;x>E&&(E=x),S>E&&(E=S);const w=(E-T)/2,M=y*2;c[_+M+0]=T+w,c[_+M+1]=w+(Math.abs(T)+w)*x2}}return c}function He(r,t,e){return e.min.x=t[r],e.min.y=t[r+1],e.min.z=t[r+2],e.max.x=t[r+3],e.max.y=t[r+4],e.max.z=t[r+5],e}function wy(r){let t=-1,e=-1/0;for(let n=0;n<3;n++){const i=r[n+3]-r[n];i>e&&(e=i,t=n)}return t}function Sy(r,t){t.set(r)}function My(r,t,e){let n,i;for(let s=0;s<3;s++){const o=s+3;n=r[s],i=t[s],e[s]=n<i?n:i,n=r[o],i=t[o],e[o]=n>i?n:i}}function ou(r,t,e){for(let n=0;n<3;n++){const i=t[r+2*n],s=t[r+2*n+1],o=i-s,a=i+s;o<e[n]&&(e[n]=o),a>e[n+3]&&(e[n+3]=a)}}function sl(r){const t=r[3]-r[0],e=r[4]-r[1],n=r[5]-r[2];return 2*(t*e+e*n+n*t)}const zs=32,A2=(r,t)=>r.candidate-t.candidate,Sr=new Array(zs).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),au=new Float32Array(6);function C2(r,t,e,n,i,s){let o=-1,a=0;if(s===Aw)o=wy(t),o!==-1&&(a=(t[o]+t[o+3])/2);else if(s===y2)o=wy(r),o!==-1&&(a=P2(e,n,i,o));else if(s===v2){const c=sl(r);let l=dp*i;const h=n*6,u=(n+i)*6;for(let d=0;d<3;d++){const f=t[d],g=(t[d+3]-f)/zs;if(i<zs/4){const p=[...Sr];p.length=i;let b=0;for(let v=h;v<u;v+=6,b++){const x=p[b];x.candidate=e[v+2*d],x.count=0;const{bounds:S,leftCacheBounds:T,rightCacheBounds:E}=x;for(let w=0;w<3;w++)E[w]=1/0,E[w+3]=-1/0,T[w]=1/0,T[w+3]=-1/0,S[w]=1/0,S[w+3]=-1/0;ou(v,e,S)}p.sort(A2);let y=i;for(let v=0;v<y;v++){const x=p[v];for(;v+1<y&&p[v+1].candidate===x.candidate;)p.splice(v+1,1),y--}for(let v=h;v<u;v+=6){const x=e[v+2*d];for(let S=0;S<y;S++){const T=p[S];x>=T.candidate?ou(v,e,T.rightCacheBounds):(ou(v,e,T.leftCacheBounds),T.count++)}}for(let v=0;v<y;v++){const x=p[v],S=x.count,T=i-x.count,E=x.leftCacheBounds,w=x.rightCacheBounds;let M=0;S!==0&&(M=sl(E)/c);let P=0;T!==0&&(P=sl(w)/c);const L=xy+dp*(M*S+P*T);L<l&&(o=d,l=L,a=x.candidate)}}else{for(let y=0;y<zs;y++){const v=Sr[y];v.count=0,v.candidate=f+g+y*g;const x=v.bounds;for(let S=0;S<3;S++)x[S]=1/0,x[S+3]=-1/0}for(let y=h;y<u;y+=6){let S=~~((e[y+2*d]-f)/g);S>=zs&&(S=zs-1);const T=Sr[S];T.count++,ou(y,e,T.bounds)}const p=Sr[zs-1];Sy(p.bounds,p.rightCacheBounds);for(let y=zs-2;y>=0;y--){const v=Sr[y],x=Sr[y+1];My(v.bounds,x.rightCacheBounds,v.rightCacheBounds)}let b=0;for(let y=0;y<zs-1;y++){const v=Sr[y],x=v.count,S=v.bounds,E=Sr[y+1].rightCacheBounds;x!==0&&(b===0?Sy(S,au):My(S,au,au)),b+=x;let w=0,M=0;b!==0&&(w=sl(au)/c);const P=i-b;P!==0&&(M=sl(E)/c);const L=xy+dp*(w*b+M*P);L<l&&(o=d,l=L,a=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:o,pos:a}}function P2(r,t,e,n){let i=0;for(let s=t,o=t+e;s<o;s++)i+=r[s*6+n*2];return i/e}class mp{constructor(){this.boundingData=new Float32Array(6)}}function R2(r,t,e,n,i,s){let o=n,a=n+i-1;const c=s.pos,l=s.axis*2;for(;;){for(;o<=a&&e[o*6+l]<c;)o++;for(;o<=a&&e[a*6+l]>=c;)a--;if(o<a){for(let h=0;h<3;h++){let u=t[o*3+h];t[o*3+h]=t[a*3+h],t[a*3+h]=u}for(let h=0;h<6;h++){let u=e[o*6+h];e[o*6+h]=e[a*6+h],e[a*6+h]=u}o++,a--}else return o}}function D2(r,t,e,n,i,s){let o=n,a=n+i-1;const c=s.pos,l=s.axis*2;for(;;){for(;o<=a&&e[o*6+l]<c;)o++;for(;o<=a&&e[a*6+l]>=c;)a--;if(o<a){let h=r[o];r[o]=r[a],r[a]=h;for(let u=0;u<6;u++){let d=e[o*6+u];e[o*6+u]=e[a*6+u],e[a*6+u]=d}o++,a--}else return o}}function Zn(r,t){return t[r+15]===65535}function fi(r,t){return t[r+6]}function Ii(r,t){return t[r+14]}function Oi(r){return r+8}function Fi(r,t){return t[r+6]}function Rw(r,t){return t[r+7]}let Dw,yl,rd,Lw;const L2=Math.pow(2,32);function Km(r){return"count"in r?1:1+Km(r.left)+Km(r.right)}function I2(r,t,e){return Dw=new Float32Array(e),yl=new Uint32Array(e),rd=new Uint16Array(e),Lw=new Uint8Array(e),Zm(r,t)}function Zm(r,t){const e=r/4,n=r/2,i="count"in t,s=t.boundingData;for(let o=0;o<6;o++)Dw[e+o]=s[o];if(i)if(t.buffer){const o=t.buffer;Lw.set(new Uint8Array(o),r);for(let a=r,c=r+o.byteLength;a<c;a+=Pl){const l=a/2;Zn(l,rd)||(yl[a/4+6]+=e)}return r+o.byteLength}else{const o=t.offset,a=t.count;return yl[e+6]=o,rd[n+14]=a,rd[n+15]=Qd,r+Pl}else{const o=t.left,a=t.right,c=t.splitAxis;let l;if(l=Zm(r+Pl,o),l/4>L2)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return yl[e+6]=l/4,l=Zm(l,a),yl[e+7]=c,l}}function O2(r,t){const e=(r.index?r.index.count:r.attributes.position.count)/3,n=e>2**16,i=n?4:2,s=t?new SharedArrayBuffer(e*i):new ArrayBuffer(e*i),o=n?new Uint32Array(s):new Uint16Array(s);for(let a=0,c=o.length;a<c;a++)o[a]=a;return o}function F2(r,t,e,n,i){const{maxDepth:s,verbose:o,maxLeafTris:a,strategy:c,onProgress:l,indirect:h}=i,u=r._indirectBuffer,d=r.geometry,f=d.index?d.index.array:null,m=h?D2:R2,_=kc(d),g=new Float32Array(6);let p=!1;const b=new mp;return pp(t,e,n,b.boundingData,g),v(b,e,n,g),b;function y(x){l&&l(x/_)}function v(x,S,T,E=null,w=0){if(!p&&w>=s&&(p=!0,o&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(d))),T<=a||w>=s)return y(S+T),x.offset=S,x.count=T,x;const M=C2(x.boundingData,E,t,S,T,c);if(M.axis===-1)return y(S+T),x.offset=S,x.count=T,x;const P=m(u,f,t,S,T,M);if(P===S||P===S+T)y(S+T),x.offset=S,x.count=T;else{x.splitAxis=M.axis;const L=new mp,I=S,F=P-S;x.left=L,pp(t,I,F,L.boundingData,g),v(L,I,F,g,w+1);const z=new mp,N=P,Z=T-F;x.right=z,pp(t,N,Z,z.boundingData,g),v(z,N,Z,g,w+1)}return x}}function k2(r,t){const e=r.geometry;t.indirect&&(r._indirectBuffer=O2(e,t.useSharedArrayBuffer),T2(e,t.range)&&!t.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),r._indirectBuffer||M2(e,t);const n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=E2(e),s=t.indirect?Cw(e,t.range):Pw(e,t.range);r._roots=s.map(o=>{const a=F2(r,i,o.offset,o.count,t),c=Km(a),l=new n(Pl*c);return I2(0,a,l),l})}class ar{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let n=1/0,i=-1/0;for(let s=0,o=t.length;s<o;s++){const c=t[s][e];n=c<n?c:n,i=c>i?c:i}this.min=n,this.max=i}setFromPoints(t,e){let n=1/0,i=-1/0;for(let s=0,o=e.length;s<o;s++){const a=e[s],c=t.dot(a);n=c<n?c:n,i=c>i?c:i}this.min=n,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}ar.prototype.setFromBox=function(){const r=new C;return function(e,n){const i=n.min,s=n.max;let o=1/0,a=-1/0;for(let c=0;c<=1;c++)for(let l=0;l<=1;l++)for(let h=0;h<=1;h++){r.x=i.x*c+s.x*(1-c),r.y=i.y*l+s.y*(1-l),r.z=i.z*h+s.z*(1-h);const u=e.dot(r);o=Math.min(u,o),a=Math.max(u,a)}this.min=o,this.max=a}}();const N2=function(){const r=new C,t=new C,e=new C;return function(i,s,o){const a=i.start,c=r,l=s.start,h=t;e.subVectors(a,l),r.subVectors(i.end,i.start),t.subVectors(s.end,s.start);const u=e.dot(h),d=h.dot(c),f=h.dot(h),m=e.dot(c),g=c.dot(c)*f-d*d;let p,b;g!==0?p=(u*d-m*f)/g:p=0,b=(u+p*d)/f,o.x=p,o.y=b}}(),p0=function(){const r=new J,t=new C,e=new C;return function(i,s,o,a){N2(i,s,r);let c=r.x,l=r.y;if(c>=0&&c<=1&&l>=0&&l<=1){i.at(c,o),s.at(l,a);return}else if(c>=0&&c<=1){l<0?s.at(0,a):s.at(1,a),i.closestPointToPoint(a,!0,o);return}else if(l>=0&&l<=1){c<0?i.at(0,o):i.at(1,o),s.closestPointToPoint(o,!0,a);return}else{let h;c<0?h=i.start:h=i.end;let u;l<0?u=s.start:u=s.end;const d=t,f=e;if(i.closestPointToPoint(u,!0,t),s.closestPointToPoint(h,!0,e),d.distanceToSquared(u)<=f.distanceToSquared(h)){o.copy(d),a.copy(u);return}else{o.copy(h),a.copy(f);return}}}}(),U2=function(){const r=new C,t=new C,e=new kn,n=new er;return function(s,o){const{radius:a,center:c}=s,{a:l,b:h,c:u}=o;if(n.start=l,n.end=h,n.closestPointToPoint(c,!0,r).distanceTo(c)<=a||(n.start=l,n.end=u,n.closestPointToPoint(c,!0,r).distanceTo(c)<=a)||(n.start=h,n.end=u,n.closestPointToPoint(c,!0,r).distanceTo(c)<=a))return!0;const _=o.getPlane(e);if(Math.abs(_.distanceToPoint(c))<=a){const p=_.projectPoint(c,t);if(o.containsPoint(p))return!0}return!1}}(),B2=1e-15;function gp(r){return Math.abs(r)<B2}class ss extends un{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new C),this.satBounds=new Array(4).fill().map(()=>new ar),this.points=[this.a,this.b,this.c],this.sphere=new An,this.plane=new kn,this.needsUpdate=!0}intersectsSphere(t){return U2(t,this)}update(){const t=this.a,e=this.b,n=this.c,i=this.points,s=this.satAxes,o=this.satBounds,a=s[0],c=o[0];this.getNormal(a),c.setFromPoints(a,i);const l=s[1],h=o[1];l.subVectors(t,e),h.setFromPoints(l,i);const u=s[2],d=o[2];u.subVectors(e,n),d.setFromPoints(u,i);const f=s[3],m=o[3];f.subVectors(n,t),m.setFromPoints(f,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}}ss.prototype.closestPointToSegment=function(){const r=new C,t=new C,e=new er;return function(i,s=null,o=null){const{start:a,end:c}=i,l=this.points;let h,u=1/0;for(let d=0;d<3;d++){const f=(d+1)%3;e.start.copy(l[d]),e.end.copy(l[f]),p0(e,i,r,t),h=r.distanceToSquared(t),h<u&&(u=h,s&&s.copy(r),o&&o.copy(t))}return this.closestPointToPoint(a,r),h=a.distanceToSquared(r),h<u&&(u=h,s&&s.copy(r),o&&o.copy(a)),this.closestPointToPoint(c,r),h=c.distanceToSquared(r),h<u&&(u=h,s&&s.copy(r),o&&o.copy(c)),Math.sqrt(u)}}();ss.prototype.intersectsTriangle=function(){const r=new ss,t=new Array(3),e=new Array(3),n=new ar,i=new ar,s=new C,o=new C,a=new C,c=new C,l=new C,h=new er,u=new er,d=new er,f=new C;function m(_,g,p){const b=_.points;let y=0,v=-1;for(let x=0;x<3;x++){const{start:S,end:T}=h;S.copy(b[x]),T.copy(b[(x+1)%3]),h.delta(o);const E=gp(g.distanceToPoint(S));if(gp(g.normal.dot(o))&&E){p.copy(h),y=2;break}const w=g.intersectLine(h,f);if(!w&&E&&f.copy(S),(w||E)&&!gp(f.distanceTo(T))){if(y<=1)(y===1?p.start:p.end).copy(f),E&&(v=y);else if(y>=2){(v===1?p.start:p.end).copy(f),y=2;break}if(y++,y===2&&v===-1)break}}return y}return function(g,p=null,b=!1){this.needsUpdate&&this.update(),g.isExtendedTriangle?g.needsUpdate&&g.update():(r.copy(g),r.update(),g=r);const y=this.plane,v=g.plane;if(Math.abs(y.normal.dot(v.normal))>1-1e-10){const x=this.satBounds,S=this.satAxes;e[0]=g.a,e[1]=g.b,e[2]=g.c;for(let w=0;w<4;w++){const M=x[w],P=S[w];if(n.setFromPoints(P,e),M.isSeparated(n))return!1}const T=g.satBounds,E=g.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let w=0;w<4;w++){const M=T[w],P=E[w];if(n.setFromPoints(P,t),M.isSeparated(n))return!1}for(let w=0;w<4;w++){const M=S[w];for(let P=0;P<4;P++){const L=E[P];if(s.crossVectors(M,L),n.setFromPoints(s,t),i.setFromPoints(s,e),n.isSeparated(i))return!1}}return p&&(b||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),p.start.set(0,0,0),p.end.set(0,0,0)),!0}else{const x=m(this,v,u);if(x===1&&g.containsPoint(u.end))return p&&(p.start.copy(u.end),p.end.copy(u.end)),!0;if(x!==2)return!1;const S=m(g,y,d);if(S===1&&this.containsPoint(d.end))return p&&(p.start.copy(d.end),p.end.copy(d.end)),!0;if(S!==2)return!1;if(u.delta(a),d.delta(c),a.dot(c)<0){let I=d.start;d.start=d.end,d.end=I}const T=u.start.dot(a),E=u.end.dot(a),w=d.start.dot(a),M=d.end.dot(a),P=E<w,L=T<M;return T!==M&&w!==E&&P===L?!1:(p&&(l.subVectors(u.start,d.start),l.dot(a)>0?p.start.copy(u.start):p.start.copy(d.start),l.subVectors(u.end,d.end),l.dot(a)<0?p.end.copy(u.end):p.end.copy(d.end)),!0)}}}();ss.prototype.distanceToPoint=function(){const r=new C;return function(e){return this.closestPointToPoint(e,r),e.distanceTo(r)}}();ss.prototype.distanceToTriangle=function(){const r=new C,t=new C,e=["a","b","c"],n=new er,i=new er;return function(o,a=null,c=null){const l=a||c?n:null;if(this.intersectsTriangle(o,l))return(a||c)&&(a&&l.getCenter(a),c&&l.getCenter(c)),0;let h=1/0;for(let u=0;u<3;u++){let d;const f=e[u],m=o[f];this.closestPointToPoint(m,r),d=m.distanceToSquared(r),d<h&&(h=d,a&&a.copy(r),c&&c.copy(m));const _=this[f];o.closestPointToPoint(_,r),d=_.distanceToSquared(r),d<h&&(h=d,a&&a.copy(_),c&&c.copy(r))}for(let u=0;u<3;u++){const d=e[u],f=e[(u+1)%3];n.set(this[d],this[f]);for(let m=0;m<3;m++){const _=e[m],g=e[(m+1)%3];i.set(o[_],o[g]),p0(n,i,r,t);const p=r.distanceToSquared(t);p<h&&(h=p,a&&a.copy(r),c&&c.copy(t))}}return Math.sqrt(h)}}();class jn{constructor(t,e,n){this.isOrientedBox=!0,this.min=new C,this.max=new C,this.matrix=new lt,this.invMatrix=new lt,this.points=new Array(8).fill().map(()=>new C),this.satAxes=new Array(3).fill().map(()=>new C),this.satBounds=new Array(3).fill().map(()=>new ar),this.alignedSatBounds=new Array(3).fill().map(()=>new ar),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),n&&this.matrix.copy(n)}set(t,e,n){this.min.copy(t),this.max.copy(e),this.matrix.copy(n),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}jn.prototype.update=function(){return function(){const t=this.matrix,e=this.min,n=this.max,i=this.points;for(let l=0;l<=1;l++)for(let h=0;h<=1;h++)for(let u=0;u<=1;u++){const d=1*l|2*h|4*u,f=i[d];f.x=l?n.x:e.x,f.y=h?n.y:e.y,f.z=u?n.z:e.z,f.applyMatrix4(t)}const s=this.satBounds,o=this.satAxes,a=i[0];for(let l=0;l<3;l++){const h=o[l],u=s[l],d=1<<l,f=i[d];h.subVectors(a,f),u.setFromPoints(h,i)}const c=this.alignedSatBounds;c[0].setFromPointsField(i,"x"),c[1].setFromPointsField(i,"y"),c[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();jn.prototype.intersectsBox=function(){const r=new ar;return function(e){this.needsUpdate&&this.update();const n=e.min,i=e.max,s=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(r.min=n.x,r.max=i.x,a[0].isSeparated(r)||(r.min=n.y,r.max=i.y,a[1].isSeparated(r))||(r.min=n.z,r.max=i.z,a[2].isSeparated(r)))return!1;for(let c=0;c<3;c++){const l=o[c],h=s[c];if(r.setFromBox(l,e),h.isSeparated(r))return!1}return!0}}();jn.prototype.intersectsTriangle=function(){const r=new ss,t=new Array(3),e=new ar,n=new ar,i=new C;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(r.copy(o),r.update(),o=r);const a=this.satBounds,c=this.satAxes;t[0]=o.a,t[1]=o.b,t[2]=o.c;for(let d=0;d<3;d++){const f=a[d],m=c[d];if(e.setFromPoints(m,t),f.isSeparated(e))return!1}const l=o.satBounds,h=o.satAxes,u=this.points;for(let d=0;d<3;d++){const f=l[d],m=h[d];if(e.setFromPoints(m,u),f.isSeparated(e))return!1}for(let d=0;d<3;d++){const f=c[d];for(let m=0;m<4;m++){const _=h[m];if(i.crossVectors(f,_),e.setFromPoints(i,t),n.setFromPoints(i,u),e.isSeparated(n))return!1}}return!0}}();jn.prototype.closestPointToPoint=function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}}();jn.prototype.distanceToPoint=function(){const r=new C;return function(e){return this.closestPointToPoint(e,r),e.distanceTo(r)}}();jn.prototype.distanceToBox=function(){const r=["x","y","z"],t=new Array(12).fill().map(()=>new er),e=new Array(12).fill().map(()=>new er),n=new C,i=new C;return function(o,a=0,c=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(c||l)&&(o.getCenter(i),this.closestPointToPoint(i,n),o.closestPointToPoint(n,i),c&&c.copy(n),l&&l.copy(i)),0;const h=a*a,u=o.min,d=o.max,f=this.points;let m=1/0;for(let g=0;g<8;g++){const p=f[g];i.copy(p).clamp(u,d);const b=p.distanceToSquared(i);if(b<m&&(m=b,c&&c.copy(p),l&&l.copy(i),b<h))return Math.sqrt(b)}let _=0;for(let g=0;g<3;g++)for(let p=0;p<=1;p++)for(let b=0;b<=1;b++){const y=(g+1)%3,v=(g+2)%3,x=p<<y|b<<v,S=1<<g|p<<y|b<<v,T=f[x],E=f[S];t[_].set(T,E);const M=r[g],P=r[y],L=r[v],I=e[_],F=I.start,z=I.end;F[M]=u[M],F[P]=p?u[P]:d[P],F[L]=b?u[L]:d[P],z[M]=d[M],z[P]=p?u[P]:d[P],z[L]=b?u[L]:d[P],_++}for(let g=0;g<=1;g++)for(let p=0;p<=1;p++)for(let b=0;b<=1;b++){i.x=g?d.x:u.x,i.y=p?d.y:u.y,i.z=b?d.z:u.z,this.closestPointToPoint(i,n);const y=i.distanceToSquared(n);if(y<m&&(m=y,c&&c.copy(n),l&&l.copy(i),y<h))return Math.sqrt(y)}for(let g=0;g<12;g++){const p=t[g];for(let b=0;b<12;b++){const y=e[b];p0(p,y,n,i);const v=n.distanceToSquared(i);if(v<m&&(m=v,c&&c.copy(n),l&&l.copy(i),v<h))return Math.sqrt(v)}}return Math.sqrt(m)}}();class m0{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class z2 extends m0{constructor(){super(()=>new ss)}}const ki=new z2;class V2{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const t=[];let e=null;this.setBuffer=n=>{e&&t.push(e),e=n,this.float32Array=new Float32Array(n),this.uint16Array=new Uint16Array(n),this.uint32Array=new Uint32Array(n)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,t.length!==0&&this.setBuffer(t.pop())}}}const Re=new V2;let kr,Xa;const wa=[],cu=new m0(()=>new xe);function H2(r,t,e,n,i,s){kr=cu.getPrimitive(),Xa=cu.getPrimitive(),wa.push(kr,Xa),Re.setBuffer(r._roots[t]);const o=Qm(0,r.geometry,e,n,i,s);Re.clearBuffer(),cu.releasePrimitive(kr),cu.releasePrimitive(Xa),wa.pop(),wa.pop();const a=wa.length;return a>0&&(Xa=wa[a-1],kr=wa[a-2]),o}function Qm(r,t,e,n,i=null,s=0,o=0){const{float32Array:a,uint16Array:c,uint32Array:l}=Re;let h=r*2;if(Zn(h,c)){const d=fi(r,l),f=Ii(h,c);return He(r,a,kr),n(d,f,!1,o,s+r,kr)}else{let M=function(L){const{uint16Array:I,uint32Array:F}=Re;let z=L*2;for(;!Zn(z,I);)L=Oi(L),z=L*2;return fi(L,F)},P=function(L){const{uint16Array:I,uint32Array:F}=Re;let z=L*2;for(;!Zn(z,I);)L=Fi(L,F),z=L*2;return fi(L,F)+Ii(z,I)};const d=Oi(r),f=Fi(r,l);let m=d,_=f,g,p,b,y;if(i&&(b=kr,y=Xa,He(m,a,b),He(_,a,y),g=i(b),p=i(y),p<g)){m=f,_=d;const L=g;g=p,p=L,b=y}b||(b=kr,He(m,a,b));const v=Zn(m*2,c),x=e(b,v,g,o+1,s+m);let S;if(x===vy){const L=M(m),F=P(m)-L;S=n(L,F,!0,o+1,s+m,b)}else S=x&&Qm(m,t,e,n,i,s,o+1);if(S)return!0;y=Xa,He(_,a,y);const T=Zn(_*2,c),E=e(y,T,p,o+1,s+_);let w;if(E===vy){const L=M(_),F=P(_)-L;w=n(L,F,!0,o+1,s+_,y)}else w=E&&Qm(_,t,e,n,i,s,o+1);return!!w}}const rl=new C,_p=new C;function G2(r,t,e={},n=0,i=1/0){const s=n*n,o=i*i;let a=1/0,c=null;if(r.shapecast({boundsTraverseOrder:h=>(rl.copy(t).clamp(h.min,h.max),rl.distanceToSquared(t)),intersectsBounds:(h,u,d)=>d<a&&d<o,intersectsTriangle:(h,u)=>{h.closestPointToPoint(t,rl);const d=t.distanceToSquared(rl);return d<a&&(_p.copy(rl),a=d,c=u),d<s}}),a===1/0)return null;const l=Math.sqrt(a);return e.point?e.point.copy(_p):e.point=_p.clone(),e.distance=l,e.faceIndex=c,e}const j2=parseInt(ah)>=169,mo=new C,go=new C,_o=new C,lu=new J,hu=new J,uu=new J,Ty=new C,Ey=new C,Ay=new C,ol=new C;function W2(r,t,e,n,i,s,o,a){let c;if(s===Vn?c=r.intersectTriangle(n,e,t,!0,i):c=r.intersectTriangle(t,e,n,s!==Sn,i),c===null)return null;const l=r.origin.distanceTo(i);return l<o||l>a?null:{distance:l,point:i.clone()}}function X2(r,t,e,n,i,s,o,a,c,l,h){mo.fromBufferAttribute(t,s),go.fromBufferAttribute(t,o),_o.fromBufferAttribute(t,a);const u=W2(r,mo,go,_o,ol,c,l,h);if(u){const d=new C;un.getBarycoord(ol,mo,go,_o,d),n&&(lu.fromBufferAttribute(n,s),hu.fromBufferAttribute(n,o),uu.fromBufferAttribute(n,a),u.uv=un.getInterpolation(ol,mo,go,_o,lu,hu,uu,new J)),i&&(lu.fromBufferAttribute(i,s),hu.fromBufferAttribute(i,o),uu.fromBufferAttribute(i,a),u.uv1=un.getInterpolation(ol,mo,go,_o,lu,hu,uu,new J)),e&&(Ty.fromBufferAttribute(e,s),Ey.fromBufferAttribute(e,o),Ay.fromBufferAttribute(e,a),u.normal=un.getInterpolation(ol,mo,go,_o,Ty,Ey,Ay,new C),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const f={a:s,b:o,c:a,normal:new C,materialIndex:0};un.getNormal(mo,go,_o,f.normal),u.face=f,u.faceIndex=s,j2&&(u.barycoord=d)}return u}function $d(r,t,e,n,i,s,o){const a=n*3;let c=a+0,l=a+1,h=a+2;const u=r.index;r.index&&(c=u.getX(c),l=u.getX(l),h=u.getX(h));const{position:d,normal:f,uv:m,uv1:_}=r.attributes,g=X2(e,d,f,m,_,c,l,h,t,s,o);return g?(g.faceIndex=n,i&&i.push(g),g):null}function nn(r,t,e,n){const i=r.a,s=r.b,o=r.c;let a=t,c=t+1,l=t+2;e&&(a=e.getX(a),c=e.getX(c),l=e.getX(l)),i.x=n.getX(a),i.y=n.getY(a),i.z=n.getZ(a),s.x=n.getX(c),s.y=n.getY(c),s.z=n.getZ(c),o.x=n.getX(l),o.y=n.getY(l),o.z=n.getZ(l)}function Y2(r,t,e,n,i,s,o,a){const{geometry:c,_indirectBuffer:l}=r;for(let h=n,u=n+i;h<u;h++)$d(c,t,e,h,s,o,a)}function q2(r,t,e,n,i,s,o){const{geometry:a,_indirectBuffer:c}=r;let l=1/0,h=null;for(let u=n,d=n+i;u<d;u++){let f;f=$d(a,t,e,u,null,s,o),f&&f.distance<l&&(h=f,l=f.distance)}return h}function K2(r,t,e,n,i,s,o){const{geometry:a}=e,{index:c}=a,l=a.attributes.position;for(let h=r,u=t+r;h<u;h++){let d;if(d=h,nn(o,d*3,c,l),o.needsUpdate=!0,n(o,d,i,s))return!0}return!1}function Z2(r,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=r.geometry,n=e.index?e.index.array:null,i=e.attributes.position;let s,o,a,c,l=0;const h=r._roots;for(let d=0,f=h.length;d<f;d++)s=h[d],o=new Uint32Array(s),a=new Uint16Array(s),c=new Float32Array(s),u(0,l),l+=s.byteLength;function u(d,f,m=!1){const _=d*2;if(a[_+15]===Qd){const p=o[d+6],b=a[_+14];let y=1/0,v=1/0,x=1/0,S=-1/0,T=-1/0,E=-1/0;for(let w=3*p,M=3*(p+b);w<M;w++){let P=n[w];const L=i.getX(P),I=i.getY(P),F=i.getZ(P);L<y&&(y=L),L>S&&(S=L),I<v&&(v=I),I>T&&(T=I),F<x&&(x=F),F>E&&(E=F)}return c[d+0]!==y||c[d+1]!==v||c[d+2]!==x||c[d+3]!==S||c[d+4]!==T||c[d+5]!==E?(c[d+0]=y,c[d+1]=v,c[d+2]=x,c[d+3]=S,c[d+4]=T,c[d+5]=E,!0):!1}else{const p=d+8,b=o[d+6],y=p+f,v=b+f;let x=m,S=!1,T=!1;t?x||(S=t.has(y),T=t.has(v),x=!S&&!T):(S=!0,T=!0);const E=x||S,w=x||T;let M=!1;E&&(M=u(p,f,x));let P=!1;w&&(P=u(b,f,x));const L=M||P;if(L)for(let I=0;I<3;I++){const F=p+I,z=b+I,N=c[F],Z=c[F+3],j=c[z],et=c[z+3];c[d+I]=N<j?N:j,c[d+I+3]=Z>et?Z:et}return L}}}function Yr(r,t,e,n,i){let s,o,a,c,l,h;const u=1/e.direction.x,d=1/e.direction.y,f=1/e.direction.z,m=e.origin.x,_=e.origin.y,g=e.origin.z;let p=t[r],b=t[r+3],y=t[r+1],v=t[r+3+1],x=t[r+2],S=t[r+3+2];return u>=0?(s=(p-m)*u,o=(b-m)*u):(s=(b-m)*u,o=(p-m)*u),d>=0?(a=(y-_)*d,c=(v-_)*d):(a=(v-_)*d,c=(y-_)*d),s>c||a>o||((a>s||isNaN(s))&&(s=a),(c<o||isNaN(o))&&(o=c),f>=0?(l=(x-g)*f,h=(S-g)*f):(l=(S-g)*f,h=(x-g)*f),s>h||l>o)?!1:((l>s||s!==s)&&(s=l),(h<o||o!==o)&&(o=h),s<=i&&o>=n)}function Q2(r,t,e,n,i,s,o,a){const{geometry:c,_indirectBuffer:l}=r;for(let h=n,u=n+i;h<u;h++){let d=l?l[h]:h;$d(c,t,e,d,s,o,a)}}function $2(r,t,e,n,i,s,o){const{geometry:a,_indirectBuffer:c}=r;let l=1/0,h=null;for(let u=n,d=n+i;u<d;u++){let f;f=$d(a,t,e,c?c[u]:u,null,s,o),f&&f.distance<l&&(h=f,l=f.distance)}return h}function J2(r,t,e,n,i,s,o){const{geometry:a}=e,{index:c}=a,l=a.attributes.position;for(let h=r,u=t+r;h<u;h++){let d;if(d=e.resolveTriangleIndex(h),nn(o,d*3,c,l),o.needsUpdate=!0,n(o,d,i,s))return!0}return!1}function tL(r,t,e,n,i,s,o){Re.setBuffer(r._roots[t]),$m(0,r,e,n,i,s,o),Re.clearBuffer()}function $m(r,t,e,n,i,s,o){const{float32Array:a,uint16Array:c,uint32Array:l}=Re,h=r*2;if(Zn(h,c)){const d=fi(r,l),f=Ii(h,c);Y2(t,e,n,d,f,i,s,o)}else{const d=Oi(r);Yr(d,a,n,s,o)&&$m(d,t,e,n,i,s,o);const f=Fi(r,l);Yr(f,a,n,s,o)&&$m(f,t,e,n,i,s,o)}}const eL=["x","y","z"];function nL(r,t,e,n,i,s){Re.setBuffer(r._roots[t]);const o=Jm(0,r,e,n,i,s);return Re.clearBuffer(),o}function Jm(r,t,e,n,i,s){const{float32Array:o,uint16Array:a,uint32Array:c}=Re;let l=r*2;if(Zn(l,a)){const u=fi(r,c),d=Ii(l,a);return q2(t,e,n,u,d,i,s)}else{const u=Rw(r,c),d=eL[u],m=n.direction[d]>=0;let _,g;m?(_=Oi(r),g=Fi(r,c)):(_=Fi(r,c),g=Oi(r));const b=Yr(_,o,n,i,s)?Jm(_,t,e,n,i,s):null;if(b){const x=b.point[d];if(m?x<=o[g+u]:x>=o[g+u+3])return b}const v=Yr(g,o,n,i,s)?Jm(g,t,e,n,i,s):null;return b&&v?b.distance<=v.distance?b:v:b||v||null}}const du=new xe,Sa=new ss,Ma=new ss,al=new lt,Cy=new jn,fu=new jn;function iL(r,t,e,n){Re.setBuffer(r._roots[t]);const i=tg(0,r,e,n);return Re.clearBuffer(),i}function tg(r,t,e,n,i=null){const{float32Array:s,uint16Array:o,uint32Array:a}=Re;let c=r*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),Cy.set(e.boundingBox.min,e.boundingBox.max,n),i=Cy),Zn(c,o)){const h=t.geometry,u=h.index,d=h.attributes.position,f=e.index,m=e.attributes.position,_=fi(r,a),g=Ii(c,o);if(al.copy(n).invert(),e.boundsTree)return He(r,s,fu),fu.matrix.copy(al),fu.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>fu.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let y=_*3,v=(g+_)*3;y<v;y+=3)if(nn(Ma,y,u,d),Ma.needsUpdate=!0,b.intersectsTriangle(Ma))return!0;return!1}});for(let p=_*3,b=(g+_)*3;p<b;p+=3){nn(Sa,p,u,d),Sa.a.applyMatrix4(al),Sa.b.applyMatrix4(al),Sa.c.applyMatrix4(al),Sa.needsUpdate=!0;for(let y=0,v=f.count;y<v;y+=3)if(nn(Ma,y,f,m),Ma.needsUpdate=!0,Sa.intersectsTriangle(Ma))return!0}}else{const h=r+8,u=a[r+6];return He(h,s,du),!!(i.intersectsBox(du)&&tg(h,t,e,n,i)||(He(u,s,du),i.intersectsBox(du)&&tg(u,t,e,n,i)))}}const pu=new lt,bp=new jn,cl=new jn,sL=new C,rL=new C,oL=new C,aL=new C;function cL(r,t,e,n={},i={},s=0,o=1/0){t.boundingBox||t.computeBoundingBox(),bp.set(t.boundingBox.min,t.boundingBox.max,e),bp.needsUpdate=!0;const a=r.geometry,c=a.attributes.position,l=a.index,h=t.attributes.position,u=t.index,d=ki.getPrimitive(),f=ki.getPrimitive();let m=sL,_=rL,g=null,p=null;i&&(g=oL,p=aL);let b=1/0,y=null,v=null;return pu.copy(e).invert(),cl.matrix.copy(pu),r.shapecast({boundsTraverseOrder:x=>bp.distanceToBox(x),intersectsBounds:(x,S,T)=>T<b&&T<o?(S&&(cl.min.copy(x.min),cl.max.copy(x.max),cl.needsUpdate=!0),!0):!1,intersectsRange:(x,S)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:E=>cl.distanceToBox(E),intersectsBounds:(E,w,M)=>M<b&&M<o,intersectsRange:(E,w)=>{for(let M=E,P=E+w;M<P;M++){nn(f,3*M,u,h),f.a.applyMatrix4(e),f.b.applyMatrix4(e),f.c.applyMatrix4(e),f.needsUpdate=!0;for(let L=x,I=x+S;L<I;L++){nn(d,3*L,l,c),d.needsUpdate=!0;const F=d.distanceToTriangle(f,m,g);if(F<b&&(_.copy(m),p&&p.copy(g),b=F,y=L,v=M),F<s)return!0}}}});{const T=kc(t);for(let E=0,w=T;E<w;E++){nn(f,3*E,u,h),f.a.applyMatrix4(e),f.b.applyMatrix4(e),f.c.applyMatrix4(e),f.needsUpdate=!0;for(let M=x,P=x+S;M<P;M++){nn(d,3*M,l,c),d.needsUpdate=!0;const L=d.distanceToTriangle(f,m,g);if(L<b&&(_.copy(m),p&&p.copy(g),b=L,y=M,v=E),L<s)return!0}}}}}),ki.releasePrimitive(d),ki.releasePrimitive(f),b===1/0?null:(n.point?n.point.copy(_):n.point=_.clone(),n.distance=b,n.faceIndex=y,i&&(i.point?i.point.copy(p):i.point=p.clone(),i.point.applyMatrix4(pu),_.applyMatrix4(pu),i.distance=_.sub(i.point).length(),i.faceIndex=v),n)}function lL(r,t=null){t&&Array.isArray(t)&&(t=new Set(t));const e=r.geometry,n=e.index?e.index.array:null,i=e.attributes.position;let s,o,a,c,l=0;const h=r._roots;for(let d=0,f=h.length;d<f;d++)s=h[d],o=new Uint32Array(s),a=new Uint16Array(s),c=new Float32Array(s),u(0,l),l+=s.byteLength;function u(d,f,m=!1){const _=d*2;if(a[_+15]===Qd){const p=o[d+6],b=a[_+14];let y=1/0,v=1/0,x=1/0,S=-1/0,T=-1/0,E=-1/0;for(let w=p,M=p+b;w<M;w++){const P=3*r.resolveTriangleIndex(w);for(let L=0;L<3;L++){let I=P+L;I=n?n[I]:I;const F=i.getX(I),z=i.getY(I),N=i.getZ(I);F<y&&(y=F),F>S&&(S=F),z<v&&(v=z),z>T&&(T=z),N<x&&(x=N),N>E&&(E=N)}}return c[d+0]!==y||c[d+1]!==v||c[d+2]!==x||c[d+3]!==S||c[d+4]!==T||c[d+5]!==E?(c[d+0]=y,c[d+1]=v,c[d+2]=x,c[d+3]=S,c[d+4]=T,c[d+5]=E,!0):!1}else{const p=d+8,b=o[d+6],y=p+f,v=b+f;let x=m,S=!1,T=!1;t?x||(S=t.has(y),T=t.has(v),x=!S&&!T):(S=!0,T=!0);const E=x||S,w=x||T;let M=!1;E&&(M=u(p,f,x));let P=!1;w&&(P=u(b,f,x));const L=M||P;if(L)for(let I=0;I<3;I++){const F=p+I,z=b+I,N=c[F],Z=c[F+3],j=c[z],et=c[z+3];c[d+I]=N<j?N:j,c[d+I+3]=Z>et?Z:et}return L}}}function hL(r,t,e,n,i,s,o){Re.setBuffer(r._roots[t]),eg(0,r,e,n,i,s,o),Re.clearBuffer()}function eg(r,t,e,n,i,s,o){const{float32Array:a,uint16Array:c,uint32Array:l}=Re,h=r*2;if(Zn(h,c)){const d=fi(r,l),f=Ii(h,c);Q2(t,e,n,d,f,i,s,o)}else{const d=Oi(r);Yr(d,a,n,s,o)&&eg(d,t,e,n,i,s,o);const f=Fi(r,l);Yr(f,a,n,s,o)&&eg(f,t,e,n,i,s,o)}}const uL=["x","y","z"];function dL(r,t,e,n,i,s){Re.setBuffer(r._roots[t]);const o=ng(0,r,e,n,i,s);return Re.clearBuffer(),o}function ng(r,t,e,n,i,s){const{float32Array:o,uint16Array:a,uint32Array:c}=Re;let l=r*2;if(Zn(l,a)){const u=fi(r,c),d=Ii(l,a);return $2(t,e,n,u,d,i,s)}else{const u=Rw(r,c),d=uL[u],m=n.direction[d]>=0;let _,g;m?(_=Oi(r),g=Fi(r,c)):(_=Fi(r,c),g=Oi(r));const b=Yr(_,o,n,i,s)?ng(_,t,e,n,i,s):null;if(b){const x=b.point[d];if(m?x<=o[g+u]:x>=o[g+u+3])return b}const v=Yr(g,o,n,i,s)?ng(g,t,e,n,i,s):null;return b&&v?b.distance<=v.distance?b:v:b||v||null}}const mu=new xe,Ta=new ss,Ea=new ss,ll=new lt,Py=new jn,gu=new jn;function fL(r,t,e,n){Re.setBuffer(r._roots[t]);const i=ig(0,r,e,n);return Re.clearBuffer(),i}function ig(r,t,e,n,i=null){const{float32Array:s,uint16Array:o,uint32Array:a}=Re;let c=r*2;if(i===null&&(e.boundingBox||e.computeBoundingBox(),Py.set(e.boundingBox.min,e.boundingBox.max,n),i=Py),Zn(c,o)){const h=t.geometry,u=h.index,d=h.attributes.position,f=e.index,m=e.attributes.position,_=fi(r,a),g=Ii(c,o);if(ll.copy(n).invert(),e.boundsTree)return He(r,s,gu),gu.matrix.copy(ll),gu.needsUpdate=!0,e.boundsTree.shapecast({intersectsBounds:b=>gu.intersectsBox(b),intersectsTriangle:b=>{b.a.applyMatrix4(n),b.b.applyMatrix4(n),b.c.applyMatrix4(n),b.needsUpdate=!0;for(let y=_,v=g+_;y<v;y++)if(nn(Ea,3*t.resolveTriangleIndex(y),u,d),Ea.needsUpdate=!0,b.intersectsTriangle(Ea))return!0;return!1}});for(let p=_,b=g+_;p<b;p++){const y=t.resolveTriangleIndex(p);nn(Ta,3*y,u,d),Ta.a.applyMatrix4(ll),Ta.b.applyMatrix4(ll),Ta.c.applyMatrix4(ll),Ta.needsUpdate=!0;for(let v=0,x=f.count;v<x;v+=3)if(nn(Ea,v,f,m),Ea.needsUpdate=!0,Ta.intersectsTriangle(Ea))return!0}}else{const h=r+8,u=a[r+6];return He(h,s,mu),!!(i.intersectsBox(mu)&&ig(h,t,e,n,i)||(He(u,s,mu),i.intersectsBox(mu)&&ig(u,t,e,n,i)))}}const _u=new lt,yp=new jn,hl=new jn,pL=new C,mL=new C,gL=new C,_L=new C;function bL(r,t,e,n={},i={},s=0,o=1/0){t.boundingBox||t.computeBoundingBox(),yp.set(t.boundingBox.min,t.boundingBox.max,e),yp.needsUpdate=!0;const a=r.geometry,c=a.attributes.position,l=a.index,h=t.attributes.position,u=t.index,d=ki.getPrimitive(),f=ki.getPrimitive();let m=pL,_=mL,g=null,p=null;i&&(g=gL,p=_L);let b=1/0,y=null,v=null;return _u.copy(e).invert(),hl.matrix.copy(_u),r.shapecast({boundsTraverseOrder:x=>yp.distanceToBox(x),intersectsBounds:(x,S,T)=>T<b&&T<o?(S&&(hl.min.copy(x.min),hl.max.copy(x.max),hl.needsUpdate=!0),!0):!1,intersectsRange:(x,S)=>{if(t.boundsTree){const T=t.boundsTree;return T.shapecast({boundsTraverseOrder:E=>hl.distanceToBox(E),intersectsBounds:(E,w,M)=>M<b&&M<o,intersectsRange:(E,w)=>{for(let M=E,P=E+w;M<P;M++){const L=T.resolveTriangleIndex(M);nn(f,3*L,u,h),f.a.applyMatrix4(e),f.b.applyMatrix4(e),f.c.applyMatrix4(e),f.needsUpdate=!0;for(let I=x,F=x+S;I<F;I++){const z=r.resolveTriangleIndex(I);nn(d,3*z,l,c),d.needsUpdate=!0;const N=d.distanceToTriangle(f,m,g);if(N<b&&(_.copy(m),p&&p.copy(g),b=N,y=I,v=M),N<s)return!0}}}})}else{const T=kc(t);for(let E=0,w=T;E<w;E++){nn(f,3*E,u,h),f.a.applyMatrix4(e),f.b.applyMatrix4(e),f.c.applyMatrix4(e),f.needsUpdate=!0;for(let M=x,P=x+S;M<P;M++){const L=r.resolveTriangleIndex(M);nn(d,3*L,l,c),d.needsUpdate=!0;const I=d.distanceToTriangle(f,m,g);if(I<b&&(_.copy(m),p&&p.copy(g),b=I,y=M,v=E),I<s)return!0}}}}}),ki.releasePrimitive(d),ki.releasePrimitive(f),b===1/0?null:(n.point?n.point.copy(_):n.point=_.clone(),n.distance=b,n.faceIndex=y,i&&(i.point?i.point.copy(p):i.point=p.clone(),i.point.applyMatrix4(_u),_.applyMatrix4(_u),i.distance=_.sub(i.point).length(),i.faceIndex=v),n)}function yL(){return typeof SharedArrayBuffer<"u"}const Rl=new Re.constructor,vd=new Re.constructor,Dr=new m0(()=>new xe),Aa=new xe,Ca=new xe,vp=new xe,xp=new xe;let wp=!1;function vL(r,t,e,n){if(wp)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");wp=!0;const i=r._roots,s=t._roots;let o,a=0,c=0;const l=new lt().copy(e).invert();for(let h=0,u=i.length;h<u;h++){Rl.setBuffer(i[h]),c=0;const d=Dr.getPrimitive();He(0,Rl.float32Array,d),d.applyMatrix4(l);for(let f=0,m=s.length;f<m&&(vd.setBuffer(s[f]),o=qi(0,0,e,l,n,a,c,0,0,d),vd.clearBuffer(),c+=s[f].length,!o);f++);if(Dr.releasePrimitive(d),Rl.clearBuffer(),a+=i[h].length,o)break}return wp=!1,o}function qi(r,t,e,n,i,s=0,o=0,a=0,c=0,l=null,h=!1){let u,d;h?(u=vd,d=Rl):(u=Rl,d=vd);const f=u.float32Array,m=u.uint32Array,_=u.uint16Array,g=d.float32Array,p=d.uint32Array,b=d.uint16Array,y=r*2,v=t*2,x=Zn(y,_),S=Zn(v,b);let T=!1;if(S&&x)h?T=i(fi(t,p),Ii(t*2,b),fi(r,m),Ii(r*2,_),c,o+t,a,s+r):T=i(fi(r,m),Ii(r*2,_),fi(t,p),Ii(t*2,b),a,s+r,c,o+t);else if(S){const E=Dr.getPrimitive();He(t,g,E),E.applyMatrix4(e);const w=Oi(r),M=Fi(r,m);He(w,f,Aa),He(M,f,Ca);const P=E.intersectsBox(Aa),L=E.intersectsBox(Ca);T=P&&qi(t,w,n,e,i,o,s,c,a+1,E,!h)||L&&qi(t,M,n,e,i,o,s,c,a+1,E,!h),Dr.releasePrimitive(E)}else{const E=Oi(t),w=Fi(t,p);He(E,g,vp),He(w,g,xp);const M=l.intersectsBox(vp),P=l.intersectsBox(xp);if(M&&P)T=qi(r,E,e,n,i,s,o,a,c+1,l,h)||qi(r,w,e,n,i,s,o,a,c+1,l,h);else if(M)if(x)T=qi(r,E,e,n,i,s,o,a,c+1,l,h);else{const L=Dr.getPrimitive();L.copy(vp).applyMatrix4(e);const I=Oi(r),F=Fi(r,m);He(I,f,Aa),He(F,f,Ca);const z=L.intersectsBox(Aa),N=L.intersectsBox(Ca);T=z&&qi(E,I,n,e,i,o,s,c,a+1,L,!h)||N&&qi(E,F,n,e,i,o,s,c,a+1,L,!h),Dr.releasePrimitive(L)}else if(P)if(x)T=qi(r,w,e,n,i,s,o,a,c+1,l,h);else{const L=Dr.getPrimitive();L.copy(xp).applyMatrix4(e);const I=Oi(r),F=Fi(r,m);He(I,f,Aa),He(F,f,Ca);const z=L.intersectsBox(Aa),N=L.intersectsBox(Ca);T=z&&qi(w,I,n,e,i,o,s,c,a+1,L,!h)||N&&qi(w,F,n,e,i,o,s,c,a+1,L,!h),Dr.releasePrimitive(L)}}return T}const bu=new jn,Ry=new xe,xL={strategy:Aw,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class g0{static serialize(t,e={}){e={cloneBuffers:!0,...e};const n=t.geometry,i=t._roots,s=t._indirectBuffer,o=n.getIndex();let a;return e.cloneBuffers?a={roots:i.map(c=>c.slice()),index:o?o.array.slice():null,indirectBuffer:s?s.slice():null}:a={roots:i,index:o?o.array:null,indirectBuffer:s},a}static deserialize(t,e,n={}){n={setIndex:!0,indirect:!!t.indirectBuffer,...n};const{index:i,roots:s,indirectBuffer:o}=t,a=new g0(e,{...n,[fp]:!0});if(a._roots=s,a._indirectBuffer=o||null,n.setIndex){const c=e.getIndex();if(c===null){const l=new Pe(t.index,1,!1);e.setIndex(l)}else c.array!==i&&(c.array.set(i),c.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({...xL,[fp]:!1},e),e.useSharedArrayBuffer&&!yL())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[fp]||(k2(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new xe))),this.resolveTriangleIndex=e.indirect?n=>this._indirectBuffer[n]:n=>n}refit(t=null){return(this.indirect?lL:Z2)(this,t)}traverse(t,e=0){const n=this._roots[e],i=new Uint32Array(n),s=new Uint16Array(n);o(0);function o(a,c=0){const l=a*2,h=s[l+15]===Qd;if(h){const u=i[a+6],d=s[l+14];t(c,h,new Float32Array(n,a*4,6),u,d)}else{const u=a+Pl/4,d=i[a+6],f=i[a+7];t(c,h,new Float32Array(n,a*4,6),f)||(o(u,c+1),o(d,c+1))}}}raycast(t,e=Bi,n=0,i=1/0){const s=this._roots,o=this.geometry,a=[],c=e.isMaterial,l=Array.isArray(e),h=o.groups,u=c?e.side:e,d=this.indirect?hL:tL;for(let f=0,m=s.length;f<m;f++){const _=l?e[h[f].materialIndex].side:u,g=a.length;if(d(this,f,_,t,a,n,i),l){const p=h[f].materialIndex;for(let b=g,y=a.length;b<y;b++)a[b].face.materialIndex=p}}return a}raycastFirst(t,e=Bi,n=0,i=1/0){const s=this._roots,o=this.geometry,a=e.isMaterial,c=Array.isArray(e);let l=null;const h=o.groups,u=a?e.side:e,d=this.indirect?dL:nL;for(let f=0,m=s.length;f<m;f++){const _=c?e[h[f].materialIndex].side:u,g=d(this,f,_,t,n,i);g!=null&&(l==null||g.distance<l.distance)&&(l=g,c&&(g.face.materialIndex=h[f].materialIndex))}return l}intersectsGeometry(t,e){let n=!1;const i=this._roots,s=this.indirect?fL:iL;for(let o=0,a=i.length;o<a&&(n=s(this,o,t,e),!n);o++);return n}shapecast(t){const e=ki.getPrimitive(),n=this.indirect?J2:K2;let{boundsTraverseOrder:i,intersectsBounds:s,intersectsRange:o,intersectsTriangle:a}=t;if(o&&a){const u=o;o=(d,f,m,_,g)=>u(d,f,m,_,g)?!0:n(d,f,this,a,m,_,e)}else o||(a?o=(u,d,f,m)=>n(u,d,this,a,f,m,e):o=(u,d,f)=>f);let c=!1,l=0;const h=this._roots;for(let u=0,d=h.length;u<d;u++){const f=h[u];if(c=H2(this,u,s,o,i,l),c)break;l+=f.byteLength}return ki.releasePrimitive(e),c}bvhcast(t,e,n){let{intersectsRanges:i,intersectsTriangles:s}=n;const o=ki.getPrimitive(),a=this.geometry.index,c=this.geometry.attributes.position,l=this.indirect?m=>{const _=this.resolveTriangleIndex(m);nn(o,_*3,a,c)}:m=>{nn(o,m*3,a,c)},h=ki.getPrimitive(),u=t.geometry.index,d=t.geometry.attributes.position,f=t.indirect?m=>{const _=t.resolveTriangleIndex(m);nn(h,_*3,u,d)}:m=>{nn(h,m*3,u,d)};if(s){const m=(_,g,p,b,y,v,x,S)=>{for(let T=p,E=p+b;T<E;T++){f(T),h.a.applyMatrix4(e),h.b.applyMatrix4(e),h.c.applyMatrix4(e),h.needsUpdate=!0;for(let w=_,M=_+g;w<M;w++)if(l(w),o.needsUpdate=!0,s(o,h,w,T,y,v,x,S))return!0}return!1};if(i){const _=i;i=function(g,p,b,y,v,x,S,T){return _(g,p,b,y,v,x,S,T)?!0:m(g,p,b,y,v,x,S,T)}}else i=m}return vL(this,t,e,i)}intersectsBox(t,e){return bu.set(t.min,t.max,e),bu.needsUpdate=!0,this.shapecast({intersectsBounds:n=>bu.intersectsBox(n),intersectsTriangle:n=>bu.intersectsTriangle(n)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,n={},i={},s=0,o=1/0){return(this.indirect?bL:cL)(this,t,e,n,i,s,o)}closestPointToPoint(t,e={},n=0,i=1/0){return G2(this,t,e,n,i)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(n=>{He(0,new Float32Array(n),Ry),t.union(Ry)}),t}}function Dy(r,t,e){return r===null?null:(r.point.applyMatrix4(t.matrixWorld),r.distance=r.point.distanceTo(e.ray.origin),r.object=t,r)}const yu=new Ko,Ly=new C,Iy=new lt,wL=ct.prototype.raycast,SL=sD.prototype.raycast,Oy=new C,pn=new ct,vu=[];function ML(r,t){this.isBatchedMesh?TL.call(this,r,t):EL.call(this,r,t)}function TL(r,t){if(this.boundsTrees){const e=this.boundsTrees,n=this._drawInfo||this._instanceInfo,i=this._drawRanges||this._geometryInfo,s=this.matrixWorld;pn.material=this.material,pn.geometry=this.geometry;const o=pn.geometry.boundsTree,a=pn.geometry.drawRange;pn.geometry.boundingSphere===null&&(pn.geometry.boundingSphere=new An);for(let c=0,l=n.length;c<l;c++){if(!this.getVisibleAt(c))continue;const h=n[c].geometryIndex;if(pn.geometry.boundsTree=e[h],this.getMatrixAt(c,pn.matrixWorld).premultiply(s),!pn.geometry.boundsTree){this.getBoundingBoxAt(h,pn.geometry.boundingBox),this.getBoundingSphereAt(h,pn.geometry.boundingSphere);const u=i[h];pn.geometry.setDrawRange(u.start,u.count)}pn.raycast(r,vu);for(let u=0,d=vu.length;u<d;u++){const f=vu[u];f.object=this,f.batchId=c,t.push(f)}vu.length=0}pn.geometry.boundsTree=o,pn.geometry.drawRange=a,pn.material=null,pn.geometry=null}else SL.call(this,r,t)}function EL(r,t){if(this.geometry.boundsTree){if(this.material===void 0)return;Iy.copy(this.matrixWorld).invert(),yu.copy(r.ray).applyMatrix4(Iy),Oy.setFromMatrixScale(this.matrixWorld),Ly.copy(yu.direction).multiply(Oy);const e=Ly.length(),n=r.near/e,i=r.far/e,s=this.geometry.boundsTree;if(r.firstHitOnly===!0){const o=Dy(s.raycastFirst(yu,this.material,n,i),this,r);o&&t.push(o)}else{const o=s.raycast(yu,this.material,n,i);for(let a=0,c=o.length;a<c;a++){const l=Dy(o[a],this,r);l&&t.push(l)}}}else wL.call(this,r,t)}function AL(r={}){return this.boundsTree=new g0(this,r),this.boundsTree}function CL(){this.boundsTree=null}const Fy=Math.PI*.5;new lt;new J;const Pa=new C;new Me;const _0=new rn(45,1,.1,1e4);_0.name="Camera";_0.position.set(0,15,20);_0.lookAt(new C);const ky=r=>{for(const t of Object.keys(r)){const e=r[t];e&&typeof e=="object"&&typeof e.dispose=="function"&&e.dispose()}r.dispose()},Iw=r=>{r.traverse(t=>{if(t instanceof ct)if(t.geometry.dispose(),Array.isArray(t.material))for(const e of t.material)ky(e);else ky(t.material)})},PL=r=>{const t=[];return r.traverse(e=>{if(e instanceof ct){const n=e.material;Array.isArray(n)?t.push(...n):t.push(n)}}),t},RL=new C,Ny=new J;function Ow(r,t,e,n){const i=RL.setFromMatrixPosition(r.matrixWorld),s=i.clone();s.project(t),Ny.set(s.x,s.y),e.setFromCamera(Ny,t);const o=e.intersectObjects(n,!0);if(o.length){const a=o[0].distance,c=i.distanceTo(e.ray.origin),l=a-c;return Number(l.toFixed(6))>=0}return!0}const DL=r=>{let t=r;for(;t;){if(!t.visible)return!1;t=t.parent}return!0},sg=(r,t)=>{const e=PL(r);for(let n=0,i=e.length;n<i;n++){const s=e[n];s instanceof Gr&&(s.envMap===null||s.userData.useSceneEnv)&&(s.envMap=t.environment,s.envMapRotation.copy(t.environmentRotation),s.userData.useSceneEnv=!0)}},Fw=(r,t,e)=>{const n=r.getBoundingClientRect();return[(t-n.left)/n.width,(e-n.top)/n.height]};class LL{constructor(t){A(this,"render");A(this,"canvas");A(this,"scene");A(this,"raycaster");A(this,"pointer");A(this,"interaction");A(this,"intersections");A(this,"lastHovered");A(this,"lastPointerDown");A(this,"captured");A(this,"lastClickTarget");A(this,"lastClickTimeStamp");A(this,"onAddObject",t=>{const{child:e}=t;e.traverse(n=>{this.interaction.push(n),n.addEventListener("childadded",this.onAddObject),n.addEventListener("childremoved",this.onRemoveObject)})});A(this,"onRemoveObject",t=>{const{child:e}=t;e.traverse(n=>{this.interaction=this.interaction.filter(i=>i!==n),n.removeEventListener("childadded",this.onAddObject),n.removeEventListener("childremoved",this.onRemoveObject)})});A(this,"onWheel",t=>{const e=this.intersect(t);e&&this.triggerWheelEvent(t,e)});A(this,"onPointerDown",t=>{if(t.pointerType!=="mouse")this.onPointerMove(t);else{const i=this.intersect(t);this.intersections[t.pointerId]=i}const e=this.intersections[t.pointerId],n=(e==null?void 0:e.object)??this.scene;this.triggerEvent("pointerdown",t,n),this.lastPointerDown[t.pointerId]=n});A(this,"onPointerMove",t=>{const e=this.intersect(t);this.intersections[t.pointerId]=e;const n=this.captured[t.pointerId];if(n){this.triggerEvent("pointermove",t,n);return}const i=(e==null?void 0:e.object)??this.scene,s=this.lastHovered[t.pointerId];i!==s&&(this.lastHovered[t.pointerId]=i,this.triggerEvent("pointerout",t,s),this.triggerEvent("pointerleave",t,s),this.triggerEvent("pointerover",t,i),this.triggerEvent("pointerenter",t,i)),this.triggerEvent("pointermove",t,i)});A(this,"onPointerUp",t=>{const e=this.lastPointerDown[t.pointerId],n=this.intersections[t.pointerId];let i=(n==null?void 0:n.object)??this.scene;const s=this.captured[t.pointerId];s&&(i=s),t.pointerType!=="mouse"&&(this.triggerEvent("pointerout",t,i),this.triggerEvent("pointerleave",t,i)),this.triggerEvent("pointerup",t,i),i===e&&(this.isLeftClick(t)?(this.triggerEvent("click",t,i),i===this.lastClickTarget&&t.timeStamp-this.lastClickTimeStamp<=300?(this.triggerEvent("dblclick",t,i),this.lastClickTimeStamp=0):(this.lastClickTarget=i,this.lastClickTimeStamp=t.timeStamp)):this.isRightClick(t)&&this.triggerEvent("contextmenu",t,i)),s&&(delete this.captured[t.pointerId],t.target.releasePointerCapture(t.pointerId))});A(this,"onPointerLeave",()=>{});A(this,"onPointerCancel",t=>{this.captured[t.pointerId]&&(delete this.captured[t.pointerId],t.target.releasePointerCapture(t.pointerId))});A(this,"onPointerLost",t=>{this.captured[t.pointerId]&&(delete this.captured[t.pointerId],t.target.releasePointerCapture(t.pointerId))});this.render=t,this.canvas=t.container,this.scene=t.scene,this.intersections={},this.lastHovered={},this.lastPointerDown={},this.captured={},this.lastClickTimeStamp=0,this.raycaster=new to,this.pointer=new J,this.interaction=[];const e={passive:!0};this.canvas.addEventListener("wheel",this.onWheel,e),this.canvas.addEventListener("pointerdown",this.onPointerDown,e),this.canvas.addEventListener("pointerup",this.onPointerUp,e),this.canvas.addEventListener("pointermove",this.onPointerMove,e),this.canvas.addEventListener("pointerleave",this.onPointerLeave,e),this.canvas.addEventListener("pointercancel",this.onPointerUp,e),this.canvas.addEventListener("lostpointercapture",this.onPointerLost,e),this.scene.addEventListener("childadded",this.onAddObject),this.scene.addEventListener("childremoved",this.onRemoveObject)}get camera(){return this.render.camera}intersect(t){const{clientX:e,clientY:n}=t,[i,s]=Fw(this.canvas,e,n);this.pointer.set(i*2-1,-s*2+1),this.camera&&this.raycaster.setFromCamera(this.pointer,this.camera);const o=this.raycaster.intersectObjects(this.interaction,!1);for(let a=0,c=o.length;a<c;a++){const l=o[a];if(DL(l.object))return l}}triggerEvent(t,e,n){const i=this.intersections[e.pointerId];let s=n;const o={type:t,...i,target:n,nativeEvent:e,pointer:this.pointer,stopped:!1,stopPropagation:()=>{o.stopped=!0},setPointerCapture:a=>{this.captured[a]=o.target,e.target.setPointerCapture(a)},releasePointerCapture:a=>{delete this.captured[a],e.target.releasePointerCapture(a)},hasPointerCapture:a=>!!this.captured[a]};for(;s&&!o.stopped;)s.dispatchEvent(o),s=s.parent}triggerWheelEvent(t,e){let i=(e==null?void 0:e.object)??this.scene;const s={type:"wheel",...e,nativeEvent:t,pointer:this.pointer,stopped:!1,stopPropagation:()=>{s.stopped=!0},setPointerCapture:()=>{},releasePointerCapture:()=>{},hasPointerCapture:()=>{}};for(;i&&!s.stopped;)i.dispatchEvent(s),i=i.parent}isLeftClick(t){const{isPrimary:e,pointerType:n,button:i}=t;return e&&(n==="mouse"&&i===0||n!=="mouse")}isRightClick(t){const{isPrimary:e,pointerType:n,button:i}=t;return e&&n==="mouse"&&i===2}}var Dl=function(){var r=0,t=document.createElement("div");t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",function(h){h.preventDefault(),n(++r%t.children.length)},!1);function e(h){return t.appendChild(h.dom),h}function n(h){for(var u=0;u<t.children.length;u++)t.children[u].style.display=u===h?"block":"none";r=h}var i=(performance||Date).now(),s=i,o=0,a=e(new Dl.Panel("FPS","#0ff","#002")),c=e(new Dl.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var l=e(new Dl.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:t,addPanel:e,showPanel:n,begin:function(){i=(performance||Date).now()},end:function(){o++;var h=(performance||Date).now();if(c.update(h-i,200),h>=s+1e3&&(a.update(o*1e3/(h-s),100),s=h,o=0,l)){var u=performance.memory;l.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return h},update:function(){i=this.end()},domElement:t,setMode:n}};Dl.Panel=function(r,t,e){var n=1/0,i=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,c=48*o,l=3*o,h=2*o,u=3*o,d=15*o,f=74*o,m=30*o,_=document.createElement("canvas");_.width=a,_.height=c,_.style.cssText="width:80px;height:48px";var g=_.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=e,g.fillRect(0,0,a,c),g.fillStyle=t,g.fillText(r,l,h),g.fillRect(u,d,f,m),g.fillStyle=e,g.globalAlpha=.9,g.fillRect(u,d,f,m),{dom:_,update:function(p,b){n=Math.min(n,p),i=Math.max(i,p),g.fillStyle=e,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=t,g.fillText(s(p)+" "+r+" ("+s(n)+"-"+s(i)+")",l,h),g.drawImage(_,u+o,d,f-o,m,u,d,f-o,m),g.fillRect(u+f-o,d,o,m),g.fillStyle=e,g.globalAlpha=.9,g.fillRect(u+f-o,d,o,s((1-p/b)*m))}}};class IL{constructor(t){A(this,"render");A(this,"stats");A(this,"enable");this.render=t,this.enable=!1,this.stats=new Dl,this.stats.dom.style.position="absolute",this.stats.dom.style.left="0",this.stats.dom.style.top="0",this.stats.dom.style.display="none",this.render.root.appendChild(this.stats.dom)}setEnable(t){this.enable=t,this.stats.dom.style.display=t?"block":"none"}update(){this.enable&&this.stats.update()}dispose(){this.render.root.removeChild(this.stats.dom)}}Qt.prototype.computeBoundsTree=AL;Qt.prototype.disposeBoundsTree=CL;ct.prototype.raycast=ML;class OL{constructor(t){A(this,"root");A(this,"container");A(this,"renderer");A(this,"scene");A(this,"renderer2d");A(this,"renderer3d");A(this,"eventManager");A(this,"debugManager");A(this,"raycaster");A(this,"fog");A(this,"camera");this.root=t,this.container=document.createElement("div"),this.container.style.position="relative",this.container.style.height="100%",this.container.className="render-3d",this.root.appendChild(this.container),ne.enabled=!0,this.renderer=new hw({alpha:!0,antialias:!0,powerPreference:"high-performance",logarithmicDepthBuffer:!0}),this.renderer.setClearColor("#202932"),this.renderer.outputColorSpace=On,this.renderer.toneMapping=Fx,this.renderer.toneMappingExposure=1,this.renderer.shadowMap.enabled=!1,this.renderer.shadowMap.type=Ox,this.renderer.setPixelRatio(window.devicePixelRatio),this.container.appendChild(this.renderer.domElement),this.renderer3d=new b2,this.renderer3d.domElement.style.position="absolute",this.renderer3d.domElement.style.top="0px",this.renderer3d.domElement.style.pointerEvents="none",this.container.appendChild(this.renderer3d.domElement),this.renderer2d=new p2,this.renderer2d.domElement.style.position="absolute",this.renderer2d.domElement.style.top="0px",this.renderer2d.domElement.style.pointerEvents="none",this.container.appendChild(this.renderer2d.domElement),this.scene=new xc,this.scene.name="Scene",this.raycaster=new to,this.fog=new t0("#cccccc",10,50),this.eventManager=new LL(this),this.debugManager=new IL(this)}get canvas(){return this.renderer.domElement}render(t){this.camera=t,this.debugManager.update(),this.renderer.render(this.scene,t),this.renderer3d.render(this.scene,t),this.renderer2d.render(this.scene,t)}resize(){const{clientWidth:t,clientHeight:e}=this.container;this.renderer.setSize(t,e),this.renderer3d.setSize(t,e),this.renderer2d.setSize(t,e)}dispose(){this.debugManager.dispose(),Iw(this.scene),this.renderer.dispose(),this.container.removeChild(this.renderer.domElement),this.container.removeChild(this.renderer3d.domElement),this.container.removeChild(this.renderer2d.domElement)}addObject(t){this.scene.add(t)}removeObject(t){this.scene.remove(t)}}const FL=new C(0,0,1);class Oz{constructor(t,e){A(this,"render");A(this,"dom");A(this,"grid");A(this,"camera");A(this,"mouse");A(this,"raycaster");A(this,"plane");A(this,"normal");A(this,"position");A(this,"updateMouse",t=>{const{clientX:e,clientY:n}=t,[i,s]=Fw(this.dom,e,n);this.mouse.set(i*2-1,-(s*2)+1)});A(this,"onMouseMove",t=>{this.updateMouse(t);const e=this.getObjects();this.raycaster.setFromCamera(this.mouse,this.camera);const n=this.raycaster.intersectObjects(e,!1);if(n.length){const i=n[0];this.normal.copy(i.normal);const s=new Gt().getNormalMatrix(i.object.matrixWorld);this.normal.applyMatrix3(s),this.position.copy(i.point)}else this.normal.set(0,1,0),this.position.set(0,0,0);this.normal.normalize(),this.plane.setFromNormalAndCoplanarPoint(this.normal,this.position),this.raycaster.ray.intersectPlane(this.plane,this.position),this.grid.position.copy(this.position),this.grid.quaternion.setFromUnitVectors(FL,this.normal),this.grid.rotateX(-Math.PI*.5)});this.render=t,this.camera=e,this.raycaster=new to,this.plane=new kn,this.normal=new C,this.position=new C,this.grid=new qm(4,4),this.grid.visible=!1,this.dom=this.render.container,this.mouse=new J}dispose(){Iw(this.grid)}show(){this.grid.visible=!0,this.dom.addEventListener("pointermove",this.onMouseMove,!1)}hide(){this.grid.visible=!1,this.dom.removeEventListener("pointermove",this.onMouseMove)}getObjects(){const{scene:t}=this.render,e=[];return t.traverseVisible(n=>e.push(n)),e}}class kL{constructor(t,e){A(this,"enabled");A(this,"dom");A(this,"camera");A(this,"minPolarAngle");A(this,"maxPolarAngle");A(this,"pointerSpeed");A(this,"velocity");A(this,"direction");A(this,"rotation");A(this,"forward");A(this,"left");A(this,"backward");A(this,"right");A(this,"moveSpeed");A(this,"onPointerDown",()=>{this.dom.addEventListener("pointermove",this.onPointerMove),this.dom.addEventListener("pointerup",this.onPointerUp)});A(this,"onPointerMove",t=>{if(!this.enabled)return;const{movementX:e,movementY:n}=t;this.rotation.setFromQuaternion(this.camera.quaternion),this.rotation.y-=e*.002*this.pointerSpeed,this.rotation.x-=n*.002*this.pointerSpeed,this.rotation.x=Math.max(Fy-this.maxPolarAngle,Math.min(Fy-this.minPolarAngle,this.rotation.x)),this.camera.quaternion.setFromEuler(this.rotation)});A(this,"onPointerUp",()=>{this.dom.removeEventListener("pointermove",this.onPointerMove),this.dom.removeEventListener("pointerup",this.onPointerUp)});A(this,"onKeyDown",t=>{switch(t.code){case"ArrowUp":case"KeyW":this.forward=!0;break;case"ArrowLeft":case"KeyA":this.left=!0;break;case"ArrowDown":case"KeyS":this.backward=!0;break;case"ArrowRight":case"KeyD":this.right=!0;break}});A(this,"onKeyUp",t=>{switch(t.code){case"ArrowUp":case"KeyW":this.forward=!1;break;case"ArrowLeft":case"KeyA":this.left=!1;break;case"ArrowDown":case"KeyS":this.backward=!1;break;case"ArrowRight":case"KeyD":this.right=!1;break}});this.enabled=!1,this.camera=t,this.dom=e,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.moveSpeed=100,this.velocity=new C,this.direction=new C,this.rotation=new Me(0,0,0,"YXZ"),this.forward=!1,this.left=!1,this.backward=!1,this.right=!1,this.dom.addEventListener("pointerdown",this.onPointerDown),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.onKeyUp)}update(t){this.enabled&&(this.velocity.x=0,this.velocity.z=0,this.direction.z=Number(this.forward)-Number(this.backward),this.direction.x=Number(this.right)-Number(this.left),this.direction.normalize(),(this.forward||this.backward)&&(this.velocity.z=-this.direction.z*this.moveSpeed*t),(this.left||this.right)&&(this.velocity.x=-this.direction.x*this.moveSpeed*t),this.moveRight(-this.velocity.x*t),this.moveForward(-this.velocity.z*t))}moveForward(t){Pa.setFromMatrixColumn(this.camera.matrix,0),Pa.crossVectors(this.camera.up,Pa),this.camera.position.addScaledVector(Pa,t)}moveRight(t){Pa.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(Pa,t)}dispose(){this.dom.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp)}}class NL extends g2{constructor(e,n){super(n);A(this,"render");A(this,"container");A(this,"factor");A(this,"domVisible");A(this,"enabled");n.className="dom-3d",this.render=e,this.factor=10,this.domVisible=!0,this.enabled=!1,this.container=document.createElement("div"),this.container.style.pointerEvents="none",n.appendChild(this.container)}get camera(){return this.render.camera}get raycaster(){return this.render.raycaster}start(){this.container.style.pointerEvents="auto"}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!this.camera||!this.enabled)return;const n=this.domVisible;this.domVisible=Ow(this,this.camera,this.raycaster,this.render.scene.children),n!==this.domVisible&&(this.container.style.display=this.domVisible?"block":"none")}setVisible(e){this.domVisible=e,this.container.style.display=e?"block":"none"}setSize(e,n){this.container.style.width=`${e*this.factor}px`,this.container.style.height=`${n*this.factor}px`}}class UL extends f2{constructor(e,n){super(n);A(this,"render");A(this,"container");A(this,"factor");A(this,"domVisible");A(this,"enabled");n.className="dom-2d",n.style.pointerEvents="auto",this.render=e,this.factor=1,this.domVisible=!0,this.enabled=!1,this.container=document.createElement("div"),this.container.style.pointerEvents="none",n.appendChild(this.container)}get camera(){return this.render.camera}get raycaster(){return this.render.raycaster}start(){this.container.style.pointerEvents="auto"}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!this.camera||!this.enabled)return;const n=this.domVisible;this.domVisible=Ow(this,this.camera,this.raycaster,this.render.scene.children),n!==this.domVisible&&(this.container.style.display=this.domVisible?"block":"none")}setVisible(e){this.domVisible=e,this.container.style.display=e?"block":"none"}setSize(e,n){this.container.style.width=`${e*this.factor}px`,this.container.style.height=`${n*this.factor}px`}}function U(r,t,e){return(t=function(n){var i=function(s,o){if(typeof s!="object"||!s)return s;var a=s[Symbol.toPrimitive];if(a!==void 0){var c=a.call(s,o);if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}(n,"string");return typeof i=="symbol"?i:i+""}(t))in r?Object.defineProperty(r,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):r[t]=e,r}function Uy(r,t){var e=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),e.push.apply(e,n)}return e}function B(r){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?Uy(Object(e),!0).forEach(function(n){U(r,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(e)):Uy(Object(e)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(e,n))})}return r}function Oe(r,t){if(r==null)return{};var e,n,i=function(o,a){if(o==null)return{};var c={};for(var l in o)if({}.hasOwnProperty.call(o,l)){if(a.indexOf(l)>=0)continue;c[l]=o[l]}return c}(r,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);for(n=0;n<s.length;n++)e=s[n],t.indexOf(e)>=0||{}.propertyIsEnumerable.call(r,e)&&(i[e]=r[e])}return i}function eo(r,t){return t||(t=r.slice(0)),Object.freeze(Object.defineProperties(r,{raw:{value:Object.freeze(t)}}))}class By{constructor(){U(this,"browserShadowBlurConstant",1),U(this,"DPI",96),U(this,"devicePixelRatio",typeof window<"u"?window.devicePixelRatio:1),U(this,"perfLimitSizeTotal",2097152),U(this,"maxCacheSideLimit",4096),U(this,"minCacheSideLimit",256),U(this,"disableStyleCopyPaste",!1),U(this,"enableGLFiltering",!0),U(this,"textureSize",4096),U(this,"forceGLPutImageData",!1),U(this,"cachesBoundsOfCurve",!1),U(this,"fontPaths",{}),U(this,"NUM_FRACTION_DIGITS",4)}}const he=new class extends By{constructor(r){super(),this.configure(r)}configure(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,r)}addFonts(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=B(B({},this.fontPaths),r)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(r=>{delete this.fontPaths[r]})}clearFonts(){this.fontPaths={}}restoreDefaults(r){const t=new By,e=(r==null?void 0:r.reduce((n,i)=>(n[i]=t[i],n),{}))||t;this.configure(e)}},qr=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return console[r]("fabric",...e)};class gs extends Error{constructor(t,e){super("fabric: ".concat(t),e)}}class BL extends gs{constructor(t){super("".concat(t," 'options.signal' is in 'aborted' state"))}}class zL{}class VL extends zL{testPrecision(t,e){const n="precision ".concat(e,` float;
void main(){}`),i=t.createShader(t.FRAGMENT_SHADER);return!!i&&(t.shaderSource(i,n),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS))}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(n=>this.testPrecision(e,n)),e.getExtension("WEBGL_lose_context").loseContext(),qr("log","WebGL: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const HL={};let zy;const Ss=()=>zy||(zy={document,window,isTouchSupported:"ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,WebGLProbe:new VL,dispose(){},copyPasteData:HL}),Nc=()=>Ss().document,b0=()=>Ss().window,kw=()=>{var r;return Math.max((r=he.devicePixelRatio)!==null&&r!==void 0?r:b0().devicePixelRatio,1)},Ll=new class{constructor(){U(this,"charWidthsCache",{}),U(this,"boundsOfCurveCache",{})}getFontCache(r){let{fontFamily:t,fontStyle:e,fontWeight:n}=r;t=t.toLowerCase(),this.charWidthsCache[t]||(this.charWidthsCache[t]={});const i=this.charWidthsCache[t],s="".concat(e.toLowerCase(),"_").concat((n+"").toLowerCase());return i[s]||(i[s]={}),i[s]}clearFontCache(r){(r=(r||"").toLowerCase())?this.charWidthsCache[r]&&delete this.charWidthsCache[r]:this.charWidthsCache={}}limitDimsByArea(r){const{perfLimitSizeTotal:t}=he,e=Math.sqrt(t*r);return[Math.floor(e),Math.floor(t/e)]}},rg="6.6.1";function od(){}const dh=Math.PI/2,xd=2*Math.PI,y0=Math.PI/180,Gn=Object.freeze([1,0,0,1,0,0]),v0=16,Mr=.4477152502,Zt="center",pe="left",Qn="top",og="bottom",qe="right",$n="none",x0=/\r?\n/,Nw="moving",Jd="scaling",Uw="rotating",w0="rotate",Bw="skewing",Wl="resizing",GL="modifyPoly",jL="modifyPath",wd="changed",tf="scale",si="scaleX",zi="scaleY",Uc="skewX",Bc="skewY",on="fill",Jn="stroke",Sd="modified",Ra="json",Sp="svg",wt=new class{constructor(){this[Ra]=new Map,this[Sp]=new Map}has(r){return this[Ra].has(r)}getClass(r){const t=this[Ra].get(r);if(!t)throw new gs("No class registered for ".concat(r));return t}setClass(r,t){t?this[Ra].set(t,r):(this[Ra].set(r.type,r),this[Ra].set(r.type.toLowerCase(),r))}getSVGClass(r){return this[Sp].get(r)}setSVGClass(r,t){this[Sp].set(t??r.type.toLowerCase(),r)}},Md=new class extends Array{remove(r){const t=this.indexOf(r);t>-1&&this.splice(t,1)}cancelAll(){const r=this.splice(0);return r.forEach(t=>t.abort()),r}cancelByCanvas(r){if(!r)return[];const t=this.filter(e=>{var n;return e.target===r||typeof e.target=="object"&&((n=e.target)===null||n===void 0?void 0:n.canvas)===r});return t.forEach(e=>e.abort()),t}cancelByTarget(r){if(!r)return[];const t=this.filter(e=>e.target===r);return t.forEach(e=>e.abort()),t}};class WL{constructor(){U(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),typeof t=="object")return Object.entries(t).forEach(n=>{let[i,s]=n;this.on(i,s)}),()=>this.off(t);if(e){const n=t;return this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(e),()=>this.off(n,e)}return()=>!1}once(t,e){if(typeof t=="object"){const n=[];return Object.entries(t).forEach(i=>{let[s,o]=i;n.push(this.once(s,o))}),()=>n.forEach(i=>i())}if(e){const n=this.on(t,function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];e.call(this,...s),n()});return n}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const n=this.__eventListeners[t],i=n.indexOf(e);i>-1&&n.splice(i,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(t===void 0)for(const n in this.__eventListeners)this._removeEventListener(n);else typeof t=="object"?Object.entries(t).forEach(n=>{let[i,s]=n;this._removeEventListener(i,s)}):this._removeEventListener(t,e)}fire(t,e){var n;if(!this.__eventListeners)return;const i=(n=this.__eventListeners[t])===null||n===void 0?void 0:n.concat();if(i)for(let s=0;s<i.length;s++)i[s].call(this,e||{})}}const Ua=(r,t)=>{const e=r.indexOf(t);return e!==-1&&r.splice(e,1),r},cr=r=>{if(r===0)return 1;switch(Math.abs(r)/dh){case 1:case 3:return 0;case 2:return-1}return Math.cos(r)},lr=r=>{if(r===0)return 0;const t=r/dh,e=Math.sign(r);switch(t){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(r)};class Y{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new Y(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new Y(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new Y(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new Y(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new Y(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new Y(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new Y(this.x/t.x,this.y/t.y)}scalarDivide(t){return new Y(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new Y(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}midPointFrom(t){return this.lerp(t)}min(t){return new Y(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new Y(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,n=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=n}clone(){return new Y(this.x,this.y)}rotate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:S0;const n=lr(t),i=cr(t),s=this.subtract(e);return new Y(s.x*i-s.y*n,s.x*n+s.y*i).add(e)}transform(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Y(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const S0=new Y(0,0),ad=r=>!!r&&Array.isArray(r._objects);function zw(r){class t extends r{constructor(){super(...arguments),U(this,"_objects",[])}_onObjectAdded(n){}_onObjectRemoved(n){}_onStackOrderChanged(n){}add(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];const o=this._objects.push(...i);return i.forEach(a=>this._onObjectAdded(a)),o}insertAt(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return this._objects.splice(n,0,...s),s.forEach(a=>this._onObjectAdded(a)),this._objects.length}remove(){const n=this._objects,i=[];for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return o.forEach(c=>{const l=n.indexOf(c);l!==-1&&(n.splice(l,1),i.push(c),this._onObjectRemoved(c))}),i}forEachObject(n){this.getObjects().forEach((i,s,o)=>n(i,s,o))}getObjects(){for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return i.length===0?[...this._objects]:this._objects.filter(o=>o.isType(...i))}item(n){return this._objects[n]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(n,i){return!!this._objects.includes(n)||!!i&&this._objects.some(s=>s instanceof t&&s.contains(n,!0))}complexity(){return this._objects.reduce((n,i)=>n+=i.complexity?i.complexity():0,0)}sendObjectToBack(n){return!(!n||n===this._objects[0])&&(Ua(this._objects,n),this._objects.unshift(n),this._onStackOrderChanged(n),!0)}bringObjectToFront(n){return!(!n||n===this._objects[this._objects.length-1])&&(Ua(this._objects,n),this._objects.push(n),this._onStackOrderChanged(n),!0)}sendObjectBackwards(n,i){if(!n)return!1;const s=this._objects.indexOf(n);if(s!==0){const o=this.findNewLowerIndex(n,s,i);return Ua(this._objects,n),this._objects.splice(o,0,n),this._onStackOrderChanged(n),!0}return!1}bringObjectForward(n,i){if(!n)return!1;const s=this._objects.indexOf(n);if(s!==this._objects.length-1){const o=this.findNewUpperIndex(n,s,i);return Ua(this._objects,n),this._objects.splice(o,0,n),this._onStackOrderChanged(n),!0}return!1}moveObjectTo(n,i){return n!==this._objects[i]&&(Ua(this._objects,n),this._objects.splice(i,0,n),this._onStackOrderChanged(n),!0)}findNewLowerIndex(n,i,s){let o;if(s){o=i;for(let a=i-1;a>=0;--a)if(n.isOverlapping(this._objects[a])){o=a;break}}else o=i-1;return o}findNewUpperIndex(n,i,s){let o;if(s){o=i;for(let a=i+1;a<this._objects.length;++a)if(n.isOverlapping(this._objects[a])){o=a;break}}else o=i+1;return o}collectObjects(n){let{left:i,top:s,width:o,height:a}=n,{includeIntersecting:c=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=[],h=new Y(i,s),u=h.add(new Y(o,a));for(let d=this._objects.length-1;d>=0;d--){const f=this._objects[d];f.selectable&&f.visible&&(c&&f.intersectsWithRect(h,u)||f.isContainedWithinRect(h,u)||c&&f.containsPoint(h)||c&&f.containsPoint(u))&&l.push(f)}return l}}return t}class Vw extends WL{_setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return typeof t=="object"?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return typeof e=="boolean"&&this.set(t,!e),this}get(t){return this[t]}}function cd(r){return b0().requestAnimationFrame(r)}function XL(r){return b0().cancelAnimationFrame(r)}let YL=0;const Kr=()=>YL++,rs=()=>{const r=Nc().createElement("canvas");if(!r||r.getContext===void 0)throw new gs("Failed to create `canvas` element");return r},qL=()=>Nc().createElement("img"),Ms=r=>{const t=rs();return t.width=r.width,t.height=r.height,t},Hw=(r,t,e)=>r.toDataURL("image/".concat(t),e),Gw=(r,t,e)=>new Promise((n,i)=>{r.toBlob(n,"image/".concat(t),e)}),Ze=r=>r*y0,jo=r=>r/y0,KL=r=>r.every((t,e)=>t===Gn[e]),Kn=(r,t,e)=>new Y(r).transform(t,e),ts=r=>{const t=1/(r[0]*r[3]-r[1]*r[2]),e=[t*r[3],-t*r[1],-t*r[2],t*r[0],0,0],{x:n,y:i}=new Y(r[4],r[5]).transform(e,!0);return e[4]=-n,e[5]=-i,e},mn=(r,t,e)=>[r[0]*t[0]+r[2]*t[1],r[1]*t[0]+r[3]*t[1],r[0]*t[2]+r[2]*t[3],r[1]*t[2]+r[3]*t[3],e?0:r[0]*t[4]+r[2]*t[5]+r[4],e?0:r[1]*t[4]+r[3]*t[5]+r[5]],M0=(r,t)=>r.reduceRight((e,n)=>n&&e?mn(n,e,t):n||e,void 0)||Gn.concat(),jw=r=>{let[t,e]=r;return Math.atan2(e,t)},Td=r=>{const t=jw(r),e=Math.pow(r[0],2)+Math.pow(r[1],2),n=Math.sqrt(e),i=(r[0]*r[3]-r[2]*r[1])/n,s=Math.atan2(r[0]*r[2]+r[1]*r[3],e);return{angle:jo(t),scaleX:n,scaleY:i,skewX:jo(s),skewY:0,translateX:r[4]||0,translateY:r[5]||0}},fh=function(r){return[1,0,0,1,r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:0]};function ph(){let{angle:r=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:t=0,y:e=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=Ze(r),i=cr(n),s=lr(n);return[i,s,-s,i,t?t-(i*t-s*e):0,e?e-(s*t+i*e):0]}const T0=function(r){return[r,0,0,arguments.length>1&&arguments[1]!==void 0?arguments[1]:r,0,0]},Ww=r=>Math.tan(Ze(r)),Xw=r=>[1,0,Ww(r),1,0,0],Yw=r=>[1,Ww(r),0,1,0,0],ef=r=>{let{scaleX:t=1,scaleY:e=1,flipX:n=!1,flipY:i=!1,skewX:s=0,skewY:o=0}=r,a=T0(n?-t:t,i?-e:e);return s&&(a=mn(a,Xw(s),!0)),o&&(a=mn(a,Yw(o),!0)),a},ZL=r=>{const{translateX:t=0,translateY:e=0,angle:n=0}=r;let i=fh(t,e);n&&(i=mn(i,ph({angle:n})));const s=ef(r);return KL(s)||(i=mn(i,s)),i},ld=function(r){let{signal:t,crossOrigin:e=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(n,i){if(t&&t.aborted)return i(new BL("loadImage"));const s=qL();let o;t&&(o=function(c){s.src="",i(c)},t.addEventListener("abort",o,{once:!0}));const a=function(){s.onload=s.onerror=null,o&&(t==null||t.removeEventListener("abort",o)),n(s)};r?(s.onload=a,s.onerror=function(){o&&(t==null||t.removeEventListener("abort",o)),i(new gs("Error loading ".concat(s.src)))},e&&(s.crossOrigin=e),s.src=r):a()})},Xl=function(r){let{signal:t,reviver:e=od}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((n,i)=>{const s=[];t&&t.addEventListener("abort",i,{once:!0}),Promise.all(r.map(o=>wt.getClass(o.type).fromObject(o,{signal:t}).then(a=>(e(o,a),s.push(a),a)))).then(n).catch(o=>{s.forEach(a=>{a.dispose&&a.dispose()}),i(o)}).finally(()=>{t&&t.removeEventListener("abort",i)})})},nf=function(r){let{signal:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((e,n)=>{const i=[];t&&t.addEventListener("abort",n,{once:!0});const s=Object.values(r).map(a=>a&&a.type&&wt.has(a.type)?Xl([a],{signal:t}).then(c=>{let[l]=c;return i.push(l),l}):a),o=Object.keys(r);Promise.all(s).then(a=>a.reduce((c,l,h)=>(c[o[h]]=l,c),{})).then(e).catch(a=>{i.forEach(c=>{c.dispose&&c.dispose()}),n(a)}).finally(()=>{t&&t.removeEventListener("abort",n)})})},zc=function(r){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((t,e)=>(e in r&&(t[e]=r[e]),t),{})},E0=(r,t)=>Object.keys(r).reduce((e,n)=>(t(r[n],n,r)&&(e[n]=r[n]),e),{}),Vy={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},Mp=(r,t,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+6*(t-r)*e:e<.5?t:e<2/3?r+(t-r)*(2/3-e)*6:r),Hy=(r,t,e,n)=>{r/=255,t/=255,e/=255;const i=Math.max(r,t,e),s=Math.min(r,t,e);let o,a;const c=(i+s)/2;if(i===s)o=a=0;else{const l=i-s;switch(a=c>.5?l/(2-i-s):l/(i+s),i){case r:o=(t-e)/l+(t<e?6:0);break;case t:o=(e-r)/l+2;break;case e:o=(r-t)/l+4}o/=6}return[Math.round(360*o),Math.round(100*a),Math.round(100*c),n]},Gy=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(r)/(r.endsWith("%")?100:1)},xu=r=>Math.min(Math.round(r),255).toString(16).toUpperCase().padStart(2,"0"),jy=r=>{let[t,e,n,i=1]=r;const s=Math.round(.3*t+.59*e+.11*n);return[s,s,s,i]};class ge{constructor(t){if(U(this,"isUnrecognised",!1),t)if(t instanceof ge)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,n,i,s=1]=t;this.setSource([e,n,i,s])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return(t=t.toLowerCase())in Vy&&(t=Vy[t]),t==="transparent"?[255,255,255,0]:ge.sourceFromHex(t)||ge.sourceFromRgb(t)||ge.sourceFromHsl(t)||(this.isUnrecognised=!0)&&[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,n]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(n,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,n]=Hy(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(n,"%)")}toHsla(){const[t,e,n,i]=Hy(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(n,"%,").concat(i,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,n,i]=this.getSource();return"".concat(xu(t)).concat(xu(e)).concat(xu(n)).concat(xu(Math.round(255*i)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(jy(this.getSource())),this}toBlackWhite(t){const[e,,,n]=jy(this.getSource()),i=e<(t||127)?0:255;return this.setSource([i,i,i,n]),this}overlayWith(t){t instanceof ge||(t=new ge(t));const e=this.getSource(),n=t.getSource(),[i,s,o]=e.map((a,c)=>Math.round(.5*a+.5*n[c]));return this.setSource([i,s,o,e[3]]),this}static fromRgb(t){return ge.fromRgba(t)}static fromRgba(t){return new ge(ge.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){const[n,i,s]=e.slice(1,4).map(o=>{const a=parseFloat(o);return o.endsWith("%")?Math.round(2.55*a):a});return[n,i,s,Gy(e[4])]}}static fromHsl(t){return ge.fromHsla(t)}static fromHsla(t){return new ge(ge.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(/^hsla?\(\s*([+-]?\d{0,3}(?:\.\d+)?(?:deg|turn|rad)?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(!e)return;const n=(ge.parseAngletoDegrees(e[1])%360+360)%360/360,i=parseFloat(e[2])/100,s=parseFloat(e[3])/100;let o,a,c;if(i===0)o=a=c=s;else{const l=s<=.5?s*(i+1):s+i-s*i,h=2*s-l;o=Mp(h,l,n+1/3),a=Mp(h,l,n),c=Mp(h,l,n-1/3)}return[Math.round(255*o),Math.round(255*a),Math.round(255*c),Gy(e[4])]}static fromHex(t){return new ge(ge.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){const e=t.slice(t.indexOf("#")+1);let n;n=e.length<=4?e.split("").map(c=>c+c):e.match(/.{2}/g);const[i,s,o,a=255]=n.map(c=>parseInt(c,16));return[i,s,o,a/255]}}static parseAngletoDegrees(t){const e=t.toLowerCase(),n=parseFloat(e);return e.includes("rad")?jo(n):e.includes("turn")?360*n:n}}const Ue=(r,t)=>parseFloat(Number(r).toFixed(t)),ic=function(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:v0;const e=/\D{0,2}$/.exec(r),n=parseFloat(r),i=he.DPI;switch(e==null?void 0:e[0]){case"mm":return n*i/25.4;case"cm":return n*i/2.54;case"in":return n*i;case"pt":return n*i/72;case"pc":return n*i/72*12;case"em":return n*t;default:return n}},QL=r=>{const[t,e]=r.trim().split(" "),[n,i]=(s=t)&&s!==$n?[s.slice(1,4),s.slice(5,8)]:s===$n?[s,s]:["Mid","Mid"];var s;return{meetOrSlice:e||"meet",alignX:n,alignY:i}},Ed=r=>"matrix("+r.map(t=>Ue(t,he.NUM_FRACTION_DIGITS)).join(" ")+")",Yl=function(r,t){let e,n,i=!(arguments.length>2&&arguments[2]!==void 0)||arguments[2];if(t)if(t.toLive)e="url(#SVGID_".concat(t.id,")");else{const s=new ge(t),o=s.getAlpha();e=s.toRgb(),o!==1&&(n=o.toString())}else e="none";return i?"".concat(r,": ").concat(e,"; ").concat(n?"".concat(r,"-opacity: ").concat(n,"; "):""):"".concat(r,'="').concat(e,'" ').concat(n?"".concat(r,'-opacity="').concat(n,'" '):"")},Ri=r=>!!r&&r.toLive!==void 0,Wy=r=>!!r&&typeof r.toObject=="function",Xy=r=>!!r&&r.offsetX!==void 0&&"source"in r,To=r=>!!r&&"multiSelectionStacking"in r;function qw(r){const t=r&&$i(r);let e=0,n=0;if(!r||!t)return{left:e,top:n};let i=r;const s=t.documentElement,o=t.body||{scrollLeft:0,scrollTop:0};for(;i&&(i.parentNode||i.host)&&(i=i.parentNode||i.host,i===t?(e=o.scrollLeft||s.scrollLeft||0,n=o.scrollTop||s.scrollTop||0):(e+=i.scrollLeft||0,n+=i.scrollTop||0),i.nodeType!==1||i.style.position!=="fixed"););return{left:e,top:n}}const $i=r=>r.ownerDocument||null,Kw=r=>{var t;return((t=r.ownerDocument)===null||t===void 0?void 0:t.defaultView)||null},Zw=function(r,t,e){let{width:n,height:i}=e,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;r.width=n,r.height=i,s>1&&(r.setAttribute("width",(n*s).toString()),r.setAttribute("height",(i*s).toString()),t.scale(s,s))},ag=(r,t)=>{let{width:e,height:n}=t;e&&(r.style.width=typeof e=="number"?"".concat(e,"px"):e),n&&(r.style.height=typeof n=="number"?"".concat(n,"px"):n)};function Yy(r){return r.onselectstart!==void 0&&(r.onselectstart=()=>!1),r.style.userSelect=$n,r}class Qw{constructor(t){U(this,"_originalCanvasStyle",void 0),U(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=(n=t)&&n.getContext!==void 0?t:t&&Nc().getElementById(t)||rs();var n;if(e.hasAttribute("data-fabric"))throw new gs("Trying to initialize a canvas that has already been initialized. Did you forget to dispose the canvas?");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:n}=t;const{el:i}=this.lower;i.classList.remove("lower-canvas"),i.removeAttribute("data-fabric"),i.setAttribute("width","".concat(e)),i.setAttribute("height","".concat(n)),i.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:n,ctx:i}=this.lower;Zw(n,i,t,e)}setCSSDimensions(t){ag(this.lower.el,t)}calcOffset(){return function(t){var e;const n=t&&$i(t),i={left:0,top:0};if(!n)return i;const s=((e=Kw(t))===null||e===void 0?void 0:e.getComputedStyle(t,null))||{};i.left+=parseInt(s.borderLeftWidth,10)||0,i.top+=parseInt(s.borderTopWidth,10)||0,i.left+=parseInt(s.paddingLeft,10)||0,i.top+=parseInt(s.paddingTop,10)||0;let o={left:0,top:0};const a=n.documentElement;t.getBoundingClientRect!==void 0&&(o=t.getBoundingClientRect());const c=qw(t);return{left:o.left+c.left-(a.clientLeft||0)+i.left,top:o.top+c.top-(a.clientTop||0)+i.top}}(this.lower.el)}dispose(){Ss().dispose(this.lower.el),delete this.lower}}const $L={backgroundVpt:!0,backgroundColor:"",overlayVpt:!0,overlayColor:"",includeDefaultValues:!0,svgViewportTransformation:!0,renderOnAddRemove:!0,skipOffscreen:!0,enableRetinaScaling:!0,imageSmoothingEnabled:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,viewportTransform:[...Gn]};class Wo extends zw(Vw){get lowerCanvasEl(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.el}get contextContainer(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.ctx}static getDefaults(){return Wo.ownDefaults}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.skipControlsDrawing=!1,this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new Qw(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const s=super.insertAt(t,...n);return n.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),s}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(qr("warn",`Canvas is trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}getRetinaScaling(){return this.enableRetinaScaling?kw():1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:n=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e){const i=B({width:this.width,height:this.height},t);this.elements.setDimensions(i,this.getRetinaScaling()),this.hasLostContext=!0,this.width=i.width,this.height=i.height}n||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t,e){this._setDimensionsImpl(t,e),e&&e.cssOnly||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){this.viewportTransform=t,this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const n=t,i=[...this.viewportTransform],s=Kn(t,ts(i));i[0]=e,i[3]=e;const o=Kn(s,i);i[4]+=n.x-o.x,i[5]+=n.y-o.y,this.setViewportTransform(i)}setZoom(t){this.zoomToPoint(new Y(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new Y(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=void 0,this.overlayImage=void 0,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=cd(()=>this.renderAndReset()))}calcViewportBoundaries(){const t=this.width,e=this.height,n=ts(this.viewportTransform),i=Kn({x:0,y:0},n),s=Kn({x:t,y:e},n),o=i.min(s),a=i.max(s);return this.vptCoords={tl:o,tr:new Y(a.x,o.y),bl:new Y(o.x,a.y),br:a}}cancelRequestedRender(){this.nextRenderHandle&&(XL(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const n=this.viewportTransform,i=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.skipControlsDrawing||this.drawControls(t),i&&(i._set("canvas",this),i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,i)),this._renderOverlay(t),this.controlsAboveOverlay&&!this.skipControlsDrawing&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const n=this.viewportTransform;t.save(),t.transform(...n),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let n=0,i=e.length;n<i;++n)e[n]&&e[n].render(t)}_renderBackgroundOrOverlay(t,e){const n=this["".concat(e,"Color")],i=this["".concat(e,"Image")],s=this.viewportTransform,o=this["".concat(e,"Vpt")];if(!n&&!i)return;const a=Ri(n);if(n){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=a?n.toLive(t):n,o&&t.transform(...s),a){t.transform(1,0,0,1,n.offsetX||0,n.offsetY||0);const c=n.gradientTransform||n.patternTransform;c&&t.transform(...c)}t.fill(),t.restore()}if(i){t.save();const{skipOffscreen:c}=this;this.skipOffscreen=o,o&&t.transform(...s),i.render(t),this.skipOffscreen=c,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new Y(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new Y(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new Y(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new Y(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new Y(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Kn(this.getCenterPoint(),ts(this.viewportTransform))}_centerObject(t,e){t.setXY(e,Zt,Zt),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const n=this.clipPath,i=n&&!n.excludeFromExport?this._toObject(n,t,e):null;return B(B(B({version:rg},zc(this,e)),{},{objects:this._objects.filter(s=>!s.excludeFromExport).map(s=>this._toObject(s,t,e))},this.__serializeBgOverlay(t,e)),i?{clipPath:i}:null)}_toObject(t,e,n){let i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);const s=t[e](n);return this.includeDefaultValues||(t.includeDefaultValues=!!i),s}__serializeBgOverlay(t,e){const n={},i=this.backgroundImage,s=this.overlayImage,o=this.backgroundColor,a=this.overlayColor;return Ri(o)?o.excludeFromExport||(n.background=o.toObject(e)):o&&(n.background=o),Ri(a)?a.excludeFromExport||(n.overlay=a.toObject(e)):a&&(n.overlay=a),i&&!i.excludeFromExport&&(n.backgroundImage=this._toObject(i,t,e)),s&&!s.excludeFromExport&&(n.overlayImage=this._toObject(s,t,e)),n}toSVG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const n=[];return this._setSVGPreamble(n,t),this._setSVGHeader(n,t),this.clipPath&&n.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(n,"background"),this._setSVGBgOverlayImage(n,"backgroundImage",e),this._setSVGObjects(n,e),this.clipPath&&n.push(`</g>
`),this._setSVGBgOverlayColor(n,"overlay"),this._setSVGBgOverlayImage(n,"overlayImage",e),n.push("</svg>"),n.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(t,e){const n=e.width||"".concat(this.width),i=e.height||"".concat(this.height),s=he.NUM_FRACTION_DIGITS,o=e.viewBox;let a;if(o)a='viewBox="'.concat(o.x," ").concat(o.y," ").concat(o.width," ").concat(o.height,'" ');else if(this.svgViewportTransformation){const c=this.viewportTransform;a='viewBox="'.concat(Ue(-c[4]/c[0],s)," ").concat(Ue(-c[5]/c[3],s)," ").concat(Ue(this.width/c[0],s)," ").concat(Ue(this.height/c[3],s),'" ')}else a='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',i,'" ',a,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",rg,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),`</defs>
`)}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(Kr()),'<clipPath id="'.concat(e.clipPathId,`" >
`).concat(e.toClipPathSVG(t.reviver),`</clipPath>
`)):""}createSVGRefElementsMarkup(){return["background","overlay"].map(t=>{const e=this["".concat(t,"Color")];if(Ri(e)){const n=this["".concat(t,"Vpt")],i=this.viewportTransform,s={isType:()=>!1,width:this.width/(n?i[0]:1),height:this.height/(n?i[3]:1)};return e.toSVG(s,{additionalTransform:n?Ed(i):""})}}).join("")}createSVGFontFacesMarkup(){const t=[],e={},n=he.fontPaths;this._objects.forEach(function s(o){t.push(o),ad(o)&&o._objects.forEach(s)}),t.forEach(s=>{if(!(o=s)||typeof o._renderText!="function")return;var o;const{styles:a,fontFamily:c}=s;!e[c]&&n[c]&&(e[c]=!0,a&&Object.values(a).forEach(l=>{Object.values(l).forEach(h=>{let{fontFamily:u=""}=h;!e[u]&&n[u]&&(e[u]=!0)})}))});const i=Object.keys(e).map(s=>`		@font-face {
			font-family: '`.concat(s,`';
			src: url('`).concat(n[s],`');
		}
`)).join("");return i?`	<style type="text/css"><![CDATA[
`.concat(i,`]]></style>
`):""}_setSVGObjects(t,e){this.forEachObject(n=>{n.excludeFromExport||this._setSVGObject(t,n,e)})}_setSVGObject(t,e,n){t.push(e.toSVG(n))}_setSVGBgOverlayImage(t,e,n){const i=this[e];i&&!i.excludeFromExport&&i.toSVG&&t.push(i.toSVG(n))}_setSVGBgOverlayColor(t,e){const n=this["".concat(e,"Color")];if(n)if(Ri(n)){const i=n.repeat||"",s=this.width,o=this.height,a=this["".concat(e,"Vpt")]?Ed(ts(this.viewportTransform)):"";t.push('<rect transform="'.concat(a," translate(").concat(s/2,",").concat(o/2,')" x="').concat(n.offsetX-s/2,'" y="').concat(n.offsetY-o/2,'" width="').concat(i!=="repeat-y"&&i!=="no-repeat"||!Xy(n)?s:n.source.width,'" height="').concat(i!=="repeat-x"&&i!=="no-repeat"||!Xy(n)?o:n.source.height,'" fill="url(#SVGID_').concat(n.id,`)"></rect>
`))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',n,'"',`></rect>
`)}loadFromJSON(t,e){let{signal:n}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!t)return Promise.reject(new gs("`json` is undefined"));const i=typeof t=="string"?JSON.parse(t):t,{objects:s=[],backgroundImage:o,background:a,overlayImage:c,overlay:l,clipPath:h}=i,u=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Xl(s,{reviver:e,signal:n}),nf({backgroundImage:o,backgroundColor:a,overlayImage:c,overlayColor:l,clipPath:h},{signal:n})]).then(d=>{let[f,m]=d;return this.clear(),this.add(...f),this.set(i),this.set(m),this.renderOnAddRemove=u,this})}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=Ms(this);return new this.constructor(t)}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:n=1,multiplier:i=1,enableRetinaScaling:s=!1}=t,o=i*(s?this.getRetinaScaling():1);return Hw(this.toCanvasElement(o,t),e,n)}toBlob(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:n=1,multiplier:i=1,enableRetinaScaling:s=!1}=t,o=i*(s?this.getRetinaScaling():1);return Gw(this.toCanvasElement(o,t),e,n)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:e,height:n,left:i,top:s,filter:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const a=(e||this.width)*t,c=(n||this.height)*t,l=this.getZoom(),h=this.width,u=this.height,d=this.skipControlsDrawing,f=l*t,m=this.viewportTransform,_=[f,0,0,f,(m[4]-(i||0))*t,(m[5]-(s||0))*t],g=this.enableRetinaScaling,p=Ms({width:a,height:c}),b=o?this._objects.filter(y=>o(y)):this._objects;return this.enableRetinaScaling=!1,this.viewportTransform=_,this.width=a,this.height=c,this.skipControlsDrawing=!0,this.calcViewportBoundaries(),this.renderCanvas(p.getContext("2d"),b),this.viewportTransform=m,this.width=h,this.height=u,this.calcViewportBoundaries(),this.enableRetinaScaling=g,this.skipControlsDrawing=d,p}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),Md.cancelByCanvas(this),this.disposed=!0,new Promise((t,e)=>{const n=()=>{this.destroy(),t(!0)};n.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=n:n()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(t=>t.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=void 0,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=void 0,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}U(Wo,"ownDefaults",$L);const JL=["touchstart","touchmove","touchend"],tI=r=>{const t=qw(r.target),e=function(n){const i=n.changedTouches;return i&&i[0]?i[0]:n}(r);return new Y(e.clientX+t.left,e.clientY+t.top)},cg=r=>JL.includes(r.type)||r.pointerType==="touch",lg=r=>{r.preventDefault(),r.stopPropagation()},nr=r=>{let t=0,e=0,n=0,i=0;for(let s=0,o=r.length;s<o;s++){const{x:a,y:c}=r[s];(a>n||!s)&&(n=a),(a<t||!s)&&(t=a),(c>i||!s)&&(i=c),(c<e||!s)&&(e=c)}return{left:t,top:e,width:n-t,height:i-e}},eI=["translateX","translateY","scaleX","scaleY"],nI=(r,t)=>Ad(r,mn(t,r.calcOwnMatrix())),Ad=(r,t)=>{const e=Td(t),{translateX:n,translateY:i,scaleX:s,scaleY:o}=e,a=Oe(e,eI),c=new Y(n,i);r.flipX=!1,r.flipY=!1,Object.assign(r,a),r.set({scaleX:s,scaleY:o}),r.setPositionByOrigin(c,Zt,Zt)},iI=r=>{r.scaleX=1,r.scaleY=1,r.skewX=0,r.skewY=0,r.flipX=!1,r.flipY=!1,r.rotate(0)},$w=r=>({scaleX:r.scaleX,scaleY:r.scaleY,skewX:r.skewX,skewY:r.skewY,angle:r.angle,left:r.left,flipX:r.flipX,flipY:r.flipY,top:r.top}),A0=(r,t,e)=>{const n=r/2,i=t/2,s=[new Y(-n,-i),new Y(n,-i),new Y(-n,i),new Y(n,i)].map(a=>a.transform(e)),o=nr(s);return new Y(o.width,o.height)},sf=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Gn;return mn(ts(arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gn),r)},sc=function(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gn,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Gn;return r.transform(sf(t,e))},sI=function(r){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gn,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Gn;return r.transform(sf(t,e),!0)},rI=(r,t,e)=>{const n=sf(t,e);return Ad(r,mn(n,r.calcOwnMatrix())),n},Jw=(r,t)=>{var e;const{transform:{target:n}}=t;(e=n.canvas)===null||e===void 0||e.fire("object:".concat(r),B(B({},t),{},{target:n})),n.fire(r,t)},oI={left:-.5,top:-.5,center:0,bottom:.5,right:.5},tn=r=>typeof r=="string"?oI[r]:r-.5,Cd="not-allowed";function tS(r){return tn(r.originX)===tn(Zt)&&tn(r.originY)===tn(Zt)}function qy(r){return .5-tn(r)}const ns=(r,t)=>r[t],eS=(r,t,e,n)=>({e:r,transform:t,pointer:new Y(e,n)});function nS(r,t){const e=r.getTotalAngle()+jo(Math.atan2(t.y,t.x))+360;return Math.round(e%360/45)}function C0(r,t,e,n,i){var s;let{target:o,corner:a}=r;const c=o.controls[a],l=((s=o.canvas)===null||s===void 0?void 0:s.getZoom())||1,h=o.padding/l,u=function(d,f,m,_){const g=d.getRelativeCenterPoint(),p=m!==void 0&&_!==void 0?d.translateToGivenOrigin(g,Zt,Zt,m,_):new Y(d.left,d.top);return(d.angle?f.rotate(-Ze(d.angle),g):f).subtract(p)}(o,new Y(n,i),t,e);return u.x>=h&&(u.x-=h),u.x<=-h&&(u.x+=h),u.y>=h&&(u.y-=h),u.y<=h&&(u.y+=h),u.x-=c.offsetX,u.y-=c.offsetY,u}const aI=(r,t,e,n)=>{const{target:i,offsetX:s,offsetY:o}=t,a=e-s,c=n-o,l=!ns(i,"lockMovementX")&&i.left!==a,h=!ns(i,"lockMovementY")&&i.top!==c;return l&&i.set(pe,a),h&&i.set(Qn,c),(l||h)&&Jw(Nw,eS(r,t,e,n)),l||h};class iS{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):$n,s=this.strokeDashOffset?this.strokeDashOffset:"0",o=this.strokeLineCap?this.strokeLineCap:"butt",a=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",l=this.opacity!==void 0?this.opacity:"1",h=this.visible?"":" visibility: hidden;",u=t?"":this.getSvgFilter(),d=Yl(on,this.fill);return[Yl(Jn,this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",o,"; ","stroke-dashoffset: ",s,"; ","stroke-linejoin: ",a,"; ","stroke-miterlimit: ",c,"; ",d,"fill-rule: ",e,"; ","opacity: ",l,";",u,h].join("")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=t?this.calcTransformMatrix():this.calcOwnMatrix(),i='transform="'.concat(Ed(n));return"".concat(i).concat(e,'" ')}_toSVG(t){return[""]}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:n=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),s=t.indexOf("COMMON_PARTS");return t[s]=i,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:n,withShadow:i,additionalTransform:s}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=e?"":'style="'.concat(this.getSvgStyles(),'" '),a=i?'style="'.concat(this.getSvgFilter(),'" '):"",c=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",h=c&&c.absolutePositioned,u=this.stroke,d=this.fill,f=this.shadow,m=[],_=t.indexOf("COMMON_PARTS");let g;c&&(c.clipPathId="CLIPPATH_".concat(Kr()),g='<clipPath id="'.concat(c.clipPathId,`" >
`).concat(c.toClipPathSVG(n),`</clipPath>
`)),h&&m.push("<g ",a,this.getSvgCommons(),` >
`),m.push("<g ",this.getSvgTransform(!1),h?"":a+this.getSvgCommons(),` >
`);const p=[o,l,e?"":this.addPaintOrder()," ",s?'transform="'.concat(s,'" '):""].join("");return t[_]=p,Ri(d)&&m.push(d.toSVG(this)),Ri(u)&&m.push(u.toSVG(this)),f&&m.push(f.toSVG(this)),c&&m.push(g),m.push(t.join("")),m.push(`</g>
`),h&&m.push(`</g>
`),n?n(m.join("")):m.join("")}addPaintOrder(){return this.paintFirst!==on?' paint-order="'.concat(this.paintFirst,'" '):""}}function rf(r){return new RegExp("^("+r.join("|")+")\\b","i")}var Ky;const Xo=String.raw(Ky||(Ky=eo(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"]))),cI=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+Xo+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+Xo+"))?\\s+(.*)"),lI={cx:pe,x:pe,r:"radius",cy:Qn,y:Qn,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},Tp="font-size",Ep="clip-path";rf(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]);rf(["symbol","image","marker","pattern","view","svg"]);const Zy=rf(["symbol","g","a","svg","clipPath","defs"]),hI=new Y(1,0),sS=new Y,rS=(r,t)=>r.rotate(t),hg=(r,t)=>new Y(t).subtract(r),ug=r=>r.distanceFrom(sS),dg=(r,t)=>Math.atan2(Il(r,t),dI(r,t)),uI=r=>dg(hI,r),P0=r=>r.eq(sS)?r:r.scalarDivide(ug(r)),oS=function(r){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return P0(new Y(-r.y,r.x).scalarMultiply(t?1:-1))},Il=(r,t)=>r.x*t.y-r.y*t.x,dI=(r,t)=>r.x*t.x+r.y*t.y,Qy=(r,t,e)=>{if(r.eq(t)||r.eq(e))return!0;const n=Il(t,e),i=Il(t,r),s=Il(e,r);return n>=0?i>=0&&s<=0:!(i<=0&&s>=0)},$y="(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?",Jy=new RegExp("(?:\\s|^)"+$y+$y+"("+Xo+"?(?:px)?)?(?:\\s?|$)(?:$|\\s)");class ir{constructor(t){const e=typeof t=="string"?ir.parseShadow(t):t;Object.assign(this,ir.ownDefaults,e),this.id=Kr()}static parseShadow(t){const e=t.trim(),[,n=0,i=0,s=0]=(Jy.exec(e)||[]).map(o=>parseFloat(o)||0);return{color:(e.replace(Jy,"")||"rgb(0,0,0)").trim(),offsetX:n,offsetY:i,blur:s}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=rS(new Y(this.offsetX,this.offsetY),Ze(-t.angle)),n=new ge(this.color);let i=40,s=40;return t.width&&t.height&&(i=100*Ue((Math.abs(e.x)+this.blur)/t.width,he.NUM_FRACTION_DIGITS)+20,s=100*Ue((Math.abs(e.y)+this.blur)/t.height,he.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(s,'%" height="').concat(100+2*s,'%" x="-').concat(i,'%" width="').concat(100+2*i,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(Ue(this.blur?this.blur/2:0,he.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(Ue(e.x,he.NUM_FRACTION_DIGITS),'" dy="').concat(Ue(e.y,he.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(n.toRgb(),'" flood-opacity="').concat(n.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling,type:this.constructor.type},e=ir.ownDefaults;return this.includeDefaultValues?t:E0(t,(n,i)=>n!==e[i])}static async fromObject(t){return new this(t)}}U(ir,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),U(ir,"type","shadow"),wt.setClass(ir,"shadow");const wc=(r,t,e)=>Math.max(r,Math.min(t,e)),fI=[Qn,pe,si,zi,"flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible",Uc,Bc],fr=[on,Jn,"strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],pI={top:0,left:0,width:0,height:0,angle:0,flipX:!1,flipY:!1,scaleX:1,scaleY:1,minScaleLimit:0,skewX:0,skewY:0,originX:pe,originY:Qn,strokeWidth:1,strokeUniform:!1,padding:0,opacity:1,paintFirst:on,fill:"rgb(0,0,0)",fillRule:"nonzero",stroke:null,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,globalCompositeOperation:"source-over",backgroundColor:"",shadow:null,visible:!0,includeDefaultValues:!0,excludeFromExport:!1,objectCaching:!0,clipPath:void 0,inverted:!1,absolutePositioned:!1,centeredRotation:!0,centeredScaling:!1,dirty:!0},mI=(r,t,e,n)=>-e*Math.cos(r/n*dh)+e+t,gI=()=>!1;class R0{constructor(t){let{startValue:e,byValue:n,duration:i=500,delay:s=0,easing:o=mI,onStart:a=od,onChange:c=od,onComplete:l=od,abort:h=gI,target:u}=t;U(this,"_state","pending"),U(this,"durationProgress",0),U(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=i,this.delay=s,this.easing=o,this._onStart=a,this._onChange=c,this._onComplete=l,this._abort=h,this.target=u,this.startValue=e,this.byValue=n,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const t=e=>{this._state==="pending"&&(this.startTime=e||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>cd(t),this.delay):cd(t)}tick(t){const e=(t||+new Date)-this.startTime,n=Math.min(e,this.duration);this.durationProgress=n/this.duration;const{value:i,valueProgress:s}=this.calculate(n);this.value=Object.freeze(i),this.valueProgress=s,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),cd(this.tick)))}register(){Md.push(this)}unregister(){Md.remove(this)}abort(){this._state="aborted",this.unregister()}}const _I=["startValue","endValue"];class bI extends R0{constructor(t){let{startValue:e=0,endValue:n=100}=t;super(B(B({},Oe(t,_I)),{},{startValue:e,byValue:n-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const yI=["startValue","endValue"];class vI extends R0{constructor(t){let{startValue:e=[0],endValue:n=[100]}=t;super(B(B({},Oe(t,yI)),{},{startValue:e,byValue:n.map((i,s)=>i-e[s])}))}calculate(t){const e=this.startValue.map((n,i)=>this.easing(t,n,this.byValue[i],this.duration,i));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const xI=["startValue","endValue","easing","onChange","onComplete","abort"],wI=(r,t,e,n)=>t+e*(1-Math.cos(r/n*dh)),Ap=r=>r&&((t,e,n)=>r(new ge(t).toRgba(),e,n));class SI extends R0{constructor(t){let{startValue:e,endValue:n,easing:i=wI,onChange:s,onComplete:o,abort:a}=t,c=Oe(t,xI);const l=new ge(e).getSource(),h=new ge(n).getSource();super(B(B({},c),{},{startValue:l,byValue:h.map((u,d)=>u-l[d]),easing:i,onChange:Ap(s),onComplete:Ap(o),abort:Ap(a)}))}calculate(t){const[e,n,i,s]=this.startValue.map((a,c)=>this.easing(t,a,this.byValue[c],this.duration,c)),o=[...[e,n,i].map(Math.round),wc(0,s,1)];return{value:o,valueProgress:o.map((a,c)=>this.byValue[c]!==0?Math.abs((a-this.startValue[c])/this.byValue[c]):0).find(a=>a!==0)||0}}}function aS(r){const t=(e=>Array.isArray(e.startValue)||Array.isArray(e.endValue))(r)?new vI(r):new bI(r);return t.start(),t}function MI(r){const t=new SI(r);return t.start(),t}class ke{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some(e=>e.eq(t))}append(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.points=this.points.concat(e.filter(i=>!this.includes(i))),this}static isPointContained(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0&&arguments[3];if(e.eq(n))return t.eq(e);if(e.x===n.x)return t.x===e.x&&(i||t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y));if(e.y===n.y)return t.y===e.y&&(i||t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x));{const s=hg(e,n),o=hg(e,t).divide(s);return i?Math.abs(o.x)===Math.abs(o.y):o.x===o.y&&o.x>=0&&o.x<=1}}static isPointInPolygon(t,e){const n=new Y(t).setX(Math.min(t.x-1,...e.map(s=>s.x)));let i=0;for(let s=0;s<e.length;s++){const o=this.intersectSegmentSegment(e[s],e[(s+1)%e.length],t,n);if(o.includes(t))return!0;i+=+(o.status==="Intersection")}return i%2==1}static intersectLineLine(t,e,n,i){let s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4],o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5];const a=e.x-t.x,c=e.y-t.y,l=i.x-n.x,h=i.y-n.y,u=t.x-n.x,d=t.y-n.y,f=l*d-h*u,m=a*d-c*u,_=h*a-l*c;if(_!==0){const g=f/_,p=m/_;return(s||0<=g&&g<=1)&&(o||0<=p&&p<=1)?new ke("Intersection").append(new Y(t.x+g*a,t.y+g*c)):new ke}if(f===0||m===0){const g=s||o||ke.isPointContained(t,n,i)||ke.isPointContained(e,n,i)||ke.isPointContained(n,t,e)||ke.isPointContained(i,t,e);return new ke(g?"Coincident":void 0)}return new ke("Parallel")}static intersectSegmentLine(t,e,n,i){return ke.intersectLineLine(t,e,n,i,!1,!0)}static intersectSegmentSegment(t,e,n,i){return ke.intersectLineLine(t,e,n,i,!1,!1)}static intersectLinePolygon(t,e,n){let i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];const s=new ke,o=n.length;for(let a,c,l,h=0;h<o;h++){if(a=n[h],c=n[(h+1)%o],l=ke.intersectLineLine(t,e,a,c,i,!1),l.status==="Coincident")return l;s.append(...l.points)}return s.points.length>0&&(s.status="Intersection"),s}static intersectSegmentPolygon(t,e,n){return ke.intersectLinePolygon(t,e,n,!1)}static intersectPolygonPolygon(t,e){const n=new ke,i=t.length,s=[];for(let o=0;o<i;o++){const a=t[o],c=t[(o+1)%i],l=ke.intersectSegmentPolygon(a,c,e);l.status==="Coincident"?(s.push(l),n.append(a,c)):n.append(...l.points)}return s.length>0&&s.length===t.length?new ke("Coincident"):(n.points.length>0&&(n.status="Intersection"),n)}static intersectPolygonRectangle(t,e,n){const i=e.min(n),s=e.max(n),o=new Y(s.x,i.y),a=new Y(i.x,s.y);return ke.intersectPolygonPolygon(t,[i,o,s,a])}}class TI extends Vw{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?Kn(t,this.group.calcTransformMatrix()):t}setXY(t,e,n){this.group&&(t=Kn(t,ts(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,n)}getRelativeXY(){return new Y(this.left,this.top)}setRelativeXY(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.originX,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.originY;this.setPositionByOrigin(t,e,n)}isStrokeAccountedForInDimensions(){return!1}getCoords(){const{tl:t,tr:e,br:n,bl:i}=this.aCoords||(this.aCoords=this.calcACoords()),s=[t,e,n,i];if(this.group){const o=this.group.calcTransformMatrix();return s.map(a=>Kn(a,o))}return s}intersectsWithRect(t,e){return ke.intersectPolygonRectangle(this.getCoords(),t,e).status==="Intersection"}intersectsWithObject(t){const e=ke.intersectPolygonPolygon(this.getCoords(),t.getCoords());return e.status==="Intersection"||e.status==="Coincident"||t.isContainedWithinObject(this)||this.isContainedWithinObject(t)}isContainedWithinObject(t){return this.getCoords().every(e=>t.containsPoint(e))}isContainedWithinRect(t,e){const{left:n,top:i,width:s,height:o}=this.getBoundingRect();return n>=t.x&&n+s<=e.x&&i>=t.y&&i+o<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t){return ke.isPointInPolygon(t,this.getCoords())}isOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return!!this.getCoords().some(n=>n.x<=e.x&&n.x>=t.x&&n.y<=e.y&&n.y>=t.y)||!!this.intersectsWithRect(t,e)||this.containsPoint(t.midPointFrom(e))}isPartiallyOnScreen(){if(!this.canvas)return!1;const{tl:t,br:e}=this.canvas.vptCoords;return this.intersectsWithRect(t,e)?!0:this.getCoords().every(n=>(n.x>=e.x||n.x<=t.x)&&(n.y>=e.y||n.y<=t.y))&&this.containsPoint(t.midPointFrom(e))}getBoundingRect(){return nr(this.getCoords())}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set(si,t),this._set(zi,t),this.setCoords()}scaleToWidth(t){const e=this.getBoundingRect().width/this.getScaledWidth();return this.scale(t/this.width/e)}scaleToHeight(t){const e=this.getBoundingRect().height/this.getScaledHeight();return this.scale(t/this.height/e)}getCanvasRetinaScaling(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?jo(jw(this.calcTransformMatrix())):this.angle}getViewportTransform(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.viewportTransform)||Gn.concat()}calcACoords(){const t=ph({angle:this.angle}),{x:e,y:n}=this.getRelativeCenterPoint(),i=fh(e,n),s=mn(i,t),o=this._getTransformedDimensions(),a=o.x/2,c=o.y/2;return{tl:Kn({x:-a,y:-c},s),tr:Kn({x:a,y:-c},s),bl:Kn({x:-a,y:c},s),br:Kn({x:a,y:c},s)}}setCoords(){this.aCoords=this.calcACoords()}transformMatrixKey(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=[];return!t&&this.group&&(e=this.group.transformMatrixKey(t)),e.push(this.top,this.left,this.width,this.height,this.scaleX,this.scaleY,this.angle,this.strokeWidth,this.skewX,this.skewY,+this.flipX,+this.flipY,tn(this.originX),tn(this.originY)),e}calcTransformMatrix(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;const n=this.transformMatrixKey(t),i=this.matrixCache;return i&&i.key.every((s,o)=>s===n[o])?i.value:(this.group&&(e=mn(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:n,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const n=this.getRelativeCenterPoint(),i={angle:this.angle,translateX:n.x,translateY:n.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},s=ZL(i);return this.ownMatrixCache={key:t,value:s},s}_getNonTransformedDimensions(){return new Y(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=B({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),n=e.strokeWidth;let i=n,s=0;this.strokeUniform&&(i=0,s=n);const o=e.width+i,a=e.height+i;let c;return c=e.skewX===0&&e.skewY===0?new Y(o*e.scaleX,a*e.scaleY):A0(o,a,ef(e)),c.scalarAdd(s)}translateToGivenOrigin(t,e,n,i,s){let o=t.x,a=t.y;const c=tn(i)-tn(e),l=tn(s)-tn(n);if(c||l){const h=this._getTransformedDimensions();o+=c*h.x,a+=l*h.y}return new Y(o,a)}translateToCenterPoint(t,e,n){if(e===Zt&&n===Zt)return t;const i=this.translateToGivenOrigin(t,e,n,Zt,Zt);return this.angle?i.rotate(Ze(this.angle),t):i}translateToOriginPoint(t,e,n){const i=this.translateToGivenOrigin(t,Zt,Zt,e,n);return this.angle?i.rotate(Ze(this.angle),t):i}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?Kn(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new Y(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,n){const i=this.translateToCenterPoint(t,e,n),s=this.translateToOriginPoint(i,this.originX,this.originY);this.set({left:s.x,top:s.y})}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),pe,Qn)}}const EI=["type"],AI=["extraParam"];let Vs=class hd extends TI{static getDefaults(){return hd.ownDefaults}get type(){const t=this.constructor.type;return t==="FabricObject"?"object":t.toLowerCase()}set type(t){qr("warn","Setting type has no effect",t)}constructor(t){super(),U(this,"_cacheContext",null),Object.assign(this,hd.ownDefaults),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=rs(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,n=t.height,i=he.maxCacheSideLimit,s=he.minCacheSideLimit;if(e<=i&&n<=i&&e*n<=he.perfLimitSizeTotal)return e<s&&(t.width=s),n<s&&(t.height=s),t;const o=e/n,[a,c]=Ll.limitDimsByArea(o),l=wc(s,a,i),h=wc(s,c,i);return e>l&&(t.zoomX/=e/l,t.width=l,t.capped=!0),n>h&&(t.zoomY/=n/h,t.height=h,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),n=e.x*t.x/this.scaleX,i=e.y*t.y/this.scaleY;return{width:Math.ceil(n+2),height:Math.ceil(i+2),zoomX:t.x,zoomY:t.y,x:n,y:i}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,{width:n,height:i,zoomX:s,zoomY:o,x:a,y:c}=this._limitCacheSize(this._getCacheCanvasDimensions()),l=n!==t.width||i!==t.height,h=this.zoomX!==s||this.zoomY!==o;if(!t||!e)return!1;if(l||h){n!==t.width||i!==t.height?(t.width=n,t.height=i):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height));const u=a/2,d=c/2;return this.cacheTranslationX=Math.round(t.width/2-u)+u,this.cacheTranslationY=Math.round(t.height/2-d)+d,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(s,o),this.zoomX=s,this.zoomY=o,!0}return!1}setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,n=this.calcTransformMatrix(!e);t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}getObjectScaling(){if(!this.group)return new Y(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=Td(this.calcTransformMatrix());return new Y(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),n=this.getCanvasRetinaScaling();return t.scalarMultiply(e*n)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t}_set(t,e){t!==si&&t!==zi||(e=this._constrainScale(e)),t===si&&e<0?(this.flipX=!this.flipX,e*=-1):t==="scaleY"&&e<0?(this.flipY=!this.flipY,e*=-1):t!=="shadow"||!e||e instanceof ir||(e=new ir(e));const n=this[t]!==e;return this[t]=e,n&&this.constructor.cacheProperties.includes(t)&&(this.dirty=!0),this.parent&&(this.dirty||n&&this.constructor.stateProperties.includes(t))&&this.parent._set("dirty",!0),this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t,!1,{}),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){if(t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext){const{zoomX:e,zoomY:n,cacheTranslationX:i,cacheTranslationY:s}=this,{width:o,height:a}=this._cacheCanvas;this.drawObject(this._cacheContext,t.forClipping,{zoomX:e,zoomY:n,cacheTranslationX:i,cacheTranslationY:s,width:o,height:a,parentClipPaths:[]}),this.dirty=!1}}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst===Jn&&this.hasFill()&&this.hasStroke()&&this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.objectCaching&&(!this.parent||!this.parent.isOnACache())||this.needsItsOwnCache(),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(t,e,n){t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",t.setTransform(1,0,0,1,0,0),t.drawImage(n,0,0),t.restore()}drawObject(t,e,n){const i=this.fill,s=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath,n),this.fill=i,this.stroke=s}createClipPathLayer(t,e){const n=Ms(e),i=n.getContext("2d");if(i.translate(e.cacheTranslationX,e.cacheTranslationY),i.scale(e.zoomX,e.zoomY),t._cacheCanvas=n,e.parentClipPaths.forEach(s=>{s.transform(i)}),e.parentClipPaths.push(t),t.absolutePositioned){const s=ts(this.calcTransformMatrix());i.transform(s[0],s[1],s[2],s[3],s[4],s[5])}return t.transform(i),t.drawObject(i,!0,e),n}_drawClipPath(t,e,n){if(!e)return;e._transformDone=!0;const i=this.createClipPathLayer(e,n);this.drawClipPathOnCache(t,e,i)}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];if(this.isNotVisible())return!1;const e=this._cacheCanvas,n=this._cacheContext;return!(!e||!n||t||!this._updateCacheCanvas())||!!(this.dirty||this.clipPath&&this.clipPath.absolutePositioned)&&(e&&n&&!t&&(n.save(),n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,e.width,e.height),n.restore()),!0)}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const n=e.stroke;n&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,Ri(n)?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?this._applyPatternForTransformedGradient(t,n):(t.strokeStyle=n.toLive(t),this._applyPatternGradientTransform(t,n)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:n}=e;n&&(Ri(n)?(t.fillStyle=n.toLive(t),this._applyPatternGradientTransform(t,n)):t.fillStyle=n)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&e.length!==0&&t.setLineDash(e)}_setShadow(t){if(!this.shadow)return;const e=this.shadow,n=this.canvas,i=this.getCanvasRetinaScaling(),[s,,,o]=(n==null?void 0:n.viewportTransform)||Gn,a=s*i,c=o*i,l=e.nonScaling?new Y(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*he.browserShadowBlurConstant*(a+c)*(l.x+l.y)/4,t.shadowOffsetX=e.offsetX*a*l.x,t.shadowOffsetY=e.offsetY*c*l.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!Ri(e))return{offsetX:0,offsetY:0};const n=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,s=-this.height/2+e.offsetY||0;return e.gradientUnits==="percentage"?t.transform(this.width,0,0,this.height,i,s):t.transform(1,0,0,1,i,s),n&&t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:i,offsetY:s}}_renderPaintInOrder(t){this.paintFirst===Jn?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),this.fillRule==="evenodd"?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var n;const i=this._limitCacheSize(this._getCacheCanvasDimensions()),s=this.getCanvasRetinaScaling(),o=i.x/this.scaleX/s,a=i.y/this.scaleY/s,c=Ms({width:Math.ceil(o),height:Math.ceil(a)}),l=c.getContext("2d");l&&(l.beginPath(),l.moveTo(0,0),l.lineTo(o,0),l.lineTo(o,a),l.lineTo(0,a),l.closePath(),l.translate(o/2,a/2),l.scale(i.zoomX/this.scaleX/s,i.zoomY/this.scaleY/s),this._applyPatternGradientTransform(l,e),l.fillStyle=e.toLive(t),l.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(s*this.scaleX/i.zoomX,s*this.scaleY/i.zoomY),t.strokeStyle=(n=l.createPattern(c,"no-repeat"))!==null&&n!==void 0?n:"")}_findCenterFromElement(){return new Y(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t);return new(wt.getClass("image"))(e)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=$w(this),n=this.group,i=this.shadow,s=Math.abs,o=t.enableRetinaScaling?kw():1,a=(t.multiplier||1)*o,c=t.canvasProvider||(b=>new Wo(b,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1}));delete this.group,t.withoutTransform&&iI(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&rI(this,this.getViewportTransform()),this.setCoords();const l=rs(),h=this.getBoundingRect(),u=this.shadow,d=new Y;if(u){const b=u.blur,y=u.nonScaling?new Y(1,1):this.getObjectScaling();d.x=2*Math.round(s(u.offsetX)+b)*s(y.x),d.y=2*Math.round(s(u.offsetY)+b)*s(y.y)}const f=h.width+d.x,m=h.height+d.y;l.width=Math.ceil(f),l.height=Math.ceil(m);const _=c(l);t.format==="jpeg"&&(_.backgroundColor="#fff"),this.setPositionByOrigin(new Y(_.width/2,_.height/2),Zt,Zt);const g=this.canvas;_._objects=[this],this.set("canvas",_),this.setCoords();const p=_.toCanvasElement(a||1,t);return this.set("canvas",g),this.shadow=i,n&&(this.group=n),this.set(e),this.setCoords(),_._objects=[],_.destroy(),p}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Hw(this.toCanvasElement(t),t.format||"png",t.quality||1)}toBlob(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Gw(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const{centeredRotation:e,originX:n,originY:i}=this;if(e){const{x:s,y:o}=this.getRelativeCenterPoint();this.originX=Zt,this.originY=Zt,this.left=s,this.top=o}if(this.set("angle",t),e){const{x:s,y:o}=this.translateToOriginPoint(this.getRelativeCenterPoint(),n,i);this.left=s,this.top=o,this.originX=n,this.originY=i}}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Md.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&Ss().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}animate(t,e){return Object.entries(t).reduce((n,i)=>{let[s,o]=i;return n[s]=this._animate(s,o,e),n},{})}_animate(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=t.split("."),s=this.constructor.colorProperties.includes(i[i.length-1]),{abort:o,startValue:a,onChange:c,onComplete:l}=n,h=B(B({},n),{},{target:this,startValue:a??i.reduce((u,d)=>u[d],this),endValue:e,abort:o==null?void 0:o.bind(this),onChange:(u,d,f)=>{i.reduce((m,_,g)=>(g===i.length-1&&(m[_]=u),m[_]),this),c&&c(u,d,f)},onComplete:(u,d,f)=>{this.setCoords(),l&&l(u,d,f)}});return s?MI(h):aS(h)}isDescendantOf(t){const{parent:e,group:n}=this;return e===t||n===t||!!e&&e.isDescendantOf(t)||!!n&&n!==e&&n.isDescendantOf(t)}getAncestors(){const t=[];let e=this;do e=e.parent,e&&t.push(e);while(e);return t}findCommonAncestors(t){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors()]};const e=this.getAncestors(),n=t.getAncestors();if(e.length===0&&n.length>0&&this===n[n.length-1])return{fork:[],otherFork:[t,...n.slice(0,n.length-1)],common:[this]};for(let i,s=0;s<e.length;s++){if(i=e[s],i===t)return{fork:[this,...e.slice(0,s)],otherFork:[],common:e.slice(s)};for(let o=0;o<n.length;o++){if(this===n[o])return{fork:[],otherFork:[t,...n.slice(0,o)],common:[this,...e]};if(i===n[o])return{fork:[this,...e.slice(0,s)],otherFork:[t,...n.slice(0,o)],common:e.slice(s)}}}return{fork:[this,...e],otherFork:[t,...n],common:[]}}hasCommonAncestors(t){const e=this.findCommonAncestors(t);return e&&!!e.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const n=e.common[0]||this.canvas;if(!n)return;const i=e.fork.pop(),s=e.otherFork.pop(),o=n._objects.indexOf(i),a=n._objects.indexOf(s);return o>-1&&o>a}toObject(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).concat(hd.customProperties,this.constructor.customProperties||[]);let e;const n=he.NUM_FRACTION_DIGITS,{clipPath:i,fill:s,stroke:o,shadow:a,strokeDashArray:c,left:l,top:h,originX:u,originY:d,width:f,height:m,strokeWidth:_,strokeLineCap:g,strokeDashOffset:p,strokeLineJoin:b,strokeUniform:y,strokeMiterLimit:v,scaleX:x,scaleY:S,angle:T,flipX:E,flipY:w,opacity:M,visible:P,backgroundColor:L,fillRule:I,paintFirst:F,globalCompositeOperation:z,skewX:N,skewY:Z}=this;i&&!i.excludeFromExport&&(e=i.toObject(t.concat("inverted","absolutePositioned")));const j=tt=>Ue(tt,n),et=B(B({},zc(this,t)),{},{type:this.constructor.type,version:rg,originX:u,originY:d,left:j(l),top:j(h),width:j(f),height:j(m),fill:Wy(s)?s.toObject():s,stroke:Wy(o)?o.toObject():o,strokeWidth:j(_),strokeDashArray:c&&c.concat(),strokeLineCap:g,strokeDashOffset:p,strokeLineJoin:b,strokeUniform:y,strokeMiterLimit:j(v),scaleX:j(x),scaleY:j(S),angle:j(T),flipX:E,flipY:w,opacity:j(M),shadow:a&&a.toObject(),visible:P,backgroundColor:L,fillRule:I,paintFirst:F,globalCompositeOperation:z,skewX:j(N),skewY:j(Z)},e?{clipPath:e}:null);return this.includeDefaultValues?et:this._removeDefaultValues(et)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),n=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return E0(t,(i,s)=>{if(s===pe||s===Qn||s==="type")return!0;const o=n[s];return i!==o&&!(Array.isArray(i)&&Array.isArray(o)&&i.length===0&&o.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}static _fromObject(t){let e=Oe(t,EI),n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:i}=n,s=Oe(n,AI);return nf(e,s).then(o=>i?(delete o[i],new this(e[i],o)):new this(o))}static fromObject(t,e){return this._fromObject(t,e)}};U(Vs,"stateProperties",fI),U(Vs,"cacheProperties",fr),U(Vs,"ownDefaults",pI),U(Vs,"type","FabricObject"),U(Vs,"colorProperties",[on,Jn,"backgroundColor"]),U(Vs,"customProperties",[]),wt.setClass(Vs),wt.setClass(Vs,"object");const Vc=(r,t,e)=>(n,i,s,o)=>{const a=t(n,i,s,o);return a&&Jw(r,B(B({},eS(n,i,s,o)),e)),a};function Hc(r){return(t,e,n,i)=>{const{target:s,originX:o,originY:a}=e,c=s.getRelativeCenterPoint(),l=s.translateToOriginPoint(c,o,a),h=r(t,e,n,i);return s.setPositionByOrigin(l,e.originX,e.originY),h}}const tv=Vc(Wl,Hc((r,t,e,n)=>{const i=C0(t,t.originX,t.originY,e,n);if(tn(t.originX)===tn(Zt)||tn(t.originX)===tn(qe)&&i.x<0||tn(t.originX)===tn(pe)&&i.x>0){const{target:s}=t,o=s.strokeWidth/(s.strokeUniform?s.scaleX:1),a=tS(t)?2:1,c=s.width,l=Math.abs(i.x*a/s.scaleX)-o;return s.set("width",Math.max(l,1)),c!==s.width}return!1}));function CI(r,t,e,n,i){n=n||{};const s=this.sizeX||n.cornerSize||i.cornerSize,o=this.sizeY||n.cornerSize||i.cornerSize,a=n.transparentCorners!==void 0?n.transparentCorners:i.transparentCorners,c=a?Jn:on,l=!a&&(n.cornerStrokeColor||i.cornerStrokeColor);let h,u=t,d=e;r.save(),r.fillStyle=n.cornerColor||i.cornerColor||"",r.strokeStyle=n.cornerStrokeColor||i.cornerStrokeColor||"",s>o?(h=s,r.scale(1,o/s),d=e*s/o):o>s?(h=o,r.scale(s/o,1),u=t*o/s):h=s,r.beginPath(),r.arc(u,d,h/2,0,xd,!1),r[c](),l&&r.stroke(),r.restore()}function PI(r,t,e,n,i){n=n||{};const s=this.sizeX||n.cornerSize||i.cornerSize,o=this.sizeY||n.cornerSize||i.cornerSize,a=n.transparentCorners!==void 0?n.transparentCorners:i.transparentCorners,c=a?Jn:on,l=!a&&(n.cornerStrokeColor||i.cornerStrokeColor),h=s/2,u=o/2;r.save(),r.fillStyle=n.cornerColor||i.cornerColor||"",r.strokeStyle=n.cornerStrokeColor||i.cornerStrokeColor||"",r.translate(t,e);const d=i.getTotalAngle();r.rotate(Ze(d)),r["".concat(c,"Rect")](-h,-u,s,o),l&&r.strokeRect(-h,-u,s,o),r.restore()}class Ki{constructor(t){U(this,"visible",!0),U(this,"actionName",tf),U(this,"angle",0),U(this,"x",0),U(this,"y",0),U(this,"offsetX",0),U(this,"offsetY",0),U(this,"sizeX",0),U(this,"sizeY",0),U(this,"touchSizeX",0),U(this,"touchSizeY",0),U(this,"cursorStyle","crosshair"),U(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e,n,i){var s;let{tl:o,tr:a,br:c,bl:l}=i;return((s=e.canvas)===null||s===void 0?void 0:s.getActiveObject())===e&&e.isControlVisible(t)&&ke.isPointInPolygon(n,[o,a,c,l])}getActionHandler(t,e,n){return this.actionHandler}getMouseDownHandler(t,e,n){return this.mouseDownHandler}getMouseUpHandler(t,e,n){return this.mouseUpHandler}cursorStyleHandler(t,e,n){return e.cursorStyle}getActionName(t,e,n){return e.actionName}getVisibility(t,e){var n,i;return(n=(i=t._controlsVisibility)===null||i===void 0?void 0:i[e])!==null&&n!==void 0?n:this.visible}setVisibility(t,e,n){this.visible=t}positionHandler(t,e,n,i){return new Y(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,n,i,s,o){const a=M0([fh(n,i),ph({angle:t}),T0((s?this.touchSizeX:this.sizeX)||e,(s?this.touchSizeY:this.sizeY)||e)]);return{tl:new Y(-.5,-.5).transform(a),tr:new Y(.5,-.5).transform(a),br:new Y(.5,.5).transform(a),bl:new Y(-.5,.5).transform(a)}}render(t,e,n,i,s){((i=i||{}).cornerStyle||s.cornerStyle)==="circle"?CI.call(this,t,e,n,i,s):PI.call(this,t,e,n,i,s)}}const RI=(r,t,e)=>e.lockRotation?Cd:t.cursorStyle,DI=Vc(Uw,Hc((r,t,e,n)=>{let{target:i,ex:s,ey:o,theta:a,originX:c,originY:l}=t;const h=i.translateToOriginPoint(i.getRelativeCenterPoint(),c,l);if(ns(i,"lockRotation"))return!1;const u=Math.atan2(o-h.y,s-h.x),d=Math.atan2(n-h.y,e-h.x);let f=jo(d-u+a);if(i.snapAngle&&i.snapAngle>0){const _=i.snapAngle,g=i.snapThreshold||_,p=Math.ceil(f/_)*_,b=Math.floor(f/_)*_;Math.abs(f-b)<g?f=b:Math.abs(f-p)<g&&(f=p)}f<0&&(f=360+f),f%=360;const m=i.angle!==f;return i.angle=f,m}));function cS(r,t){const e=t.canvas,n=r[e.uniScaleKey];return e.uniformScaling&&!n||!e.uniformScaling&&n}function lS(r,t,e){const n=ns(r,"lockScalingX"),i=ns(r,"lockScalingY");if(n&&i||!t&&(n||i)&&e||n&&t==="x"||i&&t==="y")return!0;const{width:s,height:o,strokeWidth:a}=r;return s===0&&a===0&&t!=="y"||o===0&&a===0&&t!=="x"}const LI=["e","se","s","sw","w","nw","n","ne","e"],vl=(r,t,e)=>{const n=cS(r,e);if(lS(e,t.x!==0&&t.y===0?"x":t.x===0&&t.y!==0?"y":"",n))return Cd;const i=nS(e,t);return"".concat(LI[i],"-resize")};function D0(r,t,e,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const s=t.target,o=i.by,a=cS(r,s);let c,l,h,u,d,f;if(lS(s,o,a))return!1;if(t.gestureScale)l=t.scaleX*t.gestureScale,h=t.scaleY*t.gestureScale;else{if(c=C0(t,t.originX,t.originY,e,n),d=o!=="y"?Math.sign(c.x||t.signX||1):1,f=o!=="x"?Math.sign(c.y||t.signY||1):1,t.signX||(t.signX=d),t.signY||(t.signY=f),ns(s,"lockScalingFlip")&&(t.signX!==d||t.signY!==f))return!1;if(u=s._getTransformedDimensions(),a&&!o){const g=Math.abs(c.x)+Math.abs(c.y),{original:p}=t,b=g/(Math.abs(u.x*p.scaleX/s.scaleX)+Math.abs(u.y*p.scaleY/s.scaleY));l=p.scaleX*b,h=p.scaleY*b}else l=Math.abs(c.x*s.scaleX/u.x),h=Math.abs(c.y*s.scaleY/u.y);tS(t)&&(l*=2,h*=2),t.signX!==d&&o!=="y"&&(t.originX=qy(t.originX),l*=-1,t.signX=d),t.signY!==f&&o!=="x"&&(t.originY=qy(t.originY),h*=-1,t.signY=f)}const m=s.scaleX,_=s.scaleY;return o?(o==="x"&&s.set(si,l),o==="y"&&s.set(zi,h)):(!ns(s,"lockScalingX")&&s.set(si,l),!ns(s,"lockScalingY")&&s.set(zi,h)),m!==s.scaleX||_!==s.scaleY}const wu=Vc(Jd,Hc((r,t,e,n)=>D0(r,t,e,n))),II=Vc(Jd,Hc((r,t,e,n)=>D0(r,t,e,n,{by:"x"}))),OI=Vc(Jd,Hc((r,t,e,n)=>D0(r,t,e,n,{by:"y"}))),FI=["target","ex","ey","skewingSide"],Cp={x:{counterAxis:"y",scale:si,skew:Uc,lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:zi,skew:Bc,lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},kI=["ns","nesw","ew","nwse"],NI=(r,t,e)=>{if(t.x!==0&&ns(e,"lockSkewingY")||t.y!==0&&ns(e,"lockSkewingX"))return Cd;const n=nS(e,t)%4;return"".concat(kI[n],"-resize")};function hS(r,t,e,n,i){const{target:s}=e,{counterAxis:o,origin:a,lockSkewing:c,skew:l,flip:h}=Cp[r];if(ns(s,c))return!1;const{origin:u,flip:d}=Cp[o],f=tn(e[u])*(s[d]?-1:1),m=-Math.sign(f)*(s[h]?-1:1),_=.5*-((s[l]===0&&C0(e,Zt,Zt,n,i)[r]>0||s[l]>0?1:-1)*m)+.5;return Vc(Bw,Hc((p,b,y,v)=>function(x,S,T){let{target:E,ex:w,ey:M,skewingSide:P}=S,L=Oe(S,FI);const{skew:I}=Cp[x],F=T.subtract(new Y(w,M)).divide(new Y(E.scaleX,E.scaleY))[x],z=E[I],N=L[I],Z=Math.tan(Ze(N)),j=x==="y"?E._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:E._getTransformedDimensions({scaleX:1,scaleY:1}).y,et=2*F*P/Math.max(j,1)+Z,tt=jo(Math.atan(et));E.set(I,tt);const at=z!==E[I];if(at&&x==="y"){const{skewX:dt,scaleX:St}=E,O=E._getTransformedDimensions({skewY:z}),it=E._getTransformedDimensions(),mt=dt!==0?O.x/it.x:1;mt!==1&&E.set(si,mt*St)}return at}(r,b,new Y(y,v))))(t,B(B({},e),{},{[a]:_,skewingSide:m}),n,i)}const UI=(r,t,e,n)=>hS("x",r,t,e,n),BI=(r,t,e,n)=>hS("y",r,t,e,n);function of(r,t){return r[t.canvas.altActionKey]}const Su=(r,t,e)=>{const n=of(r,e);return t.x===0?n?Uc:zi:t.y===0?n?Bc:si:""},Ya=(r,t,e)=>of(r,e)?NI(0,t,e):vl(r,t,e),ev=(r,t,e,n)=>of(r,t.target)?BI(r,t,e,n):II(r,t,e,n),nv=(r,t,e,n)=>of(r,t.target)?UI(r,t,e,n):OI(r,t,e,n),uS=()=>({ml:new Ki({x:-.5,y:0,cursorStyleHandler:Ya,actionHandler:ev,getActionName:Su}),mr:new Ki({x:.5,y:0,cursorStyleHandler:Ya,actionHandler:ev,getActionName:Su}),mb:new Ki({x:0,y:.5,cursorStyleHandler:Ya,actionHandler:nv,getActionName:Su}),mt:new Ki({x:0,y:-.5,cursorStyleHandler:Ya,actionHandler:nv,getActionName:Su}),tl:new Ki({x:-.5,y:-.5,cursorStyleHandler:vl,actionHandler:wu}),tr:new Ki({x:.5,y:-.5,cursorStyleHandler:vl,actionHandler:wu}),bl:new Ki({x:-.5,y:.5,cursorStyleHandler:vl,actionHandler:wu}),br:new Ki({x:.5,y:.5,cursorStyleHandler:vl,actionHandler:wu}),mtr:new Ki({x:0,y:-.5,actionHandler:DI,cursorStyleHandler:RI,offsetY:-40,withConnection:!0,actionName:w0})}),zI=()=>({mr:new Ki({x:.5,y:0,actionHandler:tv,cursorStyleHandler:Ya,actionName:Wl}),ml:new Ki({x:-.5,y:0,actionHandler:tv,cursorStyleHandler:Ya,actionName:Wl})}),VI=()=>B(B({},uS()),zI());class ql extends Vs{static getDefaults(){return B(B({},super.getDefaults()),ql.ownDefaults)}constructor(t){super(),Object.assign(this,this.constructor.createControls(),ql.ownDefaults),this.setOptions(t)}static createControls(){return{controls:uS()}}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform,n=e.target,i=e.action;if(this===n&&i&&i.startsWith(tf))return!1}return super._updateCacheCanvas()}getActiveControl(){const t=this.__corner;return t?{key:t,control:this.controls[t],coord:this.oCoords[t]}:void 0}findControl(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!this.hasControls||!this.canvas)return;this.__corner=void 0;const n=Object.entries(this.oCoords);for(let i=n.length-1;i>=0;i--){const[s,o]=n[i],a=this.controls[s];if(a.shouldActivate(s,this,t,e?o.touchCorner:o.corner))return this.__corner=s,{key:s,control:a,coord:this.oCoords[s]}}}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),n=fh(e.x,e.y),i=ph({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),s=mn(n,i),o=mn(t,s),a=mn(o,[1/t[0],0,0,1/t[3],0,0]),c=this.group?Td(this.calcTransformMatrix()):void 0;c&&(c.scaleX=Math.abs(c.scaleX),c.scaleY=Math.abs(c.scaleY));const l=this._calculateCurrentDimensions(c),h={};return this.forEachControl((u,d)=>{const f=u.positionHandler(l,a,this,u);h[d]=Object.assign(f,this._calcCornerCoords(u,f))}),h}_calcCornerCoords(t,e){const n=this.getTotalAngle();return{corner:t.calcCornerCoords(n,this.cornerSize,e.x,e.y,!1,this),touchCorner:t.calcCornerCoords(n,this.touchCornerSize,e.x,e.y,!0,this)}}setCoords(){super.setCoords(),this.canvas&&(this.oCoords=this.calcOCoords())}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),n=this._calculateCurrentDimensions(),i=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate(Ze(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-n.x/2,-n.y/2,n.x,n.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=B({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},n);t.save(),t.strokeStyle=i.borderColor,this._setLineDash(t,i.borderDashArray),this.strokeBorders(t,e),i.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:n,hasControls:i}=this,s=B({hasBorders:n,hasControls:i},e),o=this.getViewportTransform(),a=s.hasBorders,c=s.hasControls,l=mn(o,this.calcTransformMatrix()),h=Td(l);t.save(),t.translate(h.translateX,h.translateY),t.lineWidth=this.borderScaleFactor,this.group===this.parent&&(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(h.angle-=180),t.rotate(Ze(this.group?h.angle:this.angle)),a&&this.drawBorders(t,h,e),c&&this.drawControls(t,e),t.restore()}drawBorders(t,e,n){let i;if(n&&n.forActiveSelection||this.group){const s=A0(this.width,this.height,ef(e)),o=this.isStrokeAccountedForInDimensions()?S0:(this.strokeUniform?new Y().scalarAdd(this.canvas?this.canvas.getZoom():1):new Y(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);i=s.add(o).scalarAdd(this.borderScaleFactor).scalarAdd(2*this.padding)}else i=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,i,n)}drawControlsConnectingLines(t,e){let n=!1;t.beginPath(),this.forEachControl((i,s)=>{i.withConnection&&i.getVisibility(this,s)&&(n=!0,t.moveTo(i.x*e.x,i.y*e.y),t.lineTo(i.x*e.x+i.offsetX,i.y*e.y+i.offsetY))}),n&&t.stroke()}drawControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.save();const n=this.getCanvasRetinaScaling(),{cornerStrokeColor:i,cornerDashArray:s,cornerColor:o}=this,a=B({cornerStrokeColor:i,cornerDashArray:s,cornerColor:o},e);t.setTransform(n,0,0,n,0,0),t.strokeStyle=t.fillStyle=a.cornerColor,this.transparentCorners||(t.strokeStyle=a.cornerStrokeColor),this._setLineDash(t,a.cornerDashArray),this.forEachControl((c,l)=>{if(c.getVisibility(this,l)){const h=this.oCoords[l];c.render(t,h.x,h.y,a,this)}}),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(t).forEach(e=>{let[n,i]=e;return this.setControlVisible(n,i)})}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const n=this.canvas.viewportTransform;e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this.transform(e);const i=this.width+4,s=this.height+4;return e.clearRect(-i/2,-s/2,i,s),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}shouldStartDragging(t){return!1}onDragStart(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function dS(r,t){return t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(n=>{n!=="constructor"&&Object.defineProperty(r.prototype,n,Object.getOwnPropertyDescriptor(e.prototype,n)||Object.create(null))})}),r}U(ql,"ownDefaults",{noScaleCache:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,cornerSize:13,touchCornerSize:24,transparentCorners:!0,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,hasControls:!0,borderColor:"rgb(178,204,255)",borderDashArray:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,hasBorders:!0,selectionBackgroundColor:"",selectable:!0,evented:!0,perPixelTargetFind:!1,activeOn:"down",hoverCursor:null,moveCursor:null});class Cn extends ql{}dS(Cn,[iS]),wt.setClass(Cn),wt.setClass(Cn,"object");const HI=(r,t,e,n)=>{const i=2*(n=Math.round(n))+1,{data:s}=r.getImageData(t-n,e-n,i,i);for(let o=3;o<s.length;o+=4)if(s[o]>0)return!1;return!0};class fS{constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new Y(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new Y(1/this.options.scaleX,1/this.options.scaleY):new Y(1,1)}createSideVector(t,e){const n=hg(t,e);return this.options.strokeUniform?n.multiply(this.scale):n}projectOrthogonally(t,e,n){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,n)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(t){const e=new Y(t);return e.y+=e.x*Math.tan(Ze(this.options.skewY)),e.x+=e.y*Math.tan(Ze(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}const GI=new Y;class rc extends fS{static getOrthogonalRotationFactor(t,e){const n=e?dg(t,e):uI(t);return Math.abs(n)<dh?-1:1}constructor(t,e,n,i){super(i),U(this,"AB",void 0),U(this,"AC",void 0),U(this,"alpha",void 0),U(this,"bisector",void 0),this.A=new Y(t),this.B=new Y(e),this.C=new Y(n),this.AB=this.createSideVector(this.A,this.B),this.AC=this.createSideVector(this.A,this.C),this.alpha=dg(this.AB,this.AC),this.bisector=P0(rS(this.AB.eq(GI)?this.AC:this.AB,this.alpha/2))}calcOrthogonalProjection(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e),s=oS(i),o=rc.getOrthogonalRotationFactor(s,this.bisector);return this.scaleUnitVector(s,n*o)}projectBevel(){const t=[];return(this.alpha%xd==0?[this.B]:[this.B,this.C]).forEach(e=>{t.push(this.projectOrthogonally(this.A,e)),t.push(this.projectOrthogonally(this.A,e,-this.strokeProjectionMagnitude))}),t}projectMiter(){const t=[],e=Math.abs(this.alpha),n=1/Math.sin(e/2),i=this.scaleUnitVector(this.bisector,-this.strokeProjectionMagnitude*n),s=this.options.strokeUniform?ug(this.scaleUnitVector(this.bisector,this.options.strokeMiterLimit)):this.options.strokeMiterLimit;return ug(i)/this.strokeProjectionMagnitude<=s&&t.push(this.applySkew(this.A.add(i))),t.push(...this.projectBevel()),t}projectRoundNoSkew(t,e){const n=[],i=new Y(rc.getOrthogonalRotationFactor(this.bisector),rc.getOrthogonalRotationFactor(new Y(this.bisector.y,this.bisector.x)));return[new Y(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i),new Y(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(i)].forEach(s=>{Qy(s,t,e)&&n.push(this.A.add(s))}),n}projectRoundWithSkew(t,e){const n=[],{skewX:i,skewY:s,scaleX:o,scaleY:a,strokeUniform:c}=this.options,l=new Y(Math.tan(Ze(i)),Math.tan(Ze(s))),h=this.strokeProjectionMagnitude,u=c?h/a/Math.sqrt(1/a**2+1/o**2*l.y**2):h/Math.sqrt(1+l.y**2),d=new Y(Math.sqrt(Math.max(h**2-u**2,0)),u),f=c?h/Math.sqrt(1+l.x**2*(1/a)**2/(1/o+1/o*l.x*l.y)**2):h/Math.sqrt(1+l.x**2/(1+l.x*l.y)**2),m=new Y(f,Math.sqrt(Math.max(h**2-f**2,0)));return[m,m.scalarMultiply(-1),d,d.scalarMultiply(-1)].map(_=>this.applySkew(c?_.multiply(this.strokeUniformScalar):_)).forEach(_=>{Qy(_,t,e)&&n.push(this.applySkew(this.A).add(_))}),n}projectRound(){const t=[];t.push(...this.projectBevel());const e=this.alpha%xd==0,n=this.applySkew(this.A),i=t[e?0:2].subtract(n),s=t[e?1:0].subtract(n),o=e?this.applySkew(this.AB.scalarMultiply(-1)):this.applySkew(this.bisector.multiply(this.strokeUniformScalar).scalarMultiply(-1)),a=Il(i,o)>0,c=a?i:s,l=a?s:i;return this.isSkewed()?t.push(...this.projectRoundWithSkew(c,l)):t.push(...this.projectRoundNoSkew(c,l)),t}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t,angle:this.alpha,bisector:this.bisector}))}}class iv extends fS{constructor(t,e,n){super(n),this.A=new Y(t),this.T=new Y(e)}calcOrthogonalProjection(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const i=this.createSideVector(t,e);return this.scaleUnitVector(oS(i),n)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){const t=[];if(!this.isSkewed()&&this.A.eq(this.T)){const e=new Y(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))}else t.push(...new rc(this.A,this.T,this.T,this.options).projectRound());return t}projectSquare(){const t=[];if(this.A.eq(this.T)){const e=new Y(1,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar);t.push(this.A.add(e),this.A.subtract(e))}else{const e=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),n=this.scaleUnitVector(P0(this.createSideVector(this.A,this.T)),-this.strokeProjectionMagnitude),i=this.A.add(n);t.push(i.add(e),i.subtract(e))}return t.map(e=>this.applySkew(e))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t}))}}const jI=function(r,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];const n=[];if(r.length===0)return n;const i=r.reduce((s,o)=>(s[s.length-1].eq(o)||s.push(new Y(o)),s),[new Y(r[0])]);if(i.length===1)e=!0;else if(!e){const s=i[0],o=((a,c)=>{for(let l=a.length-1;l>=0;l--)if(c(a[l],l,a))return l;return-1})(i,a=>!a.eq(s));i.splice(o+1)}return i.forEach((s,o,a)=>{let c,l;o===0?(l=a[1],c=e?s:a[a.length-1]):o===a.length-1?(c=a[o-1],l=e?s:a[0]):(c=a[o-1],l=a[o+1]),e&&a.length===1?n.push(...new iv(s,s,t).project()):!e||o!==0&&o!==a.length-1?n.push(...new rc(s,c,l,t).project()):n.push(...new iv(s,o===0?l:c,t).project())}),n},L0=r=>{const t={};return Object.keys(r).forEach(e=>{t[e]={},Object.keys(r[e]).forEach(n=>{t[e][n]=B({},r[e][n])})}),t},WI=r=>r.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),I0=r=>{const t=[];for(let e,n=0;n<r.length;n++)(e=XI(r,n))!==!1&&t.push(e);return t},XI=(r,t)=>{const e=r.charCodeAt(t);if(isNaN(e))return"";if(e<55296||e>57343)return r.charAt(t);if(55296<=e&&e<=56319){if(r.length<=t+1)throw"High surrogate without following low surrogate";const i=r.charCodeAt(t+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return r.charAt(t)+r.charAt(t+1)}if(t===0)throw"Low surrogate without preceding high surrogate";const n=r.charCodeAt(t-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1},O0=function(r,t){let e=arguments.length>2&&arguments[2]!==void 0&&arguments[2];return r.fill!==t.fill||r.stroke!==t.stroke||r.strokeWidth!==t.strokeWidth||r.fontSize!==t.fontSize||r.fontFamily!==t.fontFamily||r.fontWeight!==t.fontWeight||r.fontStyle!==t.fontStyle||r.textBackgroundColor!==t.textBackgroundColor||r.deltaY!==t.deltaY||e&&(r.overline!==t.overline||r.underline!==t.underline||r.linethrough!==t.linethrough)},YI=(r,t)=>{const e=t.split(`
`),n=[];let i=-1,s={};r=L0(r);for(let o=0;o<e.length;o++){const a=I0(e[o]);if(r[o])for(let c=0;c<a.length;c++){i++;const l=r[o][c];l&&Object.keys(l).length>0&&(O0(s,l,!0)?n.push({start:i,end:i+1,style:l}):n[n.length-1].end++),s=l||{}}else i+=a.length,s={}}return n},qI=(r,t)=>{if(!Array.isArray(r))return L0(r);const e=t.split(x0),n={};let i=-1,s=0;for(let o=0;o<e.length;o++){const a=I0(e[o]);for(let c=0;c<a.length;c++)i++,r[s]&&r[s].start<=i&&i<r[s].end&&(n[o]=n[o]||{},n[o][c]=B({},r[s].style),i===r[s].end-1&&s++)}return n},no=["display","transform",on,"fill-opacity","fill-rule","opacity",Jn,"stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function sv(r,t){const e=r.nodeName,n=r.getAttribute("class"),i=r.getAttribute("id"),s="(?![a-zA-Z\\-]+)";let o;if(o=new RegExp("^"+e,"i"),t=t.replace(o,""),i&&t.length&&(o=new RegExp("#"+i+s,"i"),t=t.replace(o,"")),n&&t.length){const a=n.split(" ");for(let c=a.length;c--;)o=new RegExp("\\."+a[c]+s,"i"),t=t.replace(o,"")}return t.length===0}function KI(r,t){let e=!0;const n=sv(r,t.pop());return n&&t.length&&(e=function(i,s){let o,a=!0;for(;i.parentElement&&i.parentElement.nodeType===1&&s.length;)a&&(o=s.pop()),a=sv(i=i.parentElement,o);return s.length===0}(r,t)),n&&e&&t.length===0}const ZI=r=>{var t;return(t=lI[r])!==null&&t!==void 0?t:r},QI=new RegExp("(".concat(Xo,")"),"gi"),$I=r=>r.replace(QI," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var rv,ov,av,cv,lv,hv,uv;const Un="(".concat(Xo,")"),JI=String.raw(rv||(rv=eo(["(skewX)(",")"],["(skewX)\\(","\\)"])),Un),tO=String.raw(ov||(ov=eo(["(skewY)(",")"],["(skewY)\\(","\\)"])),Un),eO=String.raw(av||(av=eo(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),Un,Un,Un),nO=String.raw(cv||(cv=eo(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),Un,Un),iO=String.raw(lv||(lv=eo(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),Un,Un),sO=String.raw(hv||(hv=eo(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),Un,Un,Un,Un,Un,Un),F0="(?:".concat(sO,"|").concat(iO,"|").concat(eO,"|").concat(nO,"|").concat(JI,"|").concat(tO,")"),rO="(?:".concat(F0,"*)"),oO=String.raw(uv||(uv=eo(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),rO),aO=new RegExp(oO),cO=new RegExp(F0),lO=new RegExp(F0,"g");function fg(r){const t=[];if(!(r=$I(r).replace(/\s*([()])\s*/gi,"$1"))||r&&!aO.test(r))return[...Gn];for(const e of r.matchAll(lO)){const n=cO.exec(e[0]);if(!n)continue;let i=Gn;const s=n.filter(m=>!!m),[,o,...a]=s,[c,l,h,u,d,f]=a.map(m=>parseFloat(m));switch(o){case"translate":i=fh(c,l);break;case w0:i=ph({angle:c},{x:l,y:h});break;case tf:i=T0(c,l);break;case Uc:i=Xw(c);break;case Bc:i=Yw(c);break;case"matrix":i=[c,l,h,u,d,f]}t.push(i)}return M0(t)}function hO(r,t,e,n){const i=Array.isArray(t);let s,o=t;if(r!==on&&r!==Jn||t!==$n){if(r==="strokeUniform")return t==="non-scaling-stroke";if(r==="strokeDashArray")o=t===$n?null:t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(r==="transformMatrix")o=e&&e.transformMatrix?mn(e.transformMatrix,fg(t)):fg(t);else if(r==="visible")o=t!==$n&&t!=="hidden",e&&e.visible===!1&&(o=!1);else if(r==="opacity")o=parseFloat(t),e&&e.opacity!==void 0&&(o*=e.opacity);else if(r==="textAnchor")o=t==="start"?pe:t==="end"?qe:Zt;else if(r==="charSpacing")s=ic(t,n)/n*1e3;else if(r==="paintFirst"){const a=t.indexOf(on),c=t.indexOf(Jn);o=on,(a>-1&&c>-1&&c<a||a===-1&&c>-1)&&(o=Jn)}else{if(r==="href"||r==="xlink:href"||r==="font"||r==="id")return t;if(r==="imageSmoothing")return t==="optimizeQuality";s=i?t.map(ic):ic(t,n)}}else o="";return!i&&isNaN(s)?o:s}function uO(r,t){const e=r.match(cI);if(!e)return;const n=e[1],i=e[3],s=e[4],o=e[5],a=e[6];n&&(t.fontStyle=n),i&&(t.fontWeight=isNaN(parseFloat(i))?i:parseFloat(i)),s&&(t.fontSize=ic(s)),a&&(t.fontFamily=a),o&&(t.lineHeight=o==="normal"?1:o)}function dO(r,t){r.replace(/;\s*$/,"").split(";").forEach(e=>{if(!e)return;const[n,i]=e.split(":");t[n.trim().toLowerCase()]=i.trim()})}function fO(r){const t={},e=r.getAttribute("style");return e&&(typeof e=="string"?dO(e,t):function(n,i){Object.entries(n).forEach(s=>{let[o,a]=s;a!==void 0&&(i[o.toLowerCase()]=a)})}(e,t)),t}const pO={stroke:"strokeOpacity",fill:"fillOpacity"};function pr(r,t,e){if(!r)return{};let n,i={},s=v0;r.parentNode&&Zy.test(r.parentNode.nodeName)&&(i=pr(r.parentElement,t,e),i.fontSize&&(n=s=ic(i.fontSize)));const o=B(B(B({},t.reduce((l,h)=>{const u=r.getAttribute(h);return u&&(l[h]=u),l},{})),function(l){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u={};for(const d in h)KI(l,d.split(" "))&&(u=B(B({},u),h[d]));return u}(r,e)),fO(r));o[Ep]&&r.setAttribute(Ep,o[Ep]),o[Tp]&&(n=ic(o[Tp],s),o[Tp]="".concat(n));const a={};for(const l in o){const h=ZI(l),u=hO(h,o[l],i,n);a[h]=u}a&&a.font&&uO(a.font,a);const c=B(B({},i),a);return Zy.test(r.nodeName)?c:function(l){const h=Cn.getDefaults();return Object.entries(pO).forEach(u=>{let[d,f]=u;if(l[f]===void 0||l[d]==="")return;if(l[d]===void 0){if(!h[d])return;l[d]=h[d]}if(l[d].indexOf("url(")===0)return;const m=new ge(l[d]);l[d]=m.setAlpha(Ue(m.getAlpha()*l[f],2)).toRgba()}),l}(c)}const mO=["left","top","width","height","visible"],pS=["rx","ry"];class ds extends Cn{static getDefaults(){return B(B({},super.getDefaults()),ds.ownDefaults)}constructor(t){super(),Object.assign(this,ds.ownDefaults),this.setOptions(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:n}=this,i=-e/2,s=-n/2,o=this.rx?Math.min(this.rx,e/2):0,a=this.ry?Math.min(this.ry,n/2):0,c=o!==0||a!==0;t.beginPath(),t.moveTo(i+o,s),t.lineTo(i+e-o,s),c&&t.bezierCurveTo(i+e-Mr*o,s,i+e,s+Mr*a,i+e,s+a),t.lineTo(i+e,s+n-a),c&&t.bezierCurveTo(i+e,s+n-Mr*a,i+e-Mr*o,s+n,i+e-o,s+n),t.lineTo(i+o,s+n),c&&t.bezierCurveTo(i+Mr*o,s+n,i,s+n-Mr*a,i,s+n-a),t.lineTo(i,s+a),c&&t.bezierCurveTo(i,s+Mr*a,i+Mr*o,s,i+o,s),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...pS,...t])}_toSVG(){const{width:t,height:e,rx:n,ry:i}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(n,'" ry="').concat(i,'" width="').concat(t,'" height="').concat(e,`" />
`)]}static async fromElement(t,e,n){const i=pr(t,this.ATTRIBUTE_NAMES,n),{left:s=0,top:o=0,width:a=0,height:c=0,visible:l=!0}=i,h=Oe(i,mO);return new this(B(B(B({},e),h),{},{left:s,top:o,width:a,height:c,visible:!!(l&&a&&c)}))}}U(ds,"type","Rect"),U(ds,"cacheProperties",[...fr,...pS]),U(ds,"ownDefaults",{rx:0,ry:0}),U(ds,"ATTRIBUTE_NAMES",[...no,"x","y","rx","ry","width","height"]),wt.setClass(ds),wt.setSVGClass(ds);const Qs="initialization",Pd="added",k0="removed",Rd="imperative",mS=(r,t)=>{const{strokeUniform:e,strokeWidth:n,width:i,height:s,group:o}=t,a=o&&o!==r?sf(o.calcTransformMatrix(),r.calcTransformMatrix()):null,c=a?t.getRelativeCenterPoint().transform(a):t.getRelativeCenterPoint(),l=!t.isStrokeAccountedForInDimensions(),h=e&&l?sI(new Y(n,n),void 0,r.calcTransformMatrix()):S0,u=!e&&l?n:0,d=A0(i+u,s+u,M0([a,t.calcOwnMatrix()],!0)).add(h).scalarDivide(2);return[c.subtract(d),c.add(d)]};class af{calcLayoutResult(t,e){if(this.shouldPerformLayout(t))return this.calcBoundingBox(e,t)}shouldPerformLayout(t){let{type:e,prevStrategy:n,strategy:i}=t;return e===Qs||e===Rd||!!n&&i!==n}shouldLayoutClipPath(t){let{type:e,target:{clipPath:n}}=t;return e!==Qs&&n&&!n.absolutePositioned}getInitialSize(t,e){return e.size}calcBoundingBox(t,e){const{type:n,target:i}=e;if(n===Rd&&e.overrides)return e.overrides;if(t.length===0)return;const{left:s,top:o,width:a,height:c}=nr(t.map(u=>mS(i,u)).reduce((u,d)=>u.concat(d),[])),l=new Y(a,c),h=new Y(s,o).add(l.scalarDivide(2));if(n===Qs){const u=this.getInitialSize(e,{size:l,center:h});return{center:h,relativeCorrection:new Y(0,0),size:u}}return{center:h.transform(i.calcOwnMatrix()),size:l}}}U(af,"type","strategy");class pg extends af{shouldPerformLayout(t){return!0}}U(pg,"type","fit-content"),wt.setClass(pg);const gO=["strategy"],_O=["target","strategy","bubbles","prevStrategy"],gS="layoutManager";class Kl{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new pg;U(this,"strategy",void 0),this.strategy=t,this._subscriptions=new Map}performLayout(t){const e=B(B({bubbles:!0,strategy:this.strategy},t),{},{prevStrategy:this._prevLayoutStrategy,stopPropagation(){this.bubbles=!1}});this.onBeforeLayout(e);const n=this.getLayoutResult(e);n&&this.commitLayout(e,n),this.onAfterLayout(e,n),this._prevLayoutStrategy=e.strategy}attachHandlers(t,e){const{target:n}=e;return[Sd,Nw,Wl,Uw,Jd,Bw,wd,GL,jL].map(i=>t.on(i,s=>this.performLayout(i===Sd?{type:"object_modified",trigger:i,e:s,target:n}:{type:"object_modifying",trigger:i,e:s,target:n})))}subscribe(t,e){this.unsubscribe(t,e);const n=this.attachHandlers(t,e);this._subscriptions.set(t,n)}unsubscribe(t,e){(this._subscriptions.get(t)||[]).forEach(n=>n()),this._subscriptions.delete(t)}unsubscribeTargets(t){t.targets.forEach(e=>this.unsubscribe(e,t))}subscribeTargets(t){t.targets.forEach(e=>this.subscribe(e,t))}onBeforeLayout(t){const{target:e,type:n}=t,{canvas:i}=e;if(n===Qs||n===Pd?this.subscribeTargets(t):n===k0&&this.unsubscribeTargets(t),e.fire("layout:before",{context:t}),i&&i.fire("object:layout:before",{target:e,context:t}),n===Rd&&t.deep){const s=Oe(t,gO);e.forEachObject(o=>o.layoutManager&&o.layoutManager.performLayout(B(B({},s),{},{bubbles:!1,target:o})))}}getLayoutResult(t){const{target:e,strategy:n,type:i}=t,s=n.calcLayoutResult(t,e.getObjects());if(!s)return;const o=i===Qs?new Y:e.getRelativeCenterPoint(),{center:a,correction:c=new Y,relativeCorrection:l=new Y}=s,h=o.subtract(a).add(c).transform(i===Qs?Gn:ts(e.calcOwnMatrix()),!0).add(l);return{result:s,prevCenter:o,nextCenter:a,offset:h}}commitLayout(t,e){const{target:n}=t,{result:{size:i},nextCenter:s}=e;var o,a;n.set({width:i.x,height:i.y}),this.layoutObjects(t,e),t.type===Qs?n.set({left:(o=t.x)!==null&&o!==void 0?o:s.x+i.x*tn(n.originX),top:(a=t.y)!==null&&a!==void 0?a:s.y+i.y*tn(n.originY)}):(n.setPositionByOrigin(s,Zt,Zt),n.setCoords(),n.set("dirty",!0))}layoutObjects(t,e){const{target:n}=t;n.forEachObject(i=>{i.group===n&&this.layoutObject(t,e,i)}),t.strategy.shouldLayoutClipPath(t)&&this.layoutObject(t,e,n.clipPath)}layoutObject(t,e,n){let{offset:i}=e;n.set({left:n.left+i.x,top:n.top+i.y})}onAfterLayout(t,e){const{target:n,strategy:i,bubbles:s,prevStrategy:o}=t,a=Oe(t,_O),{canvas:c}=n;n.fire("layout:after",{context:t,result:e}),c&&c.fire("object:layout:after",{context:t,result:e,target:n});const l=n.parent;s&&l!=null&&l.layoutManager&&((a.path||(a.path=[])).push(n),l.layoutManager.performLayout(B(B({},a),{},{target:l}))),n.set("dirty",!0)}dispose(){const{_subscriptions:t}=this;t.forEach(e=>e.forEach(n=>n())),t.clear()}toObject(){return{type:gS,strategy:this.strategy.constructor.type}}toJSON(){return this.toObject()}}wt.setClass(Kl,gS);const bO=["type","objects","layoutManager"];class yO extends Kl{performLayout(){}}class Oo extends zw(Cn){static getDefaults(){return B(B({},super.getDefaults()),Oo.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),U(this,"_activeObjects",[]),U(this,"__objectSelectionTracker",void 0),U(this,"__objectSelectionDisposer",void 0),Object.assign(this,Oo.ownDefaults),this.setOptions(e),this.groupInit(t,e)}groupInit(t,e){var n;this._objects=[...t],this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.forEachObject(i=>{this.enterGroup(i,!1)}),this.layoutManager=(n=e.layoutManager)!==null&&n!==void 0?n:new Kl,this.layoutManager.performLayout({type:Qs,target:this,targets:[...t],x:e.left,y:e.top})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(qr("error","Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(t)===-1||(qr("error","Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter((e,n,i)=>this.canEnterGroup(e)&&i.indexOf(e)===n)}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=this._filterObjectsBeforeEnteringGroup(e),s=super.add(...i);return this._onAfterObjectsChange(Pd,i),s}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];const s=this._filterObjectsBeforeEnteringGroup(n),o=super.insertAt(t,...s);return this._onAfterObjectsChange(Pd,s),o}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange(k0,t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this.layoutManager.performLayout({type:t,targets:e,target:this})}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const n=this[t];return super._set(t,e),t==="canvas"&&n!==e&&(this._objects||[]).forEach(i=>{i._set(t,e)}),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectSelectionMonitor(t,e){let{target:n}=e;const i=this._activeObjects;if(t)i.push(n),this._set("dirty",!0);else if(i.length>0){const s=i.indexOf(n);s>-1&&(i.splice(s,1),this._set("dirty",!0))}}_watchObject(t,e){t&&this._watchObject(!1,e),t?(e.on("selected",this.__objectSelectionTracker),e.on("deselected",this.__objectSelectionDisposer)):(e.off("selected",this.__objectSelectionTracker),e.off("deselected",this.__objectSelectionDisposer))}enterGroup(t,e){t.group&&t.group.remove(t),t._set("parent",this),this._enterGroup(t,e)}_enterGroup(t,e){e&&Ad(t,mn(ts(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this._watchObject(!0,t);const n=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();n&&(n===t||t.isDescendantOf(n))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("parent",void 0),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(Ad(t,mn(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const n=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;n>-1&&this._activeObjects.splice(n,1)}shouldCache(){const t=Cn.prototype.shouldCache.call(this);if(t){for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1}return t}willDrawShadow(){if(super.willDrawShadow())return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.parent&&this.parent.isOnACache()}drawObject(t,e,n){this._renderBackground(t);for(let s=0;s<this._objects.length;s++){var i;const o=this._objects[s];(i=this.canvas)!==null&&i!==void 0&&i.preserveObjectStacking&&o.group!==this?(t.save(),t.transform(...ts(this.calcTransformMatrix())),o.render(t),t.restore()):o.group===this&&o.render(t)}this._drawClipPath(t,this.clipPath,n)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(t=>t.setCoords())}triggerLayout(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.layoutManager.performLayout(B({target:this,type:Rd},t))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}__serializeObjects(t,e){const n=this.includeDefaultValues;return this._objects.filter(function(i){return!i.excludeFromExport}).map(function(i){const s=i.includeDefaultValues;i.includeDefaultValues=n;const o=i[t||"toObject"](e);return i.includeDefaultValues=s,o})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.layoutManager.toObject();return B(B(B({},super.toObject(["subTargetCheck","interactive",...t])),e.strategy!=="fit-content"||this.includeDefaultValues?{layoutManager:e}:{}),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this.layoutManager.unsubscribeTargets({targets:this.getObjects(),target:this}),this._activeObjects=[],this.forEachObject(t=>{this._watchObject(!1,t),t.dispose()}),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=ds.prototype._toSVG.call(this),n=e.indexOf("COMMON_PARTS");e[n]='for="group" ';const i=e.join("");return t?t(i):i}_toSVG(t){const e=["<g ","COMMON_PARTS",` >
`],n=this._createSVGBgRect(t);n&&e.push("		",n);for(let i=0;i<this._objects.length;i++)e.push("		",this._objects[i].toSVG(t));return e.push(`</g>
`),e}getSvgStyles(){const t=this.opacity!==void 0&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],n=this._createSVGBgRect(t);n&&e.push("	",n);for(let i=0;i<this._objects.length;i++)e.push("	",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t,e){let{type:n,objects:i=[],layoutManager:s}=t,o=Oe(t,bO);return Promise.all([Xl(i,e),nf(o,e)]).then(a=>{let[c,l]=a;const h=new this(c,B(B(B({},o),l),{},{layoutManager:new yO}));if(s){const u=wt.getClass(s.type),d=wt.getClass(s.strategy);h.layoutManager=new u(new d)}else h.layoutManager=new Kl;return h.layoutManager.subscribeTargets({type:Qs,target:h,targets:h.getObjects()}),h.setCoords(),h})}}U(Oo,"type","Group"),U(Oo,"ownDefaults",{strokeWidth:0,subTargetCheck:!1,interactive:!1}),wt.setClass(Oo);const vO=(r,t)=>Math.min(t.width/r.width,t.height/r.height),xO=(r,t)=>Math.max(t.width/r.width,t.height/r.height),mg="\\s*,?\\s*",ul="".concat(mg,"(").concat(Xo,")"),wO="".concat(ul).concat(ul).concat(ul).concat(mg,"([01])").concat(mg,"([01])").concat(ul).concat(ul),SO={m:"l",M:"L"},MO=(r,t,e,n,i,s,o,a,c,l,h)=>{const u=cr(r),d=lr(r),f=cr(t),m=lr(t),_=e*i*f-n*s*m+o,g=n*i*f+e*s*m+a;return["C",l+c*(-e*i*d-n*s*u),h+c*(-n*i*d+e*s*u),_+c*(e*i*m+n*s*f),g+c*(n*i*m-e*s*f),_,g]},dv=(r,t,e,n)=>{const i=Math.atan2(t,r),s=Math.atan2(n,e);return s>=i?s-i:2*Math.PI-(i-s)};function fv(r,t,e,n,i,s,o,a){let c;if(he.cachesBoundsOfCurve&&(c=[...arguments].join(),Ll.boundsOfCurveCache[c]))return Ll.boundsOfCurveCache[c];const l=Math.sqrt,h=Math.abs,u=[],d=[[0,0],[0,0]];let f=6*r-12*e+6*i,m=-3*r+9*e-9*i+3*o,_=3*e-3*r;for(let v=0;v<2;++v){if(v>0&&(f=6*t-12*n+6*s,m=-3*t+9*n-9*s+3*a,_=3*n-3*t),h(m)<1e-12){if(h(f)<1e-12)continue;const w=-_/f;0<w&&w<1&&u.push(w);continue}const x=f*f-4*_*m;if(x<0)continue;const S=l(x),T=(-f+S)/(2*m);0<T&&T<1&&u.push(T);const E=(-f-S)/(2*m);0<E&&E<1&&u.push(E)}let g=u.length;const p=g,b=_S(r,t,e,n,i,s,o,a);for(;g--;){const{x:v,y:x}=b(u[g]);d[0][g]=v,d[1][g]=x}d[0][p]=r,d[1][p]=t,d[0][p+1]=o,d[1][p+1]=a;const y=[new Y(Math.min(...d[0]),Math.min(...d[1])),new Y(Math.max(...d[0]),Math.max(...d[1]))];return he.cachesBoundsOfCurve&&(Ll.boundsOfCurveCache[c]=y),y}const TO=(r,t,e)=>{let[n,i,s,o,a,c,l,h]=e;const u=((d,f,m,_,g,p,b)=>{if(m===0||_===0)return[];let y=0,v=0,x=0;const S=Math.PI,T=b*y0,E=lr(T),w=cr(T),M=.5*(-w*d-E*f),P=.5*(-w*f+E*d),L=m**2,I=_**2,F=P**2,z=M**2,N=L*I-L*F-I*z;let Z=Math.abs(m),j=Math.abs(_);if(N<0){const zt=Math.sqrt(1-N/(L*I));Z*=zt,j*=zt}else x=(g===p?-1:1)*Math.sqrt(N/(L*F+I*z));const et=x*Z*P/j,tt=-x*j*M/Z,at=w*et-E*tt+.5*d,dt=E*et+w*tt+.5*f;let St=dv(1,0,(M-et)/Z,(P-tt)/j),O=dv((M-et)/Z,(P-tt)/j,(-M-et)/Z,(-P-tt)/j);p===0&&O>0?O-=2*S:p===1&&O<0&&(O+=2*S);const it=Math.ceil(Math.abs(O/S*2)),mt=[],ht=O/it,It=8/3*Math.sin(ht/4)*Math.sin(ht/4)/Math.sin(ht/2);let kt=St+ht;for(let zt=0;zt<it;zt++)mt[zt]=MO(St,kt,w,E,Z,j,at,dt,It,y,v),y=mt[zt][5],v=mt[zt][6],St=kt,kt+=ht;return mt})(l-r,h-t,i,s,a,c,o);for(let d=0,f=u.length;d<f;d++)u[d][1]+=r,u[d][2]+=t,u[d][3]+=r,u[d][4]+=t,u[d][5]+=r,u[d][6]+=t;return u},EO=r=>{let t=0,e=0,n=0,i=0;const s=[];let o,a=0,c=0;for(const l of r){const h=[...l];let u;switch(h[0]){case"l":h[1]+=t,h[2]+=e;case"L":t=h[1],e=h[2],u=["L",t,e];break;case"h":h[1]+=t;case"H":t=h[1],u=["L",t,e];break;case"v":h[1]+=e;case"V":e=h[1],u=["L",t,e];break;case"m":h[1]+=t,h[2]+=e;case"M":t=h[1],e=h[2],n=h[1],i=h[2],u=["M",t,e];break;case"c":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e,h[5]+=t,h[6]+=e;case"C":a=h[3],c=h[4],t=h[5],e=h[6],u=["C",h[1],h[2],a,c,t,e];break;case"s":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e;case"S":o==="C"?(a=2*t-a,c=2*e-c):(a=t,c=e),t=h[3],e=h[4],u=["C",a,c,h[1],h[2],t,e],a=u[3],c=u[4];break;case"q":h[1]+=t,h[2]+=e,h[3]+=t,h[4]+=e;case"Q":a=h[1],c=h[2],t=h[3],e=h[4],u=["Q",a,c,t,e];break;case"t":h[1]+=t,h[2]+=e;case"T":o==="Q"?(a=2*t-a,c=2*e-c):(a=t,c=e),t=h[1],e=h[2],u=["Q",a,c,t,e];break;case"a":h[6]+=t,h[7]+=e;case"A":TO(t,e,h).forEach(d=>s.push(d)),t=h[6],e=h[7];break;case"z":case"Z":t=n,e=i,u=["Z"]}u?(s.push(u),o=u[0]):o=""}return s},Dd=(r,t,e,n)=>Math.sqrt((e-r)**2+(n-t)**2),_S=(r,t,e,n,i,s,o,a)=>c=>{const l=c**3,h=(f=>3*f**2*(1-f))(c),u=(f=>3*f*(1-f)**2)(c),d=(f=>(1-f)**3)(c);return new Y(o*l+i*h+e*u+r*d,a*l+s*h+n*u+t*d)},bS=r=>r**2,yS=r=>2*r*(1-r),vS=r=>(1-r)**2,AO=(r,t,e,n,i,s,o,a)=>c=>{const l=bS(c),h=yS(c),u=vS(c),d=3*(u*(e-r)+h*(i-e)+l*(o-i)),f=3*(u*(n-t)+h*(s-n)+l*(a-s));return Math.atan2(f,d)},CO=(r,t,e,n,i,s)=>o=>{const a=bS(o),c=yS(o),l=vS(o);return new Y(i*a+e*c+r*l,s*a+n*c+t*l)},PO=(r,t,e,n,i,s)=>o=>{const a=1-o,c=2*(a*(e-r)+o*(i-e)),l=2*(a*(n-t)+o*(s-n));return Math.atan2(l,c)},pv=(r,t,e)=>{let n=new Y(t,e),i=0;for(let s=1;s<=100;s+=1){const o=r(s/100);i+=Dd(n.x,n.y,o.x,o.y),n=o}return i},RO=(r,t)=>{let e,n=0,i=0,s={x:r.x,y:r.y},o=B({},s),a=.01,c=0;const l=r.iterator,h=r.angleFinder;for(;i<t&&a>1e-4;)o=l(n),c=n,e=Dd(s.x,s.y,o.x,o.y),e+i>t?(n-=a,a/=2):(s=o,n+=a,i+=e);return B(B({},o),{},{angle:h(c)})},xS=r=>{let t,e,n=0,i=0,s=0,o=0,a=0;const c=[];for(const l of r){const h={x:i,y:s,command:l[0],length:0};switch(l[0]){case"M":e=h,e.x=o=i=l[1],e.y=a=s=l[2];break;case"L":e=h,e.length=Dd(i,s,l[1],l[2]),i=l[1],s=l[2];break;case"C":t=_S(i,s,l[1],l[2],l[3],l[4],l[5],l[6]),e=h,e.iterator=t,e.angleFinder=AO(i,s,l[1],l[2],l[3],l[4],l[5],l[6]),e.length=pv(t,i,s),i=l[5],s=l[6];break;case"Q":t=CO(i,s,l[1],l[2],l[3],l[4]),e=h,e.iterator=t,e.angleFinder=PO(i,s,l[1],l[2],l[3],l[4]),e.length=pv(t,i,s),i=l[3],s=l[4];break;case"Z":e=h,e.destX=o,e.destY=a,e.length=Dd(i,s,o,a),i=o,s=a}n+=e.length,c.push(e)}return c.push({length:n,x:i,y:s}),c},DO=function(r,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:xS(r),n=0;for(;t-e[n].length>0&&n<e.length-2;)t-=e[n].length,n++;const i=e[n],s=t/i.length,o=r[n];switch(i.command){case"M":return{x:i.x,y:i.y,angle:0};case"Z":return B(B({},new Y(i.x,i.y).lerp(new Y(i.destX,i.destY),s)),{},{angle:Math.atan2(i.destY-i.y,i.destX-i.x)});case"L":return B(B({},new Y(i.x,i.y).lerp(new Y(o[1],o[2]),s)),{},{angle:Math.atan2(o[2]-i.y,o[1]-i.x)});case"C":case"Q":return RO(i,t)}},LO=new RegExp("[mzlhvcsqta][^mzlhvcsqta]*","gi"),mv=new RegExp(wO,"g"),IO=new RegExp(Xo,"gi"),OO={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},FO=r=>{var t;const e=[],n=(t=r.match(LO))!==null&&t!==void 0?t:[];for(const i of n){const s=i[0];if(s==="z"||s==="Z"){e.push([s]);continue}const o=OO[s.toLowerCase()];let a=[];if(s==="a"||s==="A"){mv.lastIndex=0;for(let c=null;c=mv.exec(i);)a.push(...c.slice(1))}else a=i.match(IO)||[];for(let c=0;c<a.length;c+=o){const l=new Array(o),h=SO[s];l[0]=c>0&&h?h:s;for(let u=0;u<o;u++)l[u+1]=parseFloat(a[c+u]);e.push(l)}}return e},kO=(r,t)=>r.map(e=>e.map((n,i)=>i===0||t===void 0?n:Ue(n,t)).join(" ")).join(" ");function gg(r,t){const e=r.style;e&&t&&(typeof t=="string"?e.cssText+=";"+t:Object.entries(t).forEach(n=>{let[i,s]=n;return e.setProperty(i,s)}))}class NO extends Qw{constructor(t){let{allowTouchScrolling:e=!1,containerClass:n=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),U(this,"upper",void 0),U(this,"container",void 0);const{el:i}=this.lower,s=this.createUpperCanvas();this.upper={el:s,ctx:s.getContext("2d")},this.applyCanvasStyle(i,{allowTouchScrolling:e}),this.applyCanvasStyle(s,{allowTouchScrolling:e,styles:{position:"absolute",left:"0",top:"0"}});const o=this.createContainerElement();o.classList.add(n),i.parentNode&&i.parentNode.replaceChild(o,i),o.append(i,s),this.container=o}createUpperCanvas(){const{el:t}=this.lower,e=rs();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=Nc().createElement("div");return t.setAttribute("data-fabric","wrapper"),gg(t,{position:"relative"}),Yy(t),t}applyCanvasStyle(t,e){const{styles:n,allowTouchScrolling:i}=e;gg(t,B(B({},n),{},{"touch-action":i?"manipulation":$n})),Yy(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:n,ctx:i}=this.upper;Zw(n,i,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),ag(this.upper.el,t),ag(this.container,t)}cleanupDOM(t){const e=this.container,{el:n}=this.lower,{el:i}=this.upper;super.cleanupDOM(t),e.removeChild(i),e.removeChild(n),e.parentNode&&e.parentNode.replaceChild(n,e)}dispose(){super.dispose(),Ss().dispose(this.upper.el),delete this.upper,delete this.container}}class cf extends Wo{constructor(){super(...arguments),U(this,"targets",[]),U(this,"_hoveredTargets",[]),U(this,"_objectsToRender",void 0),U(this,"_currentTransform",null),U(this,"_groupSelector",null),U(this,"contextTopDirty",!1)}static getDefaults(){return B(B({},super.getDefaults()),cf.ownDefaults)}get upperCanvasEl(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.el}get contextTop(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.ctx}get wrapperEl(){return this.elements.container}initElements(t){this.elements=new NO(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_onStackOrderChanged(){this._objectsToRender=void 0,super._onStackOrderChanged()}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter(e=>!e.group&&e!==t).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),n=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=n,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,n){const i=this.targetFindTolerance,s=this.pixelFindContext;this.clearContext(s),s.save(),s.translate(-e+i,-n+i),s.transform(...this.viewportTransform);const o=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(s),t.selectionBackgroundColor=o,s.restore();const a=Math.round(i*this.getRetinaScaling());return HI(s,a,a,a)}_isSelectionKeyPressed(t){const e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find(n=>!!n&&t[n]===!0):t[e])}_shouldClearSelection(t,e){const n=this.getActiveObjects(),i=this._activeObject;return!!(!e||e&&i&&n.length>1&&n.indexOf(e)===-1&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e)}_shouldCenterTransform(t,e,n){if(!t)return;let i;return e===tf||e===si||e===zi||e===Wl?i=this.centeredScaling||t.centeredScaling:e===w0&&(i=this.centeredRotation||t.centeredRotation),i?!n:n}_getOriginFromCorner(t,e){const n={x:t.originX,y:t.originY};return e&&(["ml","tl","bl"].includes(e)?n.x=qe:["mr","tr","br"].includes(e)&&(n.x=pe),["tl","mt","tr"].includes(e)?n.y=og:["bl","mb","br"].includes(e)&&(n.y=Qn)),n}_setupCurrentTransform(t,e,n){var i;const s=e.group?sc(this.getScenePoint(t),void 0,e.group.calcTransformMatrix()):this.getScenePoint(t),{key:o="",control:a}=e.getActiveControl()||{},c=n&&a?(i=a.getActionHandler(t,e,a))===null||i===void 0?void 0:i.bind(a):aI,l=((f,m,_,g)=>{if(!m||!f)return"drag";const p=g.controls[m];return p.getActionName(_,p,g)})(n,o,t,e),h=t[this.centeredKey],u=this._shouldCenterTransform(e,l,h)?{x:Zt,y:Zt}:this._getOriginFromCorner(e,o),d={target:e,action:l,actionHandler:c,actionPerformed:!1,corner:o,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:s.x-e.left,offsetY:s.y-e.top,originX:u.x,originY:u.y,ex:s.x,ey:s.y,lastX:s.x,lastY:s.y,theta:Ze(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:h,original:B(B({},$w(e)),{},{originX:u.x,originY:u.y})};this._currentTransform=d,this.fire("before:transform",{e:t,transform:d})}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:n,deltaX:i,deltaY:s}=this._groupSelector,o=new Y(e,n).transform(this.viewportTransform),a=new Y(e+i,n+s).transform(this.viewportTransform),c=this.selectionLineWidth/2;let l=Math.min(o.x,a.x),h=Math.min(o.y,a.y),u=Math.max(o.x,a.x),d=Math.max(o.y,a.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(l,h,u-l,d-h)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,l+=c,h+=c,u-=c,d-=c,Cn.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(l,h,u-l,d-h))}findTarget(t){if(this.skipTargetFind)return;const e=this.getViewportPoint(t),n=this._activeObject,i=this.getActiveObjects();if(this.targets=[],n&&i.length>=1){if(n.findControl(e,cg(t))||i.length>1&&this.searchPossibleTargets([n],e))return n;if(n===this.searchPossibleTargets([n],e)){if(this.preserveObjectStacking){const s=this.targets;this.targets=[];const o=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&o&&o!==n?(this.targets=s,n):o}return n}}return this.searchPossibleTargets(this._objects,e)}_pointIsInObjectSelectionArea(t,e){let n=t.getCoords();const i=this.getZoom(),s=t.padding/i;if(s){const[o,a,c,l]=n,h=Math.atan2(a.y-o.y,a.x-o.x),u=cr(h)*s,d=lr(h)*s,f=u+d,m=u-d;n=[new Y(o.x-m,o.y-f),new Y(a.x+f,a.y-m),new Y(c.x+m,c.y+f),new Y(l.x-f,l.y+m)]}return ke.isPointInPolygon(e,n)}_checkTarget(t,e){return!!(t&&t.visible&&t.evented&&this._pointIsInObjectSelectionArea(t,sc(e,void 0,this.viewportTransform))&&(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing||!this.isTargetTransparent(t,e.x,e.y)))}_searchPossibleTargets(t,e){let n=t.length;for(;n--;){const i=t[n];if(this._checkTarget(i,e)){if(ad(i)&&i.subTargetCheck){const s=this._searchPossibleTargets(i._objects,e);s&&this.targets.push(s)}return i}}}searchPossibleTargets(t,e){const n=this._searchPossibleTargets(t,e);if(n&&ad(n)&&n.interactive&&this.targets[0]){const i=this.targets;for(let s=i.length-1;s>0;s--){const o=i[s];if(!ad(o)||!o.interactive)return o}return i[0]}return n}getViewportPoint(t){return this._pointer?this._pointer:this.getPointer(t,!0)}getScenePoint(t){return this._absolutePointer?this._absolutePointer:this.getPointer(t)}getPointer(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=this.upperCanvasEl,i=n.getBoundingClientRect();let s=tI(t),o=i.width||0,a=i.height||0;o&&a||(Qn in i&&og in i&&(a=Math.abs(i.top-i.bottom)),qe in i&&pe in i&&(o=Math.abs(i.right-i.left))),this.calcOffset(),s.x=s.x-this._offset.left,s.y=s.y-this._offset.top,e||(s=sc(s,void 0,this.viewportTransform));const c=this.getRetinaScaling();c!==1&&(s.x/=c,s.y/=c);const l=o===0||a===0?new Y(1,1):new Y(n.width/o,n.height/a);return s.multiply(l)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=rs(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveObjects(){const t=this._activeObject;return To(t)?t.getObjects():t?[t]:[]}_fireSelectionEvents(t,e){let n=!1,i=!1;const s=this.getActiveObjects(),o=[],a=[];t.forEach(c=>{s.includes(c)||(n=!0,c.fire("deselected",{e,target:c}),a.push(c))}),s.forEach(c=>{t.includes(c)||(n=!0,c.fire("selected",{e,target:c}),o.push(c))}),t.length>0&&s.length>0?(i=!0,n&&this.fire("selection:updated",{e,selected:o,deselected:a})):s.length>0?(i=!0,this.fire("selection:created",{e,selected:o})):t.length>0&&(i=!0,this.fire("selection:cleared",{e,deselected:a})),i&&(this._objectsToRender=void 0)}setActiveObject(t,e){const n=this.getActiveObjects(),i=this._setActiveObject(t,e);return this._fireSelectionEvents(n,e),i}_setActiveObject(t,e){const n=this._activeObject;return n!==t&&!(!this._discardActiveObject(e,t)&&this._activeObject)&&!t.onSelect({e})&&(this._activeObject=t,To(t)&&n!==t&&t.set("canvas",this),t.setCoords(),!0)}_discardActiveObject(t,e){const n=this._activeObject;return!!n&&!n.onDeselect({e:t,object:e})&&(this._currentTransform&&this._currentTransform.target===n&&this.endCurrentTransform(t),To(n)&&n===this._hoveredTarget&&(this._hoveredTarget=void 0),this._activeObject=void 0,!0)}discardActiveObject(t){const e=this.getActiveObjects(),n=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[n]});const i=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),i}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,n=e.target,i={e:t,target:n,transform:e,action:e.action};n._scaling&&(n._scaling=!1),n.setCoords(),e.actionPerformed&&(this.fire("object:modified",i),n.fire(Sd,i))}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeObject;To(t)&&(t.removeAll(),t.dispose()),delete this._activeObject,super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,n){const i=this._realizeGroupTransformOnObject(t),s=super._toObject(t,e,n);return t.set(i),s}_realizeGroupTransformOnObject(t){const{group:e}=t;if(e&&To(e)&&this._activeObject===e){const n=zc(t,["angle","flipX","flipY",pe,si,zi,Uc,Bc,Qn]);return nI(t,e.calcOwnMatrix()),n}return{}}_setSVGObject(t,e,n){const i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,n),e.set(i)}}U(cf,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1,containerClass:"canvas-container",preserveObjectStacking:!1});class UO{constructor(t){U(this,"targets",[]),U(this,"__disposer",void 0);const e=()=>{const{hiddenTextarea:i}=t.getActiveObject()||{};i&&i.focus()},n=t.upperCanvasEl;n.addEventListener("click",e),this.__disposer=()=>n.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach(t=>{t.isEditing&&t.exitEditing()})}add(t){this.targets.push(t)}remove(t){this.unregister(t),Ua(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;!((e=this.target)===null||e===void 0)&&e.isEditing&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const BO=["target","oldTarget","fireCanvas","e"],li={passive:!1},Da=(r,t)=>{const e=r.getViewportPoint(t),n=r.getScenePoint(t);return{viewportPoint:e,scenePoint:n,pointer:e,absolutePointer:n}},Tr=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return r.addEventListener(...e)},Mi=function(r){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return r.removeEventListener(...e)},zO={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class gv extends cf{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}),U(this,"_isClick",void 0),U(this,"textEditingManager",new UO(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(e=>{this[e]=this[e].bind(this)}),this.addOrRemove(Tr,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const n=this.upperCanvasEl,i=this._getEventPrefix();t(Kw(n),"resize",this._onResize),t(n,i+"down",this._onMouseDown),t(n,"".concat(i,"move"),this._onMouseMove,li),t(n,"".concat(i,"out"),this._onMouseOut),t(n,"".concat(i,"enter"),this._onMouseEnter),t(n,"wheel",this._onMouseWheel),t(n,"contextmenu",this._onContextMenu),t(n,"dblclick",this._onDoubleClick),t(n,"dragstart",this._onDragStart),t(n,"dragend",this._onDragEnd),t(n,"dragover",this._onDragOver),t(n,"dragenter",this._onDragEnter),t(n,"dragleave",this._onDragLeave),t(n,"drop",this._onDrop),this.enablePointerEvents||t(n,"touchstart",this._onTouchStart,li)}removeListeners(){this.addOrRemove(Mi,"remove");const t=this._getEventPrefix(),e=$i(this.upperCanvasEl);Mi(e,"".concat(t,"up"),this._onMouseUp),Mi(e,"touchend",this._onTouchEnd,li),Mi(e,"".concat(t,"move"),this._onMouseMove,li),Mi(e,"touchmove",this._onMouseMove,li),clearTimeout(this._willAddMouseDown)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,n=B({e:t},Da(this,t));this.fire("mouse:out",B(B({},n),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",B({},n)),this._hoveredTargets.forEach(i=>{this.fire("mouse:out",B(B({},n),{},{target:i})),i&&i.fire("mouseout",B({},n))}),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",B({e:t},Da(this,t))),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(e&&e.onDragStart(t)){this._dragSource=e;const n={e:t,target:e};return this.fire("dragstart",n),e.fire("dragstart",n),void Tr(this.upperCanvasEl,"drag",this._onDragProgress)}lg(t)}_renderDragEffects(t,e,n){let i=!1;const s=this._dropTarget;s&&s!==e&&s!==n&&(s.clearContextTop(),i=!0),e==null||e.clearContextTop(),n!==e&&(n==null||n.clearContextTop());const o=this.contextTop;o.save(),o.transform(...this.viewportTransform),e&&(o.save(),e.transform(o),e.renderDragSourceEffect(t),o.restore(),i=!0),n&&(o.save(),n.transform(o),n.renderDropTargetEffect(t),o.restore(),i=!0),o.restore(),i&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==$n,n=e?this._activeObject:void 0,i={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:n};Mi(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",i),this._dragSource&&this._dragSource.fire("dragend",i),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getViewportPoint(t)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:n,targets:i}=this.findDragTargets(t),s=this._dragSource,o={e:t,target:n,subTargets:i,dragSource:s,canDrop:!1,dropTarget:void 0};let a;this.fire(e,o),this._fireEnterLeaveEvents(n,o),n&&(n.canDrop(t)&&(a=n),n.fire(e,o));for(let c=0;c<i.length;c++){const l=i[c];l.canDrop(t)&&(a=l),l.fire(e,o)}this._renderDragEffects(t,s,a),this._dropTarget=a}_onDragEnter(t){const{target:e,targets:n}=this.findDragTargets(t),i={e:t,target:e,subTargets:n,dragSource:this._dragSource};this.fire("dragenter",i),this._fireEnterLeaveEvents(e,i)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:n}=this.findDragTargets(t),i=this._basicEventHandler("drop:before",B({e:t,target:e,subTargets:n,dragSource:this._dragSource},Da(this,t)));i.didDrop=!1,i.dropTarget=void 0,this._basicEventHandler("drop",i),this.fire("drop:after",i)}_onContextMenu(t){const e=this.findTarget(t),n=this.targets||[],i=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:n});return this.stopContextMenu&&lg(t),this._basicEventHandler("contextmenu",i),!1}_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData()}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return t.isPrimary===!0||t.isPrimary!==!1&&(t.type==="touchend"&&t.touches.length===0||!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId)}_onTouchStart(t){let e=!this.allowTouchScrolling;const n=this._activeObject;this.mainTouchId===void 0&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),(this.isDrawingMode||n&&this._target===n)&&(e=!0),e&&t.preventDefault(),this._resetTransformEventData();const i=this.upperCanvasEl,s=this._getEventPrefix(),o=$i(i);Tr(o,"touchend",this._onTouchEnd,li),e&&Tr(o,"touchmove",this._onMouseMove,li),Mi(i,"".concat(s,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,n=this._getEventPrefix();Mi(e,"".concat(n,"move"),this._onMouseMove,li);const i=$i(e);Tr(i,"".concat(n,"up"),this._onMouseUp),Tr(i,"".concat(n,"move"),this._onMouseMove,li)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),delete this.mainTouchId;const e=this._getEventPrefix(),n=$i(this.upperCanvasEl);Mi(n,"touchend",this._onTouchEnd,li),Mi(n,"touchmove",this._onMouseMove,li),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{Tr(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,n=this._getEventPrefix();if(this._isMainEvent(t)){const i=$i(this.upperCanvasEl);Mi(i,"".concat(n,"up"),this._onMouseUp),Mi(i,"".concat(n,"move"),this._onMouseMove,li),Tr(e,"".concat(n,"move"),this._onMouseMove,li)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||!e.shouldStartDragging(t))&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t}__onMouseUp(t){var e;this._cacheTransformEventData(t),this._handleEvent(t,"up:before");const n=this._currentTransform,i=this._isClick,s=this._target,{button:o}=t;if(o)return(this.fireMiddleClick&&o===1||this.fireRightClick&&o===2)&&this._handleEvent(t,"up"),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);if(!this._isMainEvent(t))return;let a,c,l=!1;if(n&&(this._finalizeCurrentTransform(t),l=n.actionPerformed),!i){const h=s===this._activeObject;this.handleSelection(t),l||(l=this._shouldRender(s)||!h&&s===this._activeObject)}if(s){const h=s.findControl(this.getViewportPoint(t),cg(t)),{key:u,control:d}=h||{};if(c=u,s.selectable&&s!==this._activeObject&&s.activeOn==="up")this.setActiveObject(s,t),l=!0;else if(d){const f=d.getMouseUpHandler(t,s,d);f&&(a=this.getScenePoint(t),f.call(d,t,n,a.x,a.y))}s.isMoving=!1}if(n&&(n.target!==s||n.corner!==c)){const h=n.target&&n.target.controls[n.corner],u=h&&h.getMouseUpHandler(t,n.target,h);a=a||this.getScenePoint(t),u&&u.call(h,t,n,a.x,a.y)}this._setCursorFromEvent(t,s),this._handleEvent(t,"up"),this._groupSelector=null,this._currentTransform=null,s&&(s.__corner=void 0),l?this.requestRenderAll():i||(e=this._activeObject)!==null&&e!==void 0&&e.isEditing||this.renderTop()}_basicEventHandler(t,e){const{target:n,subTargets:i=[]}=e;this.fire(t,e),n&&n.fire(t,e);for(let s=0;s<i.length;s++)i[s]!==n&&i[s].fire(t,e);return e}_handleEvent(t,e){const n=this._target,i=this.targets||[],s=B(B({e:t,target:n,subTargets:i},Da(this,t)),{},{transform:this._currentTransform},e==="up:before"||e==="up"?{isClick:this._isClick,currentTarget:this.findTarget(t),currentSubTargets:this.targets}:{});this.fire("mouse:".concat(e),s),n&&n.fire("mouse".concat(e),s);for(let o=0;o<i.length;o++)i[o]!==n&&i[o].fire("mouse".concat(e),s)}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getScenePoint(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getScenePoint(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target;const{button:n}=t;if(n)return(this.fireMiddleClick&&n===1||this.fireRightClick&&n===2)&&this._handleEvent(t,"down"),void this._resetTransformEventData();if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._isMainEvent(t)||this._currentTransform)return;let i=this._shouldRender(e),s=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,s=!0,i=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const o=this.getScenePoint(t);this._groupSelector={x:o.x,y:o.y,deltaY:0,deltaX:0}}if(e){const o=e===this._activeObject;e.selectable&&e.activeOn==="down"&&this.setActiveObject(e,t);const a=e.findControl(this.getViewportPoint(t),cg(t));if(e===this._activeObject&&(a||!s)){this._setupCurrentTransform(t,e,o);const c=a?a.control:void 0,l=this.getScenePoint(t),h=c&&c.getMouseDownHandler(t,e,c);h&&h.call(c,t,this._currentTransform,l.x,l.y)}}i&&(this._objectsToRender=void 0),this._handleEvent(t,"down"),i&&this.requestRenderAll()}_resetTransformEventData(){this._target=this._pointer=this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getViewportPoint(t),this._absolutePointer=sc(this._pointer,void 0,this.viewportTransform),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}__onMouseMove(t){if(this._isClick=!1,this._cacheTransformEventData(t),this._handleEvent(t,"move:before"),this.isDrawingMode)return void this._onMouseMoveInDrawingMode(t);if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const n=this.getScenePoint(t);e.deltaX=n.x-e.x,e.deltaY=n.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const n=this.findTarget(t);this._setCursorFromEvent(t,n),this._fireOverOutEvents(t,n)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const n=this._hoveredTarget,i=this._hoveredTargets,s=this.targets,o=Math.max(i.length,s.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:n,fireCanvas:!0});for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("mouse",{e:t,target:s[a],oldTarget:i[a]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const n=this._draggedoverTarget,i=this._hoveredTargets,s=this.targets,o=Math.max(i.length,s.length);this.fireSyntheticInOutEvents("drag",B(B({},e),{},{target:t,oldTarget:n,fireCanvas:!0}));for(let a=0;a<o;a++)this.fireSyntheticInOutEvents("drag",B(B({},e),{},{target:s[a],oldTarget:i[a]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:n,oldTarget:i,fireCanvas:s,e:o}=e,a=Oe(e,BO);const{targetIn:c,targetOut:l,canvasIn:h,canvasOut:u}=zO[t],d=i!==n;if(i&&d){const f=B(B({},a),{},{e:o,target:i,nextTarget:n},Da(this,o));s&&this.fire(u,f),i.fire(l,f)}if(n&&d){const f=B(B({},a),{},{e:o,target:n,previousTarget:i},Da(this,o));s&&this.fire(h,f),n.fire(c,f)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getScenePoint(t),n=this._currentTransform,i=n.target,s=i.group?sc(e,void 0,i.group.calcTransformMatrix()):e;n.shiftKey=t.shiftKey,n.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,n,s),n.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,n){const{action:i,actionHandler:s,target:o}=e,a=!!s&&s(t,e,n.x,n.y);a&&o.setCoords(),i==="drag"&&a&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||a}_setCursorFromEvent(t,e){if(!e)return void this.setCursor(this.defaultCursor);let n=e.hoverCursor||this.hoverCursor;const i=To(this._activeObject)?this._activeObject:null,s=(!i||e.group!==i)&&e.findControl(this.getViewportPoint(t));if(s){const o=s.control;this.setCursor(o.cursorStyleHandler(t,o,e))}else e.subTargetCheck&&this.targets.concat().reverse().map(o=>{n=o.hoverCursor||n}),this.setCursor(n)}handleMultiSelection(t,e){const n=this._activeObject,i=To(n);if(n&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(n!==e||i)&&(i||!e.isDescendantOf(n)&&!n.isDescendantOf(e))&&!e.onSelect({e:t})&&!n.getActiveControl()){if(i){const s=n.getObjects();if(e===n){const o=this.getViewportPoint(t);if(!(e=this.searchPossibleTargets(s,o)||this.searchPossibleTargets(this._objects,o))||!e.selectable)return!1}e.group===n?(n.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],n.size()===1&&this._setActiveObject(n.item(0),t)):(n.multiSelectAdd(e),this._hoveredTarget=n,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(s,t)}else{n.isEditing&&n.exitEditing();const s=new(wt.getClass("ActiveSelection"))([],{canvas:this});s.multiSelectAdd(n,e),this._hoveredTarget=s,this._setActiveObject(s,t),this._fireSelectionEvents([n],t)}return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:n,deltaX:i,deltaY:s}=this._groupSelector,o=new Y(e,n),a=o.add(new Y(i,s)),c=o.min(a),l=o.max(a).subtract(c),h=this.collectObjects({left:c.x,top:c.y,width:l.x,height:l.y},{includeIntersecting:!this.selectionFullyContained}),u=o.eq(a)?h[0]?[h[0]]:[]:h.length>1?h.filter(d=>!d.onSelect({e:t})).reverse():h;if(u.length===1)this.setActiveObject(u[0],t);else if(u.length>1){const d=wt.getClass("ActiveSelection");this.setActiveObject(new d(u,{canvas:this}),t)}return this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const wS={x1:0,y1:0,x2:0,y2:0},VO=B(B({},wS),{},{r1:0,r2:0}),qa=(r,t)=>isNaN(r)&&typeof t=="number"?t:r,HO=/^(\d+\.\d+)%|(\d+)%$/;function SS(r){return r&&HO.test(r)}function MS(r,t){const e=typeof r=="number"?r:typeof r=="string"?parseFloat(r)/(SS(r)?100:1):NaN;return wc(0,qa(e,t),1)}const GO=/\s*;\s*/,jO=/\s*:\s*/;function WO(r,t){let e,n;const i=r.getAttribute("style");if(i){const o=i.split(GO);o[o.length-1]===""&&o.pop();for(let a=o.length;a--;){const[c,l]=o[a].split(jO).map(h=>h.trim());c==="stop-color"?e=l:c==="stop-opacity"&&(n=l)}}const s=new ge(e||r.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:MS(r.getAttribute("offset"),0),color:s.toRgb(),opacity:qa(parseFloat(n||r.getAttribute("stop-opacity")||""),1)*s.getAlpha()*t}}function XO(r,t){const e=[],n=r.getElementsByTagName("stop"),i=MS(t,1);for(let s=n.length;s--;)e.push(WO(n[s],i));return e}function TS(r){return r.nodeName==="linearGradient"||r.nodeName==="LINEARGRADIENT"?"linear":"radial"}function ES(r){return r.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}function Xi(r,t){return r.getAttribute(t)}function YO(r,t){return function(e,n){let i,{width:s,height:o,gradientUnits:a}=n;return Object.keys(e).reduce((c,l)=>{const h=e[l];return h==="Infinity"?i=1:h==="-Infinity"?i=0:(i=typeof h=="string"?parseFloat(h):h,typeof h=="string"&&SS(h)&&(i*=.01,a==="pixels"&&(l!=="x1"&&l!=="x2"&&l!=="r2"||(i*=s),l!=="y1"&&l!=="y2"||(i*=o)))),c[l]=i,c},{})}(TS(r)==="linear"?function(e){return{x1:Xi(e,"x1")||0,y1:Xi(e,"y1")||0,x2:Xi(e,"x2")||"100%",y2:Xi(e,"y2")||0}}(r):function(e){return{x1:Xi(e,"fx")||Xi(e,"cx")||"50%",y1:Xi(e,"fy")||Xi(e,"cy")||"50%",r1:0,x2:Xi(e,"cx")||"50%",y2:Xi(e,"cy")||"50%",r2:Xi(e,"r")||"50%"}}(r),B(B({},t),{},{gradientUnits:ES(r)}))}class Mu{constructor(t){const{type:e="linear",gradientUnits:n="pixels",coords:i={},colorStops:s=[],offsetX:o=0,offsetY:a=0,gradientTransform:c,id:l}=t||{};Object.assign(this,{type:e,gradientUnits:n,coords:B(B({},e==="radial"?VO:wS),i),colorStops:s,offsetX:o,offsetY:a,gradientTransform:c,id:l?"".concat(l,"_").concat(Kr()):Kr()})}addColorStop(t){for(const e in t){const n=new ge(t[e]);this.colorStops.push({offset:parseFloat(e),color:n.toRgb(),opacity:n.getAlpha()})}return this}toObject(t){return B(B({},zc(this,t)),{},{type:this.type,coords:B({},this.coords),colorStops:this.colorStops.map(e=>B({},e)),offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?[...this.gradientTransform]:void 0})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[],i=this.gradientTransform?this.gradientTransform.concat():Gn.concat(),s=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",o=this.colorStops.map(u=>B({},u)).sort((u,d)=>u.offset-d.offset);let a=-this.offsetX,c=-this.offsetY;var l;s==="objectBoundingBox"?(a/=t.width,c/=t.height):(a+=t.width/2,c+=t.height/2),(l=t)&&typeof l._renderPathCommands=="function"&&this.gradientUnits!=="percentage"&&(a-=t.pathOffset.x,c-=t.pathOffset.y),i[4]-=a,i[5]-=c;const h=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(s,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(Ed(i),'"'),""].join(" ");if(this.type==="linear"){const{x1:u,y1:d,x2:f,y2:m}=this.coords;n.push("<linearGradient ",h,' x1="',u,'" y1="',d,'" x2="',f,'" y2="',m,`">
`)}else if(this.type==="radial"){const{x1:u,y1:d,x2:f,y2:m,r1:_,r2:g}=this.coords,p=_>g;n.push("<radialGradient ",h,' cx="',p?u:f,'" cy="',p?d:m,'" r="',p?_:g,'" fx="',p?f:u,'" fy="',p?m:d,`">
`),p&&(o.reverse(),o.forEach(y=>{y.offset=1-y.offset}));const b=Math.min(_,g);if(b>0){const y=b/Math.max(_,g);o.forEach(v=>{v.offset+=y*(1-v.offset)})}}return o.forEach(u=>{let{color:d,offset:f,opacity:m}=u;n.push("<stop ",'offset="',100*f+"%",'" style="stop-color:',d,m!==void 0?";stop-opacity: "+m:";",`"/>
`)}),n.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),n.join("")}toLive(t){const{x1:e,y1:n,x2:i,y2:s,r1:o,r2:a}=this.coords,c=this.type==="linear"?t.createLinearGradient(e,n,i,s):t.createRadialGradient(e,n,o,i,s,a);return this.colorStops.forEach(l=>{let{color:h,opacity:u,offset:d}=l;c.addColorStop(d,u!==void 0?new ge(h).setAlpha(u).toRgba():h)}),c}static async fromObject(t){const{colorStops:e,gradientTransform:n}=t;return new this(B(B({},t),{},{colorStops:e?e.map(i=>B({},i)):void 0,gradientTransform:n?[...n]:void 0}))}static fromElement(t,e,n){const i=ES(t),s=e._findCenterFromElement();return new this(B({id:t.getAttribute("id")||void 0,type:TS(t),coords:YO(t,{width:n.viewBoxWidth||n.width,height:n.viewBoxHeight||n.height}),colorStops:XO(t,n.opacity),gradientUnits:i,gradientTransform:fg(t.getAttribute("gradientTransform")||"")},i==="pixels"?{offsetX:e.width/2-s.x,offsetY:e.height/2-s.y}:{offsetX:0,offsetY:0}))}}U(Mu,"type","Gradient"),wt.setClass(Mu,"gradient"),wt.setClass(Mu,"linear"),wt.setClass(Mu,"radial");const qO=["type","source","patternTransform"];class Pp{get type(){return"pattern"}set type(t){qr("warn","Setting type has no effect",t)}constructor(t){U(this,"repeat","repeat"),U(this,"offsetX",0),U(this,"offsetY",0),U(this,"crossOrigin",""),this.id=Kr(),Object.assign(this,t)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&this.source.naturalWidth!==0&&this.source.naturalHeight!==0)?t.createPattern(this.source,this.repeat):null}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:e,crossOrigin:n}=this;return B(B({},zc(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:n,offsetX:Ue(this.offsetX,he.NUM_FRACTION_DIGITS),offsetY:Ue(this.offsetY,he.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:n}=t;const{source:i,repeat:s,id:o}=this,a=qa(this.offsetX/e,0),c=qa(this.offsetY/n,0),l=s==="repeat-y"||s==="no-repeat"?1+Math.abs(a||0):qa(i.width/e,0),h=s==="repeat-x"||s==="no-repeat"?1+Math.abs(c||0):qa(i.height/n,0);return['<pattern id="SVGID_'.concat(o,'" x="').concat(a,'" y="').concat(c,'" width="').concat(l,'" height="').concat(h,'">'),'<image x="0" y="0" width="'.concat(i.width,'" height="').concat(i.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(t,e){let{type:n,source:i,patternTransform:s}=t,o=Oe(t,qO);const a=await ld(i,B(B({},e),{},{crossOrigin:o.crossOrigin}));return new this(B(B({},o),{},{patternTransform:s&&s.slice(0),source:a}))}}U(Pp,"type","Pattern"),wt.setClass(Pp),wt.setClass(Pp,"pattern");const KO=["path","left","top"],ZO=["d"];class Eo extends Cn{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:n,left:i,top:s}=e,o=Oe(e,KO);super(),Object.assign(this,Eo.ownDefaults),this.setOptions(o),this._setPath(t||[],!0),typeof i=="number"&&this.set(pe,i),typeof s=="number"&&this.set(Qn,s)}_setPath(t,e){this.path=EO(Array.isArray(t)?t:FO(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new Y(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){const e=-this.pathOffset.x,n=-this.pathOffset.y;t.beginPath();for(const i of this.path)switch(i[0]){case"L":t.lineTo(i[1]+e,i[2]+n);break;case"M":t.moveTo(i[1]+e,i[2]+n);break;case"C":t.bezierCurveTo(i[1]+e,i[2]+n,i[3]+e,i[4]+n,i[5]+e,i[6]+n);break;case"Q":t.quadraticCurveTo(i[1]+e,i[2]+n,i[3]+e,i[4]+n);break;case"Z":t.closePath()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return B(B({},super.toObject(t)),{},{path:this.path.map(e=>e.slice())})}toDatalessObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=kO(this.path,he.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const t=he.NUM_FRACTION_DIGITS;return" translate(".concat(Ue(-this.pathOffset.x,t),", ").concat(Ue(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:n,pathOffset:i}=this._calcDimensions();this.set({width:e,height:n,pathOffset:i}),t&&this.setPositionByOrigin(i,Zt,Zt)}_calcBoundsFromPath(){const t=[];let e=0,n=0,i=0,s=0;for(const o of this.path)switch(o[0]){case"L":i=o[1],s=o[2],t.push({x:e,y:n},{x:i,y:s});break;case"M":i=o[1],s=o[2],e=i,n=s;break;case"C":t.push(...fv(i,s,o[1],o[2],o[3],o[4],o[5],o[6])),i=o[5],s=o[6];break;case"Q":t.push(...fv(i,s,o[1],o[2],o[1],o[2],o[3],o[4])),i=o[3],s=o[4];break;case"Z":i=e,s=n}return nr(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return B(B({},t),{},{pathOffset:new Y(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e,n){const i=pr(t,this.ATTRIBUTE_NAMES,n),{d:s}=i;return new this(s,B(B(B({},Oe(i,ZO)),e),{},{left:void 0,top:void 0}))}}U(Eo,"type","Path"),U(Eo,"cacheProperties",[...fr,"path","fillRule"]),U(Eo,"ATTRIBUTE_NAMES",[...no,"d"]),wt.setClass(Eo),wt.setSVGClass(Eo);const QO=["left","top","radius"],AS=["radius","startAngle","endAngle","counterClockwise"];class js extends Cn{static getDefaults(){return B(B({},super.getDefaults()),js.ownDefaults)}constructor(t){super(),Object.assign(this,js.ownDefaults),this.setOptions(t)}_set(t,e){return super._set(t,e),t==="radius"&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,Ze(this.startAngle),Ze(this.endAngle),this.counterClockwise),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get(si)}getRadiusY(){return this.get("radius")*this.get(zi)}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...AS,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(t===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',"".concat(this.radius),`" />
`];{const{radius:e}=this,n=Ze(this.startAngle),i=Ze(this.endAngle),s=cr(n)*e,o=lr(n)*e,a=cr(i)*e,c=lr(i)*e,l=t>180?1:0,h=this.counterClockwise?0:1;return['<path d="M '.concat(s," ").concat(o," A ").concat(e," ").concat(e," 0 ").concat(l," ").concat(h," ").concat(a," ").concat(c,'" '),"COMMON_PARTS",` />
`]}}static async fromElement(t,e,n){const i=pr(t,this.ATTRIBUTE_NAMES,n),{left:s=0,top:o=0,radius:a=0}=i;return new this(B(B({},Oe(i,QO)),{},{radius:a,left:s-a,top:o-a}))}static fromObject(t){return super._fromObject(t)}}U(js,"type","Circle"),U(js,"cacheProperties",[...fr,...AS]),U(js,"ownDefaults",{radius:0,startAngle:0,endAngle:360,counterClockwise:!1}),U(js,"ATTRIBUTE_NAMES",["cx","cy","r",...no]),wt.setClass(js),wt.setSVGClass(js);const $O=["x1","y1","x2","y2"],JO=["x1","y1","x2","y2"],_g=["x1","x2","y1","y2"];class Ao extends Cn{constructor(){let[t,e,n,i]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Ao.ownDefaults),this.setOptions(s),this.x1=t,this.x2=n,this.y1=e,this.y2=i,this._setWidthHeight();const{left:o,top:a}=s;typeof o=="number"&&this.set(pe,o),typeof a=="number"&&this.set(Qn,a)}_setWidthHeight(){const{x1:t,y1:e,x2:n,y2:i}=this;this.width=Math.abs(n-t),this.height=Math.abs(i-e);const{left:s,top:o,width:a,height:c}=nr([{x:t,y:e},{x:n,y:i}]),l=new Y(s+a/2,o+c/2);this.setPositionByOrigin(l,Zt,Zt)}_set(t,e){return super._set(t,e),_g.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const n=t.strokeStyle;var i;Ri(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=(i=this.stroke)!==null&&i!==void 0?i:t.fillStyle,this.stroke&&this._renderStroke(t),t.strokeStyle=n}_findCenterFromElement(){return new Y((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return B(B({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(t.y-=this.strokeWidth),this.height===0&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:n,y2:i,width:s,height:o}=this,a=t<=e?-1:1,c=n<=i?-1:1;return{x1:a*s/2,x2:a*-s/2,y1:c*o/2,y2:c*-o/2}}_toSVG(){const{x1:t,x2:e,y1:n,y2:i}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(n,'" x2="').concat(e,'" y2="').concat(i,`" />
`)]}static async fromElement(t,e,n){const i=pr(t,this.ATTRIBUTE_NAMES,n),{x1:s=0,y1:o=0,x2:a=0,y2:c=0}=i;return new this([s,o,a,c],Oe(i,$O))}static fromObject(t){let{x1:e,y1:n,x2:i,y2:s}=t,o=Oe(t,JO);return this._fromObject(B(B({},o),{},{points:[e,n,i,s]}),{extraParam:"points"})}}U(Ao,"type","Line"),U(Ao,"cacheProperties",[...fr,..._g]),U(Ao,"ATTRIBUTE_NAMES",no.concat(_g)),wt.setClass(Ao),wt.setSVGClass(Ao);class Co extends Cn{static getDefaults(){return B(B({},super.getDefaults()),Co.ownDefaults)}constructor(t){super(),Object.assign(this,Co.ownDefaults),this.setOptions(t)}_render(t){const e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,n),t.lineTo(0,-n),t.lineTo(e,n),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}U(Co,"type","Triangle"),U(Co,"ownDefaults",{width:100,height:100}),wt.setClass(Co),wt.setSVGClass(Co);const CS=["rx","ry"];class Ws extends Cn{static getDefaults(){return B(B({},super.getDefaults()),Ws.ownDefaults)}constructor(t){super(),Object.assign(this,Ws.ownDefaults),this.setOptions(t)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get(si)}getRy(){return this.get("ry")*this.get(zi)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...CS,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" rx="'.concat(this.rx,'" ry="').concat(this.ry,`" />
`)]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,xd,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t,e,n){const i=pr(t,this.ATTRIBUTE_NAMES,n);return i.left=(i.left||0)-i.rx,i.top=(i.top||0)-i.ry,new this(i)}}function tF(r){if(!r)return[];const t=r.replace(/,/g," ").trim().split(/\s+/),e=[];for(let n=0;n<t.length;n+=2)e.push({x:parseFloat(t[n]),y:parseFloat(t[n+1])});return e}U(Ws,"type","Ellipse"),U(Ws,"cacheProperties",[...fr,...CS]),U(Ws,"ownDefaults",{rx:0,ry:0}),U(Ws,"ATTRIBUTE_NAMES",[...no,"cx","cy","rx","ry"]),wt.setClass(Ws),wt.setSVGClass(Ws);const eF=["left","top"],PS={exactBoundingBox:!1};class Zi extends Cn{static getDefaults(){return B(B({},super.getDefaults()),Zi.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),U(this,"strokeDiff",void 0),Object.assign(this,Zi.ownDefaults),this.setOptions(e),this.points=t;const{left:n,top:i}=e;this.initialized=!0,this.setBoundingBox(!0),typeof n=="number"&&this.set(pe,n),typeof i=="number"&&this.set(Qn,i)}isOpen(){return!0}_projectStrokeOnPoints(t){return jI(this.points,t,this.isOpen())}_calcDimensions(t){t=B({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:this.strokeMiterLimit,strokeUniform:this.strokeUniform,strokeWidth:this.strokeWidth},t||{});const e=this.exactBoundingBox?this._projectStrokeOnPoints(t).map(l=>l.projectedPoint):this.points;if(e.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new Y,strokeOffset:new Y,strokeDiff:new Y};const n=nr(e),i=ef(B(B({},t),{},{scaleX:1,scaleY:1})),s=nr(this.points.map(l=>Kn(l,i,!0))),o=new Y(this.scaleX,this.scaleY);let a=n.left+n.width/2,c=n.top+n.height/2;return this.exactBoundingBox&&(a-=c*Math.tan(Ze(this.skewX)),c-=a*Math.tan(Ze(this.skewY))),B(B({},n),{},{pathOffset:new Y(a,c),strokeOffset:new Y(s.left,s.top).subtract(new Y(n.left,n.top)).multiply(o),strokeDiff:new Y(n.width,n.height).subtract(new Y(s.width,s.height)).multiply(o)})}_findCenterFromElement(){const t=nr(this.points);return new Y(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:n,width:i,height:s,pathOffset:o,strokeOffset:a,strokeDiff:c}=this._calcDimensions();this.set({width:i,height:s,pathOffset:o,strokeOffset:a,strokeDiff:c}),t&&this.setPositionByOrigin(new Y(e+i/2,n+s/2),Zt,Zt)}isStrokeAccountedForInDimensions(){return this.exactBoundingBox}_getNonTransformedDimensions(){return this.exactBoundingBox?new Y(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this.exactBoundingBox){let o;if(Object.keys(t).some(a=>this.strokeUniform||this.constructor.layoutProperties.includes(a))){var e,n;const{width:a,height:c}=this._calcDimensions(t);o=new Y((e=t.width)!==null&&e!==void 0?e:a,(n=t.height)!==null&&n!==void 0?n:c)}else{var i,s;o=new Y((i=t.width)!==null&&i!==void 0?i:this.width,(s=t.height)!==null&&s!==void 0?s:this.height)}return o.multiply(new Y(t.scaleX||this.scaleX,t.scaleY||this.scaleY))}return super._getTransformedDimensions(t)}_set(t,e){const n=this.initialized&&this[t]!==e,i=super._set(t,e);return this.exactBoundingBox&&n&&((t===si||t===zi)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),i}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return B(B({},super.toObject(t)),{},{points:this.points.map(e=>{let{x:n,y:i}=e;return{x:n,y:i}})})}_toSVG(){const t=[],e=this.pathOffset.x,n=this.pathOffset.y,i=he.NUM_FRACTION_DIGITS;for(let s=0,o=this.points.length;s<o;s++)t.push(Ue(this.points[s].x-e,i),",",Ue(this.points[s].y-n,i)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),`" />
`)]}_render(t){const e=this.points.length,n=this.pathOffset.x,i=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-i);for(let s=0;s<e;s++){const o=this.points[s];t.lineTo(o.x-n,o.y-i)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e,n){return new this(tF(t.getAttribute("points")),B(B({},Oe(pr(t,this.ATTRIBUTE_NAMES,n),eF)),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}U(Zi,"ownDefaults",PS),U(Zi,"type","Polyline"),U(Zi,"layoutProperties",[Uc,Bc,"strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),U(Zi,"cacheProperties",[...fr,"points"]),U(Zi,"ATTRIBUTE_NAMES",[...no]),wt.setClass(Zi),wt.setSVGClass(Zi);class Tu extends Zi{isOpen(){return!1}}U(Tu,"ownDefaults",PS),U(Tu,"type","Polygon"),wt.setClass(Tu),wt.setSVGClass(Tu);const RS=["fontSize","fontWeight","fontFamily","fontStyle"],DS=["underline","overline","linethrough"],LS=[...RS,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],IS=[...LS,...DS,"textBackgroundColor","direction"],nF=[...RS,...DS,Jn,"strokeWidth",on,"deltaY","textBackgroundColor"],iF={_reNewline:x0,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:pe,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:void 0,pathStartOffset:0,pathSide:pe,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},ps="justify",Ld="justify-left",Ol="justify-right",Fl="justify-center";class OS extends Cn{isEmptyStyles(t){if(!this.styles||t!==void 0&&!this.styles[t])return!0;const e=t===void 0?this.styles:{line:this.styles[t]};for(const n in e)for(const i in e[n])for(const s in e[n][i])return!1;return!0}styleHas(t,e){if(!this.styles||e!==void 0&&!this.styles[e])return!1;const n=e===void 0?this.styles:{0:this.styles[e]};for(const i in n)for(const s in n[i])if(n[i][s][t]!==void 0)return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let n,i,s=0,o=!0,a=0;for(const c in e){n=0;for(const l in e[c]){const h=e[c][l]||{};s++,h[t]!==void 0?(i?h[t]!==i&&(o=!1):i=h[t],h[t]===this[t]&&delete h[t]):o=!1,Object.keys(h).length!==0?n++:delete e[c][l]}n===0&&delete e[c]}for(let c=0;c<this._textLines.length;c++)a+=this._textLines[c].length;o&&s===a&&(this[t]=i,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let n,i,s;for(i in e){for(s in n=e[i],n)delete n[s][t],Object.keys(n[s]).length===0&&delete n[s];Object.keys(n).length===0&&delete e[i]}}_extendStyles(t,e){const{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t);this._getLineStyle(n)||this._setLineStyle(n);const s=E0(B(B({},this._getStyleDeclaration(n,i)),e),o=>o!==void 0);this._setStyleDeclaration(n,i,s)}getSelectionStyles(t,e,n){const i=[];for(let s=t;s<(e||t);s++)i.push(this.getStyleAtPosition(s,n));return i}getStyleAtPosition(t,e){const{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t);return e?this.getCompleteStyleDeclaration(n,i):this._getStyleDeclaration(n,i)}setSelectionStyles(t,e,n){for(let i=e;i<(n||e);i++)this._extendStyles(i,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var n;const i=this.styles&&this.styles[t];return i&&(n=i[e])!==null&&n!==void 0?n:{}}getCompleteStyleDeclaration(t,e){return B(B({},zc(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e))}_setStyleDeclaration(t,e,n){this.styles[t][e]=n}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}U(OS,"_styleProperties",nF);const sF=/  +/g,rF=/"/g;function Rp(r,t,e,n,i){return"		".concat(function(s,o){let{left:a,top:c,width:l,height:h}=o,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:he.NUM_FRACTION_DIGITS;const d=Yl(on,s,!1),[f,m,_,g]=[a,c,l,h].map(p=>Ue(p,u));return"<rect ".concat(d,' x="').concat(f,'" y="').concat(m,'" width="').concat(_,'" height="').concat(g,'"></rect>')}(r,{left:t,top:e,width:n,height:i}),`
`)}const oF=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let Dp;class In extends OS{static getDefaults(){return B(B({},super.getDefaults()),In.ownDefaults)}constructor(t,e){super(),U(this,"__charBounds",[]),Object.assign(this,In.ownDefaults),this.setOptions(e),this.styles||(this.styles={}),this.text=t,this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=xS(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(ps)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,n,i,s,o,a;for(let c=0,l=this._textLines.length;c<l;c++)if((this.textAlign===ps||c!==l-1&&!this.isEndOfWrapping(c))&&(i=0,s=this._textLines[c],e=this.getLineWidth(c),e<this.width&&(a=this.textLines[c].match(this._reSpacesAndTabs)))){n=a.length,t=(this.width-e)/n;for(let h=0;h<=s.length;h++)o=this.__charBounds[c][h],this._reSpaceAndTab.test(s[h])?(o.width+=t,o.kernedWidth+=t,o.left+=i,i+=t):o.left+=i}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const n=e?this._unwrappedTextLines:this._textLines;let i;for(i=0;i<n.length;i++){if(t<=n[i].length)return{lineIndex:i,charIndex:t};t-=n[i].length+this.missingNewlineOffset(i,e)}return{lineIndex:i-1,charIndex:n[i-1].length<t?n[i-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst===Jn?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,n){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case Zt:t.textBaseline="middle";break;case"ascender":t.textBaseline=Qn;break;case"descender":t.textBaseline=og}t.font=this._getFontDeclaration(e,n)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,n=this._textLines.length;e<n;e++){const i=this.getLineWidth(e);i>t&&(t=i)}return t}_renderTextLine(t,e,n,i,s,o){this._renderChars(t,e,n,i,s,o)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,n=this._getLeftOffset();let i=this._getTopOffset();for(let s=0,o=this._textLines.length;s<o;s++){const a=this.getHeightOfLine(s);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",s)){i+=a;continue}const c=this._textLines[s].length,l=this._getLineLeftOffset(s);let h,u,d=0,f=0,m=this.getValueOfPropertyAt(s,0,"textBackgroundColor");for(let _=0;_<c;_++){const g=this.__charBounds[s][_];u=this.getValueOfPropertyAt(s,_,"textBackgroundColor"),this.path?(t.save(),t.translate(g.renderLeft,g.renderTop),t.rotate(g.angle),t.fillStyle=u,u&&t.fillRect(-g.width/2,-a/this.lineHeight*(1-this._fontSizeFraction),g.width,a/this.lineHeight),t.restore()):u!==m?(h=n+l+f,this.direction==="rtl"&&(h=this.width-h-d),t.fillStyle=m,m&&t.fillRect(h,i,d,a/this.lineHeight),f=g.left,d=g.width,m=u):d+=g.kernedWidth}u&&!this.path&&(h=n+l+f,this.direction==="rtl"&&(h=this.width-h-d),t.fillStyle=u,t.fillRect(h,i,d,a/this.lineHeight)),i+=a}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,n,i){const s=Ll.getFontCache(e),o=this._getFontDeclaration(e),a=n+t,c=n&&o===this._getFontDeclaration(i),l=e.fontSize/this.CACHE_FONT_SIZE;let h,u,d,f;if(n&&s[n]!==void 0&&(d=s[n]),s[t]!==void 0&&(f=h=s[t]),c&&s[a]!==void 0&&(u=s[a],f=u-d),h===void 0||d===void 0||u===void 0){const m=function(){return Dp||(Dp=Ms({width:0,height:0}).getContext("2d")),Dp}();this._setTextStyles(m,e,!0),h===void 0&&(f=h=m.measureText(t).width,s[t]=h),d===void 0&&c&&n&&(d=m.measureText(n).width,s[n]=d),c&&u===void 0&&(u=m.measureText(a).width,s[a]=u,f=u-d)}return{width:h*l,kernedWidth:f*l}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return this.charSpacing!==0&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e,n,i=0;const s=this.pathSide===qe,o=this.path,a=this._textLines[t],c=a.length,l=new Array(c);this.__charBounds[t]=l;for(let h=0;h<c;h++){const u=a[h];n=this._getGraphemeBox(u,t,h,e),l[h]=n,i+=n.kernedWidth,e=u}if(l[c]={left:n?n.left+n.width:0,width:0,kernedWidth:0,height:this.fontSize,deltaY:0},o&&o.segmentsInfo){let h=0;const u=o.segmentsInfo[o.segmentsInfo.length-1].length;switch(this.textAlign){case pe:h=s?u-i:0;break;case Zt:h=(u-i)/2;break;case qe:h=s?0:u-i}h+=this.pathStartOffset*(s?-1:1);for(let d=s?c-1:0;s?d>=0:d<c;s?d--:d++)n=l[d],h>u?h%=u:h<0&&(h+=u),this._setGraphemeOnPath(h,n),h+=n.kernedWidth}return{width:i,numOfSpaces:0}}_setGraphemeOnPath(t,e){const n=t+e.kernedWidth/2,i=this.path,s=DO(i.path,n,i.segmentsInfo);e.renderLeft=s.x-i.pathOffset.x,e.renderTop=s.y-i.pathOffset.y,e.angle=s.angle+(this.pathSide===qe?Math.PI:0)}_getGraphemeBox(t,e,n,i,s){const o=this.getCompleteStyleDeclaration(e,n),a=i?this.getCompleteStyleDeclaration(e,n-1):{},c=this._measureChar(t,o,i,a);let l,h=c.kernedWidth,u=c.width;this.charSpacing!==0&&(l=this._getWidthOfCharSpacing(),u+=l,h+=l);const d={width:u,left:0,height:o.fontSize,kernedWidth:h,deltaY:o.deltaY};if(n>0&&!s){const f=this.__charBounds[e][n-1];d.left=f.left+f.width+c.kernedWidth-c.width}return d}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let n=1,i=this._textLines[t].length;n<i;n++)e=Math.max(this.getHeightOfChar(t,n),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let n=0,i=this._textLines.length;n<i;n++)t=this.getHeightOfLine(n),e+=n===i-1?t/this.lineHeight:t;return e}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let n=0;const i=this._getLeftOffset(),s=this._getTopOffset();for(let o=0,a=this._textLines.length;o<a;o++){const c=this.getHeightOfLine(o),l=c/this.lineHeight,h=this._getLineLeftOffset(o);this._renderTextLine(e,t,this._textLines[o],i+h,s+n+l,o),n+=c}t.restore()}_renderTextFill(t){(this.fill||this.styleHas(on))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,n,i,s,o){const a=this.getHeightOfLine(o),c=this.textAlign.includes(ps),l=this.path,h=!c&&this.charSpacing===0&&this.isEmptyStyles(o)&&!l,u=this.direction==="ltr",d=this.direction==="ltr"?1:-1,f=e.direction;let m,_,g,p,b,y="",v=0;if(e.save(),f!==this.direction&&(e.canvas.setAttribute("dir",u?"ltr":"rtl"),e.direction=u?"ltr":"rtl",e.textAlign=u?pe:qe),s-=a*this._fontSizeFraction/this.lineHeight,h)return this._renderChar(t,e,o,0,n.join(""),i,s),void e.restore();for(let x=0,S=n.length-1;x<=S;x++)p=x===S||this.charSpacing||l,y+=n[x],g=this.__charBounds[o][x],v===0?(i+=d*(g.kernedWidth-g.width),v+=g.width):v+=g.kernedWidth,c&&!p&&this._reSpaceAndTab.test(n[x])&&(p=!0),p||(m=m||this.getCompleteStyleDeclaration(o,x),_=this.getCompleteStyleDeclaration(o,x+1),p=O0(m,_,!1)),p&&(l?(e.save(),e.translate(g.renderLeft,g.renderTop),e.rotate(g.angle),this._renderChar(t,e,o,x,y,-v/2,0),e.restore()):(b=i,this._renderChar(t,e,o,x,y,b,s)),y="",m=_,i+=d*v,v=0);e.restore()}_applyPatternGradientTransformText(t){const e=this.width+this.strokeWidth,n=this.height+this.strokeWidth,i=Ms({width:e,height:n}),s=i.getContext("2d");return i.width=e,i.height=n,s.beginPath(),s.moveTo(0,0),s.lineTo(e,0),s.lineTo(e,n),s.lineTo(0,n),s.closePath(),s.translate(e/2,n/2),s.fillStyle=t.toLive(s),this._applyPatternGradientTransform(s,t),s.fill(),s.createPattern(i,"no-repeat")}handleFiller(t,e,n){let i,s;return Ri(n)?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?(i=-this.width/2,s=-this.height/2,t.translate(i,s),t[e]=this._applyPatternGradientTransformText(n),{offsetX:i,offsetY:s}):(t[e]=n.toLive(t),this._applyPatternGradientTransform(t,n)):(t[e]=n,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:n,strokeWidth:i}=e;return t.lineWidth=i,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",n)}_setFillStyles(t,e){let{fill:n}=e;return this.handleFiller(t,"fillStyle",n)}_renderChar(t,e,n,i,s,o,a){const c=this._getStyleDeclaration(n,i),l=this.getCompleteStyleDeclaration(n,i),h=t==="fillText"&&l.fill,u=t==="strokeText"&&l.stroke&&l.strokeWidth;if(u||h){if(e.save(),e.font=this._getFontDeclaration(l),c.textBackgroundColor&&this._removeShadow(e),c.deltaY&&(a+=c.deltaY),h){const d=this._setFillStyles(e,l);e.fillText(s,o-d.offsetX,a-d.offsetY)}if(u){const d=this._setStrokeStyles(e,l);e.strokeText(s,o-d.offsetX,a-d.offsetY)}e.restore()}}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,n){const i=this.get2DCursorLocation(t,!0),s=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),o=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),a={fontSize:s*n.size,deltaY:o+s*n.baseline};this.setSelectionStyles(a,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),n=this.width-e,i=this.textAlign,s=this.direction,o=this.isEndOfWrapping(t);let a=0;return i===ps||i===Fl&&!o||i===Ol&&!o||i===Ld&&!o?0:(i===Zt&&(a=n/2),i===qe&&(a=n),i===Fl&&(a=n/2),i===Ol&&(a=n),s==="rtl"&&(i===qe||i===ps||i===Ol?a=0:i===pe||i===Ld?a=-n:i!==Zt&&i!==Fl||(a=-n/2)),a)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(this.__lineWidths[t]!==void 0)return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,n){var i;return(i=this._getStyleDeclaration(t,e)[n])!==null&&i!==void 0?i:this[n]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let n=this._getTopOffset();const i=this._getLeftOffset(),s=this.path,o=this._getWidthOfCharSpacing(),a=this.offsets[e];for(let c=0,l=this._textLines.length;c<l;c++){const h=this.getHeightOfLine(c);if(!this[e]&&!this.styleHas(e,c)){n+=h;continue}const u=this._textLines[c],d=h/this.lineHeight,f=this._getLineLeftOffset(c);let m,_,g=0,p=0,b=this.getValueOfPropertyAt(c,0,e),y=this.getValueOfPropertyAt(c,0,on);const v=n+d*(1-this._fontSizeFraction);let x=this.getHeightOfChar(c,0),S=this.getValueOfPropertyAt(c,0,"deltaY");for(let E=0,w=u.length;E<w;E++){const M=this.__charBounds[c][E];m=this.getValueOfPropertyAt(c,E,e),_=this.getValueOfPropertyAt(c,E,on);const P=this.getHeightOfChar(c,E),L=this.getValueOfPropertyAt(c,E,"deltaY");if(s&&m&&_)t.save(),t.fillStyle=y,t.translate(M.renderLeft,M.renderTop),t.rotate(M.angle),t.fillRect(-M.kernedWidth/2,a*P+L,M.kernedWidth,this.fontSize/15),t.restore();else if((m!==b||_!==y||P!==x||L!==S)&&p>0){let I=i+f+g;this.direction==="rtl"&&(I=this.width-I-p),b&&y&&(t.fillStyle=y,t.fillRect(I,v+a*x+S,p,this.fontSize/15)),g=M.left,p=M.width,b=m,y=_,x=P,S=L}else p+=M.kernedWidth}let T=i+f+g;this.direction==="rtl"&&(T=this.width-T-p),t.fillStyle=_,m&&_&&t.fillRect(T,v+a*x+S,p-o,this.fontSize/15),n+=h}this._removeShadow(t)}_getFontDeclaration(){let{fontFamily:t=this.fontFamily,fontStyle:e=this.fontStyle,fontWeight:n=this.fontWeight,fontSize:i=this.fontSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;const o=t.includes("'")||t.includes('"')||t.includes(",")||In.genericFonts.includes(t.toLowerCase())?t:'"'.concat(t,'"');return[e,n,"".concat(s?this.CACHE_FONT_SIZE:i,"px"),o].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return I0(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),n=new Array(e.length),i=[`
`];let s=[];for(let o=0;o<e.length;o++)n[o]=this.graphemeSplit(e[o]),s=s.concat(n[o],i);return s.pop(),{_unwrappedLines:n,lines:e,graphemeText:s,graphemeLines:n}}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return B(B({},super.toObject([...IS,...t])),{},{styles:YI(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:n}=this.constructor;super.set(t,e);let i=!1,s=!1;if(typeof t=="object")for(const o in t)o==="path"&&this.setPathInfo(),i=i||n.includes(o),s=s||o==="path";else i=n.includes(t),s=t==="path";return s&&this.setPathInfo(),i&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e,n){const i=pr(t,In.ATTRIBUTE_NAMES,n),s=B(B({},e),i),{textAnchor:o=pe,textDecoration:a="",dx:c=0,dy:l=0,top:h=0,left:u=0,fontSize:d=v0,strokeWidth:f=1}=s,m=Oe(s,oF),_=new this((t.textContent||"").replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),B({left:u+c,top:h+l,underline:a.includes("underline"),overline:a.includes("overline"),linethrough:a.includes("line-through"),strokeWidth:0,fontSize:d},m)),g=_.getScaledHeight()/_.height,p=((_.height+_.strokeWidth)*_.lineHeight-_.height)*g,b=_.getScaledHeight()+p;let y=0;return o===Zt&&(y=_.getScaledWidth()/2),o===qe&&(y=_.getScaledWidth()),_.set({left:_.left-y,top:_.top-(b-_.fontSize*(.07+_._fontSizeFraction))/_.lineHeight,strokeWidth:f}),_}static fromObject(t){return this._fromObject(B(B({},t),{},{styles:qI(t.styles||{},t.text)}),{extraParam:"text"})}}U(In,"textLayoutProperties",LS),U(In,"cacheProperties",[...fr,...IS]),U(In,"ownDefaults",iF),U(In,"type","Text"),U(In,"genericFonts",["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]),U(In,"ATTRIBUTE_NAMES",no.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),dS(In,[class extends iS{_toSVG(){const r=this._getSVGLeftTopOffsets(),t=this._getSVGTextAndBg(r.textTop,r.textLeft);return this._wrapSVGTextAndBg(t)}toSVG(r){return this._createBaseSVGMarkup(this._toSVG(),{reviver:r,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(r){let{textBgRects:t,textSpans:e}=r;const n=this.getSvgTextDecoration(this);return[t.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(rF,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",n?'text-decoration="'.concat(n,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",e.join(""),`</text>
`]}_getSVGTextAndBg(r,t){const e=[],n=[];let i,s=r;this.backgroundColor&&n.push(...Rp(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let o=0,a=this._textLines.length;o<a;o++)i=this._getLineLeftOffset(o),this.direction==="rtl"&&(i+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(n,o,t+i,s),this._setSVGTextLineText(e,o,t+i,s),s+=this.getHeightOfLine(o);return{textSpans:e,textBgRects:n}}_createTextCharSpan(r,t,e,n){const i=this.getSvgSpanStyles(t,r!==r.trim()||!!r.match(sF)),s=i?'style="'.concat(i,'"'):"",o=t.deltaY,a=o?' dy="'.concat(Ue(o,he.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(Ue(e,he.NUM_FRACTION_DIGITS),'" y="').concat(Ue(n,he.NUM_FRACTION_DIGITS),'" ').concat(a).concat(s,">").concat(WI(r),"</tspan>")}_setSVGTextLineText(r,t,e,n){const i=this.getHeightOfLine(t),s=this.textAlign.includes(ps),o=this._textLines[t];let a,c,l,h,u,d="",f=0;n+=i*(1-this._fontSizeFraction)/this.lineHeight;for(let m=0,_=o.length-1;m<=_;m++)u=m===_||this.charSpacing,d+=o[m],l=this.__charBounds[t][m],f===0?(e+=l.kernedWidth-l.width,f+=l.width):f+=l.kernedWidth,s&&!u&&this._reSpaceAndTab.test(o[m])&&(u=!0),u||(a=a||this.getCompleteStyleDeclaration(t,m),c=this.getCompleteStyleDeclaration(t,m+1),u=O0(a,c,!0)),u&&(h=this._getStyleDeclaration(t,m),r.push(this._createTextCharSpan(d,h,e,n)),d="",a=c,this.direction==="rtl"?e-=f:e+=f,f=0)}_setSVGTextLineBg(r,t,e,n){const i=this._textLines[t],s=this.getHeightOfLine(t)/this.lineHeight;let o,a=0,c=0,l=this.getValueOfPropertyAt(t,0,"textBackgroundColor");for(let h=0;h<i.length;h++){const{left:u,width:d,kernedWidth:f}=this.__charBounds[t][h];o=this.getValueOfPropertyAt(t,h,"textBackgroundColor"),o!==l?(l&&r.push(...Rp(l,e+c,n,a,s)),c=u,a=d,l=o):a+=f}o&&r.push(...Rp(l,e+c,n,a,s))}_getSVGLineTopOffset(r){let t,e=0;for(t=0;t<r;t++)e+=this.getHeightOfLine(t);const n=this.getHeightOfLine(t);return{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(r){return"".concat(super.getSvgStyles(r)," white-space: pre;")}getSvgSpanStyles(r,t){const{fontFamily:e,strokeWidth:n,stroke:i,fill:s,fontSize:o,fontStyle:a,fontWeight:c,deltaY:l}=r,h=this.getSvgTextDecoration(r);return[i?Yl(Jn,i):"",n?"stroke-width: ".concat(n,"; "):"",e?"font-family: ".concat(e.includes("'")||e.includes('"')?e:"'".concat(e,"'"),"; "):"",o?"font-size: ".concat(o,"px; "):"",a?"font-style: ".concat(a,"; "):"",c?"font-weight: ".concat(c,"; "):"",h&&"text-decoration: ".concat(h,"; "),s?Yl(on,s):"",l?"baseline-shift: ".concat(-l,"; "):"",t?"white-space: pre; ":""].join("")}getSvgTextDecoration(r){return["overline","underline","line-through"].filter(t=>r[t.replace("-","")]).join(" ")}}]),wt.setClass(In),wt.setSVGClass(In);class aF{constructor(t){U(this,"target",void 0),U(this,"__mouseDownInPlace",!1),U(this,"__dragStartFired",!1),U(this,"__isDraggingOver",!1),U(this,"__dragStartSelection",void 0),U(this,"__dragImageDisposer",void 0),U(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach(n=>n()),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,n=e.getSelectionStartFromPointer(t);return e.isEditing&&n>=e.selectionStart&&n<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var n;let{selectionStart:i,selectionEnd:s}=e;const o=this.target,a=o.canvas,c=new Y(o.flipX?-1:1,o.flipY?-1:1),l=o._getCursorBoundaries(i),h=new Y(l.left+l.leftOffset,l.top+l.topOffset).multiply(c).transform(o.calcTransformMatrix()),u=a.getScenePoint(t).subtract(h),d=o.getCanvasRetinaScaling(),f=o.getBoundingRect(),m=h.subtract(new Y(f.left,f.top)),_=a.viewportTransform,g=m.add(u).transform(_,!0),p=o.backgroundColor,b=L0(o.styles);o.backgroundColor="";const y={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};o.setSelectionStyles(y,0,i),o.setSelectionStyles(y,s,o.text.length),o.dirty=!0;const v=o.toCanvasElement({enableRetinaScaling:a.enableRetinaScaling,viewportTransform:!0});o.backgroundColor=p,o.styles=b,o.dirty=!0,gg(v,{position:"fixed",left:"".concat(-v.width,"px"),border:$n,width:"".concat(v.width/d,"px"),height:"".concat(v.height/d,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{v.remove()},$i(t.target||this.target.hiddenTextarea).body.appendChild(v),(n=t.dataTransfer)===null||n===void 0||n.setDragImage(v,g.x,g.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,n=this.isActive();if(n&&t.dataTransfer){const i=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},s=e._text.slice(i.selectionStart,i.selectionEnd).join(""),o=B({text:e.text,value:s},i);t.dataTransfer.setData("text/plain",s),t.dataTransfer.setData("application/fabric",JSON.stringify({value:s,styles:e.getSelectionStyles(i.selectionStart,i.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,o)}return e.abortCursorAnimation(),n}canDrop(t){if(this.target.editable&&!this.target.getActiveControl()&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),n=this.__dragStartSelection;return e<n.selectionStart||e>n.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e}=t;const n=this.targetCanDrop(e);!this.__isDraggingOver&&n&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e}=t,n=this.targetCanDrop(e);!this.__isDraggingOver&&n?this.__isDraggingOver=!0:this.__isDraggingOver&&!n&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:n}=t,i=n.defaultPrevented;this.__isDraggingOver=!1,n.preventDefault();let s=(e=n.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain");if(s&&!i){const o=this.target,a=o.canvas;let c=o.getSelectionStartFromPointer(n);const{styles:l}=n.dataTransfer.types.includes("application/fabric")?JSON.parse(n.dataTransfer.getData("application/fabric")):{},h=s[Math.max(0,s.length-1)],u=0;if(this.__dragStartSelection){const d=this.__dragStartSelection.selectionStart,f=this.__dragStartSelection.selectionEnd;c>d&&c<=f?c=d:c>f&&(c-=f-d),o.removeChars(d,f),delete this.__dragStartSelection}o._reNewline.test(h)&&(o._reNewline.test(o._text[c])||c===o._text.length)&&(s=s.trimEnd()),t.didDrop=!0,t.dropTarget=o,o.insertChars(s,l,c),a.setActiveObject(o),o.enterEditing(n),o.selectionStart=Math.min(c+u,o._text.length),o.selectionEnd=Math.min(o.selectionStart+s.length,o._text.length),o.hiddenTextarea.value=o.text,o._updateTextarea(),o.hiddenTextarea.focus(),o.fire(wd,{index:c+u,action:"drop"}),a.fire("text:changed",{target:o}),a.contextTopDirty=!0,a.requestRenderAll()}}dragEndHandler(t){let{e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var n;const i=this.target,s=this.target.canvas,{selectionStart:o,selectionEnd:a}=this.__dragStartSelection,c=((n=e.dataTransfer)===null||n===void 0?void 0:n.dropEffect)||$n;c===$n?(i.selectionStart=o,i.selectionEnd=a,i._updateTextarea(),i.hiddenTextarea.focus()):(i.clearContextTop(),c==="move"&&(i.removeChars(o,a),i.selectionStart=i.selectionEnd=o,i.hiddenTextarea&&(i.hiddenTextarea.value=i.text),i._updateTextarea(),i.fire(wd,{index:o,action:"dragend"}),s.fire("text:changed",{target:i}),s.requestRenderAll()),i.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const _v=/[ \n\.,;!\?\-]/;class cF extends In{constructor(){super(...arguments),U(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:n,delay:i,onComplete:s}=t;return aS({startValue:this._currentCursorOpacity,endValue:e,duration:n,delay:i,onComplete:s,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:o=>{this._currentCursorOpacity=o,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:Math.max(t||0,100),onComplete:this._onTickComplete})}_onTickComplete(){var t;(t=this._currentTickCompleteState)===null||t===void 0||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:1,duration:this.cursorDuration,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach(e=>{e&&!e.isDone()&&(t=!0,e.abort())}),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(t=>!t||t.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,n=t-1;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)e++,n--;for(;/\S/.test(this._text[n])&&n>-1;)e++,n--;return t-e}findWordBoundaryRight(t){let e=0,n=t;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)e++,n++;for(;/\S/.test(this._text[n])&&n<this._text.length;)e++,n++;return t+e}findLineBoundaryLeft(t){let e=0,n=t-1;for(;!/\n/.test(this._text[n])&&n>-1;)e++,n--;return t-e}findLineBoundaryRight(t){let e=0,n=t;for(;!/\n/.test(this._text[n])&&n<this._text.length;)e++,n++;return t+e}searchWordBoundary(t,e){const n=this._text;let i=t>0&&this._reSpace.test(n[t])&&(e===-1||!x0.test(n[t-1]))?t-1:t,s=n[i];for(;i>0&&i<n.length&&!_v.test(s);)i+=e,s=n[i];return e===-1&&_v.test(s)&&i++,i}selectWord(t){t=t||this.selectionStart;const e=this.searchWordBoundary(t,-1),n=Math.max(e,this.searchWordBoundary(t,1));this.selectionStart=e,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){t=t||this.selectionStart;const e=this.findLineBoundaryLeft(t),n=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(t){!this.isEditing&&this.editable&&(this.enterEditingImpl(),this.fire("editing:entered",t?{e:t}:void 0),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}enterEditingImpl(){this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick()}updateSelectionOnMouseMove(t){if(this.getActiveControl())return;const e=this.hiddenTextarea;$i(e).activeElement!==e&&e.focus();const n=this.getSelectionStartFromPointer(t),i=this.selectionStart,s=this.selectionEnd;(n===this.__selectionStartOnMouseDown&&i!==s||i!==n&&s!==n)&&(n>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=n):(this.selectionStart=n,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===s||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,n){const i=n.slice(0,t),s=this.graphemeSplit(i).length;if(t===e)return{selectionStart:s,selectionEnd:s};const o=n.slice(t,e);return{selectionStart:s,selectionEnd:s+this.graphemeSplit(o).length}}fromGraphemeToStringSelection(t,e,n){const i=n.slice(0,t).join("").length;return t===e?{selectionStart:i,selectionEnd:i}:{selectionStart:i,selectionEnd:i+n.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),n=this.get2DCursorLocation(t),i=n.lineIndex,s=n.charIndex,o=this.getValueOfPropertyAt(i,s,"fontSize")*this.lineHeight,a=e.leftOffset,c=this.getCanvasRetinaScaling(),l=this.canvas.upperCanvasEl,h=l.width/c,u=l.height/c,d=h-o,f=u-o,m=new Y(e.left+a,e.top+e.topOffset+o).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new Y(l.clientWidth/h,l.clientHeight/u));return m.x<0&&(m.x=0),m.x>d&&(m.x=d),m.y<0&&(m.y=0),m.y>f&&(m.y=f),m.x+=this.canvas._offset.left,m.y+=this.canvas._offset.top,{left:"".concat(m.x,"px"),top:"".concat(m.y,"px"),fontSize:"".concat(o,"px"),charHeight:o}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation(),this.selectionStart!==this.selectionEnd&&this.clearContextTop()}exitEditingImpl(){this._exitEditing(),this.selectionEnd=this.selectionStart,this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords())}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.exitEditingImpl(),this.fire("editing:exited"),t&&this.fire(Sd),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:n,charIndex:i}=this.get2DCursorLocation(t,!0),{lineIndex:s,charIndex:o}=this.get2DCursorLocation(e,!0);if(n!==s){if(this.styles[n])for(let a=i;a<this._unwrappedTextLines[n].length;a++)delete this.styles[n][a];if(this.styles[s])for(let a=o;a<this._unwrappedTextLines[s].length;a++){const c=this.styles[s][a];c&&(this.styles[n]||(this.styles[n]={}),this.styles[n][i+a-o]=c)}for(let a=n+1;a<=s;a++)delete this.styles[a];this.shiftLineStyles(s,n-s)}else if(this.styles[n]){const a=this.styles[n],c=o-i;for(let l=i;l<o;l++)delete a[l];for(const l in this.styles[n]){const h=parseInt(l,10);h>=o&&(a[h-c]=a[l],delete a[l])}}}shiftLineStyles(t,e){const n=Object.assign({},this.styles);for(const i in this.styles){const s=parseInt(i,10);s>t&&(this.styles[s+e]=n[s],n[s-e]||delete this.styles[s])}}insertNewlineStyleObject(t,e,n,i){const s={},o=this._unwrappedTextLines[t].length,a=o===e;let c=!1;n||(n=1),this.shiftLineStyles(t,n);const l=this.styles[t]?this.styles[t][e===0?e:e-1]:void 0;for(const u in this.styles[t]){const d=parseInt(u,10);d>=e&&(c=!0,s[d-e]=this.styles[t][u],a&&e===0||delete this.styles[t][u])}let h=!1;for(c&&!a&&(this.styles[t+n]=s,h=!0),(h||o>e)&&n--;n>0;)i&&i[n-1]?this.styles[t+n]={0:B({},i[n-1])}:l?this.styles[t+n]={0:B({},l)}:delete this.styles[t+n],n--;this._forceClearCache=!0}insertCharStyleObject(t,e,n,i){this.styles||(this.styles={});const s=this.styles[t],o=s?B({},s):{};n||(n=1);for(const c in o){const l=parseInt(c,10);l>=e&&(s[l+n]=o[l],o[l-n]||delete s[l])}if(this._forceClearCache=!0,i){for(;n--;)Object.keys(i[n]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+n]=B({},i[n]));return}if(!s)return;const a=s[e?e-1:1];for(;a&&n--;)this.styles[t][e+n]=B({},a)}insertNewStyleBlock(t,e,n){const i=this.get2DCursorLocation(e,!0),s=[0];let o,a=0;for(let c=0;c<t.length;c++)t[c]===`
`?(a++,s[a]=0):s[a]++;for(s[0]>0&&(this.insertCharStyleObject(i.lineIndex,i.charIndex,s[0],n),n=n&&n.slice(s[0]+1)),a&&this.insertNewlineStyleObject(i.lineIndex,i.charIndex+s[0],a),o=1;o<a;o++)s[o]>0?this.insertCharStyleObject(i.lineIndex+o,0,s[o],n):n&&this.styles[i.lineIndex+o]&&n[0]&&(this.styles[i.lineIndex+o][0]=n[0]),n=n&&n.slice(s[o]+1);s[o]>0&&this.insertCharStyleObject(i.lineIndex+o,0,s[o],n)}removeChars(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;i>n&&this.removeStyleFromTo(n,i);const s=this.graphemeSplit(t);this.insertNewStyleBlock(s,n,e),this._text=[...this._text.slice(0,n),...s,...this._text.slice(i)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,n){n<=t?(e===t?this._selectionDirection=pe:this._selectionDirection===qe&&(this._selectionDirection=pe,this.selectionEnd=t),this.selectionStart=n):n>t&&n<e?this._selectionDirection===qe?this.selectionEnd=n:this.selectionStart=n:(e===t?this._selectionDirection=qe:this._selectionDirection===pe&&(this._selectionDirection=qe,this.selectionStart=e),this.selectionEnd=n)}}class lF extends cF{initHiddenTextarea(){const t=this.canvas&&$i(this.canvas.getElement())||Nc(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(o=>{let[a,c]=o;return e.setAttribute(a,c)});const{top:n,left:i,fontSize:s}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(n,"; left: ").concat(i,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(s,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",compositionend:"onCompositionEnd"}).map(o=>{let[a,c]=o;return e.addEventListener(a,this[c].bind(this))}),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){const e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const n=()=>{this.updateFromTextArea(),this.fire(wd),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value==="")return this.styles={},void n();const i=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,s=this._text.length,o=i.length,a=this.selectionStart,c=this.selectionEnd,l=a!==c;let h,u,d,f,m=o-s;const _=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),g=a>_.selectionStart;l?(u=this._text.slice(a,c),m+=c-a):o<s&&(u=g?this._text.slice(c+m,c):this._text.slice(a,a-m));const p=i.slice(_.selectionEnd-m,_.selectionEnd);if(u&&u.length&&(p.length&&(h=this.getSelectionStyles(a,a+1,!1),h=p.map(()=>h[0])),l?(d=a,f=c):g?(d=c-u.length,f=c):(d=c,f=c+u.length),this.removeStyleFromTo(d,f)),p.length){const{copyPasteData:b}=Ss();e&&p.join("")===b.copiedText&&!he.disableStyleCopyPaste&&(h=b.copiedTextStyle),this.insertNewStyleBlock(p,a,h)}n()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){let{target:e}=t;const{selectionStart:n,selectionEnd:i}=e;this.compositionStart=n,this.compositionEnd=i,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=Ss();t.copiedText=this.getSelectedText(),he.disableStyleCopyPaste?t.copiedTextStyle=void 0:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let n,i=this._getLineLeftOffset(t);return e>0&&(n=this.__charBounds[t][e-1],i+=n.left+n.width),i}getDownCursorOffset(t,e){const n=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(n),s=i.lineIndex;if(s===this._textLines.length-1||t.metaKey||t.keyCode===34)return this._text.length-n;const o=i.charIndex,a=this._getWidthBeforeCursor(s,o),c=this._getIndexOnLine(s+1,a);return this._textLines[s].slice(o).length+c+1+this.missingNewlineOffset(s)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const n=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(n),s=i.lineIndex;if(s===0||t.metaKey||t.keyCode===33)return-n;const o=i.charIndex,a=this._getWidthBeforeCursor(s,o),c=this._getIndexOnLine(s-1,a),l=this._textLines[s].slice(0,o),h=this.missingNewlineOffset(s-1);return-this._textLines[s-1].length+c-l.length+(1-h)}_getIndexOnLine(t,e){const n=this._textLines[t];let i,s,o=this._getLineLeftOffset(t),a=0;for(let c=0,l=n.length;c<l;c++)if(i=this.__charBounds[t][c].width,o+=i,o>e){s=!0;const h=o-i,u=o,d=Math.abs(h-e);a=Math.abs(u-e)<d?c:c-1;break}return s||(a=n.length-1),a}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const n=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===qe);if(e.shiftKey?this.moveCursorWithShift(n):this.moveCursorWithoutShift(n),n!==0){const i=this.text.length;this.selectionStart=wc(0,this.selectionStart,i),this.selectionEnd=wc(0,this.selectionEnd,i),this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===pe?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),t!==0}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),t!==0}moveCursorLeft(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",t)}_move(t,e,n){let i;if(t.altKey)i=this["findWordBoundary".concat(n)](this[e]);else{if(!t.metaKey&&t.keyCode!==35&&t.keyCode!==36)return this[e]+=n==="Left"?-1:1,!0;i=this["findLineBoundary".concat(n)](this[e])}return i!==void 0&&this[e]!==i&&(this[e]=i,!0)}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=pe,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===qe&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection=pe,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){const n="moveCursor".concat(t).concat(e.shiftKey?"WithShift":"WithoutShift");this._currentCursorOpacity=1,this[n](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===pe&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=qe,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=qe,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}const Lp=r=>!!r.button;class hF extends lF{constructor(){super(...arguments),U(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new aF(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}onMouseDown(t){if(!this.canvas)return;this.__newClickTime=+new Date;const e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),lg(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastSelected=this.selected&&!this.getActiveControl()}isTripleClick(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y}doubleClickHandler(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))}tripleClickHandler(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))}_mouseDownHandler(t){let{e}=t;this.canvas&&this.editable&&!Lp(e)&&!this.getActiveControl()&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())))}_mouseDownHandlerBefore(t){let{e}=t;this.canvas&&this.editable&&!Lp(e)&&(this.selected=this===this.canvas._activeObject)}mouseUpHandler(t){let{e,transform:n}=t;const i=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const s=this.canvas._activeObject;if(s&&s!==this)return}!this.editable||this.group&&!this.group.interactive||n&&n.actionPerformed||Lp(e)||i||(this.__lastSelected&&!this.getActiveControl()?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),n=this.selectionStart,i=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(n,i,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getScenePoint(t).transform(ts(this.calcTransformMatrix())).add(new Y(-this._getLeftOffset(),-this._getTopOffset()));let n=0,i=0,s=0;for(let l=0;l<this._textLines.length&&n<=e.y;l++)n+=this.getHeightOfLine(l),s=l,l>0&&(i+=this._textLines[l-1].length+this.missingNewlineOffset(l-1));let o=Math.abs(this._getLineLeftOffset(s));const a=this._textLines[s].length,c=this.__charBounds[s];for(let l=0;l<a;l++){const h=o+c[l].kernedWidth;if(e.x<=h){Math.abs(e.x-h)<=Math.abs(e.x-o)&&i++;break}o=h,i++}return Math.min(this.flipX?a-i:i,this._text.length)}}const Eu="moveCursorUp",Au="moveCursorDown",Cu="moveCursorLeft",Pu="moveCursorRight",Ru="exitEditing",uF=B({selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,keysMap:{9:Ru,27:Ru,33:Eu,34:Au,35:Pu,36:Cu,37:Cu,38:Eu,39:Pu,40:Au},keysMapRtl:{9:Ru,27:Ru,33:Eu,34:Au,35:Cu,36:Pu,37:Pu,38:Eu,39:Cu,40:Au},ctrlKeysMapDown:{65:"selectAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}},{_selectionDirection:null,_reSpace:/\s|\r?\n/,inCompositionMode:!1});class $s extends hF{static getDefaults(){return B(B({},super.getDefaults()),$s.ownDefaults)}get type(){const t=super.type;return t==="itext"?"i-text":t}constructor(t,e){super(t,B(B({},$s.ownDefaults),e)),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):(t==="canvas"&&(this.canvas instanceof gv&&this.canvas.textEditingManager.remove(this),e instanceof gv&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,n=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,n)}setSelectionStyles(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,n)}get2DCursorLocation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const n=super.toCanvasElement(t);return this.isEditing=e,n}renderCursorOrSelection(){if(!this.isEditing)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries();this.selectionStart!==this.selectionEnd||this.inCompositionMode?this.renderSelection(t,e):this.renderCursor(t,e),this.canvas.contextTopDirty=!0,t.restore()}_getCursorBoundaries(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const n=this._getLeftOffset(),i=this._getTopOffset(),s=this._getCursorBoundariesOffsets(t,e);return{left:n,top:i,leftOffset:s.left,topOffset:s.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,n=0;const{charIndex:i,lineIndex:s}=this.get2DCursorLocation(t);for(let l=0;l<s;l++)e+=this.getHeightOfLine(l);const o=this._getLineLeftOffset(s),a=this.__charBounds[s][i];a&&(n=a.left),this.charSpacing!==0&&i===this._textLines[s].length&&(n-=this._getWidthOfCharSpacing());const c={top:e,left:o+(n>0?n:0)};return this.direction==="rtl"&&(this.textAlign===qe||this.textAlign===ps||this.textAlign===Ol?c.left*=-1:this.textAlign===pe||this.textAlign===Ld?c.left=o-(n>0?n:0):this.textAlign!==Zt&&this.textAlign!==Fl||(c.left=o-(n>0?n:0))),c}renderCursorAt(t){this._renderCursor(this.canvas.contextTop,this._getCursorBoundaries(t,!0),t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}getCursorRenderingData(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._getCursorBoundaries(t);const n=this.get2DCursorLocation(t),i=n.lineIndex,s=n.charIndex>0?n.charIndex-1:0,o=this.getValueOfPropertyAt(i,s,"fontSize"),a=this.getObjectScaling().x*this.canvas.getZoom(),c=this.cursorWidth/a,l=this.getValueOfPropertyAt(i,s,"deltaY"),h=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-o*(1-this._fontSizeFraction);return{color:this.cursorColor||this.getValueOfPropertyAt(i,s,"fill"),opacity:this._currentCursorOpacity,left:e.left+e.leftOffset-c/2,top:h+e.top+l,width:c,height:o}}_renderCursor(t,e,n){const{color:i,opacity:s,left:o,top:a,width:c,height:l}=this.getCursorRenderingData(n,e);t.fillStyle=i,t.globalAlpha=s,t.fillRect(o,a,c,l)}renderSelection(t,e){const n={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,n,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,n){const i=e.selectionStart,s=e.selectionEnd,o=this.textAlign.includes(ps),a=this.get2DCursorLocation(i),c=this.get2DCursorLocation(s),l=a.lineIndex,h=c.lineIndex,u=a.charIndex<0?0:a.charIndex,d=c.charIndex<0?0:c.charIndex;for(let f=l;f<=h;f++){const m=this._getLineLeftOffset(f)||0;let _=this.getHeightOfLine(f),g=0,p=0,b=0;if(f===l&&(p=this.__charBounds[l][u].left),f>=l&&f<h)b=o&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===h)if(d===0)b=this.__charBounds[h][d].left;else{const T=this._getWidthOfCharSpacing();b=this.__charBounds[h][d-1].left+this.__charBounds[h][d-1].width-T}g=_,(this.lineHeight<1||f===h&&this.lineHeight>1)&&(_/=this.lineHeight);let y=n.left+m+p,v=_,x=0;const S=b-p;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",v=1,x=_):t.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===qe||this.textAlign===ps||this.textAlign===Ol?y=this.width-y-S:this.textAlign===pe||this.textAlign===Ld?y=n.left+m-b:this.textAlign!==Zt&&this.textAlign!==Fl||(y=n.left+m-b)),t.fillRect(y,n.top+n.topOffset+x,S,v),n.topOffset+=g}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,on)}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this.exitEditingImpl(),this.draggableTextDelegate.dispose(),super.dispose()}}U($s,"ownDefaults",uF),U($s,"type","IText"),wt.setClass($s),wt.setClass($s,"i-text");class Js extends $s{static getDefaults(){return B(B({},super.getDefaults()),Js.ownDefaults)}constructor(t,e){super(t,B(B({},Js.ownDefaults),e))}static createControls(){return{controls:VI()}}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(ps)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,n=0,i=0;const s={};for(let o=0;o<t.graphemeLines.length;o++)t.graphemeText[i]===`
`&&o>0?(n=0,i++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[i])&&o>0&&(n++,i++),s[o]={line:e,offset:n},i+=t.graphemeLines[o].length,n+=t.graphemeLines[o].length;return s}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const n=this._styleMap[e];n&&(e=n.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e,n=0,i=t+1,s=!1;const o=this._styleMap[t],a=this._styleMap[t+1];o&&(t=o.line,n=o.offset),a&&(i=a.line,s=i===t,e=a.offset);const c=t===void 0?this.styles:{line:this.styles[t]};for(const l in c)for(const h in c[l]){const u=parseInt(h,10);if(u>=n&&(!s||u<e))for(const d in c[l][h])return!1}return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const n=this._styleMap[t];if(!n)return{};t=n.line,e=n.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,n){const i=this._styleMap[t];super._setStyleDeclaration(i.line,i.offset+e,n)}_deleteStyleDeclaration(t,e){const n=this._styleMap[t];super._deleteStyleDeclaration(n.line,n.offset+e)}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];super._setLineStyle(e.line)}_wrapText(t,e){this.isWrapping=!0;const n=this.getGraphemeDataForRender(t),i=[];for(let s=0;s<n.wordsData.length;s++)i.push(...this._wrapLine(s,e,n));return this.isWrapping=!1,i}getGraphemeDataForRender(t){const e=this.splitByGrapheme,n=e?"":" ";let i=0;return{wordsData:t.map((s,o)=>{let a=0;const c=e?this.graphemeSplit(s):this.wordSplit(s);return c.length===0?[{word:[],width:0}]:c.map(l=>{const h=e?[l]:this.graphemeSplit(l),u=this._measureWord(h,o,a);return i=Math.max(u,i),a+=h.length+n.length,{word:h,width:u}})}),largestWordWidth:i}}_measureWord(t,e){let n,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=0;for(let o=0,a=t.length;o<a;o++)s+=this._getGraphemeBox(t[o],e,o+i,n,!0).kernedWidth,n=t[o];return s}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,n){let{largestWordWidth:i,wordsData:s}=n,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const a=this._getWidthOfCharSpacing(),c=this.splitByGrapheme,l=[],h=c?"":" ";let u=0,d=[],f=0,m=0,_=!0;e-=o;const g=Math.max(e,i,this.dynamicMinWidth),p=s[t];let b;for(f=0,b=0;b<p.length;b++){const{word:y,width:v}=p[b];f+=y.length,u+=m+v-a,u>g&&!_?(l.push(d),d=[],u=v,_=!0):u+=a,_||c||d.push(h),d=d.concat(y),m=c?0:this._measureWord([h],t,f),f++,_=!1}return b&&l.push(d),i+o>this.dynamicMinWidth&&(this.dynamicMinWidth=i-a+o),l}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t,e){return this.splitByGrapheme&&!e?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),n=this._wrapText(e.lines,this.width),i=new Array(n.length);for(let s=0;s<n.length;s++)i[s]=n[s].join("");return e.lines=i,e.graphemeLines=n,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t=new Map;for(const e in this._styleMap){const n=parseInt(e,10);if(this._textLines[n]){const i=this._styleMap[e].line;t.set("".concat(i),!0)}}for(const e in this.styles)t.has(e)||delete this.styles[e]}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject(["minWidth","splitByGrapheme",...t])}}U(Js,"type","Textbox"),U(Js,"textLayoutProperties",[...$s.textLayoutProperties,"width"]),U(Js,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),wt.setClass(Js);class bv extends af{shouldPerformLayout(t){return!!t.target.clipPath&&super.shouldPerformLayout(t)}shouldLayoutClipPath(){return!1}calcLayoutResult(t,e){const{target:n}=t,{clipPath:i,group:s}=n;if(!i||!this.shouldPerformLayout(t))return;const{width:o,height:a}=nr(mS(n,i)),c=new Y(o,a);if(i.absolutePositioned)return{center:sc(i.getRelativeCenterPoint(),void 0,s?s.calcTransformMatrix():void 0),size:c};{const l=i.getRelativeCenterPoint().transform(n.calcOwnMatrix(),!0);if(this.shouldPerformLayout(t)){const{center:h=new Y,correction:u=new Y}=this.calcBoundingBox(e,t)||{};return{center:h.add(l),correction:u.subtract(l),size:c}}return{center:n.getRelativeCenterPoint().add(l),size:c}}}}U(bv,"type","clip-path"),wt.setClass(bv);class yv extends af{getInitialSize(t,e){let{target:n}=t,{size:i}=e;return new Y(n.width||i.x,n.height||i.y)}}U(yv,"type","fixed"),wt.setClass(yv);class dF extends Kl{subscribeTargets(t){const e=t.target;t.targets.reduce((n,i)=>(i.parent&&n.add(i.parent),n),new Set).forEach(n=>{n.layoutManager.subscribeTargets({target:n,targets:[e]})})}unsubscribeTargets(t){const e=t.target,n=e.getObjects();t.targets.reduce((i,s)=>(s.parent&&i.add(s.parent),i),new Set).forEach(i=>{!n.some(s=>s.parent===i)&&i.layoutManager.unsubscribeTargets({target:i,targets:[e]})})}}class Po extends Oo{static getDefaults(){return B(B({},super.getDefaults()),Po.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,Po.ownDefaults),this.setOptions(e);const{left:n,top:i,layoutManager:s}=e;this.groupInit(t,{left:n,top:i,layoutManager:s??new dF})}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.multiSelectionStacking==="selection-order"?this.add(...e):e.forEach(i=>{const s=this._objects.findIndex(a=>a.isInFrontOf(i)),o=s===-1?this.size():s;this.insertAt(o,i)})}canEnterGroup(t){return this.getObjects().some(e=>e.isDescendantOf(t)||t.isDescendantOf(e))?(qr("error","ActiveSelection: circular object trees are not supported, this call has no effect"),!1):super.canEnterGroup(t)}enterGroup(t,e){t.parent&&t.parent===t.group?t.parent._exitGroup(t):t.group&&t.parent!==t.group&&t.group.remove(t),this._enterGroup(t,e)}exitGroup(t,e){this._exitGroup(t,e),t.parent&&t.parent._enterGroup(t,!0)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const n=new Set;e.forEach(i=>{const{parent:s}=i;s&&n.add(s)}),t===k0?n.forEach(i=>{i._onAfterObjectsChange(Pd,e)}):n.forEach(i=>{i._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,n){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;const i=B(B({hasControls:!1},n),{},{forActiveSelection:!0});for(let s=0;s<this._objects.length;s++)this._objects[s]._renderControls(t,i);super._renderControls(t,e),t.restore()}}U(Po,"type","ActiveSelection"),U(Po,"ownDefaults",{multiSelectionStacking:"canvas-stacking"}),wt.setClass(Po),wt.setClass(Po,"activeSelection");class fF{constructor(){U(this,"resources",{})}applyFilters(t,e,n,i,s){const o=s.getContext("2d");if(!o)return;o.drawImage(e,0,0,n,i);const a={sourceWidth:n,sourceHeight:i,imageData:o.getImageData(0,0,n,i),originalEl:e,originalImageData:o.getImageData(0,0,n,i),canvasEl:s,ctx:o,filterBackend:this};t.forEach(l=>{l.applyTo(a)});const{imageData:c}=a;return c.width===n&&c.height===i||(s.width=c.width,s.height=c.height),o.putImageData(c,0,0),a}}class FS{constructor(){let{tileSize:t=he.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};U(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),U(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e)}createWebGLCanvas(t,e){const n=Ms({width:t,height:e}),i=n.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});i&&(i.clearColor(0,0,0,0),this.canvas=n,this.gl=i)}applyFilters(t,e,n,i,s,o){const a=this.gl,c=s.getContext("2d");if(!a||!c)return;let l;o&&(l=this.getCachedTexture(o,e));const h={originalWidth:e.width||e.naturalWidth||0,originalHeight:e.height||e.naturalHeight||0,sourceWidth:n,sourceHeight:i,destinationWidth:n,destinationHeight:i,context:a,sourceTexture:this.createTexture(a,n,i,l?void 0:e),targetTexture:this.createTexture(a,n,i),originalTexture:l||this.createTexture(a,n,i,l?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:s},u=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,u),t.forEach(d=>{d&&d.applyTo(h)}),function(d){const f=d.targetCanvas,m=f.width,_=f.height,g=d.destinationWidth,p=d.destinationHeight;m===g&&_===p||(f.width=g,f.height=p)}(h),this.copyGLTo2D(a,h),a.bindTexture(a.TEXTURE_2D,null),a.deleteTexture(h.sourceTexture),a.deleteTexture(h.targetTexture),a.deleteFramebuffer(u),c.setTransform(1,0,0,1,0,0),h}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,n,i,s){const{NEAREST:o,TEXTURE_2D:a,RGBA:c,UNSIGNED_BYTE:l,CLAMP_TO_EDGE:h,TEXTURE_MAG_FILTER:u,TEXTURE_MIN_FILTER:d,TEXTURE_WRAP_S:f,TEXTURE_WRAP_T:m}=t,_=t.createTexture();return t.bindTexture(a,_),t.texParameteri(a,u,s||o),t.texParameteri(a,d,s||o),t.texParameteri(a,f,h),t.texParameteri(a,m,h),i?t.texImage2D(a,0,c,c,l,i):t.texImage2D(a,0,c,e,n,0,c,l,null),_}getCachedTexture(t,e,n){const{textureCache:i}=this;if(i[t])return i[t];{const s=this.createTexture(this.gl,e.width,e.height,e,n);return s&&(i[t]=s),s}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const n=t.canvas,i=e.targetCanvas,s=i.getContext("2d");if(!s)return;s.translate(0,i.height),s.scale(1,-1);const o=n.height-i.height;s.drawImage(n,0,o,i.width,i.height,0,0,i.width,i.height)}copyGLTo2DPutImageData(t,e){const n=e.targetCanvas.getContext("2d"),i=e.destinationWidth,s=e.destinationHeight,o=i*s*4;if(!n)return;const a=new Uint8Array(this.imageBuffer,0,o),c=new Uint8ClampedArray(this.imageBuffer,0,o);t.readPixels(0,0,i,s,t.RGBA,t.UNSIGNED_BYTE,a);const l=new ImageData(c,i,s);n.putImageData(l,0,0)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const n=t.getExtension("WEBGL_debug_renderer_info");if(n){const i=t.getParameter(n.UNMASKED_RENDERER_WEBGL),s=t.getParameter(n.UNMASKED_VENDOR_WEBGL);i&&(e.renderer=i.toLowerCase()),s&&(e.vendor=s.toLowerCase())}return this.gpuInfo=e,e}}let Ip;function pF(){const{WebGLProbe:r}=Ss();return r.queryWebGL(rs()),he.enableGLFiltering&&r.isSupported(he.textureSize)?new FS({tileSize:he.textureSize}):new fF}function Op(){return!Ip&&(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(Ip=pF()),Ip}const mF=["filters","resizeFilter","src","crossOrigin","type"],kS=["cropX","cropY"];class Pi extends Cn{static getDefaults(){return B(B({},super.getDefaults()),Pi.ownDefaults)}constructor(t,e){super(),U(this,"_lastScaleX",1),U(this,"_lastScaleY",1),U(this,"_filterScalingX",1),U(this,"_filterScalingY",1),this.filters=[],Object.assign(this,Pi.ownDefaults),this.setOptions(e),this.cacheKey="texture".concat(Kr()),this.setElement(typeof t=="string"?(this.canvas&&$i(this.canvas.getElement())||Nc()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(n),(e=t.classList)===null||e===void 0||e.add(Pi.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=Op(!1);e instanceof FS&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(t=>{const e=this[t];e&&Ss().dispose(e),this[t]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||this.strokeWidth===0)return;const e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,-n),t.lineTo(e,-n),t.lineTo(e,n),t.lineTo(-e,n),t.lineTo(-e,-n),t.closePath()}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=[];return this.filters.forEach(n=>{n&&e.push(n.toObject())}),B(B({},super.toObject([...kS,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,n=-this.width/2,i=-this.height/2;let s=[],o=[],a="",c="";if(!e)return[];if(this.hasCrop()){const l=Kr();s.push('<clipPath id="imageCrop_'+l+`">
`,'	<rect x="'+n+'" y="'+i+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),a=' clip-path="url(#imageCrop_'+l+')" '}if(this.imageSmoothing||(c=' image-rendering="optimizeSpeed"'),t.push("	<image ","COMMON_PARTS",'xlink:href="'.concat(this.getSvgSrc(!0),'" x="').concat(n-this.cropX,'" y="').concat(i-this.cropY,'" width="').concat(e.width||e.naturalWidth,'" height="').concat(e.height||e.naturalHeight,'"').concat(c).concat(a,`></image>
`)),this.stroke||this.strokeDashArray){const l=this.fill;this.fill=null,o=['	<rect x="'.concat(n,'" y="').concat(i,'" width="').concat(this.width,'" height="').concat(this.height,'" style="').concat(this.getSvgStyles(),`" />
`)],this.fill=l}return s=this.paintFirst!==on?s.concat(o,t):s.concat(t,o),s}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src")||"":e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return ld(t,{crossOrigin:e,signal:n}).then(i=>{e!==void 0&&this.set({crossOrigin:e}),this.setElement(i)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),i=n.x,s=n.y,o=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||i>e&&s>e)return this._element=o,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=s);const a=Ms(o),{width:c,height:l}=o;this._element=a,this._lastScaleX=t.scaleX=i,this._lastScaleY=t.scaleY=s,Op().applyFilters([t],o,c,l,this._element),this._filterScalingX=a.width/this._originalElement.width,this._filterScalingY=a.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(t=t.filter(s=>s&&!s.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),t.length===0)return this._element=this._originalElement,this._filteredEl=void 0,this._filterScalingX=1,void(this._filterScalingY=1);const e=this._originalElement,n=e.naturalWidth||e.width,i=e.naturalHeight||e.height;if(this._element===this._originalElement){const s=Ms({width:n,height:i});this._element=s,this._filteredEl=s}else this._filteredEl&&(this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,i),this._lastScaleX=1,this._lastScaleY=1);Op().applyFilters(t,this._originalElement,n,i,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const n=this._filterScalingX,i=this._filterScalingY,s=this.width,o=this.height,a=Math.max(this.cropX,0),c=Math.max(this.cropY,0),l=e.naturalWidth||e.width,h=e.naturalHeight||e.height,u=a*n,d=c*i,f=Math.min(s*n,l-u),m=Math.min(o*i,h-d),_=-s/2,g=-o/2,p=Math.min(s,l/n-a),b=Math.min(o,h/i-c);e&&t.drawImage(e,u,d,f,m,_,g,p,b)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.getOriginalSize();this.width=t||n.width,this.height=e||n.height}parsePreserveAspectRatioAttribute(){const t=QL(this.preserveAspectRatio||""),e=this.width,n=this.height,i={width:e,height:n};let s,o=this._element.width,a=this._element.height,c=1,l=1,h=0,u=0,d=0,f=0;return!t||t.alignX===$n&&t.alignY===$n?(c=e/o,l=n/a):(t.meetOrSlice==="meet"&&(c=l=vO(this._element,i),s=(e-o*c)/2,t.alignX==="Min"&&(h=-s),t.alignX==="Max"&&(h=s),s=(n-a*l)/2,t.alignY==="Min"&&(u=-s),t.alignY==="Max"&&(u=s)),t.meetOrSlice==="slice"&&(c=l=xO(this._element,i),s=o-e/c,t.alignX==="Mid"&&(d=s/2),t.alignX==="Max"&&(d=s),s=a-n/l,t.alignY==="Mid"&&(f=s/2),t.alignY==="Max"&&(f=s),o=e/c,a=n/l)),{width:o,height:a,scaleX:c,scaleY:l,offsetLeft:h,offsetTop:u,cropX:d,cropY:f}}static fromObject(t,e){let{filters:n,resizeFilter:i,src:s,crossOrigin:o,type:a}=t,c=Oe(t,mF);return Promise.all([ld(s,B(B({},e),{},{crossOrigin:o})),n&&Xl(n,e),i&&Xl([i],e),nf(c,e)]).then(l=>{let[h,u=[],[d]=[],f={}]=l;return new this(h,B(B({},c),{},{src:s,filters:u,resizeFilter:d},f))})}static fromURL(t){let{crossOrigin:e=null,signal:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0;return ld(t,{crossOrigin:e,signal:n}).then(s=>new this(s,i))}static async fromElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const i=pr(t,this.ATTRIBUTE_NAMES,n);return this.fromURL(i["xlink:href"],e,i).catch(s=>(qr("log","Unable to parse Image",s),null))}}U(Pi,"type","Image"),U(Pi,"cacheProperties",[...fr,...kS]),U(Pi,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),U(Pi,"CSS_CANVAS","canvas-img"),U(Pi,"ATTRIBUTE_NAMES",[...no,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]),wt.setClass(Pi),wt.setSVGClass(Pi);rf(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);const lf=r=>r.webgl!==void 0,N0="precision highp float",gF=`
    `.concat(N0,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),_F=["type"],bF=["type"],yF=new RegExp(N0,"g");class ln{get type(){return this.constructor.type}constructor(){let t=Oe(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_F);Object.assign(this,this.constructor.defaults,t)}getFragmentSource(){return gF}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`}createProgram(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.getVertexSource();const{WebGLProbe:{GLPrecision:i="highp"}}=Ss();i!=="highp"&&(e=e.replace(yF,N0.replace("highp",i)));const s=t.createShader(t.VERTEX_SHADER),o=t.createShader(t.FRAGMENT_SHADER),a=t.createProgram();if(!s||!o||!a)throw new gs("Vertex, fragment shader or program creation error");if(t.shaderSource(s,n),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new gs("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(s)));if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new gs("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(o)));if(t.attachShader(a,s),t.attachShader(a,o),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new gs('Shader link error for "'.concat(this.type,'" ').concat(t.getProgramInfoLog(a)));const c=this.getUniformLocations(t,a)||{};return c.uStepW=t.getUniformLocation(a,"uStepW"),c.uStepH=t.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:this.getAttributeLocations(t,a),uniformLocations:c}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){const n=this.constructor.uniformLocations,i={};for(let s=0;s<n.length;s++)i[n[s]]=t.getUniformLocation(e,n[s]);return i}sendAttributeData(t,e,n){const i=e.aPosition,s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const n=t.destinationWidth,i=t.destinationHeight;t.sourceWidth===n&&t.sourceHeight===i||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,n,i)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){return!1}applyTo(t){lf(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,n=this.retrieveShader(t);t.pass===0&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(n.program),this.sendAttributeData(e,n.attributeLocations,t.aPosition),e.uniform1f(n.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(n.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,n.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,n){t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const{sourceWidth:e,sourceHeight:n}=t,i=Ms({width:e,height:n});t.helpLayer=i}}toObject(){const t=Object.keys(this.constructor.defaults||{});return B({type:this.type},t.reduce((e,n)=>(e[n]=this[n],e),{}))}toJSON(){return this.toObject()}static async fromObject(t,e){return new this(Oe(t,bF))}}U(ln,"type","BaseFilter"),U(ln,"uniformLocations",[]);const vF={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `};class Du extends ln{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(vF[this.mode],`
        }
      }
      `)}applyTo2d(t){let{imageData:{data:e}}=t;const n=new ge(this.color).getSource(),i=this.alpha,s=n[0]*i,o=n[1]*i,a=n[2]*i,c=1-i;for(let l=0;l<e.length;l+=4){const h=e[l],u=e[l+1],d=e[l+2];let f,m,_;switch(this.mode){case"multiply":f=h*s/255,m=u*o/255,_=d*a/255;break;case"screen":f=255-(255-h)*(255-s)/255,m=255-(255-u)*(255-o)/255,_=255-(255-d)*(255-a)/255;break;case"add":f=h+s,m=u+o,_=d+a;break;case"difference":f=Math.abs(h-s),m=Math.abs(u-o),_=Math.abs(d-a);break;case"subtract":f=h-s,m=u-o,_=d-a;break;case"darken":f=Math.min(h,s),m=Math.min(u,o),_=Math.min(d,a);break;case"lighten":f=Math.max(h,s),m=Math.max(u,o),_=Math.max(d,a);break;case"overlay":f=s<128?2*h*s/255:255-2*(255-h)*(255-s)/255,m=o<128?2*u*o/255:255-2*(255-u)*(255-o)/255,_=a<128?2*d*a/255:255-2*(255-d)*(255-a)/255;break;case"exclusion":f=s+h-2*s*h/255,m=o+u-2*o*u/255,_=a+d-2*a*d/255;break;case"tint":f=s+h*c,m=o+u*c,_=a+d*c}e[l]=f,e[l+1]=m,e[l+2]=_}}sendUniformData(t,e){const n=new ge(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(e.uColor,n)}}U(Du,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),U(Du,"type","BlendColor"),U(Du,"uniformLocations",["uColor"]),wt.setClass(Du);const xF={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},wF=["type","image"];class Lu extends ln{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return xF[this.mode]}getVertexSource(){return`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `}applyToWebGL(t){const e=t.context,n=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,n,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:n}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/n,1]}applyTo2d(t){let{imageData:{data:e,width:n,height:i},filterBackend:{resources:s}}=t;const o=this.image;s.blendImage||(s.blendImage=rs());const a=s.blendImage,c=a.getContext("2d");a.width!==n||a.height!==i?(a.width=n,a.height=i):c.clearRect(0,0,n,i),c.setTransform(o.scaleX,0,0,o.scaleY,o.left,o.top),c.drawImage(o.getElement(),0,0,n,i);const l=c.getImageData(0,0,n,i).data;for(let h=0;h<e.length;h+=4){const u=e[h],d=e[h+1],f=e[h+2],m=e[h+3],_=l[h],g=l[h+1],p=l[h+2],b=l[h+3];switch(this.mode){case"multiply":e[h]=u*_/255,e[h+1]=d*g/255,e[h+2]=f*p/255,e[h+3]=m*b/255;break;case"mask":e[h+3]=b}}}sendUniformData(t,e){const n=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,n)}toObject(){return B(B({},super.toObject()),{},{image:this.image&&this.image.toObject()})}static async fromObject(t,e){let{type:n,image:i}=t,s=Oe(t,wF);return Pi.fromObject(i,e).then(o=>new this(B(B({},s),{},{image:o})))}}U(Lu,"type","BlendImage"),U(Lu,"defaults",{mode:"multiply",alpha:1}),U(Lu,"uniformLocations",["uTransformMatrix","uImage"]),wt.setClass(Lu);class Iu extends ln{getFragmentSource(){return`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float total = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        float weight = 1.0 - abs(percent);
        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
        total += weight;
      }
      gl_FragColor = color / total;
    }
  `}applyTo(t){lf(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){let{ctx:e,imageData:n,filterBackend:{resources:i}}=t;const{width:s,height:o}=n;i.blurLayer1||(i.blurLayer1=rs(),i.blurLayer2=rs());const a=i.blurLayer1,c=i.blurLayer2;a.width===s&&a.height===o||(c.width=a.width=s,c.height=a.height=o);const l=a.getContext("2d"),h=c.getContext("2d"),u=15,d=.06*this.blur*.5;let f,m,_,g;for(l.putImageData(n,0,0),h.clearRect(0,0,s,o),g=-15;g<=u;g++)f=(Math.random()-.5)/4,m=g/u,_=d*m*s+f,h.globalAlpha=1-Math.abs(m),h.drawImage(a,_,f),l.drawImage(c,0,0),h.globalAlpha=1,h.clearRect(0,0,c.width,c.height);for(g=-15;g<=u;g++)f=(Math.random()-.5)/4,m=g/u,_=d*m*o+f,h.globalAlpha=1-Math.abs(m),h.drawImage(a,f,_),l.drawImage(c,0,0),h.globalAlpha=1,h.clearRect(0,0,c.width,c.height);e.drawImage(a,0,0);const p=e.getImageData(0,0,a.width,a.height);return l.globalAlpha=1,l.clearRect(0,0,a.width,a.height),p}sendUniformData(t,e){const n=this.chooseRightDelta();t.uniform2fv(e.uDelta,n)}isNeutralState(){return this.blur===0}chooseRightDelta(){let t=1;const e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);const n=t*this.blur*.12;return this.horizontal?e[0]=n:e[1]=n,e}}U(Iu,"type","Blur"),U(Iu,"defaults",{blur:0}),U(Iu,"uniformLocations",["uDelta"]),wt.setClass(Iu);class Ou extends ln{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const n=Math.round(255*this.brightness);for(let i=0;i<e.length;i+=4)e[i]+=n,e[i+1]+=n,e[i+2]+=n}isNeutralState(){return this.brightness===0}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}U(Ou,"type","Brightness"),U(Ou,"defaults",{brightness:0}),U(Ou,"uniformLocations",["uBrightness"]),wt.setClass(Ou);const NS={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],colorsOnly:!0};class Ka extends ln{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`}applyTo2d(t){const e=t.imageData.data,n=this.matrix,i=this.colorsOnly;for(let s=0;s<e.length;s+=4){const o=e[s],a=e[s+1],c=e[s+2];if(e[s]=o*n[0]+a*n[1]+c*n[2]+255*n[4],e[s+1]=o*n[5]+a*n[6]+c*n[7]+255*n[9],e[s+2]=o*n[10]+a*n[11]+c*n[12]+255*n[14],!i){const l=e[s+3];e[s]+=l*n[3],e[s+1]+=l*n[8],e[s+2]+=l*n[13],e[s+3]=o*n[15]+a*n[16]+c*n[17]+l*n[18]+255*n[19]}}}sendUniformData(t,e){const n=this.matrix,i=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],s=[n[4],n[9],n[14],n[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,i),t.uniform4fv(e.uConstants,s)}toObject(){return B(B({},super.toObject()),{},{matrix:[...this.matrix]})}}function Zo(r,t){var e;const n=(U(e=class extends Ka{toObject(){return{type:this.type,colorsOnly:this.colorsOnly}}},"type",r),U(e,"defaults",{colorsOnly:!1,matrix:t}),e);return wt.setClass(n,r),n}U(Ka,"type","ColorMatrix"),U(Ka,"defaults",NS),U(Ka,"uniformLocations",["uColorMatrix","uConstants"]),wt.setClass(Ka);Zo("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);Zo("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);Zo("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);Zo("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);Zo("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);Zo("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);Zo("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);class vv extends ln{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.subFilters=t.subFilters||[]}applyTo(t){lf(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach(e=>{e.applyTo(t)})}toObject(){return{type:this.type,subFilters:this.subFilters.map(t=>t.toObject())}}isNeutralState(){return!this.subFilters.some(t=>!t.isNeutralState())}static fromObject(t,e){return Promise.all((t.subFilters||[]).map(n=>wt.getClass(n.type).fromObject(n,e))).then(n=>new this({subFilters:n}))}}U(vv,"type","Composed"),wt.setClass(vv);class Fu extends ln{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`}isNeutralState(){return this.contrast===0}applyTo2d(t){let{imageData:{data:e}}=t;const n=Math.floor(255*this.contrast),i=259*(n+255)/(255*(259-n));for(let s=0;s<e.length;s+=4)e[s]=i*(e[s]-128)+128,e[s+1]=i*(e[s+1]-128)+128,e[s+2]=i*(e[s+2]-128)+128}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}U(Fu,"type","Contrast"),U(Fu,"defaults",{contrast:0}),U(Fu,"uniformLocations",["uContrast"]),wt.setClass(Fu);const SF={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `};class ku extends ln{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return SF[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,n=e.data,i=this.matrix,s=Math.round(Math.sqrt(i.length)),o=Math.floor(s/2),a=e.width,c=e.height,l=t.ctx.createImageData(a,c),h=l.data,u=this.opaque?1:0;let d,f,m,_,g,p,b,y,v,x,S,T,E;for(S=0;S<c;S++)for(x=0;x<a;x++){for(g=4*(S*a+x),d=0,f=0,m=0,_=0,E=0;E<s;E++)for(T=0;T<s;T++)b=S+E-o,p=x+T-o,b<0||b>=c||p<0||p>=a||(y=4*(b*a+p),v=i[E*s+T],d+=n[y]*v,f+=n[y+1]*v,m+=n[y+2]*v,u||(_+=n[y+3]*v));h[g]=d,h[g+1]=f,h[g+2]=m,h[g+3]=u?n[g+3]:_}t.imageData=l}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return B(B({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}U(ku,"type","Convolute"),U(ku,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),U(ku,"uniformLocations",["uMatrix","uOpaque","uHalfSize","uSize"]),wt.setClass(ku);const US="Gamma";class Nu extends ln{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(t),this.gamma=t.gamma||this.constructor.defaults.gamma.concat()}applyTo2d(t){let{imageData:{data:e}}=t;const n=this.gamma,i=1/n[0],s=1/n[1],o=1/n[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const a=this.rgbValues;for(let c=0;c<256;c++)a.r[c]=255*Math.pow(c/255,i),a.g[c]=255*Math.pow(c/255,s),a.b[c]=255*Math.pow(c/255,o);for(let c=0;c<e.length;c+=4)e[c]=a.r[e[c]],e[c+1]=a.g[e[c+1]],e[c+2]=a.b[e[c+2]]}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}isNeutralState(){const{gamma:t}=this;return t[0]===1&&t[1]===1&&t[2]===1}toObject(){return{type:US,gamma:this.gamma.concat()}}}U(Nu,"type",US),U(Nu,"defaults",{gamma:[1,1,1]}),U(Nu,"uniformLocations",["uGamma"]),wt.setClass(Nu);const MF={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `};class Uu extends ln{applyTo2d(t){let{imageData:{data:e}}=t;for(let n,i=0;i<e.length;i+=4){const s=e[i],o=e[i+1],a=e[i+2];switch(this.mode){case"average":n=(s+o+a)/3;break;case"lightness":n=(Math.min(s,o,a)+Math.max(s,o,a))/2;break;case"luminosity":n=.21*s+.72*o+.07*a}e[i+2]=e[i+1]=e[i]=n}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return MF[this.mode]}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}U(Uu,"type","Grayscale"),U(Uu,"defaults",{mode:"average"}),U(Uu,"uniformLocations",["uMode"]),wt.setClass(Uu);const TF=B(B({},NS),{},{rotation:0});class Fp extends Ka{calculateMatrix(){const t=this.rotation*Math.PI,e=cr(t),n=lr(t),i=1/3,s=Math.sqrt(i)*n,o=1-e;this.matrix=[e+o/3,i*o-s,i*o+s,0,0,i*o+s,e+i*o,i*o-s,0,0,i*o-s,i*o+s,e+i*o,0,0,0,0,0,1,0]}isNeutralState(){return this.rotation===0}applyTo(t){this.calculateMatrix(),super.applyTo(t)}toObject(){return{type:this.type,rotation:this.rotation}}}U(Fp,"type","HueRotation"),U(Fp,"defaults",TF),wt.setClass(Fp);class Bu extends ln{applyTo2d(t){let{imageData:{data:e}}=t;for(let n=0;n<e.length;n+=4)e[n]=255-e[n],e[n+1]=255-e[n+1],e[n+2]=255-e[n+2],this.alpha&&(e[n+3]=255-e[n+3])}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`}isNeutralState(){return!this.invert}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}U(Bu,"type","Invert"),U(Bu,"defaults",{alpha:!1,invert:!0}),U(Bu,"uniformLocations",["uInvert","uAlpha"]),wt.setClass(Bu);class zu extends ln{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const n=this.noise;for(let i=0;i<e.length;i+=4){const s=(.5-Math.random())*n;e[i]+=s,e[i+1]+=s,e[i+2]+=s}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}isNeutralState(){return this.noise===0}}U(zu,"type","Noise"),U(zu,"defaults",{noise:0}),U(zu,"uniformLocations",["uNoise","uSeed"]),wt.setClass(zu);class Vu extends ln{applyTo2d(t){let{imageData:{data:e,width:n,height:i}}=t;for(let s=0;s<i;s+=this.blocksize)for(let o=0;o<n;o+=this.blocksize){const a=4*s*n+4*o,c=e[a],l=e[a+1],h=e[a+2],u=e[a+3];for(let d=s;d<Math.min(s+this.blocksize,i);d++)for(let f=o;f<Math.min(o+this.blocksize,n);f++){const m=4*d*n+4*f;e[m]=c,e[m+1]=l,e[m+2]=h,e[m+3]=u}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepH;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}U(Vu,"type","Pixelate"),U(Vu,"defaults",{blocksize:4}),U(Vu,"uniformLocations",["uBlocksize"]),wt.setClass(Vu);class Hu extends ln{getFragmentSource(){return`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`}applyTo2d(t){let{imageData:{data:e}}=t;const n=255*this.distance,i=new ge(this.color).getSource(),s=[i[0]-n,i[1]-n,i[2]-n],o=[i[0]+n,i[1]+n,i[2]+n];for(let a=0;a<e.length;a+=4){const c=e[a],l=e[a+1],h=e[a+2];c>s[0]&&l>s[1]&&h>s[2]&&c<o[0]&&l<o[1]&&h<o[2]&&(e[a+3]=0)}}sendUniformData(t,e){const n=new ge(this.color).getSource(),i=this.distance,s=[0+n[0]/255-i,0+n[1]/255-i,0+n[2]/255-i,1],o=[n[0]/255+i,n[1]/255+i,n[2]/255+i,1];t.uniform4fv(e.uLow,s),t.uniform4fv(e.uHigh,o)}}U(Hu,"type","RemoveColor"),U(Hu,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),U(Hu,"uniformLocations",["uLow","uHigh"]),wt.setClass(Hu);class Gu extends ln{sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,n=this.getFilterWindow(),i=new Array(n);for(let s=1;s<=n;s++)i[s-1]=t(s*e);return i}generateShader(t){const e=new Array(t);for(let n=1;n<=t;n++)e[n-1]="".concat(n,".0 * uDelta");return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec2 uDelta;
      varying vec2 vTexCoord;
      uniform float uTaps[`.concat(t,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(e.map((n,i)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(n,") * uTaps[").concat(i,"] + texture2D(uTexture, vTexCoord - ").concat(n,") * uTaps[").concat(i,`];
              sum += 2.0 * uTaps[`).concat(i,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyToForWebgl(t){t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,super.applyTo(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,super.applyTo(t),t.sourceHeight=t.destinationHeight}applyTo(t){lf(t)?this.applyToForWebgl(t):this.applyTo2d(t)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-11920929e-14)return 1;const n=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(n)/n}}applyTo2d(t){const e=t.imageData,n=this.scaleX,i=this.scaleY;this.rcpScaleX=1/n,this.rcpScaleY=1/i;const s=e.width,o=e.height,a=Math.round(s*n),c=Math.round(o*i);let l;l=this.resizeType==="sliceHack"?this.sliceByTwo(t,s,o,a,c):this.resizeType==="hermite"?this.hermiteFastResize(t,s,o,a,c):this.resizeType==="bilinear"?this.bilinearFiltering(t,s,o,a,c):this.resizeType==="lanczos"?this.lanczosResize(t,s,o,a,c):new ImageData(a,c),t.imageData=l}sliceByTwo(t,e,n,i,s){const o=t.imageData,a=.5;let c=!1,l=!1,h=e*a,u=n*a;const d=t.filterBackend.resources;let f=0,m=0;const _=e;let g=0;d.sliceByTwo||(d.sliceByTwo=rs());const p=d.sliceByTwo;(p.width<1.5*e||p.height<n)&&(p.width=1.5*e,p.height=n);const b=p.getContext("2d");for(b.clearRect(0,0,1.5*e,n),b.putImageData(o,0,0),i=Math.floor(i),s=Math.floor(s);!c||!l;)e=h,n=u,i<Math.floor(h*a)?h=Math.floor(h*a):(h=i,c=!0),s<Math.floor(u*a)?u=Math.floor(u*a):(u=s,l=!0),b.drawImage(p,f,m,e,n,_,g,h,u),f=_,m=g,g+=u;return b.getImageData(f,m,i,s)}lanczosResize(t,e,n,i,s){const o=t.imageData.data,a=t.ctx.createImageData(i,s),c=a.data,l=this.lanczosCreate(this.lanczosLobes),h=this.rcpScaleX,u=this.rcpScaleY,d=2/this.rcpScaleX,f=2/this.rcpScaleY,m=Math.ceil(h*this.lanczosLobes/2),_=Math.ceil(u*this.lanczosLobes/2),g={},p={x:0,y:0},b={x:0,y:0};return function y(v){let x,S,T,E,w,M,P,L,I,F,z;for(p.x=(v+.5)*h,b.x=Math.floor(p.x),x=0;x<s;x++){for(p.y=(x+.5)*u,b.y=Math.floor(p.y),w=0,M=0,P=0,L=0,I=0,S=b.x-m;S<=b.x+m;S++)if(!(S<0||S>=e)){F=Math.floor(1e3*Math.abs(S-p.x)),g[F]||(g[F]={});for(let N=b.y-_;N<=b.y+_;N++)N<0||N>=n||(z=Math.floor(1e3*Math.abs(N-p.y)),g[F][z]||(g[F][z]=l(Math.sqrt(Math.pow(F*d,2)+Math.pow(z*f,2))/1e3)),T=g[F][z],T>0&&(E=4*(N*e+S),w+=T,M+=T*o[E],P+=T*o[E+1],L+=T*o[E+2],I+=T*o[E+3]))}E=4*(x*i+v),c[E]=M/w,c[E+1]=P/w,c[E+2]=L/w,c[E+3]=I/w}return++v<i?y(v):a}(0)}bilinearFiltering(t,e,n,i,s){let o,a,c,l,h,u,d,f,m,_,g,p,b,y=0;const v=this.rcpScaleX,x=this.rcpScaleY,S=4*(e-1),T=t.imageData.data,E=t.ctx.createImageData(i,s),w=E.data;for(d=0;d<s;d++)for(f=0;f<i;f++)for(h=Math.floor(v*f),u=Math.floor(x*d),m=v*f-h,_=x*d-u,b=4*(u*e+h),g=0;g<4;g++)o=T[b+g],a=T[b+4+g],c=T[b+S+g],l=T[b+S+4+g],p=o*(1-m)*(1-_)+a*m*(1-_)+c*_*(1-m)+l*m*_,w[y++]=p;return E}hermiteFastResize(t,e,n,i,s){const o=this.rcpScaleX,a=this.rcpScaleY,c=Math.ceil(o/2),l=Math.ceil(a/2),h=t.imageData.data,u=t.ctx.createImageData(i,s),d=u.data;for(let f=0;f<s;f++)for(let m=0;m<i;m++){const _=4*(m+f*i);let g=0,p=0,b=0,y=0,v=0,x=0,S=0;const T=(f+.5)*a;for(let E=Math.floor(f*a);E<(f+1)*a;E++){const w=Math.abs(T-(E+.5))/l,M=(m+.5)*o,P=w*w;for(let L=Math.floor(m*o);L<(m+1)*o;L++){let I=Math.abs(M-(L+.5))/c;const F=Math.sqrt(P+I*I);F>1&&F<-1||(g=2*F*F*F-3*F*F+1,g>0&&(I=4*(L+E*e),S+=g*h[I+3],b+=g,h[I+3]<255&&(g=g*h[I+3]/250),y+=g*h[I],v+=g*h[I+1],x+=g*h[I+2],p+=g))}}d[_]=y/p,d[_+1]=v/p,d[_+2]=x/p,d[_+3]=S/b}return u}}U(Gu,"type","Resize"),U(Gu,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3}),U(Gu,"uniformLocations",["uDelta","uTaps"]),wt.setClass(Gu);class ju extends ln{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const n=-this.saturation;for(let i=0;i<e.length;i+=4){const s=e[i],o=e[i+1],a=e[i+2],c=Math.max(s,o,a);e[i]+=c!==s?(c-s)*n:0,e[i+1]+=c!==o?(c-o)*n:0,e[i+2]+=c!==a?(c-a)*n:0}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}isNeutralState(){return this.saturation===0}}U(ju,"type","Saturation"),U(ju,"defaults",{saturation:0}),U(ju,"uniformLocations",["uSaturation"]),wt.setClass(ju);class Wu extends ln{getFragmentSource(){return`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`}applyTo2d(t){let{imageData:{data:e}}=t;const n=-this.vibrance;for(let i=0;i<e.length;i+=4){const s=e[i],o=e[i+1],a=e[i+2],c=Math.max(s,o,a),l=(s+o+a)/3,h=2*Math.abs(c-l)/255*n;e[i]+=c!==s?(c-s)*h:0,e[i+1]+=c!==o?(c-o)*h:0,e[i+2]+=c!==a?(c-a)*h:0}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}isNeutralState(){return this.vibrance===0}}U(Wu,"type","Vibrance"),U(Wu,"defaults",{vibrance:0}),U(Wu,"uniformLocations",["uVibrance"]),wt.setClass(Wu);const Xu=128;class EF extends ct{constructor(){super();A(this,"geometry");A(this,"material");A(this,"diffuseMap");A(this,"alphaMap");A(this,"mapCanvas");A(this,"alphaCanvas");A(this,"mapText");A(this,"alphaText");A(this,"_fontSize");A(this,"fontSizeScale");A(this,"onDiffuseMapRender",()=>{this.diffuseMap.needsUpdate=!0});A(this,"onAlphaMapRender",()=>{this.alphaMap.needsUpdate=!0});this._fontSize=12,this.fontSizeScale=2,this.geometry=new Nn,this.material=new en({transparent:!0,side:Sn,toneMapped:!1,alphaTest:.1});const e=Xu,n=Xu,i=document.createElement("canvas");i.width=e,i.height=n,i.style.width=`${e}px`,i.style.height=`${n}px`;const s=document.createElement("canvas");s.width=e,s.height=n,s.style.width=`${e}px`,s.style.height=`${n}px`,this.mapCanvas=new Wo(i,{backgroundColor:"#000",width:e,height:n}),this.alphaCanvas=new Wo(s,{backgroundColor:"#000",width:e,height:n});const o=this._fontSize*this.fontSizeScale;this.mapText=new Js("文本",{width:e,fontSize:o,fontFamily:"Arial",fontStyle:"normal",splitByGraheme:!0,fill:"#000",textAlign:"center"}),this.alphaText=new Js("文本",{width:e,fontSize:o,fontFamily:"Arial",fontStyle:"normal",splitByGraheme:!0,fill:"#fff",textAlign:"center"}),this.mapCanvas.add(this.mapText),this.alphaCanvas.add(this.alphaText),this.mapCanvas.on("after:render",this.onDiffuseMapRender),this.alphaCanvas.on("after:render",this.onAlphaMapRender),this.diffuseMap=new Jh(this.mapCanvas.lowerCanvasEl),this.alphaMap=new Jh(this.alphaCanvas.lowerCanvasEl),this.material.map=this.diffuseMap,this.material.alphaMap=this.alphaMap,this.material.map.needsUpdate=!0,this.material.alphaMap.needsUpdate=!0,this.material.needsUpdate=!0}get text(){return this.mapText.text}set text(e){this.mapText.set("text",e),this.alphaText.set("text",e)}get align(){return this.mapText.textAlign}set align(e){this.mapText.set("textAlign",e),this.alphaText.set("textAlign",e)}get fill(){return this.mapText.fill}set fill(e){this.mapText.set("fill",e)}get fontFamily(){return this.mapText.fontFamily}set fontFamily(e){this.mapText.set("fontFamily",e),this.alphaText.set("fontFamily",e)}get fontSize(){return this._fontSize}set fontSize(e){this._fontSize=e,this.mapText.set("fontSize",this.fontSize*this.fontSizeScale),this.alphaText.set("fontSize",this.fontSize*this.fontSizeScale)}get fontStyle(){return this.mapText.fontStyle}set fontStyle(e){this.mapText.set("fontStyle",e),this.alphaText.set("fontStyle",e)}setSize(e,n){this.geometry.dispose(),this.geometry=new Nn(e,n),e=e*Xu,n=n*Xu,this.mapCanvas.lowerCanvasEl.width=e,this.mapCanvas.lowerCanvasEl.height=n,this.mapCanvas.lowerCanvasEl.style.width=`${e}px`,this.mapCanvas.lowerCanvasEl.style.height=`${n}px`,this.alphaCanvas.lowerCanvasEl.width=e,this.alphaCanvas.lowerCanvasEl.height=n,this.alphaCanvas.lowerCanvasEl.style.width=`${e}px`,this.alphaCanvas.lowerCanvasEl.style.height=`${n}px`,this.mapCanvas.set("width",e),this.mapCanvas.set("height",n),this.alphaCanvas.set("width",e),this.alphaCanvas.set("height",n),this.mapText.set("width",e),this.mapText.set("height",n),this.alphaText.set("width",e),this.alphaText.set("height",n),this.diffuseMap.dispose(),this.alphaMap.dispose(),this.mapCanvas.requestRenderAll(),this.alphaCanvas.requestRenderAll(),this.diffuseMap=new Jh(this.mapCanvas.lowerCanvasEl),this.alphaMap=new Jh(this.alphaCanvas.lowerCanvasEl),this.diffuseMap.minFilter=gn,this.alphaMap.minFilter=gn,this.material.map=this.diffuseMap,this.material.alphaMap=this.alphaMap}render(){this.mapCanvas.requestRenderAll(),this.alphaCanvas.requestRenderAll()}dispose(){this.mapCanvas.off("after:render",this.onDiffuseMapRender),this.alphaCanvas.off("after:render",this.onAlphaMapRender),this.diffuseMap.dispose(),this.alphaMap.dispose()}}var AF=Object.defineProperty,CF=(r,t,e)=>t in r?AF(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Us=(r,t,e)=>(CF(r,typeof t!="symbol"?t+"":t,e),e);class PF{constructor(){Us(this,"_previousTime"),Us(this,"_currentTime"),Us(this,"_delta"),Us(this,"_elapsed"),Us(this,"_timescale"),Us(this,"_useFixedDelta"),Us(this,"_fixedDelta"),Us(this,"_usePageVisibilityAPI"),Us(this,"_pageVisibilityHandler"),this._previousTime=0,this._currentTime=0,this._delta=0,this._elapsed=0,this._timescale=1,this._useFixedDelta=!1,this._fixedDelta=16.67,this._usePageVisibilityAPI=typeof document<"u"&&document.hidden!==void 0}connect(){return this._usePageVisibilityAPI&&(this._pageVisibilityHandler=RF.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1)),this}dispose(){return this._usePageVisibilityAPI&&this._pageVisibilityHandler&&document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this}disableFixedDelta(){return this._useFixedDelta=!1,this}enableFixedDelta(){return this._useFixedDelta=!0,this}getDelta(){return this._delta/1e3}getElapsedTime(){return this._elapsed/1e3}getFixedDelta(){return this._fixedDelta/1e3}getTimescale(){return this._timescale}reset(){return this._currentTime=this._now(),this}setFixedDelta(t){return this._fixedDelta=t*1e3,this}setTimescale(t){return this._timescale=t,this}update(){return this._useFixedDelta===!0?this._delta=this._fixedDelta:(this._previousTime=this._currentTime,this._currentTime=this._now(),this._delta=this._currentTime-this._previousTime),this._delta*=this._timescale,this._elapsed+=this._delta,this}get elapsedTime(){return this.getElapsedTime()}_now(){return(typeof performance>"u"?Date:performance).now()}}function RF(){document.hidden===!1&&this.reset()}const U0=parseInt(ah.replace(/\D+/g,"")),DF=U0>=125?"uv1":"uv2";function xv(r,t){if(t===rE)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),r;if(t===Vm||t===Kx){let e=r.getIndex();if(e===null){const o=[],a=r.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)o.push(c);r.setIndex(o),e=r.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),r}const n=e.count-2,i=[];if(e)if(t===Vm)for(let o=1;o<=n;o++)i.push(e.getX(0)),i.push(e.getX(o)),i.push(e.getX(o+1));else for(let o=0;o<n;o++)o%2===0?(i.push(e.getX(o)),i.push(e.getX(o+1)),i.push(e.getX(o+2))):(i.push(e.getX(o+2)),i.push(e.getX(o+1)),i.push(e.getX(o)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=r.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),r}var LF=Object.defineProperty,IF=(r,t,e)=>t in r?LF(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,OF=(r,t,e)=>(IF(r,t+"",e),e);async function wv(r){const t=await r.arrayBuffer(),e=btoa(String.fromCharCode(...new Uint8Array(t)));return`data:${r.type||""};base64,${e}`}let Yu,kp,La,qu;function Np(r,t=1/0,e=null){kp||(kp=new Nn(2,2,1,1)),La||(La=new ws({uniforms:{blitTexture:new Or(r)},vertexShader:`
        varying vec2 vUv;
        void main(){
            vUv = uv;
            gl_Position = vec4(position.xy * 1.0,0.,.999999);
        }
      `,fragmentShader:`
          uniform sampler2D blitTexture; 
          varying vec2 vUv;

          void main(){ 
              gl_FragColor = vec4(vUv.xy, 0, 1);
              
              #ifdef IS_SRGB
              gl_FragColor = LinearTosRGB( texture2D( blitTexture, vUv) );
              #else
              gl_FragColor = texture2D( blitTexture, vUv);
              #endif
          }
      `})),La.uniforms.blitTexture.value=r,La.defines.IS_SRGB="colorSpace"in r?r.colorSpace==="srgb":r.encoding===3001,La.needsUpdate=!0,qu||(qu=new ct(kp,La),qu.frustrumCulled=!1);const n=new rn,i=new xc;i.add(qu),e||(e=Yu=new hw({antialias:!1})),e.setSize(Math.min(r.image.width,t),Math.min(r.image.height,t)),e.clear(),e.render(i,n);const s=new Ie(e.domElement);return s.minFilter=r.minFilter,s.magFilter=r.magFilter,s.wrapS=r.wrapS,s.wrapT=r.wrapT,s.name=r.name,Yu&&(Yu.dispose(),Yu=null),s}const Sv={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]},BS=(()=>{class r{constructor(){this.pluginCallbacks=[],this.register(function(e){return new jF(e)}),this.register(function(e){return new WF(e)}),this.register(function(e){return new qF(e)}),this.register(function(e){return new KF(e)}),this.register(function(e){return new ZF(e)}),this.register(function(e){return new QF(e)}),this.register(function(e){return new XF(e)}),this.register(function(e){return new YF(e)}),this.register(function(e){return new $F(e)}),this.register(function(e){return new JF(e)}),this.register(function(e){return new tk(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,i,s){const o=new GF,a=[];for(let c=0,l=this.pluginCallbacks.length;c<l;c++)a.push(this.pluginCallbacks[c](o));o.setPlugins(a),o.write(e,n,s).catch(i)}parseAsync(e,n){const i=this;return new Promise(function(s,o){i.parse(e,s,o,n)})}}return OF(r,"Utils",{insertKeyframe:function(t,e){const i=t.getValueSize(),s=new t.TimeBufferType(t.times.length+1),o=new t.ValueBufferType(t.values.length+i),a=t.createInterpolant(new t.ValueBufferType(i));let c;if(t.times.length===0){s[0]=e;for(let l=0;l<i;l++)o[l]=0;c=0}else if(e<t.times[0]){if(Math.abs(t.times[0]-e)<.001)return 0;s[0]=e,s.set(t.times,1),o.set(a.evaluate(e),0),o.set(t.values,i),c=0}else if(e>t.times[t.times.length-1]){if(Math.abs(t.times[t.times.length-1]-e)<.001)return t.times.length-1;s[s.length-1]=e,s.set(t.times,0),o.set(t.values,0),o.set(a.evaluate(e),t.values.length),c=s.length-1}else for(let l=0;l<t.times.length;l++){if(Math.abs(t.times[l]-e)<.001)return l;if(t.times[l]<e&&t.times[l+1]>e){s.set(t.times.slice(0,l+1),0),s[l+1]=e,s.set(t.times.slice(l+1),l+2),o.set(t.values.slice(0,(l+1)*i),0),o.set(a.evaluate(e),(l+1)*i),o.set(t.values.slice((l+1)*i),(l+2)*i),c=l+1;break}}return t.times=s,t.values=o,c},mergeMorphTargetTracks:function(t,e){const n=[],i={},s=t.tracks;for(let o=0;o<s.length;++o){let a=s[o];const c=$t.parseTrackName(a.name),l=$t.findNode(e,c.nodeName);if(c.propertyName!=="morphTargetInfluences"||c.propertyIndex===void 0){n.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(bc)}const h=l.morphTargetInfluences.length,u=l.morphTargetDictionary[c.propertyIndex];if(u===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+c.propertyIndex);let d;if(i[l.uuid]===void 0){d=a.clone();const m=new d.ValueBufferType(h*d.times.length);for(let _=0;_<d.times.length;_++)m[_*h+u]=d.values[_];d.name=(c.nodeName||"")+".morphTargetInfluences",d.values=m,i[l.uuid]=d,n.push(d);continue}const f=a.createInterpolant(new a.ValueBufferType(1));d=i[l.uuid];for(let m=0;m<d.times.length;m++)d.values[m*h+u]=f.evaluate(d.times[m]);for(let m=0;m<a.times.length;m++){const _=this.insertKeyframe(d,a.times[m]);d.values[_*h+u]=a.values[m]}}return t.tracks=n,t}}),r})(),Jt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Up="KHR_mesh_quantization",pi={};pi[gn]=Jt.NEAREST;pi[Vg]=Jt.NEAREST_MIPMAP_NEAREST;pi[za]=Jt.NEAREST_MIPMAP_LINEAR;pi[dn]=Jt.LINEAR;pi[Ml]=Jt.LINEAR_MIPMAP_NEAREST;pi[Ji]=Jt.LINEAR_MIPMAP_LINEAR;pi[di]=Jt.CLAMP_TO_EDGE;pi[xs]=Jt.REPEAT;pi[zl]=Jt.MIRRORED_REPEAT;const Mv={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},FF=new pt,Tv=12,kF=1179937895,NF=2,Ev=8,UF=1313821514,BF=5130562;function xl(r,t){return r.length===t.length&&r.every(function(e,n){return e===t[n]})}function zF(r){return new TextEncoder().encode(r).buffer}function VF(r){return xl(r.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function HF(r,t,e){const n={min:new Array(r.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(r.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let i=t;i<t+e;i++)for(let s=0;s<r.itemSize;s++){let o;r.itemSize>4?o=r.array[i*r.itemSize+s]:(s===0?o=r.getX(i):s===1?o=r.getY(i):s===2?o=r.getZ(i):s===3&&(o=r.getW(i)),r.normalized===!0&&(o=Le.normalize(o,r.array))),n.min[s]=Math.min(n.min[s],o),n.max[s]=Math.max(n.max[s],o)}return n}function zS(r){return Math.ceil(r/4)*4}function Bp(r,t=0){const e=zS(r.byteLength);if(e!==r.byteLength){const n=new Uint8Array(e);if(n.set(new Uint8Array(r)),t!==0)for(let i=r.byteLength;i<e;i++)n[i]=t;return n.buffer}return r}function Av(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function Cv(r,t){if(r.toBlob!==void 0)return new Promise(n=>r.toBlob(n,t));let e;return t==="image/jpeg"?e=.92:t==="image/webp"&&(e=.8),r.convertToBlob({type:t,quality:e})}class GF{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(t){this.plugins=t}async write(t,e,n={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(t),await Promise.all(this.pending);const i=this,s=i.buffers,o=i.json;n=i.options;const a=i.extensionsUsed,c=i.extensionsRequired,l=new Blob(s,{type:"application/octet-stream"}),h=Object.keys(a),u=Object.keys(c);h.length>0&&(o.extensionsUsed=h),u.length>0&&(o.extensionsRequired=u),o.buffers&&o.buffers.length>0&&(o.buffers[0].byteLength=l.size),n.binary===!0?l.arrayBuffer().then(d=>{const f=Bp(d),m=new DataView(new ArrayBuffer(Ev));m.setUint32(0,f.byteLength,!0),m.setUint32(4,BF,!0);const _=Bp(zF(JSON.stringify(o)),32),g=new DataView(new ArrayBuffer(Ev));g.setUint32(0,_.byteLength,!0),g.setUint32(4,UF,!0);const p=new ArrayBuffer(Tv),b=new DataView(p);b.setUint32(0,kF,!0),b.setUint32(4,NF,!0);const y=Tv+g.byteLength+_.byteLength+m.byteLength+f.byteLength;b.setUint32(8,y,!0),new Blob([p,g,_,m,f],{type:"application/octet-stream"}).arrayBuffer().then(e)}):o.buffers&&o.buffers.length>0?wv(l).then(d=>{o.buffers[0].uri=d,e(o)}):e(o)}serializeUserData(t,e){if(Object.keys(t.userData).length===0)return;const n=this.options,i=this.extensionsUsed;try{const s=JSON.parse(JSON.stringify(t.userData));if(n.includeCustomExtensions&&s.gltfExtensions){e.extensions===void 0&&(e.extensions={});for(const o in s.gltfExtensions)e.extensions[o]=s.gltfExtensions[o],i[o]=!0;delete s.gltfExtensions}Object.keys(s).length>0&&(e.extras=s)}catch(s){console.warn("THREE.GLTFExporter: userData of '"+t.name+"' won't be serialized because of JSON.stringify error - "+s.message)}}getUID(t,e=!1){if(this.uids.has(t)===!1){const i=new Map;i.set(!0,this.uid++),i.set(!1,this.uid++),this.uids.set(t,i)}return this.uids.get(t).get(e)}isNormalizedNormalAttribute(t){if(this.cache.attributesNormalized.has(t))return!1;const n=new C;for(let i=0,s=t.count;i<s;i++)if(Math.abs(n.fromBufferAttribute(t,i).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(t){const e=this.cache;if(e.attributesNormalized.has(t))return e.attributesNormalized.get(t);const n=t.clone(),i=new C;for(let s=0,o=n.count;s<o;s++)i.fromBufferAttribute(n,s),i.x===0&&i.y===0&&i.z===0?i.setX(1):i.normalize(),n.setXYZ(s,i.x,i.y,i.z);return e.attributesNormalized.set(t,n),n}applyTextureTransform(t,e){let n=!1;const i={};(e.offset.x!==0||e.offset.y!==0)&&(i.offset=e.offset.toArray(),n=!0),e.rotation!==0&&(i.rotation=e.rotation,n=!0),(e.repeat.x!==1||e.repeat.y!==1)&&(i.scale=e.repeat.toArray(),n=!0),n&&(t.extensions=t.extensions||{},t.extensions.KHR_texture_transform=i,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(t,e){if(t===e)return t;function n(f){return("colorSpace"in f?f.colorSpace==="srgb":f.encoding===3001)?function(_){return _<.04045?_*.0773993808:Math.pow(_*.9478672986+.0521327014,2.4)}:function(_){return _}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),t instanceof rp&&(t=Np(t)),e instanceof rp&&(e=Np(e));const i=t?t.image:null,s=e?e.image:null,o=Math.max(i?i.width:0,s?s.width:0),a=Math.max(i?i.height:0,s?s.height:0),c=Av();c.width=o,c.height=a;const l=c.getContext("2d");l.fillStyle="#00ffff",l.fillRect(0,0,o,a);const h=l.getImageData(0,0,o,a);if(i){l.drawImage(i,0,0,o,a);const f=n(t),m=l.getImageData(0,0,o,a).data;for(let _=2;_<m.length;_+=4)h.data[_]=f(m[_]/256)*256}if(s){l.drawImage(s,0,0,o,a);const f=n(e),m=l.getImageData(0,0,o,a).data;for(let _=1;_<m.length;_+=4)h.data[_]=f(m[_]/256)*256}l.putImageData(h,0,0);const d=(t||e).clone();return d.source=new Ie(c).source,"colorSpace"in d?d.colorSpace="":d.encoding=3e3,d.channel=(t||e).channel,t&&e&&t.channel!==e.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),d}processBuffer(t){const e=this.json,n=this.buffers;return e.buffers||(e.buffers=[{byteLength:0}]),n.push(t),0}processBufferView(t,e,n,i,s){const o=this.json;o.bufferViews||(o.bufferViews=[]);let a;switch(e){case Jt.BYTE:case Jt.UNSIGNED_BYTE:a=1;break;case Jt.SHORT:case Jt.UNSIGNED_SHORT:a=2;break;default:a=4}let c=t.itemSize*a;s===Jt.ARRAY_BUFFER&&(c=Math.ceil(c/4)*4);const l=zS(i*c),h=new DataView(new ArrayBuffer(l));let u=0;for(let m=n;m<n+i;m++){for(let _=0;_<t.itemSize;_++){let g;t.itemSize>4?g=t.array[m*t.itemSize+_]:(_===0?g=t.getX(m):_===1?g=t.getY(m):_===2?g=t.getZ(m):_===3&&(g=t.getW(m)),t.normalized===!0&&(g=Le.normalize(g,t.array))),e===Jt.FLOAT?h.setFloat32(u,g,!0):e===Jt.INT?h.setInt32(u,g,!0):e===Jt.UNSIGNED_INT?h.setUint32(u,g,!0):e===Jt.SHORT?h.setInt16(u,g,!0):e===Jt.UNSIGNED_SHORT?h.setUint16(u,g,!0):e===Jt.BYTE?h.setInt8(u,g):e===Jt.UNSIGNED_BYTE&&h.setUint8(u,g),u+=a}u%c!==0&&(u+=c-u%c)}const d={buffer:this.processBuffer(h.buffer),byteOffset:this.byteOffset,byteLength:l};return s!==void 0&&(d.target=s),s===Jt.ARRAY_BUFFER&&(d.byteStride=c),this.byteOffset+=l,o.bufferViews.push(d),{id:o.bufferViews.length-1,byteLength:0}}processBufferViewImage(t){const e=this,n=e.json;return n.bufferViews||(n.bufferViews=[]),t.arrayBuffer().then(i=>{const s=Bp(i),o={buffer:e.processBuffer(s),byteOffset:e.byteOffset,byteLength:s.byteLength};return e.byteOffset+=s.byteLength,n.bufferViews.push(o)-1})}processAccessor(t,e,n,i){const s=this.json,o={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let a;if(t.array.constructor===Float32Array)a=Jt.FLOAT;else if(t.array.constructor===Int32Array)a=Jt.INT;else if(t.array.constructor===Uint32Array)a=Jt.UNSIGNED_INT;else if(t.array.constructor===Int16Array)a=Jt.SHORT;else if(t.array.constructor===Uint16Array)a=Jt.UNSIGNED_SHORT;else if(t.array.constructor===Int8Array)a=Jt.BYTE;else if(t.array.constructor===Uint8Array)a=Jt.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+t.array.constructor.name);if(n===void 0&&(n=0),i===void 0&&(i=t.count),i===0)return null;const c=HF(t,n,i);let l;e!==void 0&&(l=t===e.index?Jt.ELEMENT_ARRAY_BUFFER:Jt.ARRAY_BUFFER);const h=this.processBufferView(t,a,n,i,l),u={bufferView:h.id,byteOffset:h.byteOffset,componentType:a,count:i,max:c.max,min:c.min,type:o[t.itemSize]};return t.normalized===!0&&(u.normalized=!0),s.accessors||(s.accessors=[]),s.accessors.push(u)-1}processImage(t,e,n,i="image/png"){if(t!==null){const s=this,o=s.cache,a=s.json,c=s.options,l=s.pending;o.images.has(t)||o.images.set(t,{});const h=o.images.get(t),u=i+":flipY/"+n.toString();if(h[u]!==void 0)return h[u];a.images||(a.images=[]);const d={mimeType:i},f=Av();f.width=Math.min(t.width,c.maxTextureSize),f.height=Math.min(t.height,c.maxTextureSize);const m=f.getContext("2d");if(n===!0&&(m.translate(0,f.height),m.scale(1,-1)),t.data!==void 0){e!==zn&&console.error("GLTFExporter: Only RGBAFormat is supported.",e),(t.width>c.maxTextureSize||t.height>c.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",t);const g=new Uint8ClampedArray(t.height*t.width*4);for(let p=0;p<g.length;p+=4)g[p+0]=t.data[p+0],g[p+1]=t.data[p+1],g[p+2]=t.data[p+2],g[p+3]=t.data[p+3];m.putImageData(new ImageData(g,t.width,t.height),0,0)}else m.drawImage(t,0,0,f.width,f.height);c.binary===!0?l.push(Cv(f,i).then(g=>s.processBufferViewImage(g)).then(g=>{d.bufferView=g})):f.toDataURL!==void 0?d.uri=f.toDataURL(i):l.push(Cv(f,i).then(wv).then(g=>{d.uri=g}));const _=a.images.push(d)-1;return h[u]=_,_}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(t){const e=this.json;e.samplers||(e.samplers=[]);const n={magFilter:pi[t.magFilter],minFilter:pi[t.minFilter],wrapS:pi[t.wrapS],wrapT:pi[t.wrapT]};return e.samplers.push(n)-1}processTexture(t){const n=this.options,i=this.cache,s=this.json;if(i.textures.has(t))return i.textures.get(t);s.textures||(s.textures=[]),t instanceof rp&&(t=Np(t,n.maxTextureSize));let o=t.userData.mimeType;o==="image/webp"&&(o="image/png");const a={sampler:this.processSampler(t),source:this.processImage(t.image,t.format,t.flipY,o)};t.name&&(a.name=t.name),this._invokeAll(function(l){l.writeTexture&&l.writeTexture(t,a)});const c=s.textures.push(a)-1;return i.textures.set(t,c),c}processMaterial(t){const e=this.cache,n=this.json;if(e.materials.has(t))return e.materials.get(t);if(t.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const i={pbrMetallicRoughness:{}};t.isMeshStandardMaterial!==!0&&t.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const s=t.color.toArray().concat([t.opacity]);if(xl(s,[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=s),t.isMeshStandardMaterial?(i.pbrMetallicRoughness.metallicFactor=t.metalness,i.pbrMetallicRoughness.roughnessFactor=t.roughness):(i.pbrMetallicRoughness.metallicFactor=.5,i.pbrMetallicRoughness.roughnessFactor=.5),t.metalnessMap||t.roughnessMap){const a=this.buildMetalRoughTexture(t.metalnessMap,t.roughnessMap),c={index:this.processTexture(a),channel:a.channel};this.applyTextureTransform(c,a),i.pbrMetallicRoughness.metallicRoughnessTexture=c}if(t.map){const a={index:this.processTexture(t.map),texCoord:t.map.channel};this.applyTextureTransform(a,t.map),i.pbrMetallicRoughness.baseColorTexture=a}if(t.emissive){const a=t.emissive;if(Math.max(a.r,a.g,a.b)>0&&(i.emissiveFactor=t.emissive.toArray()),t.emissiveMap){const l={index:this.processTexture(t.emissiveMap),texCoord:t.emissiveMap.channel};this.applyTextureTransform(l,t.emissiveMap),i.emissiveTexture=l}}if(t.normalMap){const a={index:this.processTexture(t.normalMap),texCoord:t.normalMap.channel};t.normalScale&&t.normalScale.x!==1&&(a.scale=t.normalScale.x),this.applyTextureTransform(a,t.normalMap),i.normalTexture=a}if(t.aoMap){const a={index:this.processTexture(t.aoMap),texCoord:t.aoMap.channel};t.aoMapIntensity!==1&&(a.strength=t.aoMapIntensity),this.applyTextureTransform(a,t.aoMap),i.occlusionTexture=a}t.transparent?i.alphaMode="BLEND":t.alphaTest>0&&(i.alphaMode="MASK",i.alphaCutoff=t.alphaTest),t.side===Sn&&(i.doubleSided=!0),t.name!==""&&(i.name=t.name),this.serializeUserData(t,i),this._invokeAll(function(a){a.writeMaterial&&a.writeMaterial(t,i)});const o=n.materials.push(i)-1;return e.materials.set(t,o),o}processMesh(t){const e=this.cache,n=this.json,i=[t.geometry.uuid];if(Array.isArray(t.material))for(let y=0,v=t.material.length;y<v;y++)i.push(t.material[y].uuid);else i.push(t.material.uuid);const s=i.join(":");if(e.meshes.has(s))return e.meshes.get(s);const o=t.geometry;let a;t.isLineSegments?a=Jt.LINES:t.isLineLoop?a=Jt.LINE_LOOP:t.isLine?a=Jt.LINE_STRIP:t.isPoints?a=Jt.POINTS:a=t.material.wireframe?Jt.LINES:Jt.TRIANGLES;const c={},l={},h=[],u=[],d={...U0>=152?{uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3"}:{uv:"TEXCOORD_0",uv2:"TEXCOORD_1"},color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},f=o.getAttribute("normal");f!==void 0&&!this.isNormalizedNormalAttribute(f)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),o.setAttribute("normal",this.createNormalizedNormalAttribute(f)));let m=null;for(let y in o.attributes){if(y.slice(0,5)==="morph")continue;const v=o.attributes[y];if(y=d[y]||y.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(y)||(y="_"+y),e.attributes.has(this.getUID(v))){l[y]=e.attributes.get(this.getUID(v));continue}m=null;const S=v.array;y==="JOINTS_0"&&!(S instanceof Uint16Array)&&!(S instanceof Uint8Array)&&(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),m=new Pe(new Uint16Array(S),v.itemSize,v.normalized));const T=this.processAccessor(m||v,o);T!==null&&(y.startsWith("_")||this.detectMeshQuantization(y,v),l[y]=T,e.attributes.set(this.getUID(v),T))}if(f!==void 0&&o.setAttribute("normal",f),Object.keys(l).length===0)return null;if(t.morphTargetInfluences!==void 0&&t.morphTargetInfluences.length>0){const y=[],v=[],x={};if(t.morphTargetDictionary!==void 0)for(const S in t.morphTargetDictionary)x[t.morphTargetDictionary[S]]=S;for(let S=0;S<t.morphTargetInfluences.length;++S){const T={};let E=!1;for(const w in o.morphAttributes){if(w!=="position"&&w!=="normal"){E||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),E=!0);continue}const M=o.morphAttributes[w][S],P=w.toUpperCase(),L=o.attributes[w];if(e.attributes.has(this.getUID(M,!0))){T[P]=e.attributes.get(this.getUID(M,!0));continue}const I=M.clone();if(!o.morphTargetsRelative)for(let F=0,z=M.count;F<z;F++)for(let N=0;N<M.itemSize;N++)N===0&&I.setX(F,M.getX(F)-L.getX(F)),N===1&&I.setY(F,M.getY(F)-L.getY(F)),N===2&&I.setZ(F,M.getZ(F)-L.getZ(F)),N===3&&I.setW(F,M.getW(F)-L.getW(F));T[P]=this.processAccessor(I,o),e.attributes.set(this.getUID(L,!0),T[P])}u.push(T),y.push(t.morphTargetInfluences[S]),t.morphTargetDictionary!==void 0&&v.push(x[S])}c.weights=y,v.length>0&&(c.extras={},c.extras.targetNames=v)}const _=Array.isArray(t.material);if(_&&o.groups.length===0)return null;const g=_?t.material:[t.material],p=_?o.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let y=0,v=p.length;y<v;y++){const x={mode:a,attributes:l};if(this.serializeUserData(o,x),u.length>0&&(x.targets=u),o.index!==null){let T=this.getUID(o.index);(p[y].start!==void 0||p[y].count!==void 0)&&(T+=":"+p[y].start+":"+p[y].count),e.attributes.has(T)?x.indices=e.attributes.get(T):(x.indices=this.processAccessor(o.index,o,p[y].start,p[y].count),e.attributes.set(T,x.indices)),x.indices===null&&delete x.indices}const S=this.processMaterial(g[p[y].materialIndex]);S!==null&&(x.material=S),h.push(x)}c.primitives=h,n.meshes||(n.meshes=[]),this._invokeAll(function(y){y.writeMesh&&y.writeMesh(t,c)});const b=n.meshes.push(c)-1;return e.meshes.set(s,b),b}detectMeshQuantization(t,e){if(this.extensionsUsed[Up])return;let n;switch(e.array.constructor){case Int8Array:n="byte";break;case Uint8Array:n="unsigned byte";break;case Int16Array:n="short";break;case Uint16Array:n="unsigned short";break;default:return}e.normalized&&(n+=" normalized");const i=t.split("_",1)[0];Sv[i]&&Sv[i].includes(n)&&(this.extensionsUsed[Up]=!0,this.extensionsRequired[Up]=!0)}processCamera(t){const e=this.json;e.cameras||(e.cameras=[]);const n=t.isOrthographicCamera,i={type:n?"orthographic":"perspective"};return n?i.orthographic={xmag:t.right*2,ymag:t.top*2,zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near}:i.perspective={aspectRatio:t.aspect,yfov:Le.degToRad(t.fov),zfar:t.far<=0?.001:t.far,znear:t.near<0?0:t.near},t.name!==""&&(i.name=t.type),e.cameras.push(i)-1}processAnimation(t,e){const n=this.json,i=this.nodeMap;n.animations||(n.animations=[]),t=BS.Utils.mergeMorphTargetTracks(t.clone(),e);const s=t.tracks,o=[],a=[];for(let c=0;c<s.length;++c){const l=s[c],h=$t.parseTrackName(l.name);let u=$t.findNode(e,h.nodeName);const d=Mv[h.propertyName];if(h.objectName==="bones"&&(u.isSkinnedMesh===!0?u=u.skeleton.getBoneByName(h.objectIndex):u=void 0),!u||!d)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',l.name),null;const f=1;let m=l.values.length/l.times.length;d===Mv.morphTargetInfluences&&(m/=u.morphTargetInfluences.length);let _;l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(_="CUBICSPLINE",m/=3):l.getInterpolation()===_c?_="STEP":_="LINEAR",a.push({input:this.processAccessor(new Pe(l.times,f)),output:this.processAccessor(new Pe(l.values,m)),interpolation:_}),o.push({sampler:a.length-1,target:{node:i.get(u),path:d}})}return n.animations.push({name:t.name||"clip_"+n.animations.length,samplers:a,channels:o}),n.animations.length-1}processSkin(t){const e=this.json,n=this.nodeMap,i=e.nodes[n.get(t)],s=t.skeleton;if(s===void 0)return null;const o=t.skeleton.bones[0];if(o===void 0)return null;const a=[],c=new Float32Array(s.bones.length*16),l=new lt;for(let u=0;u<s.bones.length;++u)a.push(n.get(s.bones[u])),l.copy(s.boneInverses[u]),l.multiply(t.bindMatrix).toArray(c,u*16);return e.skins===void 0&&(e.skins=[]),e.skins.push({inverseBindMatrices:this.processAccessor(new Pe(c,16)),joints:a,skeleton:n.get(o)}),i.skin=e.skins.length-1}processNode(t){const e=this.json,n=this.options,i=this.nodeMap;e.nodes||(e.nodes=[]);const s={};if(n.trs){const a=t.quaternion.toArray(),c=t.position.toArray(),l=t.scale.toArray();xl(a,[0,0,0,1])||(s.rotation=a),xl(c,[0,0,0])||(s.translation=c),xl(l,[1,1,1])||(s.scale=l)}else t.matrixAutoUpdate&&t.updateMatrix(),VF(t.matrix)===!1&&(s.matrix=t.matrix.elements);if(t.name!==""&&(s.name=String(t.name)),this.serializeUserData(t,s),t.isMesh||t.isLine||t.isPoints){const a=this.processMesh(t);a!==null&&(s.mesh=a)}else t.isCamera&&(s.camera=this.processCamera(t));if(t.isSkinnedMesh&&this.skins.push(t),t.children.length>0){const a=[];for(let c=0,l=t.children.length;c<l;c++){const h=t.children[c];if(h.visible||n.onlyVisible===!1){const u=this.processNode(h);u!==null&&a.push(u)}}a.length>0&&(s.children=a)}this._invokeAll(function(a){a.writeNode&&a.writeNode(t,s)});const o=e.nodes.push(s)-1;return i.set(t,o),o}processScene(t){const e=this.json,n=this.options;e.scenes||(e.scenes=[],e.scene=0);const i={};t.name!==""&&(i.name=t.name),e.scenes.push(i);const s=[];for(let o=0,a=t.children.length;o<a;o++){const c=t.children[o];if(c.visible||n.onlyVisible===!1){const l=this.processNode(c);l!==null&&s.push(l)}}s.length>0&&(i.nodes=s),this.serializeUserData(t,i)}processObjects(t){const e=new xc;e.name="AuxScene";for(let n=0;n<t.length;n++)e.children.push(t[n]);this.processScene(e)}processInput(t){const e=this.options;t=t instanceof Array?t:[t],this._invokeAll(function(i){i.beforeParse&&i.beforeParse(t)});const n=[];for(let i=0;i<t.length;i++)t[i]instanceof xc?this.processScene(t[i]):n.push(t[i]);n.length>0&&this.processObjects(n);for(let i=0;i<this.skins.length;++i)this.processSkin(this.skins[i]);for(let i=0;i<e.animations.length;++i)this.processAnimation(e.animations[i],t[0]);this._invokeAll(function(i){i.afterParse&&i.afterParse(t)})}_invokeAll(t){for(let e=0,n=this.plugins.length;e<n;e++)t(this.plugins[e])}}class jF{constructor(t){this.writer=t,this.name="KHR_lights_punctual"}writeNode(t,e){if(!t.isLight)return;if(!t.isDirectionalLight&&!t.isPointLight&&!t.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",t);return}const n=this.writer,i=n.json,s=n.extensionsUsed,o={};t.name&&(o.name=t.name),o.color=t.color.toArray(),o.intensity=t.intensity,t.isDirectionalLight?o.type="directional":t.isPointLight?(o.type="point",t.distance>0&&(o.range=t.distance)):t.isSpotLight&&(o.type="spot",t.distance>0&&(o.range=t.distance),o.spot={},o.spot.innerConeAngle=(t.penumbra-1)*t.angle*-1,o.spot.outerConeAngle=t.angle),t.decay!==void 0&&t.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),t.target&&(t.target.parent!==t||t.target.position.x!==0||t.target.position.y!==0||t.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),s[this.name]||(i.extensions=i.extensions||{},i.extensions[this.name]={lights:[]},s[this.name]=!0);const a=i.extensions[this.name].lights;a.push(o),e.extensions=e.extensions||{},e.extensions[this.name]={light:a.length-1}}}let WF=class{constructor(t){this.writer=t,this.name="KHR_materials_unlit"}writeMaterial(t,e){if(!t.isMeshBasicMaterial)return;const i=this.writer.extensionsUsed;e.extensions=e.extensions||{},e.extensions[this.name]={},i[this.name]=!0,e.pbrMetallicRoughness.metallicFactor=0,e.pbrMetallicRoughness.roughnessFactor=.9}},XF=class{constructor(t){this.writer=t,this.name="KHR_materials_clearcoat"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.clearcoat===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.clearcoatFactor=t.clearcoat,t.clearcoatMap){const o={index:n.processTexture(t.clearcoatMap),texCoord:t.clearcoatMap.channel};n.applyTextureTransform(o,t.clearcoatMap),s.clearcoatTexture=o}if(s.clearcoatRoughnessFactor=t.clearcoatRoughness,t.clearcoatRoughnessMap){const o={index:n.processTexture(t.clearcoatRoughnessMap),texCoord:t.clearcoatRoughnessMap.channel};n.applyTextureTransform(o,t.clearcoatRoughnessMap),s.clearcoatRoughnessTexture=o}if(t.clearcoatNormalMap){const o={index:n.processTexture(t.clearcoatNormalMap),texCoord:t.clearcoatNormalMap.channel};n.applyTextureTransform(o,t.clearcoatNormalMap),s.clearcoatNormalTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}},YF=class{constructor(t){this.writer=t,this.name="KHR_materials_iridescence"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.iridescence===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.iridescenceFactor=t.iridescence,t.iridescenceMap){const o={index:n.processTexture(t.iridescenceMap),texCoord:t.iridescenceMap.channel};n.applyTextureTransform(o,t.iridescenceMap),s.iridescenceTexture=o}if(s.iridescenceIor=t.iridescenceIOR,s.iridescenceThicknessMinimum=t.iridescenceThicknessRange[0],s.iridescenceThicknessMaximum=t.iridescenceThicknessRange[1],t.iridescenceThicknessMap){const o={index:n.processTexture(t.iridescenceThicknessMap),texCoord:t.iridescenceThicknessMap.channel};n.applyTextureTransform(o,t.iridescenceThicknessMap),s.iridescenceThicknessTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}},qF=class{constructor(t){this.writer=t,this.name="KHR_materials_transmission"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.transmissionFactor=t.transmission,t.transmissionMap){const o={index:n.processTexture(t.transmissionMap),texCoord:t.transmissionMap.channel};n.applyTextureTransform(o,t.transmissionMap),s.transmissionTexture=o}e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}},KF=class{constructor(t){this.writer=t,this.name="KHR_materials_volume"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.transmission===0)return;const n=this.writer,i=n.extensionsUsed,s={};if(s.thicknessFactor=t.thickness,t.thicknessMap){const o={index:n.processTexture(t.thicknessMap),texCoord:t.thicknessMap.channel};n.applyTextureTransform(o,t.thicknessMap),s.thicknessTexture=o}s.attenuationDistance=t.attenuationDistance,s.attenuationColor=t.attenuationColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}},ZF=class{constructor(t){this.writer=t,this.name="KHR_materials_ior"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.ior===1.5)return;const i=this.writer.extensionsUsed,s={};s.ior=t.ior,e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}},QF=class{constructor(t){this.writer=t,this.name="KHR_materials_specular"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.specularIntensity===1&&t.specularColor.equals(FF)&&!t.specularIntensityMap&&!t.specularColorTexture)return;const n=this.writer,i=n.extensionsUsed,s={};if(t.specularIntensityMap){const o={index:n.processTexture(t.specularIntensityMap),texCoord:t.specularIntensityMap.channel};n.applyTextureTransform(o,t.specularIntensityMap),s.specularTexture=o}if(t.specularColorMap){const o={index:n.processTexture(t.specularColorMap),texCoord:t.specularColorMap.channel};n.applyTextureTransform(o,t.specularColorMap),s.specularColorTexture=o}s.specularFactor=t.specularIntensity,s.specularColorFactor=t.specularColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}},$F=class{constructor(t){this.writer=t,this.name="KHR_materials_sheen"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.sheen==0)return;const n=this.writer,i=n.extensionsUsed,s={};if(t.sheenRoughnessMap){const o={index:n.processTexture(t.sheenRoughnessMap),texCoord:t.sheenRoughnessMap.channel};n.applyTextureTransform(o,t.sheenRoughnessMap),s.sheenRoughnessTexture=o}if(t.sheenColorMap){const o={index:n.processTexture(t.sheenColorMap),texCoord:t.sheenColorMap.channel};n.applyTextureTransform(o,t.sheenColorMap),s.sheenColorTexture=o}s.sheenRoughnessFactor=t.sheenRoughness,s.sheenColorFactor=t.sheenColor.toArray(),e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}},JF=class{constructor(t){this.writer=t,this.name="KHR_materials_anisotropy"}writeMaterial(t,e){if(!t.isMeshPhysicalMaterial||t.anisotropy==0)return;const n=this.writer,i=n.extensionsUsed,s={};if(t.anisotropyMap){const o={index:n.processTexture(t.anisotropyMap)};n.applyTextureTransform(o,t.anisotropyMap),s.anisotropyTexture=o}s.anisotropyStrength=t.anisotropy,s.anisotropyRotation=t.anisotropyRotation,e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}},tk=class{constructor(t){this.writer=t,this.name="KHR_materials_emissive_strength"}writeMaterial(t,e){if(!t.isMeshStandardMaterial||t.emissiveIntensity===1)return;const i=this.writer.extensionsUsed,s={};s.emissiveStrength=t.emissiveIntensity,e.extensions=e.extensions||{},e.extensions[this.name]=s,i[this.name]=!0}};var Di=Uint8Array,Nr=Uint16Array,bg=Uint32Array,VS=new Di([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),HS=new Di([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ek=new Di([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),GS=function(r,t){for(var e=new Nr(31),n=0;n<31;++n)e[n]=t+=1<<r[n-1];for(var i=new bg(e[30]),n=1;n<30;++n)for(var s=e[n];s<e[n+1];++s)i[s]=s-e[n]<<5|n;return[e,i]},jS=GS(VS,2),WS=jS[0],nk=jS[1];WS[28]=258,nk[258]=28;var ik=GS(HS,0),sk=ik[0],yg=new Nr(32768);for(var Ce=0;Ce<32768;++Ce){var Er=(Ce&43690)>>>1|(Ce&21845)<<1;Er=(Er&52428)>>>2|(Er&13107)<<2,Er=(Er&61680)>>>4|(Er&3855)<<4,yg[Ce]=((Er&65280)>>>8|(Er&255)<<8)>>>1}var kl=function(r,t,e){for(var n=r.length,i=0,s=new Nr(t);i<n;++i)++s[r[i]-1];var o=new Nr(t);for(i=0;i<t;++i)o[i]=o[i-1]+s[i-1]<<1;var a;if(e){a=new Nr(1<<t);var c=15-t;for(i=0;i<n;++i)if(r[i])for(var l=i<<4|r[i],h=t-r[i],u=o[r[i]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)a[yg[u]>>>c]=l}else for(a=new Nr(n),i=0;i<n;++i)r[i]&&(a[i]=yg[o[r[i]-1]++]>>>15-r[i]);return a},mh=new Di(288);for(var Ce=0;Ce<144;++Ce)mh[Ce]=8;for(var Ce=144;Ce<256;++Ce)mh[Ce]=9;for(var Ce=256;Ce<280;++Ce)mh[Ce]=7;for(var Ce=280;Ce<288;++Ce)mh[Ce]=8;var XS=new Di(32);for(var Ce=0;Ce<32;++Ce)XS[Ce]=5;var rk=kl(mh,9,1),ok=kl(XS,5,1),zp=function(r){for(var t=r[0],e=1;e<r.length;++e)r[e]>t&&(t=r[e]);return t},Yi=function(r,t,e){var n=t/8|0;return(r[n]|r[n+1]<<8)>>(t&7)&e},Vp=function(r,t){var e=t/8|0;return(r[e]|r[e+1]<<8|r[e+2]<<16)>>(t&7)},ak=function(r){return(r/8|0)+(r&7&&1)},ck=function(r,t,e){(e==null||e>r.length)&&(e=r.length);var n=new(r instanceof Nr?Nr:r instanceof bg?bg:Di)(e-t);return n.set(r.subarray(t,e)),n},lk=function(r,t,e){var n=r.length;if(!n||e&&!e.l&&n<5)return t||new Di(0);var i=!t||e,s=!e||e.i;e||(e={}),t||(t=new Di(n*3));var o=function(mt){var ht=t.length;if(mt>ht){var It=new Di(Math.max(ht*2,mt));It.set(t),t=It}},a=e.f||0,c=e.p||0,l=e.b||0,h=e.l,u=e.d,d=e.m,f=e.n,m=n*8;do{if(!h){e.f=a=Yi(r,c,1);var _=Yi(r,c+1,3);if(c+=3,_)if(_==1)h=rk,u=ok,d=9,f=5;else if(_==2){var y=Yi(r,c,31)+257,v=Yi(r,c+10,15)+4,x=y+Yi(r,c+5,31)+1;c+=14;for(var S=new Di(x),T=new Di(19),E=0;E<v;++E)T[ek[E]]=Yi(r,c+E*3,7);c+=v*3;for(var w=zp(T),M=(1<<w)-1,P=kl(T,w,1),E=0;E<x;){var L=P[Yi(r,c,M)];c+=L&15;var g=L>>>4;if(g<16)S[E++]=g;else{var I=0,F=0;for(g==16?(F=3+Yi(r,c,3),c+=2,I=S[E-1]):g==17?(F=3+Yi(r,c,7),c+=3):g==18&&(F=11+Yi(r,c,127),c+=7);F--;)S[E++]=I}}var z=S.subarray(0,y),N=S.subarray(y);d=zp(z),f=zp(N),h=kl(z,d,1),u=kl(N,f,1)}else throw"invalid block type";else{var g=ak(c)+4,p=r[g-4]|r[g-3]<<8,b=g+p;if(b>n){if(s)throw"unexpected EOF";break}i&&o(l+p),t.set(r.subarray(g,b),l),e.b=l+=p,e.p=c=b*8;continue}if(c>m){if(s)throw"unexpected EOF";break}}i&&o(l+131072);for(var Z=(1<<d)-1,j=(1<<f)-1,et=c;;et=c){var I=h[Vp(r,c)&Z],tt=I>>>4;if(c+=I&15,c>m){if(s)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(tt<256)t[l++]=tt;else if(tt==256){et=c,h=null;break}else{var at=tt-254;if(tt>264){var E=tt-257,dt=VS[E];at=Yi(r,c,(1<<dt)-1)+WS[E],c+=dt}var St=u[Vp(r,c)&j],O=St>>>4;if(!St)throw"invalid distance";c+=St&15;var N=sk[O];if(O>3){var dt=HS[O];N+=Vp(r,c)&(1<<dt)-1,c+=dt}if(c>m){if(s)throw"unexpected EOF";break}i&&o(l+131072);for(var it=l+at;l<it;l+=4)t[l]=t[l-N],t[l+1]=t[l+1-N],t[l+2]=t[l+2-N],t[l+3]=t[l+3-N];l=it}}e.l=h,e.p=et,e.b=l,h&&(a=1,e.m=d,e.d=u,e.n=f)}while(!a);return l==t.length?t:ck(t,0,l)},hk=new Di(0),uk=function(r){if((r[0]&15)!=8||r[0]>>>4>7||(r[0]<<8|r[1])%31)throw"invalid zlib data";if(r[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function dk(r,t){return lk((uk(r),r.subarray(2,-4)),t)}var fk=typeof TextDecoder<"u"&&new TextDecoder,pk=0;try{fk.decode(hk,{stream:!0}),pk=1}catch{}var mk=Object.defineProperty,gk=(r,t,e)=>t in r?mk(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Q=(r,t,e)=>(gk(r,typeof t!="symbol"?t+"":t,e),e);class _k extends Bt{constructor(t,e){super(),Q(this,"isTransformControls",!0),Q(this,"visible",!1),Q(this,"domElement"),Q(this,"raycaster",new to),Q(this,"gizmo"),Q(this,"plane"),Q(this,"tempVector",new C),Q(this,"tempVector2",new C),Q(this,"tempQuaternion",new jt),Q(this,"unit",{X:new C(1,0,0),Y:new C(0,1,0),Z:new C(0,0,1)}),Q(this,"pointStart",new C),Q(this,"pointEnd",new C),Q(this,"offset",new C),Q(this,"rotationAxis",new C),Q(this,"startNorm",new C),Q(this,"endNorm",new C),Q(this,"rotationAngle",0),Q(this,"cameraPosition",new C),Q(this,"cameraQuaternion",new jt),Q(this,"cameraScale",new C),Q(this,"parentPosition",new C),Q(this,"parentQuaternion",new jt),Q(this,"parentQuaternionInv",new jt),Q(this,"parentScale",new C),Q(this,"worldPositionStart",new C),Q(this,"worldQuaternionStart",new jt),Q(this,"worldScaleStart",new C),Q(this,"worldPosition",new C),Q(this,"worldQuaternion",new jt),Q(this,"worldQuaternionInv",new jt),Q(this,"worldScale",new C),Q(this,"eye",new C),Q(this,"positionStart",new C),Q(this,"quaternionStart",new jt),Q(this,"scaleStart",new C),Q(this,"camera"),Q(this,"object"),Q(this,"enabled",!0),Q(this,"axis",null),Q(this,"mode","translate"),Q(this,"translationSnap",null),Q(this,"rotationSnap",null),Q(this,"scaleSnap",null),Q(this,"space","world"),Q(this,"size",1),Q(this,"dragging",!1),Q(this,"showX",!0),Q(this,"showY",!0),Q(this,"showZ",!0),Q(this,"changeEvent",{type:"change"}),Q(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),Q(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),Q(this,"objectChangeEvent",{type:"objectChange"}),Q(this,"intersectObjectWithRay",(i,s,o)=>{const a=s.intersectObject(i,!0);for(let c=0;c<a.length;c++)if(a[c].object.visible||o)return a[c];return!1}),Q(this,"attach",i=>(this.object=i,this.visible=!0,this)),Q(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),Q(this,"reset",()=>this.enabled?(this.dragging&&this.object!==void 0&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this):this),Q(this,"updateMatrixWorld",()=>{this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),Q(this,"pointerHover",i=>{if(this.object===void 0||this.dragging===!0)return;this.raycaster.setFromCamera(i,this.camera);const s=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);s?this.axis=s.object.name:this.axis=null}),Q(this,"pointerDown",i=>{if(!(this.object===void 0||this.dragging===!0||i.button!==0)&&this.axis!==null){this.raycaster.setFromCamera(i,this.camera);const s=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(s){let o=this.space;if(this.mode==="scale"?o="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(o="world"),o==="local"&&this.mode==="rotate"){const a=this.rotationSnap;this.axis==="X"&&a&&(this.object.rotation.x=Math.round(this.object.rotation.x/a)*a),this.axis==="Y"&&a&&(this.object.rotation.y=Math.round(this.object.rotation.y/a)*a),this.axis==="Z"&&a&&(this.object.rotation.z=Math.round(this.object.rotation.z/a)*a)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(s.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),Q(this,"pointerMove",i=>{const s=this.axis,o=this.mode,a=this.object;let c=this.space;if(o==="scale"?c="local":(s==="E"||s==="XYZE"||s==="XYZ")&&(c="world"),a===void 0||s===null||this.dragging===!1||i.button!==-1)return;this.raycaster.setFromCamera(i,this.camera);const l=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(l){if(this.pointEnd.copy(l.point).sub(this.worldPositionStart),o==="translate")this.offset.copy(this.pointEnd).sub(this.pointStart),c==="local"&&s!=="XYZ"&&this.offset.applyQuaternion(this.worldQuaternionInv),s.indexOf("X")===-1&&(this.offset.x=0),s.indexOf("Y")===-1&&(this.offset.y=0),s.indexOf("Z")===-1&&(this.offset.z=0),c==="local"&&s!=="XYZ"?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),a.position.copy(this.offset).add(this.positionStart),this.translationSnap&&(c==="local"&&(a.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this.quaternionStart)),c==="world"&&(a.parent&&a.position.add(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld)),s.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),s.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),s.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(this.tempVector.setFromMatrixPosition(a.parent.matrixWorld))));else if(o==="scale"){if(s.search("XYZ")!==-1){let h=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(h*=-1),this.tempVector2.set(h,h,h)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),s.search("X")===-1&&(this.tempVector2.x=1),s.search("Y")===-1&&(this.tempVector2.y=1),s.search("Z")===-1&&(this.tempVector2.z=1);a.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(s.search("X")!==-1&&(this.object.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),s.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(o==="rotate"){this.offset.copy(this.pointEnd).sub(this.pointStart);const h=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));s==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.eye)<0?1:-1):s==="XYZE"?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*h):(s==="X"||s==="Y"||s==="Z")&&(this.rotationAxis.copy(this.unit[s]),this.tempVector.copy(this.unit[s]),c==="local"&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*h),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),c==="local"&&s!=="E"&&s!=="XYZE"?(a.quaternion.copy(this.quaternionStart),a.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),a.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),Q(this,"pointerUp",i=>{i.button===0&&(this.dragging&&this.axis!==null&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),Q(this,"getPointer",i=>{var s;if(this.domElement&&((s=this.domElement.ownerDocument)!=null&&s.pointerLockElement))return{x:0,y:0,button:i.button};{const o=i.changedTouches?i.changedTouches[0]:i,a=this.domElement.getBoundingClientRect();return{x:(o.clientX-a.left)/a.width*2-1,y:-(o.clientY-a.top)/a.height*2+1,button:i.button}}}),Q(this,"onPointerHover",i=>{if(this.enabled)switch(i.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(i));break}}),Q(this,"onPointerDown",i=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(i)),this.pointerDown(this.getPointer(i)))}),Q(this,"onPointerMove",i=>{this.enabled&&this.pointerMove(this.getPointer(i))}),Q(this,"onPointerUp",i=>{!this.enabled||!this.domElement||(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(i)))}),Q(this,"getMode",()=>this.mode),Q(this,"setMode",i=>{this.mode=i}),Q(this,"setTranslationSnap",i=>{this.translationSnap=i}),Q(this,"setRotationSnap",i=>{this.rotationSnap=i}),Q(this,"setScaleSnap",i=>{this.scaleSnap=i}),Q(this,"setSize",i=>{this.size=i}),Q(this,"setSpace",i=>{this.space=i}),Q(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),Q(this,"connect",i=>{i===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=i,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),Q(this,"dispose",()=>{var i,s,o,a,c,l;(i=this.domElement)==null||i.removeEventListener("pointerdown",this.onPointerDown),(s=this.domElement)==null||s.removeEventListener("pointermove",this.onPointerHover),(a=(o=this.domElement)==null?void 0:o.ownerDocument)==null||a.removeEventListener("pointermove",this.onPointerMove),(l=(c=this.domElement)==null?void 0:c.ownerDocument)==null||l.removeEventListener("pointerup",this.onPointerUp),this.traverse(h=>{const u=h;u.geometry&&u.geometry.dispose(),u.material&&u.material.dispose()})}),this.domElement=e,this.camera=t,this.gizmo=new bk,this.add(this.gizmo),this.plane=new yk,this.add(this.plane);const n=(i,s)=>{let o=s;Object.defineProperty(this,i,{get:function(){return o!==void 0?o:s},set:function(a){o!==a&&(o=a,this.plane[i]=a,this.gizmo[i]=a,this.dispatchEvent({type:i+"-changed",value:a}),this.dispatchEvent(this.changeEvent))}}),this[i]=s,this.plane[i]=s,this.gizmo[i]=s};n("camera",this.camera),n("object",this.object),n("enabled",this.enabled),n("axis",this.axis),n("mode",this.mode),n("translationSnap",this.translationSnap),n("rotationSnap",this.rotationSnap),n("scaleSnap",this.scaleSnap),n("space",this.space),n("size",this.size),n("dragging",this.dragging),n("showX",this.showX),n("showY",this.showY),n("showZ",this.showZ),n("worldPosition",this.worldPosition),n("worldPositionStart",this.worldPositionStart),n("worldQuaternion",this.worldQuaternion),n("worldQuaternionStart",this.worldQuaternionStart),n("cameraPosition",this.cameraPosition),n("cameraQuaternion",this.cameraQuaternion),n("pointStart",this.pointStart),n("pointEnd",this.pointEnd),n("rotationAxis",this.rotationAxis),n("rotationAngle",this.rotationAngle),n("eye",this.eye),e!==void 0&&this.connect(e)}}class bk extends Bt{constructor(){super(),Q(this,"isTransformControlsGizmo",!0),Q(this,"type","TransformControlsGizmo"),Q(this,"tempVector",new C(0,0,0)),Q(this,"tempEuler",new Me),Q(this,"alignVector",new C(0,1,0)),Q(this,"zeroVector",new C(0,0,0)),Q(this,"lookAtMatrix",new lt),Q(this,"tempQuaternion",new jt),Q(this,"tempQuaternion2",new jt),Q(this,"identityQuaternion",new jt),Q(this,"unitX",new C(1,0,0)),Q(this,"unitY",new C(0,1,0)),Q(this,"unitZ",new C(0,0,1)),Q(this,"gizmo"),Q(this,"picker"),Q(this,"helper"),Q(this,"rotationAxis",new C),Q(this,"cameraPosition",new C),Q(this,"worldPositionStart",new C),Q(this,"worldQuaternionStart",new jt),Q(this,"worldPosition",new C),Q(this,"worldQuaternion",new jt),Q(this,"eye",new C),Q(this,"camera",null),Q(this,"enabled",!0),Q(this,"axis",null),Q(this,"mode","translate"),Q(this,"space","world"),Q(this,"size",1),Q(this,"dragging",!1),Q(this,"showX",!0),Q(this,"showY",!0),Q(this,"showZ",!0),Q(this,"updateMatrixWorld",()=>{let tt=this.space;this.mode==="scale"&&(tt="local");const at=tt==="local"?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let dt=[];dt=dt.concat(this.picker[this.mode].children),dt=dt.concat(this.gizmo[this.mode].children),dt=dt.concat(this.helper[this.mode].children);for(let St=0;St<dt.length;St++){const O=dt[St];O.visible=!0,O.rotation.set(0,0,0),O.position.copy(this.worldPosition);let it;if(this.camera.isOrthographicCamera?it=(this.camera.top-this.camera.bottom)/this.camera.zoom:it=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),O.scale.set(1,1,1).multiplyScalar(it*this.size/7),O.tag==="helper"){O.visible=!1,O.name==="AXIS"?(O.position.copy(this.worldPositionStart),O.visible=!!this.axis,this.axis==="X"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),O.quaternion.copy(at).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(at).dot(this.eye))>.9&&(O.visible=!1)),this.axis==="Y"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),O.quaternion.copy(at).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(at).dot(this.eye))>.9&&(O.visible=!1)),this.axis==="Z"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),O.quaternion.copy(at).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(at).dot(this.eye))>.9&&(O.visible=!1)),this.axis==="XYZE"&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),O.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),O.quaternion.multiply(this.tempQuaternion),O.visible=this.dragging),this.axis==="E"&&(O.visible=!1)):O.name==="START"?(O.position.copy(this.worldPositionStart),O.visible=this.dragging):O.name==="END"?(O.position.copy(this.worldPosition),O.visible=this.dragging):O.name==="DELTA"?(O.position.copy(this.worldPositionStart),O.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),O.scale.copy(this.tempVector),O.visible=this.dragging):(O.quaternion.copy(at),this.dragging?O.position.copy(this.worldPositionStart):O.position.copy(this.worldPosition),this.axis&&(O.visible=this.axis.search(O.name)!==-1));continue}O.quaternion.copy(at),this.mode==="translate"||this.mode==="scale"?((O.name==="X"||O.name==="XYZX")&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(at).dot(this.eye))>.99&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),(O.name==="Y"||O.name==="XYZY")&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(at).dot(this.eye))>.99&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),(O.name==="Z"||O.name==="XYZZ")&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(at).dot(this.eye))>.99&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),O.name==="XY"&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(at).dot(this.eye))<.2&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),O.name==="YZ"&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(at).dot(this.eye))<.2&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),O.name==="XZ"&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(at).dot(this.eye))<.2&&(O.scale.set(1e-10,1e-10,1e-10),O.visible=!1),O.name.search("X")!==-1&&(this.alignVector.copy(this.unitX).applyQuaternion(at).dot(this.eye)<0?O.tag==="fwd"?O.visible=!1:O.scale.x*=-1:O.tag==="bwd"&&(O.visible=!1)),O.name.search("Y")!==-1&&(this.alignVector.copy(this.unitY).applyQuaternion(at).dot(this.eye)<0?O.tag==="fwd"?O.visible=!1:O.scale.y*=-1:O.tag==="bwd"&&(O.visible=!1)),O.name.search("Z")!==-1&&(this.alignVector.copy(this.unitZ).applyQuaternion(at).dot(this.eye)<0?O.tag==="fwd"?O.visible=!1:O.scale.z*=-1:O.tag==="bwd"&&(O.visible=!1))):this.mode==="rotate"&&(this.tempQuaternion2.copy(at),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(at).invert()),O.name.search("E")!==-1&&O.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),O.name==="X"&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),O.quaternion.copy(this.tempQuaternion)),O.name==="Y"&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),O.quaternion.copy(this.tempQuaternion)),O.name==="Z"&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),O.quaternion.copy(this.tempQuaternion))),O.visible=O.visible&&(O.name.indexOf("X")===-1||this.showX),O.visible=O.visible&&(O.name.indexOf("Y")===-1||this.showY),O.visible=O.visible&&(O.name.indexOf("Z")===-1||this.showZ),O.visible=O.visible&&(O.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),O.material.tempOpacity=O.material.tempOpacity||O.material.opacity,O.material.tempColor=O.material.tempColor||O.material.color.clone(),O.material.color.copy(O.material.tempColor),O.material.opacity=O.material.tempOpacity,this.enabled?this.axis&&(O.name===this.axis?(O.material.opacity=1,O.material.color.lerp(new pt(1,1,1),.5)):this.axis.split("").some(function(mt){return O.name===mt})?(O.material.opacity=1,O.material.color.lerp(new pt(1,1,1),.5)):(O.material.opacity*=.25,O.material.color.lerp(new pt(1,1,1),.5))):(O.material.opacity*=.5,O.material.color.lerp(new pt(1,1,1),.5))}super.updateMatrixWorld()});const t=new en({depthTest:!1,depthWrite:!1,transparent:!0,side:Sn,fog:!1,toneMapped:!1}),e=new Ui({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),n=t.clone();n.opacity=.15;const i=t.clone();i.opacity=.33;const s=t.clone();s.color.set(16711680);const o=t.clone();o.color.set(65280);const a=t.clone();a.color.set(255);const c=t.clone();c.opacity=.25;const l=c.clone();l.color.set(16776960);const h=c.clone();h.color.set(65535);const u=c.clone();u.color.set(16711935),t.clone().color.set(16776960);const f=e.clone();f.color.set(16711680);const m=e.clone();m.color.set(65280);const _=e.clone();_.color.set(255);const g=e.clone();g.color.set(65535);const p=e.clone();p.color.set(16711935);const b=e.clone();b.color.set(16776960);const y=e.clone();y.color.set(7895160);const v=b.clone();v.opacity=.25;const x=new Ln(0,.05,.2,12,1,!1),S=new Fn(.125,.125,.125),T=new Qt;T.setAttribute("position",new Ot([0,0,0,1,0,0],3));const E=(tt,at)=>{const dt=new Qt,St=[];for(let O=0;O<=64*at;++O)St.push(0,Math.cos(O/32*Math.PI)*tt,Math.sin(O/32*Math.PI)*tt);return dt.setAttribute("position",new Ot(St,3)),dt},w=()=>{const tt=new Qt;return tt.setAttribute("position",new Ot([0,0,0,1,1,1],3)),tt},M={X:[[new ct(x,s),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new ct(x,s),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new Kt(T,f)]],Y:[[new ct(x,o),[0,1,0],null,null,"fwd"],[new ct(x,o),[0,1,0],[Math.PI,0,0],null,"bwd"],[new Kt(T,m),null,[0,0,Math.PI/2]]],Z:[[new ct(x,a),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new ct(x,a),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new Kt(T,_),null,[0,-Math.PI/2,0]]],XYZ:[[new ct(new ls(.1,0),c.clone()),[0,0,0],[0,0,0]]],XY:[[new ct(new Nn(.295,.295),l.clone()),[.15,.15,0]],[new Kt(T,b),[.18,.3,0],null,[.125,1,1]],[new Kt(T,b),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new ct(new Nn(.295,.295),h.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new Kt(T,g),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new Kt(T,g),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new ct(new Nn(.295,.295),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new Kt(T,p),[.18,0,.3],null,[.125,1,1]],[new Kt(T,p),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},P={X:[[new ct(new Ln(.2,0,1,4,1,!1),n),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new ct(new Ln(.2,0,1,4,1,!1),n),[0,.6,0]]],Z:[[new ct(new Ln(.2,0,1,4,1,!1),n),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new ct(new ls(.2,0),n)]],XY:[[new ct(new Nn(.4,.4),n),[.2,.2,0]]],YZ:[[new ct(new Nn(.4,.4),n),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new ct(new Nn(.4,.4),n),[.2,0,.2],[-Math.PI/2,0,0]]]},L={START:[[new ct(new ls(.01,2),i),null,null,null,"helper"]],END:[[new ct(new ls(.01,2),i),null,null,null,"helper"]],DELTA:[[new Kt(w(),i),null,null,null,"helper"]],X:[[new Kt(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Kt(T,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Kt(T,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I={X:[[new Kt(E(1,.5),f)],[new ct(new ls(.04,0),s),[0,0,.99],null,[1,3,1]]],Y:[[new Kt(E(1,.5),m),null,[0,0,-Math.PI/2]],[new ct(new ls(.04,0),o),[0,0,.99],null,[3,1,1]]],Z:[[new Kt(E(1,.5),_),null,[0,Math.PI/2,0]],[new ct(new ls(.04,0),a),[.99,0,0],null,[1,3,1]]],E:[[new Kt(E(1.25,1),v),null,[0,Math.PI/2,0]],[new ct(new Ln(.03,0,.15,4,1,!1),v),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new ct(new Ln(.03,0,.15,4,1,!1),v),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new ct(new Ln(.03,0,.15,4,1,!1),v),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new ct(new Ln(.03,0,.15,4,1,!1),v),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new Kt(E(1,1),y),null,[0,Math.PI/2,0]]]},F={AXIS:[[new Kt(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},z={X:[[new ct(new Wa(1,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new ct(new Wa(1,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new ct(new Wa(1,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new ct(new Wa(1.25,.1,2,24),n)]],XYZE:[[new ct(new dr(.7,10,8),n)]]},N={X:[[new ct(S,s),[.8,0,0],[0,0,-Math.PI/2]],[new Kt(T,f),null,null,[.8,1,1]]],Y:[[new ct(S,o),[0,.8,0]],[new Kt(T,m),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new ct(S,a),[0,0,.8],[Math.PI/2,0,0]],[new Kt(T,_),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new ct(S,l),[.85,.85,0],null,[2,2,.2]],[new Kt(T,b),[.855,.98,0],null,[.125,1,1]],[new Kt(T,b),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new ct(S,h),[0,.85,.85],null,[.2,2,2]],[new Kt(T,g),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new Kt(T,g),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new ct(S,u),[.85,0,.85],null,[2,.2,2]],[new Kt(T,p),[.855,0,.98],null,[.125,1,1]],[new Kt(T,p),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new ct(new Fn(.125,.125,.125),c.clone()),[1.1,0,0]]],XYZY:[[new ct(new Fn(.125,.125,.125),c.clone()),[0,1.1,0]]],XYZZ:[[new ct(new Fn(.125,.125,.125),c.clone()),[0,0,1.1]]]},Z={X:[[new ct(new Ln(.2,0,.8,4,1,!1),n),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new ct(new Ln(.2,0,.8,4,1,!1),n),[0,.5,0]]],Z:[[new ct(new Ln(.2,0,.8,4,1,!1),n),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new ct(S,n),[.85,.85,0],null,[3,3,.2]]],YZ:[[new ct(S,n),[0,.85,.85],null,[.2,3,3]]],XZ:[[new ct(S,n),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new ct(new Fn(.2,.2,.2),n),[1.1,0,0]]],XYZY:[[new ct(new Fn(.2,.2,.2),n),[0,1.1,0]]],XYZZ:[[new ct(new Fn(.2,.2,.2),n),[0,0,1.1]]]},j={X:[[new Kt(T,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Kt(T,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Kt(T,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},et=tt=>{const at=new Bt;for(let dt in tt)for(let St=tt[dt].length;St--;){const O=tt[dt][St][0].clone(),it=tt[dt][St][1],mt=tt[dt][St][2],ht=tt[dt][St][3],It=tt[dt][St][4];O.name=dt,O.tag=It,it&&O.position.set(it[0],it[1],it[2]),mt&&O.rotation.set(mt[0],mt[1],mt[2]),ht&&O.scale.set(ht[0],ht[1],ht[2]),O.updateMatrix();const kt=O.geometry.clone();kt.applyMatrix4(O.matrix),O.geometry=kt,O.renderOrder=1/0,O.position.set(0,0,0),O.rotation.set(0,0,0),O.scale.set(1,1,1),at.add(O)}return at};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=et(M)),this.add(this.gizmo.rotate=et(I)),this.add(this.gizmo.scale=et(N)),this.add(this.picker.translate=et(P)),this.add(this.picker.rotate=et(z)),this.add(this.picker.scale=et(Z)),this.add(this.helper.translate=et(L)),this.add(this.helper.rotate=et(F)),this.add(this.helper.scale=et(j)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class yk extends ct{constructor(){super(new Nn(1e5,1e5,2,2),new en({visible:!1,wireframe:!0,side:Sn,transparent:!0,opacity:.1,toneMapped:!1})),Q(this,"isTransformControlsPlane",!0),Q(this,"type","TransformControlsPlane"),Q(this,"unitX",new C(1,0,0)),Q(this,"unitY",new C(0,1,0)),Q(this,"unitZ",new C(0,0,1)),Q(this,"tempVector",new C),Q(this,"dirVector",new C),Q(this,"alignVector",new C),Q(this,"tempMatrix",new lt),Q(this,"identityQuaternion",new jt),Q(this,"cameraQuaternion",new jt),Q(this,"worldPosition",new C),Q(this,"worldQuaternion",new jt),Q(this,"eye",new C),Q(this,"axis",null),Q(this,"mode","translate"),Q(this,"space","world"),Q(this,"updateMatrixWorld",()=>{let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),this.unitX.set(1,0,0).applyQuaternion(t==="local"?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion(t==="local"?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion(t==="local"?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0);break}break;case"rotate":default:this.dirVector.set(0,0,0)}this.dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}function Sc(r){if(typeof TextDecoder<"u")return new TextDecoder().decode(r);let t="";for(let e=0,n=r.length;e<n;e++)t+=String.fromCharCode(r[e]);try{return decodeURIComponent(escape(t))}catch{return t}}const Ro="srgb",sr="srgb-linear",Pv=3001,vk=3e3;class xk extends Ps{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Ek(e)}),this.register(function(e){return new Ak(e)}),this.register(function(e){return new kk(e)}),this.register(function(e){return new Nk(e)}),this.register(function(e){return new Uk(e)}),this.register(function(e){return new Pk(e)}),this.register(function(e){return new Rk(e)}),this.register(function(e){return new Dk(e)}),this.register(function(e){return new Lk(e)}),this.register(function(e){return new Tk(e)}),this.register(function(e){return new Ik(e)}),this.register(function(e){return new Ck(e)}),this.register(function(e){return new Fk(e)}),this.register(function(e){return new Ok(e)}),this.register(function(e){return new Sk(e)}),this.register(function(e){return new Bk(e)}),this.register(function(e){return new zk(e)})}load(t,e,n,i){const s=this;let o;if(this.resourcePath!=="")o=this.resourcePath;else if(this.path!==""){const l=Io.extractUrlBase(t);o=Io.resolveURL(l,this.path)}else o=Io.extractUrlBase(t);this.manager.itemStart(t);const a=function(l){i?i(l):console.error(l),s.manager.itemError(t),s.manager.itemEnd(t)},c=new Fc(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,function(l){try{s.parse(l,o,function(h){e(h),s.manager.itemEnd(t)},a)}catch(h){a(h)}},n,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let s;const o={},a={};if(typeof t=="string")s=JSON.parse(t);else if(t instanceof ArrayBuffer)if(Sc(new Uint8Array(t.slice(0,4)))===YS){try{o[ee.KHR_BINARY_GLTF]=new Vk(t)}catch(h){i&&i(h);return}s=JSON.parse(o[ee.KHR_BINARY_GLTF].content)}else s=JSON.parse(Sc(new Uint8Array(t)));else s=t;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new t3(s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const h=this.pluginCallbacks[l](c);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[h.name]=h,o[h.name]=!0}if(s.extensionsUsed)for(let l=0;l<s.extensionsUsed.length;++l){const h=s.extensionsUsed[l],u=s.extensionsRequired||[];switch(h){case ee.KHR_MATERIALS_UNLIT:o[h]=new Mk;break;case ee.KHR_DRACO_MESH_COMPRESSION:o[h]=new Hk(s,this.dracoLoader);break;case ee.KHR_TEXTURE_TRANSFORM:o[h]=new Gk;break;case ee.KHR_MESH_QUANTIZATION:o[h]=new jk;break;default:u.indexOf(h)>=0&&a[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}c.setExtensions(o),c.setPlugins(a),c.parse(n,i)}parseAsync(t,e){const n=this;return new Promise(function(i,s){n.parse(t,e,i,s)})}}function wk(){let r={};return{get:function(t){return r[t]},add:function(t,e){r[t]=e},remove:function(t){delete r[t]},removeAll:function(){r={}}}}const ee={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Sk{constructor(t){this.parser=t,this.name=ee.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const s=e[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const s=e.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let l;const h=new pt(16777215);c.color!==void 0&&h.setRGB(c.color[0],c.color[1],c.color[2],sr);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new h0(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new yd(h),l.distance=u;break;case"spot":l=new l0(h),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,Hs(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=e.createUniqueName(c.name||"light_"+t),i=Promise.resolve(l),e.cache.add(n,i),i}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,n=this.parser,s=n.json.nodes[t],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(e.cache,a,c)})}}class Mk{constructor(){this.name=ee.KHR_MATERIALS_UNLIT}getMaterialType(){return en}extendParams(t,e,n){const i=[];t.color=new pt(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const o=s.baseColorFactor;t.color.setRGB(o[0],o[1],o[2],sr),t.opacity=o[3]}s.baseColorTexture!==void 0&&i.push(n.assignTexture(t,"map",s.baseColorTexture,Ro))}return Promise.all(i)}}class Tk{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(e.emissiveIntensity=s),Promise.resolve()}}class Ek{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(o.clearcoatFactor!==void 0&&(e.clearcoat=o.clearcoatFactor),o.clearcoatTexture!==void 0&&s.push(n.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),o.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),o.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),o.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),o.clearcoatNormalTexture.scale!==void 0)){const a=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new J(a,a)}return Promise.all(s)}}class Ak{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_DISPERSION}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Ck{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.iridescenceFactor!==void 0&&(e.iridescence=o.iridescenceFactor),o.iridescenceTexture!==void 0&&s.push(n.assignTexture(e,"iridescenceMap",o.iridescenceTexture)),o.iridescenceIor!==void 0&&(e.iridescenceIOR=o.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),o.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=o.iridescenceThicknessMinimum),o.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=o.iridescenceThicknessMaximum),o.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(e,"iridescenceThicknessMap",o.iridescenceThicknessTexture)),Promise.all(s)}}class Pk{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_SHEEN}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new pt(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=i.extensions[this.name];if(o.sheenColorFactor!==void 0){const a=o.sheenColorFactor;e.sheenColor.setRGB(a[0],a[1],a[2],sr)}return o.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=o.sheenRoughnessFactor),o.sheenColorTexture!==void 0&&s.push(n.assignTexture(e,"sheenColorMap",o.sheenColorTexture,Ro)),o.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class Rk{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.transmissionFactor!==void 0&&(e.transmission=o.transmissionFactor),o.transmissionTexture!==void 0&&s.push(n.assignTexture(e,"transmissionMap",o.transmissionTexture)),Promise.all(s)}}class Dk{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_VOLUME}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];e.thickness=o.thicknessFactor!==void 0?o.thicknessFactor:0,o.thicknessTexture!==void 0&&s.push(n.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new pt().setRGB(a[0],a[1],a[2],sr),Promise.all(s)}}class Lk{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_IOR}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return e.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Ik{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_SPECULAR}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];e.specularIntensity=o.specularFactor!==void 0?o.specularFactor:1,o.specularTexture!==void 0&&s.push(n.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new pt().setRGB(a[0],a[1],a[2],sr),o.specularColorTexture!==void 0&&s.push(n.assignTexture(e,"specularColorMap",o.specularColorTexture,Ro)),Promise.all(s)}}class Ok{constructor(t){this.parser=t,this.name=ee.EXT_MATERIALS_BUMP}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return e.bumpScale=o.bumpFactor!==void 0?o.bumpFactor:1,o.bumpTexture!==void 0&&s.push(n.assignTexture(e,"bumpMap",o.bumpTexture)),Promise.all(s)}}class Fk{constructor(t){this.parser=t,this.name=ee.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:As}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];return o.anisotropyStrength!==void 0&&(e.anisotropy=o.anisotropyStrength),o.anisotropyRotation!==void 0&&(e.anisotropyRotation=o.anisotropyRotation),o.anisotropyTexture!==void 0&&s.push(n.assignTexture(e,"anisotropyMap",o.anisotropyTexture)),Promise.all(s)}}class kk{constructor(t){this.parser=t,this.name=ee.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],o=e.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s.source,o)}}class Nk{constructor(t){this.parser=t,this.name=ee.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,s=i.textures[t];if(!s.extensions||!s.extensions[e])return null;const o=s.extensions[e],a=i.images[o.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(t,o.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class Uk{constructor(t){this.parser=t,this.name=ee.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,s=i.textures[t];if(!s.extensions||!s.extensions[e])return null;const o=s.extensions[e],a=i.images[o.source];let c=n.textureLoader;if(a.uri){const l=n.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return n.loadTextureImage(t,o.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(t)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(e.height===1)}})),this.isSupported}}class Bk{constructor(t){this.name=ee.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),o=this.parser.options.meshoptDecoder;if(!o||!o.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const c=i.byteOffset||0,l=i.byteLength||0,h=i.count,u=i.byteStride,d=new Uint8Array(a,c,l);return o.decodeGltfBufferAsync?o.decodeGltfBufferAsync(h,u,d,i.mode,i.filter).then(function(f){return f.buffer}):o.ready.then(function(){const f=new ArrayBuffer(h*u);return o.decodeGltfBuffer(new Uint8Array(f),h,u,d,i.mode,i.filter),f})})}else return null}}class zk{constructor(t){this.name=ee.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,n=e.nodes[t];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=e.meshes[n.mesh];for(const l of i.primitives)if(l.mode!==Ci.TRIANGLES&&l.mode!==Ci.TRIANGLE_STRIP&&l.mode!==Ci.TRIANGLE_FAN&&l.mode!==void 0)return null;const o=n.extensions[this.name].attributes,a=[],c={};for(const l in o)a.push(this.parser.getDependency("accessor",o[l]).then(h=>(c[l]=h,c[l])));return a.length<1?null:(a.push(this.parser.createNodeMesh(t)),Promise.all(a).then(l=>{const h=l.pop(),u=h.isGroup?h.children:[h],d=l[0].count,f=[];for(const m of u){const _=new lt,g=new C,p=new jt,b=new C(1,1,1),y=new QR(m.geometry,m.material,d);for(let v=0;v<d;v++)c.TRANSLATION&&g.fromBufferAttribute(c.TRANSLATION,v),c.ROTATION&&p.fromBufferAttribute(c.ROTATION,v),c.SCALE&&b.fromBufferAttribute(c.SCALE,v),y.setMatrixAt(v,_.compose(g,p,b));for(const v in c)if(v==="_COLOR_0"){const x=c[v];y.instanceColor=new jm(x.array,x.itemSize,x.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&m.geometry.setAttribute(v,c[v]);Bt.prototype.copy.call(y,m),this.parser.assignFinalMaterial(y),f.push(y)}return h.isGroup?(h.clear(),h.add(...f),h):f[0]}))}}const YS="glTF",dl=12,Rv={JSON:1313821514,BIN:5130562};class Vk{constructor(t){this.name=ee.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,dl);if(this.header={magic:Sc(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==YS)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-dl,i=new DataView(t,dl);let s=0;for(;s<n;){const o=i.getUint32(s,!0);s+=4;const a=i.getUint32(s,!0);if(s+=4,a===Rv.JSON){const c=new Uint8Array(t,dl+s,o);this.content=Sc(c)}else if(a===Rv.BIN){const c=dl+s;this.body=t.slice(c,c+o)}s+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Hk{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ee.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,s=t.extensions[this.name].bufferView,o=t.extensions[this.name].attributes,a={},c={},l={};for(const h in o){const u=vg[h]||h.toLowerCase();a[u]=o[h]}for(const h in t.attributes){const u=vg[h]||h.toLowerCase();if(o[h]!==void 0){const d=n.accessors[t.attributes[h]],f=oc[d.componentType];l[u]=f.name,c[u]=d.normalized===!0}}return e.getDependency("bufferView",s).then(function(h){return new Promise(function(u,d){i.decodeDracoFile(h,function(f){for(const m in f.attributes){const _=f.attributes[m],g=c[m];g!==void 0&&(_.normalized=g)}u(f)},a,l,sr,d)})})}}class Gk{constructor(){this.name=ee.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class jk{constructor(){this.name=ee.KHR_MESH_QUANTIZATION}}class qS extends hh{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=t*i*3+i;for(let o=0;o!==i;o++)e[o]=n[s+o];return e}interpolate_(t,e,n,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,h=i-e,u=(n-e)/h,d=u*u,f=d*u,m=t*l,_=m-l,g=-2*f+3*d,p=f-d,b=1-g,y=p-d+u;for(let v=0;v!==a;v++){const x=o[_+v+a],S=o[_+v+c]*h,T=o[m+v+a],E=o[m+v]*h;s[v]=b*x+y*S+g*T+p*E}return s}}const Wk=new jt;class Xk extends qS{interpolate_(t,e,n,i){const s=super.interpolate_(t,e,n,i);return Wk.fromArray(s).normalize().toArray(s),s}}const Ci={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},oc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Dv={9728:gn,9729:dn,9984:Vg,9985:Ml,9986:za,9987:Ji},Lv={33071:di,33648:zl,10497:xs},Hp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vg={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...U0>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ar={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Yk={CUBICSPLINE:void 0,LINEAR:bc,STEP:_c},Gp={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function qk(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new lh({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Bi})),r.DefaultMaterial}function bo(r,t,e){for(const n in e.extensions)r[n]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=e.extensions[n])}function Hs(r,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(r.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Kk(r,t,e){let n=!1,i=!1,s=!1;for(let l=0,h=t.length;l<h;l++){const u=t[l];if(u.POSITION!==void 0&&(n=!0),u.NORMAL!==void 0&&(i=!0),u.COLOR_0!==void 0&&(s=!0),n&&i&&s)break}if(!n&&!i&&!s)return Promise.resolve(r);const o=[],a=[],c=[];for(let l=0,h=t.length;l<h;l++){const u=t[l];if(n){const d=u.POSITION!==void 0?e.getDependency("accessor",u.POSITION):r.attributes.position;o.push(d)}if(i){const d=u.NORMAL!==void 0?e.getDependency("accessor",u.NORMAL):r.attributes.normal;a.push(d)}if(s){const d=u.COLOR_0!==void 0?e.getDependency("accessor",u.COLOR_0):r.attributes.color;c.push(d)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],d=l[2];return n&&(r.morphAttributes.position=h),i&&(r.morphAttributes.normal=u),s&&(r.morphAttributes.color=d),r.morphTargetsRelative=!0,r})}function Zk(r,t){if(r.updateMorphTargets(),t.weights!==void 0)for(let e=0,n=t.weights.length;e<n;e++)r.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(r.morphTargetInfluences.length===e.length){r.morphTargetDictionary={};for(let n=0,i=e.length;n<i;n++)r.morphTargetDictionary[e[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Qk(r){let t;const e=r.extensions&&r.extensions[ee.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+jp(e.attributes):t=r.indices+":"+jp(r.attributes)+":"+r.mode,r.targets!==void 0)for(let n=0,i=r.targets.length;n<i;n++)t+=":"+jp(r.targets[n]);return t}function jp(r){let t="";const e=Object.keys(r).sort();for(let n=0,i=e.length;n<i;n++)t+=e[n]+":"+r[e[n]]+";";return t}function xg(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function $k(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Jk=new lt;class t3{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new wk,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&s<98?this.textureLoader=new Zd(this.options.manager):this.textureLoader=new DD(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Fc(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(o){return o._markDefs&&o._markDefs()}),Promise.all(this._invokeAll(function(o){return o.beforeRoot&&o.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(o){const a={scene:o[0][i.scene||0],scenes:o[0],animations:o[1],cameras:o[2],asset:i.asset,parser:n,userData:{}};return bo(s,a,i),Hs(a,i),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();t(a)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let i=0,s=e.length;i<s;i++){const o=e[i].joints;for(let a=0,c=o.length;a<c;a++)t[o[a]].isBone=!0}for(let i=0,s=t.length;i<s;i++){const o=t[i];o.mesh!==void 0&&(this._addNodeRef(this.meshCache,o.mesh),o.skin!==void 0&&(n[o.mesh].isSkinnedMesh=!0)),o.camera!==void 0&&this._addNodeRef(this.cameraCache,o.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone(),s=(o,a)=>{const c=this.associations.get(o);c!=null&&this.associations.set(a,c);for(const[l,h]of o.children.entries())s(h,a.children[l])};return s(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const s=t(e[i]);s&&n.push(s)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(e)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(e)});break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(e)});break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(e)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(e)});break;case"skin":i=this.loadSkin(e);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(e)});break;case"camera":i=this.loadCamera(e);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(t,e)}),!i)throw new Error("Unknown type: "+t);break}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(i.map(function(s,o){return n.getDependency(t,o)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],n=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[ee.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,o){n.load(Io.resolveURL(e.uri,i.path),s,void 0,function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(n){const i=e.byteLength||0,s=e.byteOffset||0;return n.slice(s,s+i)})}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(i.bufferView===void 0&&i.sparse===void 0){const o=Hp[i.type],a=oc[i.componentType],c=i.normalized===!0,l=new a(i.count*o);return Promise.resolve(new Pe(l,o,c))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(o){const a=o[0],c=Hp[i.type],l=oc[i.componentType],h=l.BYTES_PER_ELEMENT,u=h*c,d=i.byteOffset||0,f=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,m=i.normalized===!0;let _,g;if(f&&f!==u){const p=Math.floor(d/f),b="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+p+":"+i.count;let y=e.cache.get(b);y||(_=new l(a,p*f,i.count*f/h),y=new uw(_,f/h),e.cache.add(b,y)),g=new Gl(y,c,d%f/h,m)}else a===null?_=new l(i.count*c):_=new l(a,d,i.count*c),g=new Pe(_,c,m);if(i.sparse!==void 0){const p=Hp.SCALAR,b=oc[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,v=i.sparse.values.byteOffset||0,x=new b(o[1],y,i.sparse.count*p),S=new l(o[2],v,i.sparse.count*c);a!==null&&(g=new Pe(g.array.slice(),g.itemSize,g.normalized));for(let T=0,E=x.length;T<E;T++){const w=x[T];if(g.setX(w,S[T*c]),c>=2&&g.setY(w,S[T*c+1]),c>=3&&g.setZ(w,S[T*c+2]),c>=4&&g.setW(w,S[T*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return g})}loadTexture(t){const e=this.json,n=this.options,s=e.textures[t].source,o=e.images[s];let a=this.textureLoader;if(o.uri){const c=n.manager.getHandler(o.uri);c!==null&&(a=c)}return this.loadTextureImage(t,s,a)}loadTextureImage(t,e,n){const i=this,s=this.json,o=s.textures[t],a=s.images[e],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(e,n).then(function(h){h.flipY=!1,h.name=o.name||a.name||"",h.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(h.name=a.uri);const d=(s.samplers||{})[o.sampler]||{};return h.magFilter=Dv[d.magFilter]||dn,h.minFilter=Dv[d.minFilter]||Ji,h.wrapS=Lv[d.wrapS]||xs,h.wrapT=Lv[d.wrapT]||xs,i.associations.set(h,{textures:t}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(t,e){const n=this,i=this.json,s=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(u=>u.clone());const o=i.images[t],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(o.bufferView!==void 0)c=n.getDependency("bufferView",o.bufferView).then(function(u){l=!0;const d=new Blob([u],{type:o.mimeType});return c=a.createObjectURL(d),c});else if(o.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(u){return new Promise(function(d,f){let m=d;e.isImageBitmapLoader===!0&&(m=function(_){const g=new Ie(_);g.needsUpdate=!0,d(g)}),e.load(Io.resolveURL(u,s.path),m,void 0,f)})}).then(function(u){return l===!0&&a.revokeObjectURL(c),Hs(u,o),u.userData.mimeType=o.mimeType||$k(o.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[t]=h,h}assignTexture(t,e,n,i){const s=this;return this.getDependency("texture",n.index).then(function(o){if(!o)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(o=o.clone(),o.channel=n.texCoord),s.extensions[ee.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[ee.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=s.associations.get(o);o=s.extensions[ee.KHR_TEXTURE_TRANSFORM].extendTexture(o,a),s.associations.set(o,c)}}return i!==void 0&&(typeof i=="number"&&(i=i===Pv?Ro:sr),"colorSpace"in o?o.colorSpace=i:o.encoding=i===Ro?Pv:vk),t[e]=o,o})}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=e.attributes.tangent===void 0,s=e.attributes.color!==void 0,o=e.attributes.normal===void 0;if(t.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new ja,Hn.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(t.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new Ui,Hn.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(a,c)),n=c}if(i||s||o){let a="ClonedMaterial:"+n.uuid+":";i&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),o&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),s&&(c.vertexColors=!0),o&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}t.material=n}getMaterialType(){return lh}loadMaterial(t){const e=this,n=this.json,i=this.extensions,s=n.materials[t];let o;const a={},c=s.extensions||{},l=[];if(c[ee.KHR_MATERIALS_UNLIT]){const u=i[ee.KHR_MATERIALS_UNLIT];o=u.getMaterialType(),l.push(u.extendParams(a,s,e))}else{const u=s.pbrMetallicRoughness||{};if(a.color=new pt(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const d=u.baseColorFactor;a.color.setRGB(d[0],d[1],d[2],sr),a.opacity=d[3]}u.baseColorTexture!==void 0&&l.push(e.assignTexture(a,"map",u.baseColorTexture,Ro)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(e.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(e.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),o=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(t,a)})))}s.doubleSided===!0&&(a.side=Sn);const h=s.alphaMode||Gp.OPAQUE;if(h===Gp.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===Gp.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&o!==en&&(l.push(e.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new J(1,1),s.normalTexture.scale!==void 0)){const u=s.normalTexture.scale;a.normalScale.set(u,u)}if(s.occlusionTexture!==void 0&&o!==en&&(l.push(e.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&o!==en){const u=s.emissiveFactor;a.emissive=new pt().setRGB(u[0],u[1],u[2],sr)}return s.emissiveTexture!==void 0&&o!==en&&l.push(e.assignTexture(a,"emissiveMap",s.emissiveTexture,Ro)),Promise.all(l).then(function(){const u=new o(a);return s.name&&(u.name=s.name),Hs(u,s),e.associations.set(u,{materials:t}),s.extensions&&bo(i,u,s),u})}createUniqueName(t){const e=$t.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,n=this.extensions,i=this.primitiveCache;function s(a){return n[ee.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,e).then(function(c){return Iv(c,a,e)})}const o=[];for(let a=0,c=t.length;a<c;a++){const l=t[a],h=Qk(l),u=i[h];if(u)o.push(u.promise);else{let d;l.extensions&&l.extensions[ee.KHR_DRACO_MESH_COMPRESSION]?d=s(l):d=Iv(new Qt,l,e),i[h]={primitive:l,promise:d},o.push(d)}}return Promise.all(o)}loadMesh(t){const e=this,n=this.json,i=this.extensions,s=n.meshes[t],o=s.primitives,a=[];for(let c=0,l=o.length;c<l;c++){const h=o[c].material===void 0?qk(this.cache):this.getDependency("material",o[c].material);a.push(h)}return a.push(e.loadGeometries(o)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],u=[];for(let f=0,m=h.length;f<m;f++){const _=h[f],g=o[f];let p;const b=l[f];if(g.mode===Ci.TRIANGLES||g.mode===Ci.TRIANGLE_STRIP||g.mode===Ci.TRIANGLE_FAN||g.mode===void 0)p=s.isSkinnedMesh===!0?new fw(_,b):new ct(_,b),p.isSkinnedMesh===!0&&p.normalizeSkinWeights(),g.mode===Ci.TRIANGLE_STRIP?p.geometry=xv(p.geometry,Kx):g.mode===Ci.TRIANGLE_FAN&&(p.geometry=xv(p.geometry,Vm));else if(g.mode===Ci.LINES)p=new zo(_,b);else if(g.mode===Ci.LINE_STRIP)p=new Kt(_,b);else if(g.mode===Ci.LINE_LOOP)p=new rD(_,b);else if(g.mode===Ci.POINTS)p=new sd(_,b);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(p.geometry.morphAttributes).length>0&&Zk(p,s),p.name=e.createUniqueName(s.name||"mesh_"+t),Hs(p,s),g.extensions&&bo(i,p,g),e.assignFinalMaterial(p),u.push(p)}for(let f=0,m=u.length;f<m;f++)e.associations.set(u[f],{meshes:t,primitives:f});if(u.length===1)return s.extensions&&bo(i,u[0],s),u[0];const d=new Li;s.extensions&&bo(i,d,s),e.associations.set(d,{meshes:t});for(let f=0,m=u.length;f<m;f++)d.add(u[f]);return d})}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?e=new rn(Le.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(e=new ch(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),Hs(e,n),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],n=[];for(let i=0,s=e.joints.length;i<s;i++)n.push(this._loadNodeShallow(e.joints[i]));return e.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",e.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const s=i.pop(),o=i,a=[],c=[];for(let l=0,h=o.length;l<h;l++){const u=o[l];if(u){a.push(u);const d=new lt;s!==null&&d.fromArray(s.array,l*16),c.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[l])}return new Kd(a,c)})}loadAnimation(t){const e=this.json,n=this,i=e.animations[t],s=i.name?i.name:"animation_"+t,o=[],a=[],c=[],l=[],h=[];for(let u=0,d=i.channels.length;u<d;u++){const f=i.channels[u],m=i.samplers[f.sampler],_=f.target,g=_.node,p=i.parameters!==void 0?i.parameters[m.input]:m.input,b=i.parameters!==void 0?i.parameters[m.output]:m.output;_.node!==void 0&&(o.push(this.getDependency("node",g)),a.push(this.getDependency("accessor",p)),c.push(this.getDependency("accessor",b)),l.push(m),h.push(_))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c),Promise.all(l),Promise.all(h)]).then(function(u){const d=u[0],f=u[1],m=u[2],_=u[3],g=u[4],p=[];for(let b=0,y=d.length;b<y;b++){const v=d[b],x=f[b],S=m[b],T=_[b],E=g[b];if(v===void 0)continue;v.updateMatrix&&v.updateMatrix();const w=n._createAnimationTracks(v,x,S,T,E);if(w)for(let M=0;M<w.length;M++)p.push(w[M])}return new jl(s,void 0,p)})}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(s){const o=n._getNodeRef(n.meshCache,i.mesh,s);return i.weights!==void 0&&o.traverse(function(a){if(a.isMesh)for(let c=0,l=i.weights.length;c<l;c++)a.morphTargetInfluences[c]=i.weights[c]}),o})}loadNode(t){const e=this.json,n=this,i=e.nodes[t],s=n._loadNodeShallow(t),o=[],a=i.children||[];for(let l=0,h=a.length;l<h;l++)o.push(n.getDependency("node",a[l]));const c=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([s,Promise.all(o),c]).then(function(l){const h=l[0],u=l[1],d=l[2];d!==null&&h.traverse(function(f){f.isSkinnedMesh&&f.bind(d,Jk)});for(let f=0,m=u.length;f<m;f++)h.add(u[f]);return h})}_loadNodeShallow(t){const e=this.json,n=this.extensions,i=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const s=e.nodes[t],o=s.name?i.createUniqueName(s.name):"",a=[],c=i._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return c&&a.push(c),s.camera!==void 0&&a.push(i.getDependency("camera",s.camera).then(function(l){return i._getNodeRef(i.cameraCache,s.camera,l)})),i._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){a.push(l)}),this.nodeCache[t]=Promise.all(a).then(function(l){let h;if(s.isBone===!0?h=new gd:l.length>1?h=new Li:l.length===1?h=l[0]:h=new Bt,h!==l[0])for(let u=0,d=l.length;u<d;u++)h.add(l[u]);if(s.name&&(h.userData.name=s.name,h.name=o),Hs(h,s),s.extensions&&bo(n,h,s),s.matrix!==void 0){const u=new lt;u.fromArray(s.matrix),h.applyMatrix4(u)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return i.associations.has(h)||i.associations.set(h,{}),i.associations.get(h).nodes=t,h}),this.nodeCache[t]}loadScene(t){const e=this.extensions,n=this.json.scenes[t],i=this,s=new Li;n.name&&(s.name=i.createUniqueName(n.name)),Hs(s,n),n.extensions&&bo(e,s,n);const o=n.nodes||[],a=[];for(let c=0,l=o.length;c<l;c++)a.push(i.getDependency("node",o[c]));return Promise.all(a).then(function(c){for(let h=0,u=c.length;h<u;h++)s.add(c[h]);const l=h=>{const u=new Map;for(const[d,f]of i.associations)(d instanceof Hn||d instanceof Ie)&&u.set(d,f);return h.traverse(d=>{const f=i.associations.get(d);f!=null&&u.set(d,f)}),u};return i.associations=l(s),s})}_createAnimationTracks(t,e,n,i,s){const o=[],a=t.name?t.name:t.uuid,c=[];Ar[s.path]===Ar.weights?t.traverse(function(d){d.morphTargetInfluences&&c.push(d.name?d.name:d.uuid)}):c.push(a);let l;switch(Ar[s.path]){case Ar.weights:l=Vo;break;case Ar.rotation:l=Ho;break;case Ar.position:case Ar.scale:l=Go;break;default:switch(n.itemSize){case 1:l=Vo;break;case 2:case 3:default:l=Go;break}break}const h=i.interpolation!==void 0?Yk[i.interpolation]:bc,u=this._getArrayFromAccessor(n);for(let d=0,f=c.length;d<f;d++){const m=new l(c[d]+"."+Ar[s.path],e.array,u,h);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),o.push(m)}return o}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const n=xg(e.constructor),i=new Float32Array(e.length);for(let s=0,o=e.length;s<o;s++)i[s]=e[s]*n;e=i}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(n){const i=this instanceof Ho?Xk:qS;return new i(this.times,this.values,this.getValueSize()/3,n)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function e3(r,t,e){const n=t.attributes,i=new xe;if(n.POSITION!==void 0){const a=e.json.accessors[n.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(i.set(new C(c[0],c[1],c[2]),new C(l[0],l[1],l[2])),a.normalized){const h=xg(oc[a.componentType]);i.min.multiplyScalar(h),i.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=t.targets;if(s!==void 0){const a=new C,c=new C;for(let l=0,h=s.length;l<h;l++){const u=s[l];if(u.POSITION!==void 0){const d=e.json.accessors[u.POSITION],f=d.min,m=d.max;if(f!==void 0&&m!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),d.normalized){const _=xg(oc[d.componentType]);c.multiplyScalar(_)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}r.boundingBox=i;const o=new An;i.getCenter(o.center),o.radius=i.min.distanceTo(i.max)/2,r.boundingSphere=o}function Iv(r,t,e){const n=t.attributes,i=[];function s(o,a){return e.getDependency("accessor",o).then(function(c){r.setAttribute(a,c)})}for(const o in n){const a=vg[o]||o.toLowerCase();a in r.attributes||i.push(s(n[o],a))}if(t.indices!==void 0&&!r.index){const o=e.getDependency("accessor",t.indices).then(function(a){r.setIndex(a)});i.push(o)}return Hs(r,t),e3(r,t,e),Promise.all(i).then(function(){return t.targets!==void 0?Kk(r,t.targets,e):r})}const fl=new C;function Ti(r,t,e,n,i,s){const o=2*Math.PI*i/4,a=Math.max(s-2*i,0),c=Math.PI/4;fl.copy(t),fl[n]=0,fl.normalize();const l=.5*o/(o+a),h=1-fl.angleTo(r)/c;return Math.sign(fl[e])===1?h*l:a/(o+a)+l+l*(1-h)}class n3 extends Fn{constructor(t=1,e=1,n=1,i=2,s=.1){if(i=i*2+1,s=Math.min(t/2,e/2,n/2,s),super(1,1,1,i,i,i),i===1)return;const o=this.toNonIndexed();this.index=null,this.attributes.position=o.attributes.position,this.attributes.normal=o.attributes.normal,this.attributes.uv=o.attributes.uv;const a=new C,c=new C,l=new C(t,e,n).divideScalar(2).subScalar(s),h=this.attributes.position.array,u=this.attributes.normal.array,d=this.attributes.uv.array,f=h.length/6,m=new C,_=.5/i;for(let g=0,p=0;g<h.length;g+=3,p+=2)switch(a.fromArray(h,g),c.copy(a),c.x-=Math.sign(c.x)*_,c.y-=Math.sign(c.y)*_,c.z-=Math.sign(c.z)*_,c.normalize(),h[g+0]=l.x*Math.sign(a.x)+c.x*s,h[g+1]=l.y*Math.sign(a.y)+c.y*s,h[g+2]=l.z*Math.sign(a.z)+c.z*s,u[g+0]=c.x,u[g+1]=c.y,u[g+2]=c.z,Math.floor(g/f)){case 0:m.set(1,0,0),d[p+0]=Ti(m,c,"z","y",s,n),d[p+1]=1-Ti(m,c,"y","z",s,e);break;case 1:m.set(-1,0,0),d[p+0]=1-Ti(m,c,"z","y",s,n),d[p+1]=1-Ti(m,c,"y","z",s,e);break;case 2:m.set(0,1,0),d[p+0]=1-Ti(m,c,"x","z",s,t),d[p+1]=Ti(m,c,"z","x",s,n);break;case 3:m.set(0,-1,0),d[p+0]=1-Ti(m,c,"x","z",s,t),d[p+1]=1-Ti(m,c,"z","x",s,n);break;case 4:m.set(0,0,1),d[p+0]=1-Ti(m,c,"x","y",s,t),d[p+1]=1-Ti(m,c,"y","x",s,e);break;case 5:m.set(0,0,-1),d[p+0]=Ti(m,c,"x","y",s,t),d[p+1]=1-Ti(m,c,"y","x",s,e);break}}}function KS(r,t,e){const n=e.length-r-1;if(t>=e[n])return n-1;if(t<=e[r])return r;let i=r,s=n,o=Math.floor((i+s)/2);for(;t<e[o]||t>=e[o+1];)t<e[o]?s=o:i=o,o=Math.floor((i+s)/2);return o}function i3(r,t,e,n){const i=[],s=[],o=[];i[0]=1;for(let a=1;a<=e;++a){s[a]=t-n[r+1-a],o[a]=n[r+a]-t;let c=0;for(let l=0;l<a;++l){const h=o[l+1],u=s[a-l],d=i[l]/(h+u);i[l]=c+h*d,c=u*d}i[a]=c}return i}function s3(r,t,e,n){const i=KS(r,n,t),s=i3(i,n,r,t),o=new ie(0,0,0,0);for(let a=0;a<=r;++a){const c=e[i-r+a],l=s[a],h=c.w*l;o.x+=c.x*h,o.y+=c.y*h,o.z+=c.z*h,o.w+=c.w*l}return o}function r3(r,t,e,n,i){const s=[];for(let u=0;u<=e;++u)s[u]=0;const o=[];for(let u=0;u<=n;++u)o[u]=s.slice(0);const a=[];for(let u=0;u<=e;++u)a[u]=s.slice(0);a[0][0]=1;const c=s.slice(0),l=s.slice(0);for(let u=1;u<=e;++u){c[u]=t-i[r+1-u],l[u]=i[r+u]-t;let d=0;for(let f=0;f<u;++f){const m=l[f+1],_=c[u-f];a[u][f]=m+_;const g=a[f][u-1]/a[u][f];a[f][u]=d+m*g,d=_*g}a[u][u]=d}for(let u=0;u<=e;++u)o[0][u]=a[u][e];for(let u=0;u<=e;++u){let d=0,f=1;const m=[];for(let _=0;_<=e;++_)m[_]=s.slice(0);m[0][0]=1;for(let _=1;_<=n;++_){let g=0;const p=u-_,b=e-_;u>=_&&(m[f][0]=m[d][0]/a[b+1][p],g=m[f][0]*a[p][b]);const y=p>=-1?1:-p,v=u-1<=b?_-1:e-u;for(let S=y;S<=v;++S)m[f][S]=(m[d][S]-m[d][S-1])/a[b+1][p+S],g+=m[f][S]*a[p+S][b];u<=b&&(m[f][_]=-m[d][_-1]/a[b+1][u],g+=m[f][_]*a[u][b]),o[_][u]=g;const x=d;d=f,f=x}}let h=e;for(let u=1;u<=n;++u){for(let d=0;d<=e;++d)o[u][d]*=h;h*=e-u}return o}function o3(r,t,e,n,i){const s=i<r?i:r,o=[],a=KS(r,n,t),c=r3(a,n,r,s,t),l=[];for(let h=0;h<e.length;++h){const u=e[h].clone(),d=u.w;u.x*=d,u.y*=d,u.z*=d,l[h]=u}for(let h=0;h<=s;++h){const u=l[a-r].clone().multiplyScalar(c[h][0]);for(let d=1;d<=r;++d)u.add(l[a-r+d].clone().multiplyScalar(c[h][d]));o[h]=u}for(let h=s+1;h<=i+1;++h)o[h]=new ie(0,0,0);return o}function a3(r,t){let e=1;for(let i=2;i<=r;++i)e*=i;let n=1;for(let i=2;i<=t;++i)n*=i;for(let i=2;i<=r-t;++i)n*=i;return e/n}function c3(r){const t=r.length,e=[],n=[];for(let s=0;s<t;++s){const o=r[s];e[s]=new C(o.x,o.y,o.z),n[s]=o.w}const i=[];for(let s=0;s<t;++s){const o=e[s].clone();for(let a=1;a<=s;++a)o.sub(i[s-a].clone().multiplyScalar(a3(s,a)*n[a]));i[s]=o.divideScalar(n[0])}return i}function l3(r,t,e,n,i){const s=o3(r,t,e,n,i);return c3(s)}class Ov extends os{constructor(t,e,n,i,s){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=i||0,this.endKnot=s||this.knots.length-1;for(let o=0;o<n.length;++o){const a=n[o];this.controlPoints[o]=new ie(a.x,a.y,a.z,a.w)}}getPoint(t,e){const n=e||new C,i=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=s3(this.degree,this.knots,this.controlPoints,i);return s.w!=1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(t,e){const n=e||new C,i=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),s=l3(this.degree,this.knots,this.controlPoints,i,1);return n.copy(s[1]).normalize(),n}}let te,Xe,qn;class h3 extends Ps{constructor(t){super(t)}load(t,e,n,i){const s=this,o=s.path===""?Io.extractUrlBase(t):s.path,a=new Fc(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(t,function(c){try{e(s.parse(c,o))}catch(l){i?i(l):console.error(l),s.manager.itemError(t)}},n,i)}parse(t,e){if(g3(t))te=new m3().parse(t);else{const i=JS(t);if(!_3(i))throw new Error("THREE.FBXLoader: Unknown format.");if(kv(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+kv(i));te=new p3().parse(i)}const n=new Zd(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new u3(n,this.manager).parse(te)}}class u3{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){Xe=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),n=this.parseMaterials(e),i=this.parseDeformers(),s=new d3().parse(i);return this.parseScene(i,s,n),qn}parseConnections(){const t=new Map;return"Connections"in te&&te.Connections.connections.forEach(function(n){const i=n[0],s=n[1],o=n[2];t.has(i)||t.set(i,{parents:[],children:[]});const a={ID:s,relationship:o};t.get(i).parents.push(a),t.has(s)||t.set(s,{parents:[],children:[]});const c={ID:i,relationship:o};t.get(s).children.push(c)}),t}parseImages(){const t={},e={};if("Video"in te.Objects){const n=te.Objects.Video;for(const i in n){const s=n[i],o=parseInt(i);if(t[o]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c=typeof s.Content=="string"&&s.Content!=="";if(a||c){const l=this.parseImage(n[i]);e[s.RelativeFilename||s.Filename]=l}}}}for(const n in t){const i=t[n];e[i]!==void 0?t[n]=e[i]:t[n]=t[n].split("\\").pop()}return t}parseImage(t){const e=t.Content,n=t.RelativeFilename||t.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(i){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof e=="string")return"data:"+s+";base64,"+e;{const o=new Uint8Array(e);return window.URL.createObjectURL(new Blob([o],{type:s}))}}parseTextures(t){const e=new Map;if("Texture"in te.Objects){const n=te.Objects.Texture;for(const i in n){const s=this.parseTexture(n[i],t);e.set(parseInt(i),s)}}return e}parseTexture(t,e){const n=this.loadTexture(t,e);n.ID=t.id,n.name=t.attrName;const i=t.WrapModeU,s=t.WrapModeV,o=i!==void 0?i.value:0,a=s!==void 0?s.value:0;if(n.wrapS=o===0?xs:di,n.wrapT=a===0?xs:di,"Scaling"in t){const c=t.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}return n}loadTexture(t,e){let n;const i=this.textureLoader.path,s=Xe.get(t.id).children;s!==void 0&&s.length>0&&e[s[0].ID]!==void 0&&(n=e[s[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let o;const a=t.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",t.RelativeFilename),o=new Ie):(c.setPath(this.textureLoader.path),o=c.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",t.RelativeFilename),o=new Ie):o=this.textureLoader.load(n);return this.textureLoader.setPath(i),o}parseMaterials(t){const e=new Map;if("Material"in te.Objects){const n=te.Objects.Material;for(const i in n){const s=this.parseMaterial(n[i],t);s!==null&&e.set(parseInt(i),s)}}return e}parseMaterial(t,e){const n=t.id,i=t.attrName;let s=t.ShadingModel;if(typeof s=="object"&&(s=s.value),!Xe.has(n))return null;const o=this.parseParameters(t,e,n);let a;switch(s.toLowerCase()){case"phong":a=new Gr;break;case"lambert":a=new mD;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new Gr;break}return a.setValues(o),a.name=i,a}parseParameters(t,e,n){const i={};t.BumpFactor&&(i.bumpScale=t.BumpFactor.value),t.Diffuse?i.color=new pt().fromArray(t.Diffuse.value):t.DiffuseColor&&(t.DiffuseColor.type==="Color"||t.DiffuseColor.type==="ColorRGB")&&(i.color=new pt().fromArray(t.DiffuseColor.value)),t.DisplacementFactor&&(i.displacementScale=t.DisplacementFactor.value),t.Emissive?i.emissive=new pt().fromArray(t.Emissive.value):t.EmissiveColor&&(t.EmissiveColor.type==="Color"||t.EmissiveColor.type==="ColorRGB")&&(i.emissive=new pt().fromArray(t.EmissiveColor.value)),t.EmissiveFactor&&(i.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(i.opacity=parseFloat(t.Opacity.value)),i.opacity<1&&(i.transparent=!0),t.ReflectionFactor&&(i.reflectivity=t.ReflectionFactor.value),t.Shininess&&(i.shininess=t.Shininess.value),t.Specular?i.specular=new pt().fromArray(t.Specular.value):t.SpecularColor&&t.SpecularColor.type==="Color"&&(i.specular=new pt().fromArray(t.SpecularColor.value));const s=this;return Xe.get(n).children.forEach(function(o){const a=o.relationship;switch(a){case"Bump":i.bumpMap=s.getTexture(e,o.ID);break;case"Maya|TEX_ao_map":i.aoMap=s.getTexture(e,o.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=s.getTexture(e,o.ID),i.map!==void 0&&("colorSpace"in i.map?i.map.colorSpace="srgb":i.map.encoding=3001);break;case"DisplacementColor":i.displacementMap=s.getTexture(e,o.ID);break;case"EmissiveColor":i.emissiveMap=s.getTexture(e,o.ID),i.emissiveMap!==void 0&&("colorSpace"in i.emissiveMap?i.emissiveMap.colorSpace="srgb":i.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=s.getTexture(e,o.ID);break;case"ReflectionColor":i.envMap=s.getTexture(e,o.ID),i.envMap!==void 0&&(i.envMap.mapping=pc,"colorSpace"in i.envMap?i.envMap.colorSpace="srgb":i.envMap.encoding=3001);break;case"SpecularColor":i.specularMap=s.getTexture(e,o.ID),i.specularMap!==void 0&&("colorSpace"in i.specularMap?i.specularMap.colorSpace="srgb":i.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=s.getTexture(e,o.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),i}getTexture(t,e){return"LayeredTexture"in te.Objects&&e in te.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),e=Xe.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in te.Objects){const n=te.Objects.Deformer;for(const i in n){const s=n[i],o=Xe.get(parseInt(i));if(s.attrType==="Skin"){const a=this.parseSkeleton(o,n);a.ID=i,o.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=o.parents[0].ID,t[i]=a}else if(s.attrType==="BlendShape"){const a={id:i};a.rawTargets=this.parseMorphTargets(o,n),a.id=i,o.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),e[i]=a}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const n=[];return t.children.forEach(function(i){const s=e[i.ID];if(s.attrType!=="Cluster")return;const o={ID:i.ID,indices:[],weights:[],transformLink:new lt().fromArray(s.TransformLink.a)};"Indexes"in s&&(o.indices=s.Indexes.a,o.weights=s.Weights.a),n.push(o)}),{rawBones:n,bones:[]}}parseMorphTargets(t,e){const n=[];for(let i=0;i<t.children.length;i++){const s=t.children[i],o=e[s.ID],a={name:o.attrName,initialWeight:o.DeformPercent,id:o.id,fullWeights:o.FullWeights.a};if(o.attrType!=="BlendShapeChannel")return;a.geoID=Xe.get(parseInt(s.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(t,e,n){qn=new Li;const i=this.parseModels(t.skeletons,e,n),s=te.Objects.Model,o=this;i.forEach(function(c){const l=s[c.ID];o.setLookAtProperties(c,l),Xe.get(c.ID).parents.forEach(function(u){const d=i.get(u.ID);d!==void 0&&d.add(c)}),c.parent===null&&qn.add(c)}),this.bindSkeleton(t.skeletons,e,i),this.createAmbientLight(),qn.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const l=QS(c.userData.transformData);c.applyMatrix4(l),c.updateWorldMatrix()}});const a=new f3().parse();qn.children.length===1&&qn.children[0].isGroup&&(qn.children[0].animations=a,qn=qn.children[0]),qn.animations=a}parseModels(t,e,n){const i=new Map,s=te.Objects.Model;for(const o in s){const a=parseInt(o),c=s[o],l=Xe.get(a);let h=this.buildSkeleton(l,t,a,c.attrName);if(!h){switch(c.attrType){case"Camera":h=this.createCamera(l);break;case"Light":h=this.createLight(l);break;case"Mesh":h=this.createMesh(l,e,n);break;case"NurbsCurve":h=this.createCurve(l,e);break;case"LimbNode":case"Root":h=new gd;break;case"Null":default:h=new Li;break}h.name=c.attrName?$t.sanitizeNodeName(c.attrName):"",h.ID=a}this.getTransformData(h,c),i.set(a,h)}return i}buildSkeleton(t,e,n,i){let s=null;return t.parents.forEach(function(o){for(const a in e){const c=e[a];c.rawBones.forEach(function(l,h){if(l.ID===o.ID){const u=s;s=new gd,s.matrixWorld.copy(l.transformLink),s.name=i?$t.sanitizeNodeName(i):"",s.ID=n,c.bones[h]=s,u!==null&&s.add(u)}})}}),s}createCamera(t){let e,n;if(t.children.forEach(function(i){const s=te.Objects.NodeAttribute[i.ID];s!==void 0&&(n=s)}),n===void 0)e=new Bt;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let o=1e3;n.FarPlane!==void 0&&(o=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const l=a/c;let h=45;n.FieldOfView!==void 0&&(h=n.FieldOfView.value);const u=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:e=new rn(h,l,s,o),u!==null&&e.setFocalLength(u);break;case 1:e=new ch(-a/2,a/2,c/2,-c/2,s,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),e=new Bt;break}}return e}createLight(t){let e,n;if(t.children.forEach(function(i){const s=te.Objects.NodeAttribute[i.ID];s!==void 0&&(n=s)}),n===void 0)e=new Bt;else{let i;n.LightType===void 0?i=0:i=n.LightType.value;let s=16777215;n.Color!==void 0&&(s=new pt().fromArray(n.Color.value));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(i){case 0:e=new yd(s,o,a,c);break;case 1:e=new h0(s,o);break;case 2:let l=Math.PI/3;n.InnerAngle!==void 0&&(l=Le.degToRad(n.InnerAngle.value));let h=0;n.OuterAngle!==void 0&&(h=Le.degToRad(n.OuterAngle.value),h=Math.max(h,1)),e=new l0(s,o,a,l,h,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),e=new yd(s,o);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(e.castShadow=!0)}return e}createMesh(t,e,n){let i,s=null,o=null;const a=[];return t.children.forEach(function(c){e.has(c.ID)&&(s=e.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?o=a:a.length>0?o=a[0]:(o=new Gr({color:13421772}),a.push(o)),"color"in s.attributes&&a.forEach(function(c){c.vertexColors=!0}),s.FBX_Deformer?(i=new fw(s,o),i.normalizeSkinWeights()):i=new ct(s,o),i}createCurve(t,e){const n=t.children.reduce(function(s,o){return e.has(o.ID)&&(s=e.get(o.ID)),s},null),i=new Ui({color:3342591,linewidth:1});return new Kt(n,i)}getTransformData(t,e){const n={};"InheritType"in e&&(n.inheritType=parseInt(e.InheritType.value)),"RotationOrder"in e?n.eulerOrder=$S(e.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in e&&(n.translation=e.Lcl_Translation.value),"PreRotation"in e&&(n.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(n.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(n.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(n.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(n.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(n.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(n.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(n.rotationPivot=e.RotationPivot.value),t.userData.transformData=n}setLookAtProperties(t,e){"LookAtProperty"in e&&Xe.get(t.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const s=te.Objects.Model[i.ID];if("Lcl_Translation"in s){const o=s.Lcl_Translation.value;t.target!==void 0?(t.target.position.fromArray(o),qn.add(t.target)):t.lookAt(new C().fromArray(o))}}})}bindSkeleton(t,e,n){const i=this.parsePoseNodes();for(const s in t){const o=t[s];Xe.get(parseInt(o.ID)).parents.forEach(function(c){if(e.has(c.ID)){const l=c.ID;Xe.get(l).parents.forEach(function(u){n.has(u.ID)&&n.get(u.ID).bind(new Kd(o.bones),i[u.ID])})}})}}parsePoseNodes(){const t={};if("Pose"in te.Objects){const e=te.Objects.Pose;for(const n in e)if(e[n].attrType==="BindPose"&&e[n].NbPoseNodes>0){const i=e[n].PoseNode;Array.isArray(i)?i.forEach(function(s){t[s.Node]=new lt().fromArray(s.Matrix.a)}):t[i.Node]=new lt().fromArray(i.Matrix.a)}}return t}createAmbientLight(){if("GlobalSettings"in te&&"AmbientColor"in te.GlobalSettings){const t=te.GlobalSettings.AmbientColor.value,e=t[0],n=t[1],i=t[2];if(e!==0||n!==0||i!==0){const s=new pt(e,n,i);qn.add(new Mw(s,1))}}}}class d3{parse(t){const e=new Map;if("Geometry"in te.Objects){const n=te.Objects.Geometry;for(const i in n){const s=Xe.get(parseInt(i)),o=this.parseGeometry(s,n[i],t);e.set(parseInt(i),o)}}return e}parseGeometry(t,e,n){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,n);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,n){const i=n.skeletons,s=[],o=t.parents.map(function(u){return te.Objects.Model[u.ID]});if(o.length===0)return;const a=t.children.reduce(function(u,d){return i[d.ID]!==void 0&&(u=i[d.ID]),u},null);t.children.forEach(function(u){n.morphTargets[u.ID]!==void 0&&s.push(n.morphTargets[u.ID])});const c=o[0],l={};"RotationOrder"in c&&(l.eulerOrder=$S(c.RotationOrder.value)),"InheritType"in c&&(l.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(l.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(l.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(l.scale=c.GeometricScaling.value);const h=QS(l);return this.genGeometry(e,a,s,h)}genGeometry(t,e,n,i){const s=new Qt;t.attrName&&(s.name=t.attrName);const o=this.parseGeoNode(t,e),a=this.genBuffers(o),c=new Ot(a.vertex,3);if(c.applyMatrix4(i),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new Ot(a.colors,3)),e&&(s.setAttribute("skinIndex",new Qg(a.weightsIndices,4)),s.setAttribute("skinWeight",new Ot(a.vertexWeights,4)),s.FBX_Deformer=e),a.normal.length>0){const l=new Gt().getNormalMatrix(i),h=new Ot(a.normal,3);h.applyNormalMatrix(l),s.setAttribute("normal",h)}if(a.uvs.forEach(function(l,h){DF==="uv2"&&h++;const u=h===0?"uv":`uv${h}`;s.setAttribute(u,new Ot(a.uvs[h],2))}),o.material&&o.material.mappingType!=="AllSame"){let l=a.materialIndex[0],h=0;if(a.materialIndex.forEach(function(u,d){u!==l&&(s.addGroup(h,d-h,l),l=u,h=d)}),s.groups.length>0){const u=s.groups[s.groups.length-1],d=u.start+u.count;d!==a.materialIndex.length&&s.addGroup(d,a.materialIndex.length-d,l)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,t,n,i),s}parseGeoNode(t,e){const n={};if(n.vertexPositions=t.Vertices!==void 0?t.Vertices.a:[],n.vertexIndices=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(n.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(n.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(n.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){n.uv=[];let i=0;for(;t.LayerElementUV[i];)t.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(t.LayerElementUV[i])),i++}return n.weightTable={},e!==null&&(n.skeleton=e,e.rawBones.forEach(function(i,s){i.indices.forEach(function(o,a){n.weightTable[o]===void 0&&(n.weightTable[o]=[]),n.weightTable[o].push({id:s,weight:i.weights[a]})})})),n}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,s=!1,o=[],a=[],c=[],l=[],h=[],u=[];const d=this;return t.vertexIndices.forEach(function(f,m){let _,g=!1;f<0&&(f=f^-1,g=!0);let p=[],b=[];if(o.push(f*3,f*3+1,f*3+2),t.color){const y=Ku(m,n,f,t.color);c.push(y[0],y[1],y[2])}if(t.skeleton){if(t.weightTable[f]!==void 0&&t.weightTable[f].forEach(function(y){b.push(y.weight),p.push(y.id)}),b.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const y=[0,0,0,0],v=[0,0,0,0];b.forEach(function(x,S){let T=x,E=p[S];v.forEach(function(w,M,P){if(T>w){P[M]=T,T=w;const L=y[M];y[M]=E,E=L}})}),p=y,b=v}for(;b.length<4;)b.push(0),p.push(0);for(let y=0;y<4;++y)h.push(b[y]),u.push(p[y])}if(t.normal){const y=Ku(m,n,f,t.normal);a.push(y[0],y[1],y[2])}t.material&&t.material.mappingType!=="AllSame"&&(_=Ku(m,n,f,t.material)[0]),t.uv&&t.uv.forEach(function(y,v){const x=Ku(m,n,f,y);l[v]===void 0&&(l[v]=[]),l[v].push(x[0]),l[v].push(x[1])}),i++,g&&(d.genFace(e,t,o,_,a,c,l,h,u,i),n++,i=0,o=[],a=[],c=[],l=[],h=[],u=[])}),e}genFace(t,e,n,i,s,o,a,c,l,h){for(let u=2;u<h;u++)t.vertex.push(e.vertexPositions[n[0]]),t.vertex.push(e.vertexPositions[n[1]]),t.vertex.push(e.vertexPositions[n[2]]),t.vertex.push(e.vertexPositions[n[(u-1)*3]]),t.vertex.push(e.vertexPositions[n[(u-1)*3+1]]),t.vertex.push(e.vertexPositions[n[(u-1)*3+2]]),t.vertex.push(e.vertexPositions[n[u*3]]),t.vertex.push(e.vertexPositions[n[u*3+1]]),t.vertex.push(e.vertexPositions[n[u*3+2]]),e.skeleton&&(t.vertexWeights.push(c[0]),t.vertexWeights.push(c[1]),t.vertexWeights.push(c[2]),t.vertexWeights.push(c[3]),t.vertexWeights.push(c[(u-1)*4]),t.vertexWeights.push(c[(u-1)*4+1]),t.vertexWeights.push(c[(u-1)*4+2]),t.vertexWeights.push(c[(u-1)*4+3]),t.vertexWeights.push(c[u*4]),t.vertexWeights.push(c[u*4+1]),t.vertexWeights.push(c[u*4+2]),t.vertexWeights.push(c[u*4+3]),t.weightsIndices.push(l[0]),t.weightsIndices.push(l[1]),t.weightsIndices.push(l[2]),t.weightsIndices.push(l[3]),t.weightsIndices.push(l[(u-1)*4]),t.weightsIndices.push(l[(u-1)*4+1]),t.weightsIndices.push(l[(u-1)*4+2]),t.weightsIndices.push(l[(u-1)*4+3]),t.weightsIndices.push(l[u*4]),t.weightsIndices.push(l[u*4+1]),t.weightsIndices.push(l[u*4+2]),t.weightsIndices.push(l[u*4+3])),e.color&&(t.colors.push(o[0]),t.colors.push(o[1]),t.colors.push(o[2]),t.colors.push(o[(u-1)*3]),t.colors.push(o[(u-1)*3+1]),t.colors.push(o[(u-1)*3+2]),t.colors.push(o[u*3]),t.colors.push(o[u*3+1]),t.colors.push(o[u*3+2])),e.material&&e.material.mappingType!=="AllSame"&&(t.materialIndex.push(i),t.materialIndex.push(i),t.materialIndex.push(i)),e.normal&&(t.normal.push(s[0]),t.normal.push(s[1]),t.normal.push(s[2]),t.normal.push(s[(u-1)*3]),t.normal.push(s[(u-1)*3+1]),t.normal.push(s[(u-1)*3+2]),t.normal.push(s[u*3]),t.normal.push(s[u*3+1]),t.normal.push(s[u*3+2])),e.uv&&e.uv.forEach(function(d,f){t.uvs[f]===void 0&&(t.uvs[f]=[]),t.uvs[f].push(a[f][0]),t.uvs[f].push(a[f][1]),t.uvs[f].push(a[f][(u-1)*2]),t.uvs[f].push(a[f][(u-1)*2+1]),t.uvs[f].push(a[f][u*2]),t.uvs[f].push(a[f][u*2+1])})}addMorphTargets(t,e,n,i){if(n.length===0)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const s=this;n.forEach(function(o){o.rawTargets.forEach(function(a){const c=te.Objects.Geometry[a.geoID];c!==void 0&&s.genMorphGeometry(t,e,c,i,a.name)})})}genMorphGeometry(t,e,n,i,s){const o=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],l=t.attributes.position.count*3,h=new Float32Array(l);for(let m=0;m<c.length;m++){const _=c[m]*3;h[_]=a[m*3],h[_+1]=a[m*3+1],h[_+2]=a[m*3+2]}const u={vertexIndices:o,vertexPositions:h},d=this.genBuffers(u),f=new Ot(d.vertex,3);f.name=s||n.attrName,f.applyMatrix4(i),t.morphAttributes.position.push(f)}parseNormals(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in t?s=t.NormalIndex.a:"NormalsIndex"in t&&(s=t.NormalsIndex.a)),{dataSize:3,buffer:i,indices:s,mappingType:e,referenceType:n}}parseUVs(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.UV.a;let s=[];return n==="IndexToDirect"&&(s=t.UVIndex.a),{dataSize:2,buffer:i,indices:s,mappingType:e,referenceType:n}}parseVertexColors(t){const e=t.MappingInformationType,n=t.ReferenceInformationType,i=t.Colors.a;let s=[];return n==="IndexToDirect"&&(s=t.ColorIndex.a),{dataSize:4,buffer:i,indices:s,mappingType:e,referenceType:n}}parseMaterialIndices(t){const e=t.MappingInformationType,n=t.ReferenceInformationType;if(e==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=t.Materials.a,s=[];for(let o=0;o<i.length;++o)s.push(o);return{dataSize:1,buffer:i,indices:s,mappingType:e,referenceType:n}}parseNurbsGeometry(t){if(Ov===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Qt;const e=parseInt(t.Order);if(isNaN(e))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",t.Order,t.id),new Qt;const n=e-1,i=t.KnotVector.a,s=[],o=t.Points.a;for(let u=0,d=o.length;u<d;u+=4)s.push(new ie().fromArray(o,u));let a,c;if(t.Form==="Closed")s.push(s[0]);else if(t.Form==="Periodic"){a=n,c=i.length-1-a;for(let u=0;u<n;++u)s.push(s[u])}const h=new Ov(n,i,s,a,c).getPoints(s.length*12);return new Qt().setFromPoints(h)}}class f3{parse(){const t=[],e=this.parseClips();if(e!==void 0)for(const n in e){const i=e[n],s=this.addClip(i);t.push(s)}return t}parseClips(){if(te.Objects.AnimationCurve===void 0)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=te.Objects.AnimationCurveNode,e=new Map;for(const n in t){const i=t[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:i.id,attr:i.attrName,curves:{}};e.set(s.id,s)}}return e}parseAnimationCurves(t){const e=te.Objects.AnimationCurve;for(const n in e){const i={id:e[n].id,times:e[n].KeyTime.a.map(b3),values:e[n].KeyValueFloat.a},s=Xe.get(i.id);if(s!==void 0){const o=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?t.get(o).curves.x=i:a.match(/Y/)?t.get(o).curves.y=i:a.match(/Z/)?t.get(o).curves.z=i:a.match(/d|DeformPercent/)&&t.has(o)&&(t.get(o).curves.morph=i)}}}parseAnimationLayers(t){const e=te.Objects.AnimationLayer,n=new Map;for(const i in e){const s=[],o=Xe.get(parseInt(i));o!==void 0&&(o.children.forEach(function(c,l){if(t.has(c.ID)){const h=t.get(c.ID);if(h.curves.x!==void 0||h.curves.y!==void 0||h.curves.z!==void 0){if(s[l]===void 0){const u=Xe.get(c.ID).parents.filter(function(d){return d.relationship!==void 0})[0].ID;if(u!==void 0){const d=te.Objects.Model[u.toString()];if(d===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const f={modelName:d.attrName?$t.sanitizeNodeName(d.attrName):"",ID:d.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};qn.traverse(function(m){m.ID===d.id&&(f.transform=m.matrix,m.userData.transformData&&(f.eulerOrder=m.userData.transformData.eulerOrder))}),f.transform||(f.transform=new lt),"PreRotation"in d&&(f.preRotation=d.PreRotation.value),"PostRotation"in d&&(f.postRotation=d.PostRotation.value),s[l]=f}}s[l]&&(s[l][h.attr]=h)}else if(h.curves.morph!==void 0){if(s[l]===void 0){const u=Xe.get(c.ID).parents.filter(function(p){return p.relationship!==void 0})[0].ID,d=Xe.get(u).parents[0].ID,f=Xe.get(d).parents[0].ID,m=Xe.get(f).parents[0].ID,_=te.Objects.Model[m],g={modelName:_.attrName?$t.sanitizeNodeName(_.attrName):"",morphName:te.Objects.Deformer[u].attrName};s[l]=g}s[l][h.attr]=h}}}),n.set(parseInt(i),s))}return n}parseAnimStacks(t){const e=te.Objects.AnimationStack,n={};for(const i in e){const s=Xe.get(parseInt(i)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const o=t.get(s[0].ID);n[i]={name:e[i].attrName,layer:o}}return n}addClip(t){let e=[];const n=this;return t.layer.forEach(function(i){e=e.concat(n.generateTracks(i))}),new jl(t.name,-1,e)}generateTracks(t){const e=[];let n=new C,i=new jt,s=new C;if(t.transform&&t.transform.decompose(n,i,s),n=n.toArray(),i=new Me().setFromQuaternion(i,t.eulerOrder).toArray(),s=s.toArray(),t.T!==void 0&&Object.keys(t.T.curves).length>0){const o=this.generateVectorTrack(t.modelName,t.T.curves,n,"position");o!==void 0&&e.push(o)}if(t.R!==void 0&&Object.keys(t.R.curves).length>0){const o=this.generateRotationTrack(t.modelName,t.R.curves,i,t.preRotation,t.postRotation,t.eulerOrder);o!==void 0&&e.push(o)}if(t.S!==void 0&&Object.keys(t.S.curves).length>0){const o=this.generateVectorTrack(t.modelName,t.S.curves,s,"scale");o!==void 0&&e.push(o)}if(t.DeformPercent!==void 0){const o=this.generateMorphTrack(t);o!==void 0&&e.push(o)}return e}generateVectorTrack(t,e,n,i){const s=this.getTimesForAllAxes(e),o=this.getKeyframeTrackValues(s,e,n);return new Go(t+"."+i,s,o)}generateRotationTrack(t,e,n,i,s,o){e.x!==void 0&&(this.interpolateRotations(e.x),e.x.values=e.x.values.map(Le.degToRad)),e.y!==void 0&&(this.interpolateRotations(e.y),e.y.values=e.y.values.map(Le.degToRad)),e.z!==void 0&&(this.interpolateRotations(e.z),e.z.values=e.z.values.map(Le.degToRad));const a=this.getTimesForAllAxes(e),c=this.getKeyframeTrackValues(a,e,n);i!==void 0&&(i=i.map(Le.degToRad),i.push(o),i=new Me().fromArray(i),i=new jt().setFromEuler(i)),s!==void 0&&(s=s.map(Le.degToRad),s.push(o),s=new Me().fromArray(s),s=new jt().setFromEuler(s).invert());const l=new jt,h=new Me,u=[];for(let d=0;d<c.length;d+=3)h.set(c[d],c[d+1],c[d+2],o),l.setFromEuler(h),i!==void 0&&l.premultiply(i),s!==void 0&&l.multiply(s),l.toArray(u,d/3*4);return new Ho(t+".quaternion",a,u)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,n=e.values.map(function(s){return s/100}),i=qn.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new Vo(t.modelName+".morphTargetInfluences["+i+"]",e.times,n)}getTimesForAllAxes(t){let e=[];if(t.x!==void 0&&(e=e.concat(t.x.times)),t.y!==void 0&&(e=e.concat(t.y.times)),t.z!==void 0&&(e=e.concat(t.z.times)),e=e.sort(function(n,i){return n-i}),e.length>1){let n=1,i=e[0];for(let s=1;s<e.length;s++){const o=e[s];o!==i&&(e[n]=o,i=o,n++)}e=e.slice(0,n)}return e}getKeyframeTrackValues(t,e,n){const i=n,s=[];let o=-1,a=-1,c=-1;return t.forEach(function(l){if(e.x&&(o=e.x.times.indexOf(l)),e.y&&(a=e.y.times.indexOf(l)),e.z&&(c=e.z.times.indexOf(l)),o!==-1){const h=e.x.values[o];s.push(h),i[0]=h}else s.push(i[0]);if(a!==-1){const h=e.y.values[a];s.push(h),i[1]=h}else s.push(i[1]);if(c!==-1){const h=e.z.values[c];s.push(h),i[2]=h}else s.push(i[2])}),s}interpolateRotations(t){for(let e=1;e<t.values.length;e++){const n=t.values[e-1],i=t.values[e]-n,s=Math.abs(i);if(s>=180){const o=s/180,a=i/o;let c=n+a;const l=t.times[e-1],u=(t.times[e]-l)/o;let d=l+u;const f=[],m=[];for(;d<t.times[e];)f.push(d),d+=u,m.push(c),c+=a;t.times=Nv(t.times,e,f),t.values=Nv(t.values,e,m)}}}}class p3{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new ZS,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,n=t.split(/[\r\n]+/);return n.forEach(function(i,s){const o=i.match(/^[\s\t]*;/),a=i.match(/^[\s\t]*$/);if(o||a)return;const c=i.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),l=i.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=i.match("^\\t{"+(e.currentIndent-1)+"}}");c?e.parseNodeBegin(i,c):l?e.parseNodeProperty(i,l,n[++s]):h?e.popStack():i.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(t,e){const n=e[1].trim().replace(/^"/,"").replace(/"$/,""),i=e[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},o=this.parseNodeAttr(i),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in a?(n==="PoseNode"?a.PoseNode.push(s):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),o.id!==""&&(a[n][o.id]=s)):typeof o.id=="number"?(a[n]={},a[n][o.id]=s):n!=="Properties70"&&(n==="PoseNode"?a[n]=[s]:a[n]=s),typeof o.id=="number"&&(s.id=o.id),o.name!==""&&(s.attrName=o.name),o.type!==""&&(s.attrType=o.type),this.pushStack(s)}parseNodeAttr(t){let e=t[0];t[0]!==""&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let n="",i="";return t.length>1&&(n=t[1].replace(/^(\w+)::/,""),i=t[2]),{id:e,name:n,type:i}}parseNodeProperty(t,e,n){let i=e[1].replace(/^"/,"").replace(/"$/,"").trim(),s=e[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const o=this.getCurrentNode();if(o.name==="Properties70"){this.parseNodeSpecialProperty(t,i,s);return}if(i==="C"){const c=s.split(",").slice(1),l=parseInt(c[0]),h=parseInt(c[1]);let u=s.split(",").slice(3);u=u.map(function(d){return d.trim().replace(/^"/,"")}),i="connections",s=[l,h],v3(s,u),o[i]===void 0&&(o[i]=[])}i==="Node"&&(o.id=s),i in o&&Array.isArray(o[i])?o[i].push(s):i!=="a"?o[i]=s:o.a=s,this.setCurrentProp(o,i),i==="a"&&s.slice(-1)!==","&&(o.a=Xp(s))}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,t.slice(-1)!==","&&(e.a=Xp(e.a))}parseNodeSpecialProperty(t,e,n){const i=n.split('",').map(function(h){return h.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=i[0],o=i[1],a=i[2],c=i[3];let l=i[4];switch(o){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Xp(l);break}this.getPrevNode()[s]={type:o,type2:a,flag:c,value:l},this.setCurrentProp(this.getPrevNode(),s)}}class m3{parse(t){const e=new Fv(t);e.skip(23);const n=e.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new ZS;for(;!this.endOfContent(e);){const s=this.parseNode(e,n);s!==null&&i.add(s.name,s)}return i}endOfContent(t){return t.size()%16===0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const n={},i=e>=7500?t.getUint64():t.getUint32(),s=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const o=t.getUint8(),a=t.getString(o);if(i===0)return null;const c=[];for(let d=0;d<s;d++)c.push(this.parseProperty(t));const l=c.length>0?c[0]:"",h=c.length>1?c[1]:"",u=c.length>2?c[2]:"";for(n.singleProperty=s===1&&t.getOffset()===i;i>t.getOffset();){const d=this.parseNode(t,e);d!==null&&this.parseSubNode(a,n,d)}return n.propertyList=c,typeof l=="number"&&(n.id=l),h!==""&&(n.attrName=h),u!==""&&(n.attrType=u),a!==""&&(n.name=a),n}parseSubNode(t,e,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(e[n.name]=n,n.a=i):e[n.name]=i}else if(t==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(s,o){o!==0&&i.push(s)}),e.connections===void 0&&(e.connections=[]),e.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){e[s]=n[s]});else if(t==="Properties70"&&n.name==="P"){let i=n.propertyList[0],s=n.propertyList[1];const o=n.propertyList[2],a=n.propertyList[3];let c;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],e[i]={type:s,type2:o,flag:a,value:c}}else e[n.name]===void 0?typeof n.id=="number"?(e[n.name]={},e[n.name][n.id]=n):e[n.name]=n:n.name==="PoseNode"?(Array.isArray(e[n.name])||(e[n.name]=[e[n.name]]),e[n.name].push(n)):e[n.name][n.id]===void 0&&(e[n.name][n.id]=n)}parseProperty(t){const e=t.getString(1);let n;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return n=t.getUint32(),t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=t.getUint32(),s=t.getUint32(),o=t.getUint32();if(s===0)switch(e){case"b":case"c":return t.getBooleanArray(i);case"d":return t.getFloat64Array(i);case"f":return t.getFloat32Array(i);case"i":return t.getInt32Array(i);case"l":return t.getInt64Array(i)}const a=dk(new Uint8Array(t.getArrayBuffer(o))),c=new Fv(a.buffer);switch(e){case"b":case"c":return c.getBooleanArray(i);case"d":return c.getFloat64Array(i);case"f":return c.getFloat32Array(i);case"i":return c.getInt32Array(i);case"l":return c.getInt64Array(i)}default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class Fv{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=e!==void 0?e:!0}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(t){const e=[];for(let n=0;n<t;n++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),e&2147483648?(e=~e&4294967295,t=~t&4294967295,t===4294967295&&(e=e+1&4294967295),t=t+1&4294967295,-(e*4294967296+t)):e*4294967296+t}getInt64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),e*4294967296+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let n=0;n<t;n++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){let e=[];for(let i=0;i<t;i++)e[i]=this.getUint8();const n=e.indexOf(0);return n>=0&&(e=e.slice(0,n)),Sc(new Uint8Array(e))}}class ZS{add(t,e){this[t]=e}}function g3(r){const t="Kaydara FBX Binary  \0";return r.byteLength>=t.length&&t===JS(r,0,t.length)}function _3(r){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let e=0;function n(i){const s=r[i-1];return r=r.slice(e+i),e++,s}for(let i=0;i<t.length;++i)if(n(1)===t[i])return!1;return!0}function kv(r){const t=/FBXVersion: (\d+)/,e=r.match(t);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function b3(r){return r/46186158e3}const y3=[];function Ku(r,t,e,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=r;break;case"ByPolygon":i=t;break;case"ByVertice":i=e;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const s=i*n.dataSize,o=s+n.dataSize;return x3(y3,n.buffer,s,o)}const Wp=new Me,Ia=new C;function QS(r){const t=new lt,e=new lt,n=new lt,i=new lt,s=new lt,o=new lt,a=new lt,c=new lt,l=new lt,h=new lt,u=new lt,d=new lt,f=r.inheritType?r.inheritType:0;if(r.translation&&t.setPosition(Ia.fromArray(r.translation)),r.preRotation){const M=r.preRotation.map(Le.degToRad);M.push(r.eulerOrder),e.makeRotationFromEuler(Wp.fromArray(M))}if(r.rotation){const M=r.rotation.map(Le.degToRad);M.push(r.eulerOrder),n.makeRotationFromEuler(Wp.fromArray(M))}if(r.postRotation){const M=r.postRotation.map(Le.degToRad);M.push(r.eulerOrder),i.makeRotationFromEuler(Wp.fromArray(M)),i.invert()}r.scale&&s.scale(Ia.fromArray(r.scale)),r.scalingOffset&&a.setPosition(Ia.fromArray(r.scalingOffset)),r.scalingPivot&&o.setPosition(Ia.fromArray(r.scalingPivot)),r.rotationOffset&&c.setPosition(Ia.fromArray(r.rotationOffset)),r.rotationPivot&&l.setPosition(Ia.fromArray(r.rotationPivot)),r.parentMatrixWorld&&(u.copy(r.parentMatrix),h.copy(r.parentMatrixWorld));const m=e.clone().multiply(n).multiply(i),_=new lt;_.extractRotation(h);const g=new lt;g.copyPosition(h);const p=g.clone().invert().multiply(h),b=_.clone().invert().multiply(p),y=s,v=new lt;if(f===0)v.copy(_).multiply(m).multiply(b).multiply(y);else if(f===1)v.copy(_).multiply(b).multiply(m).multiply(y);else{const P=new lt().scale(new C().setFromMatrixScale(u)).clone().invert(),L=b.clone().multiply(P);v.copy(_).multiply(m).multiply(L).multiply(y)}const x=l.clone().invert(),S=o.clone().invert();let T=t.clone().multiply(c).multiply(l).multiply(e).multiply(n).multiply(i).multiply(x).multiply(a).multiply(o).multiply(s).multiply(S);const E=new lt().copyPosition(T),w=h.clone().multiply(E);return d.copyPosition(w),T=d.clone().multiply(v),T.premultiply(h.invert()),T}function $S(r){r=r||0;const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return r===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[r]}function Xp(r){return r.split(",").map(function(e){return parseFloat(e)})}function JS(r,t,e){return t===void 0&&(t=0),e===void 0&&(e=r.byteLength),Sc(new Uint8Array(r,t,e))}function v3(r,t){for(let e=0,n=r.length,i=t.length;e<i;e++,n++)r[n]=t[e]}function x3(r,t,e,n){for(let i=e,s=0;i<n;i++,s++)r[s]=t[i];return r}function Nv(r,t,e){return r.slice(0,t).concat(e).concat(r.slice(t))}class w3 extends Ps{constructor(t){super(t)}load(t,e,n,i){const s=this,o=this.path===""?Io.extractUrlBase(t):this.path,a=new Fc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(c){try{e(s.parse(c,o))}catch(l){i?i(l):console.error(l),s.manager.itemError(t)}},n,i)}setMaterialOptions(t){return this.materialOptions=t,this}parse(t,e){const n=t.split(`
`);let i={};const s=/\s+/,o={};for(let c=0;c<n.length;c++){let l=n[c];if(l=l.trim(),l.length===0||l.charAt(0)==="#")continue;const h=l.indexOf(" ");let u=h>=0?l.substring(0,h):l;u=u.toLowerCase();let d=h>=0?l.substring(h+1):"";if(d=d.trim(),u==="newmtl")i={name:d},o[d]=i;else if(u==="ka"||u==="kd"||u==="ks"||u==="ke"){const f=d.split(s,3);i[u]=[parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2])]}else i[u]=d}const a=new S3(this.resourcePath||e,this.materialOptions);return a.setCrossOrigin(this.crossOrigin),a.setManager(this.manager),a.setMaterials(o),a}}class S3{constructor(t="",e={}){this.baseUrl=t,this.options=e,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:Bi,this.wrap=this.options.wrap!==void 0?this.options.wrap:xs}setCrossOrigin(t){return this.crossOrigin=t,this}setManager(t){this.manager=t}setMaterials(t){this.materialsInfo=this.convert(t),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(t){if(!this.options)return t;const e={};for(const n in t){const i=t[n],s={};e[n]=s;for(const o in i){let a=!0,c=i[o];const l=o.toLowerCase();switch(l){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(c=[c[0]/255,c[1]/255,c[2]/255]),this.options&&this.options.ignoreZeroRGBs&&c[0]===0&&c[1]===0&&c[2]===0&&(a=!1);break}a&&(s[l]=c)}}return e}preload(){for(const t in this.materialsInfo)this.create(t)}getIndex(t){return this.nameLookup[t]}getAsArray(){let t=0;for(const e in this.materialsInfo)this.materialsArray[t]=this.create(e),this.nameLookup[e]=t,t++;return this.materialsArray}create(t){return this.materials[t]===void 0&&this.createMaterial_(t),this.materials[t]}createMaterial_(t){const e=this,n=this.materialsInfo[t],i={name:t,side:this.side};function s(a,c){return typeof c!="string"||c===""?"":/^https?:\/\//i.test(c)?c:a+c}function o(a,c){if(i[a])return;const l=e.getTextureParams(c,i),h=e.loadTexture(s(e.baseUrl,l.url));h.repeat.copy(l.scale),h.offset.copy(l.offset),h.wrapS=e.wrap,h.wrapT=e.wrap,i[a]=h}for(const a in n){const c=n[a];let l;if(c!=="")switch(a.toLowerCase()){case"kd":i.color=new pt().fromArray(c);break;case"ks":i.specular=new pt().fromArray(c);break;case"ke":i.emissive=new pt().fromArray(c);break;case"map_kd":o("map",c);break;case"map_ks":o("specularMap",c);break;case"map_ke":o("emissiveMap",c);break;case"norm":o("normalMap",c);break;case"map_bump":case"bump":o("bumpMap",c);break;case"map_d":o("alphaMap",c),i.transparent=!0;break;case"ns":i.shininess=parseFloat(c);break;case"d":l=parseFloat(c),l<1&&(i.opacity=l,i.transparent=!0);break;case"tr":l=parseFloat(c),this.options&&this.options.invertTrProperty&&(l=1-l),l>0&&(i.opacity=1-l,i.transparent=!0);break}}return this.materials[t]=new Gr(i),this.materials[t]}getTextureParams(t,e){const n={scale:new J(1,1),offset:new J(0,0)},i=t.split(/\s+/);let s;return s=i.indexOf("-bm"),s>=0&&(e.bumpScale=parseFloat(i[s+1]),i.splice(s,2)),s=i.indexOf("-s"),s>=0&&(n.scale.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),s=i.indexOf("-o"),s>=0&&(n.offset.set(parseFloat(i[s+1]),parseFloat(i[s+2])),i.splice(s,4)),n.url=i.join(" ").trim(),n}loadTexture(t,e,n,i,s){const o=this.manager!==void 0?this.manager:Sw;let a=o.getHandler(t);a===null&&(a=new Zd(o)),a.setCrossOrigin&&a.setCrossOrigin(this.crossOrigin);const c=a.load(t,n,i,s);return e!==void 0&&(c.mapping=e),c}}class M3 extends ED{constructor(t){super(t),this.type=Ks}parse(t){const o=function(E,w){switch(E){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(w||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(w||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(w||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(w||""))}},h=`
`,u=function(E,w,M){w=w||1024;let L=E.pos,I=-1,F=0,z="",N=String.fromCharCode.apply(null,new Uint16Array(E.subarray(L,L+128)));for(;0>(I=N.indexOf(h))&&F<w&&L<E.byteLength;)z+=N,F+=N.length,L+=128,N+=String.fromCharCode.apply(null,new Uint16Array(E.subarray(L,L+128)));return-1<I?(E.pos+=F+I+1,z+N.slice(0,I)):!1},d=function(E){const w=/^#\?(\S+)/,M=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,P=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,L=/^\s*FORMAT=(\S+)\s*$/,I=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,F={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let z,N;for((E.pos>=E.byteLength||!(z=u(E)))&&o(1,"no header found"),(N=z.match(w))||o(3,"bad initial token"),F.valid|=1,F.programtype=N[1],F.string+=z+`
`;z=u(E),z!==!1;){if(F.string+=z+`
`,z.charAt(0)==="#"){F.comments+=z+`
`;continue}if((N=z.match(M))&&(F.gamma=parseFloat(N[1])),(N=z.match(P))&&(F.exposure=parseFloat(N[1])),(N=z.match(L))&&(F.valid|=2,F.format=N[1]),(N=z.match(I))&&(F.valid|=4,F.height=parseInt(N[1],10),F.width=parseInt(N[2],10)),F.valid&2&&F.valid&4)break}return F.valid&2||o(3,"missing format specifier"),F.valid&4||o(3,"missing image size specifier"),F},f=function(E,w,M){const P=w;if(P<8||P>32767||E[0]!==2||E[1]!==2||E[2]&128)return new Uint8Array(E);P!==(E[2]<<8|E[3])&&o(3,"wrong scanline width");const L=new Uint8Array(4*w*M);L.length||o(4,"unable to allocate buffer space");let I=0,F=0;const z=4*P,N=new Uint8Array(4),Z=new Uint8Array(z);let j=M;for(;j>0&&F<E.byteLength;){F+4>E.byteLength&&o(1),N[0]=E[F++],N[1]=E[F++],N[2]=E[F++],N[3]=E[F++],(N[0]!=2||N[1]!=2||(N[2]<<8|N[3])!=P)&&o(3,"bad rgbe scanline format");let et=0,tt;for(;et<z&&F<E.byteLength;){tt=E[F++];const dt=tt>128;if(dt&&(tt-=128),(tt===0||et+tt>z)&&o(3,"bad scanline data"),dt){const St=E[F++];for(let O=0;O<tt;O++)Z[et++]=St}else Z.set(E.subarray(F,F+tt),et),et+=tt,F+=tt}const at=P;for(let dt=0;dt<at;dt++){let St=0;L[I]=Z[dt+St],St+=P,L[I+1]=Z[dt+St],St+=P,L[I+2]=Z[dt+St],St+=P,L[I+3]=Z[dt+St],I+=4}j--}return L},m=function(E,w,M,P){const L=E[w+3],I=Math.pow(2,L-128)/255;M[P+0]=E[w+0]*I,M[P+1]=E[w+1]*I,M[P+2]=E[w+2]*I,M[P+3]=1},_=function(E,w,M,P){const L=E[w+3],I=Math.pow(2,L-128)/255;M[P+0]=Ph.toHalfFloat(Math.min(E[w+0]*I,65504)),M[P+1]=Ph.toHalfFloat(Math.min(E[w+1]*I,65504)),M[P+2]=Ph.toHalfFloat(Math.min(E[w+2]*I,65504)),M[P+3]=Ph.toHalfFloat(1)},g=new Uint8Array(t);g.pos=0;const p=d(g),b=p.width,y=p.height,v=f(g.subarray(g.pos),b,y);let x,S,T;switch(this.type){case Tn:T=v.length/4;const E=new Float32Array(T*4);for(let M=0;M<T;M++)m(v,M*4,E,M*4);x=E,S=Tn;break;case Ks:T=v.length/4;const w=new Uint16Array(T*4);for(let M=0;M<T;M++)_(v,M*4,w,M*4);x=w,S=Ks;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:b,height:y,data:x,header:p.string,gamma:p.gamma,exposure:p.exposure,type:S}}setDataType(t){return this.type=t,this}load(t,e,n,i){function s(o,a){switch(o.type){case Tn:case Ks:"colorSpace"in o?o.colorSpace="srgb-linear":o.encoding=3e3,o.minFilter=dn,o.magFilter=dn,o.generateMipmaps=!1,o.flipY=!0;break}e&&e(o,a)}return super.load(t,s,n,i)}}const T3=/^[og]\s*(.+)?/,E3=/^mtllib /,A3=/^usemtl /,C3=/^usemap /,Uv=new C,Yp=new C,Bv=new C,zv=new C,Ei=new C;function P3(){const r={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=e!==!1;return}const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:e!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(i,s){const o=this._finalize(!1);o&&(o.inherited||o.groupCount<=0)&&this.materials.splice(o.index,1);const a={index:this.materials.length,name:i||"",mtllib:Array.isArray(s)&&s.length>0?s[s.length-1]:"",smooth:o!==void 0?o.smooth:this.smooth,groupStart:o!==void 0?o.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(c){const l={index:typeof c=="number"?c:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return l.clone=this.clone.bind(l),l}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){const s=this.currentMaterial();if(s&&s.groupEnd===-1&&(s.groupEnd=this.geometry.vertices.length/3,s.groupCount=s.groupEnd-s.groupStart,s.inherited=!1),i&&this.materials.length>1)for(let o=this.materials.length-1;o>=0;o--)this.materials[o].groupCount<=0&&this.materials.splice(o,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),s}},n&&n.name&&typeof n.clone=="function"){const i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,e){const n=parseInt(t,10);return(n>=0?n-1:n+e/3)*3},parseNormalIndex:function(t,e){const n=parseInt(t,10);return(n>=0?n-1:n+e/3)*3},parseUVIndex:function(t,e){const n=parseInt(t,10);return(n>=0?n-1:n+e/2)*2},addVertex:function(t,e,n){const i=this.vertices,s=this.object.geometry.vertices;s.push(i[t+0],i[t+1],i[t+2]),s.push(i[e+0],i[e+1],i[e+2]),s.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){const e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,n){const i=this.normals,s=this.object.geometry.normals;s.push(i[t+0],i[t+1],i[t+2]),s.push(i[e+0],i[e+1],i[e+2]),s.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(t,e,n){const i=this.vertices,s=this.object.geometry.normals;Uv.fromArray(i,t),Yp.fromArray(i,e),Bv.fromArray(i,n),Ei.subVectors(Bv,Yp),zv.subVectors(Uv,Yp),Ei.cross(zv),Ei.normalize(),s.push(Ei.x,Ei.y,Ei.z),s.push(Ei.x,Ei.y,Ei.z),s.push(Ei.x,Ei.y,Ei.z)},addColor:function(t,e,n){const i=this.colors,s=this.object.geometry.colors;i[t]!==void 0&&s.push(i[t+0],i[t+1],i[t+2]),i[e]!==void 0&&s.push(i[e+0],i[e+1],i[e+2]),i[n]!==void 0&&s.push(i[n+0],i[n+1],i[n+2])},addUV:function(t,e,n){const i=this.uvs,s=this.object.geometry.uvs;s.push(i[t+0],i[t+1]),s.push(i[e+0],i[e+1]),s.push(i[n+0],i[n+1])},addDefaultUV:function(){const t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){const e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,n,i,s,o,a,c,l){const h=this.vertices.length;let u=this.parseVertexIndex(t,h),d=this.parseVertexIndex(e,h),f=this.parseVertexIndex(n,h);if(this.addVertex(u,d,f),this.addColor(u,d,f),a!==void 0&&a!==""){const m=this.normals.length;u=this.parseNormalIndex(a,m),d=this.parseNormalIndex(c,m),f=this.parseNormalIndex(l,m),this.addNormal(u,d,f)}else this.addFaceNormal(u,d,f);if(i!==void 0&&i!==""){const m=this.uvs.length;u=this.parseUVIndex(i,m),d=this.parseUVIndex(s,m),f=this.parseUVIndex(o,m),this.addUV(u,d,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";const e=this.vertices.length;for(let n=0,i=t.length;n<i;n++){const s=this.parseVertexIndex(t[n],e);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";const n=this.vertices.length,i=this.uvs.length;for(let s=0,o=t.length;s<o;s++)this.addVertexLine(this.parseVertexIndex(t[s],n));for(let s=0,o=e.length;s<o;s++)this.addUVLine(this.parseUVIndex(e[s],i))}};return r.startObject("",!1),r}class R3 extends Ps{constructor(t){super(t),this.materials=null}load(t,e,n,i){const s=this,o=new Fc(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(a){try{e(s.parse(a))}catch(c){i?i(c):console.error(c),s.manager.itemError(t)}},n,i)}setMaterials(t){return this.materials=t,this}parse(t){const e=new P3;t.indexOf(`\r
`)!==-1&&(t=t.replace(/\r\n/g,`
`)),t.indexOf(`\\
`)!==-1&&(t=t.replace(/\\\n/g,""));const n=t.split(`
`);let i="",s="",o=0,a=[];const c=typeof"".trimLeft=="function";for(let u=0,d=n.length;u<d;u++)if(i=n[u],i=c?i.trimLeft():i.trim(),o=i.length,o!==0&&(s=i.charAt(0),s!=="#"))if(s==="v"){const f=i.split(/\s+/);switch(f[0]){case"v":e.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?e.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])):e.colors.push(void 0,void 0,void 0);break;case"vn":e.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":e.uvs.push(parseFloat(f[1]),parseFloat(f[2]));break}}else if(s==="f"){const m=i.substr(1).trim().split(/\s+/),_=[];for(let p=0,b=m.length;p<b;p++){const y=m[p];if(y.length>0){const v=y.split("/");_.push(v)}}const g=_[0];for(let p=1,b=_.length-1;p<b;p++){const y=_[p],v=_[p+1];e.addFace(g[0],y[0],v[0],g[1],y[1],v[1],g[2],y[2],v[2])}}else if(s==="l"){const f=i.substring(1).trim().split(" ");let m=[];const _=[];if(i.indexOf("/")===-1)m=f;else for(let g=0,p=f.length;g<p;g++){const b=f[g].split("/");b[0]!==""&&m.push(b[0]),b[1]!==""&&_.push(b[1])}e.addLineGeometry(m,_)}else if(s==="p"){const m=i.substr(1).trim().split(" ");e.addPointGeometry(m)}else if((a=T3.exec(i))!==null){const f=(" "+a[0].substr(1).trim()).substr(1);e.startObject(f)}else if(A3.test(i))e.object.startMaterial(i.substring(7).trim(),e.materialLibraries);else if(E3.test(i))e.materialLibraries.push(i.substring(7).trim());else if(C3.test(i))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(s==="s"){if(a=i.split(" "),a.length>1){const m=a[1].trim().toLowerCase();e.object.smooth=m!=="0"&&m!=="off"}else e.object.smooth=!0;const f=e.object.currentMaterial();f&&(f.smooth=e.object.smooth)}else{if(i==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+i+'"')}e.finalize();const l=new Li;if(l.materialLibraries=[].concat(e.materialLibraries),!(e.objects.length===1&&e.objects[0].geometry.vertices.length===0)===!0)for(let u=0,d=e.objects.length;u<d;u++){const f=e.objects[u],m=f.geometry,_=f.materials,g=m.type==="Line",p=m.type==="Points";let b=!1;if(m.vertices.length===0)continue;const y=new Qt;y.setAttribute("position",new Ot(m.vertices,3)),m.normals.length>0&&y.setAttribute("normal",new Ot(m.normals,3)),m.colors.length>0&&(b=!0,y.setAttribute("color",new Ot(m.colors,3))),m.hasUVIndices===!0&&y.setAttribute("uv",new Ot(m.uvs,2));const v=[];for(let S=0,T=_.length;S<T;S++){const E=_[S],w=E.name+"_"+E.smooth+"_"+b;let M=e.materials[w];if(this.materials!==null){if(M=this.materials.create(E.name),g&&M&&!(M instanceof Ui)){const P=new Ui;Hn.prototype.copy.call(P,M),P.color.copy(M.color),M=P}else if(p&&M&&!(M instanceof ja)){const P=new ja({size:10,sizeAttenuation:!1});Hn.prototype.copy.call(P,M),P.color.copy(M.color),P.map=M.map,M=P}}M===void 0&&(g?M=new Ui:p?M=new ja({size:1,sizeAttenuation:!1}):M=new Gr,M.name=E.name,M.flatShading=!E.smooth,M.vertexColors=b,e.materials[w]=M),v.push(M)}let x;if(v.length>1){for(let S=0,T=_.length;S<T;S++){const E=_[S];y.addGroup(E.groupStart,E.groupCount,S)}g?x=new zo(y,v):p?x=new sd(y,v):x=new ct(y,v)}else g?x=new zo(y,v[0]):p?x=new sd(y,v[0]):x=new ct(y,v[0]);x.name=f.name,l.add(x)}else if(e.vertices.length>0){const u=new ja({size:1,sizeAttenuation:!1}),d=new Qt;d.setAttribute("position",new Ot(e.vertices,3)),e.colors.length>0&&e.colors[0]!==void 0&&(d.setAttribute("color",new Ot(e.colors,3)),u.vertexColors=!0);const f=new sd(d,u);l.add(f)}return l}}var D3=function(){var r="b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",t="b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb",e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),n=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if(typeof WebAssembly!="object")return{supported:!1};var i=WebAssembly.validate(e)?t:r,s,o=WebAssembly.instantiate(a(i),{}).then(function(p){s=p.instance,s.exports.__wasm_call_ctors()});function a(p){for(var b=new Uint8Array(p.length),y=0;y<p.length;++y){var v=p.charCodeAt(y);b[y]=v>96?v-97:v>64?v-39:v+4}for(var x=0,y=0;y<p.length;++y)b[x++]=b[y]<60?n[b[y]]:(b[y]-60)*64+b[++y];return b.buffer.slice(0,x)}function c(p,b,y,v,x,S){var T=s.exports.sbrk,E=y+3&-4,w=T(E*v),M=T(x.length),P=new Uint8Array(s.exports.memory.buffer);P.set(x,M);var L=p(w,y,v,M,x.length);if(L==0&&S&&S(w,E,v),b.set(P.subarray(w,w+y*v)),T(w-T(0)),L!=0)throw new Error("Malformed buffer data: "+L)}var l={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},u=[],d=0;function f(p){var b={object:new Worker(p),pending:0,requests:{}};return b.object.onmessage=function(y){var v=y.data;b.pending-=v.count,b.requests[v.id][v.action](v.value),delete b.requests[v.id]},b}function m(p){for(var b="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(a(i))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+c.toString()+g.toString(),y=new Blob([b],{type:"text/javascript"}),v=URL.createObjectURL(y),x=0;x<p;++x)u[x]=f(v);URL.revokeObjectURL(v)}function _(p,b,y,v,x){for(var S=u[0],T=1;T<u.length;++T)u[T].pending<S.pending&&(S=u[T]);return new Promise(function(E,w){var M=new Uint8Array(y),P=d++;S.pending+=p,S.requests[P]={resolve:E,reject:w},S.object.postMessage({id:P,count:p,size:b,source:M,mode:v,filter:x},[M.buffer])})}function g(p){o.then(function(){var b=p.data;try{var y=new Uint8Array(b.count*b.size);c(s.exports[b.mode],y,b.count,b.size,b.source,s.exports[b.filter]),self.postMessage({id:b.id,count:b.count,action:"resolve",value:y},[y.buffer])}catch(v){self.postMessage({id:b.id,count:b.count,action:"reject",value:v})}})}return{ready:o,supported:!0,useWorkers:function(p){m(p)},decodeVertexBuffer:function(p,b,y,v,x){c(s.exports.meshopt_decodeVertexBuffer,p,b,y,v,s.exports[l[x]])},decodeIndexBuffer:function(p,b,y,v){c(s.exports.meshopt_decodeIndexBuffer,p,b,y,v)},decodeIndexSequence:function(p,b,y,v){c(s.exports.meshopt_decodeIndexSequence,p,b,y,v)},decodeGltfBuffer:function(p,b,y,v,x,S){c(s.exports[h[x]],p,b,y,v,s.exports[l[S]])},decodeGltfBufferAsync:function(p,b,y,v,x){return u.length>0?_(p,b,y,h[v],l[x]):o.then(function(){var S=new Uint8Array(p*b);return c(s.exports[h[v]],S,p,b,y,s.exports[l[x]]),S})}}}(),Rt=(r=>(r.Scene="Scene",r.Group="Group",r.PerspectiveCamera="PerspectiveCamera",r.OrthographicCamera="OrthographicCamera",r.Plane="Plane",r.Box="Box",r.Sphere="Sphere",r.Cone="Cone",r.Cylinder="Cylinder",r.Pipe="Pipe",r.Polygon="Polygon",r.Wall="Wall",r.AmbientLight="AmbientLight",r.DirectionalLight="DirectionalLight",r.HemisphereLight="HemisphereLight",r.SpotLight="SpotLight",r.PointLight="PointLight",r.Model="Model",r.Symbol="Symbol",r.Text="Text",r))(Rt||{});const L3={Scene:"场景",Group:"组",PerspectiveCamera:"透视相机",OrthographicCamera:"正交相机",Plane:"平面",Box:"立方体",Sphere:"球体",Cone:"圆锥体",Cylinder:"圆柱体",Pipe:"管道",Polygon:"多边形",Wall:"墙体",AmbientLight:"环境光",DirectionalLight:"平行光",HemisphereLight:"半球光",SpotLight:"聚光灯",PointLight:"点光源",Model:"模型",Symbol:"图符",Text:"文本"};var is=(r=>(r.Linear="Linear",r.Bezier="Bezier",r))(is||{}),_s=(r=>(r.Basic="MeshBasicMaterial",r.Stand="MeshStandardMaterial",r.Phong="MeshPhongMaterial",r.Shader="ShaderMaterial",r))(_s||{}),Rr=(r=>(r.OBJ="obj",r.GLTF="gltf",r.FBX="fbx",r))(Rr||{}),mi=(r=>(r.SimpleScript="SimpleScript",r.Animator="Animator",r.OrbitControls="OrbitControls",r.PointerLockControls="PointerLockControls",r))(mi||{});const Wz={SimpleScript:"脚本",Animator:"动画控制",OrbitControls:"轨道控制",PointerLockControls:"第一人称控制"},Xz=`class Script {
  constructor(entity, scene) {
    this.entity = entity
    this.scene = scene
  }

  /** 脚本启用时调用 */
  onEnable() {}

  /** 脚本禁用时调用 */
  onDisable() {}

  /** 场景初始化完成调用 */
  start() {
             
  }

  /** 场景每帧渲染时调用, delta为每帧时间间, 单位秒 */
  update(delta) {
    
  }

  /** 模型销毁时调用 */
  destroy() {
    
  }
}`,tM=()=>Le.generateUUID(),qp=new lt,Yz=new J,qs=new C,Vv=new Me,qz=new jt,hf=new rn(45,1,.1,1e4);hf.name="Camera";hf.position.set(0,15,30);hf.lookAt(new C);const I3=(r,t,e=!0)=>{const n=[];return e?r.traverse(i=>n.push(i)):n.push(...r.children),n.filter(i=>!t.includes(i))},wg=r=>{for(const t of Object.keys(r)){const e=r[t];e&&typeof e=="object"&&typeof e.dispose=="function"&&e.dispose()}r.dispose()},O3=r=>{r.traverse(t=>{if(t instanceof ct)if(t.geometry.dispose(),Array.isArray(t.material))for(const e of t.material)wg(e);else wg(t.material)})},B0=r=>{const t=[];return r.traverse(e=>{if(e instanceof ct){const n=e.material;Array.isArray(n)?t.push(...n):t.push(n)}}),t},F3=r=>{let t=1;const e=Array.from(new Set(B0(r)));return e.forEach(n=>{n.name||(n.name=`material_${t++}`)}),e},Kz=r=>{const t=[];let e=1;return new Set(B0(r)).forEach(i=>{let s=i.name;t.includes(s)||(s||(s=`material_${e++}`),t.push(s))}),t},k3=r=>{const t=new Map;for(const e of r)if(e instanceof ct){const n=e.material;if(Array.isArray(n))n.forEach(i=>{if(t.has(i.name)){const s=t.get(i.name);s==null||s.push(e)}else t.set(i.name,[e])});else if(t.has(n.name)){const i=t.get(n.name);i==null||i.push(e)}else t.set(n.name,[e])}return t},N3=r=>{r.traverse(t=>{t instanceof ct&&t.geometry.computeBoundsTree()})},Hv=new xe,U3=(r,t=new xe)=>(r.forEach(e=>{Hv.setFromObject(e),t.union(Hv)}),t),B3=()=>{const r=new lh;return r.name="default",r.side=Sn,r},Gc=()=>{const r=B3(),t=new ct(void 0,r);return t.name="internal",t},z3=(r,t)=>new Nn(r.x,r.y,t.x,t.y),V3=(r,t,e)=>e?new n3(r.x,r.y,r.z,t.x,e):new Fn(r.x,r.y,r.z,t.x,t.y,t.z),H3=(r,t,e,n)=>new dr(r,n.x,n.y,0,t,0,e),G3=(r,t,e,n,i)=>new r0(r,t,i.x,i.y,e,0,n),j3=(r,t,e,n,i,s)=>new Ln(r,t,e,s.x,s.y,n,0,i),W3=(r,t)=>{const e=new yw;for(let n=0;n<r.length-1;n++){const i=r[n],s=r[n+1];if(i.type===is.Linear&&s.type===is.Linear){const o=new C().fromArray(i.point),a=new C().fromArray(s.point),c=new s0(o,a);e.add(c)}else{const o=new C().fromArray(i.point),a=new C().fromArray(i.after).add(o),c=new C().fromArray(s.point),l=new C().fromArray(s.before).add(c),h=new i0(o,a,l,c);e.add(h)}}return new a0(e,200,t,8,!1)},Yo=(r,t,e)=>{const n=r.getBoundingClientRect();return[(t-n.left)/n.width,(e-n.top)/n.height]},Zl=r=>r.button===0&&r.buttons===1,X3=r=>r.button===2&&r.buttons===2,Y3=r=>{const e=r.split("/").pop();if(e===void 0||Dx(e))return"";const n=e.lastIndexOf(".");return n&&n!=-1?e.slice(n+1,e.length):""},q3=r=>{const e=r.split("/").pop();if(e===void 0||Dx(e))return"";const n=e.lastIndexOf(".");return n&&n!=-1?e.slice(0,Math.max(0,n)):e},fs=(r,t=3)=>{const e=new TT(r);return Number(e.toFixed(t))},K3=(r,t)=>{let e=r;for(;e;){if(e.parent===t)return!0;e=e.parent}return!1},Z3=r=>{const{document:t}=JSON.parse(r),e=t.scene;e.ver=t.ver,e.name=t.name,e.code=t.code,e.author=t.author,e.company=t.company,e.desc=t.desc,e.date=t.date;const n=new Map;n.set(e.id,e);for(let i=0;i<t.elements.length;i++){const s=t.elements[i],o=n.get(s.parent),a={...s};o==null||o.children.push(a),n.set(a.id,a)}return{scene:e}},Q3=r=>{const{ver:t,name:e,code:n,author:i,company:s,desc:o,date:a}=r.scene,c=eM(r.scene.children,r.scene.id),l={...r.scene,children:[]};return{document:{ver:t,name:e,code:n,author:i,company:s,desc:o,date:a,scene:l,elements:c}}},eM=(r,t)=>{const e=[];for(const n of r){const i={...n,children:[],parent:t};e.push(i,...eM(n.children,i.id))}return e},bn=(r,t)=>{const e=r.generateID();return{id:e,name:`${L3[t]}-${e}`,position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],type:t,visible:!0,selectable:!0,transformable:!0,children:[],components:[]}},Zz=(r,t)=>{const e={...bn(r,Rt.Plane),size:[1,1],segments:[1,1],materials:[{name:"default"}],...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},Qz=(r,t)=>{const e={...bn(r,Rt.Box),materials:[{name:"default"}],size:[1,1,1],segments:[1,1,1],radius:0,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},$z=(r,t)=>{const e={...bn(r,Rt.Cone),materials:[{name:"default"}],radius:1,height:1,segments:[32,3],thetaLength:Math.PI*2,openEnded:!1,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},Jz=(r,t)=>{const e={...bn(r,Rt.Cylinder),materials:[{name:"default"}],radiusTop:1,radiusBottom:1,height:1,segments:[32,3],thetaLength:Math.PI*2,openEnded:!1,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},tV=(r,t)=>{const e={...bn(r,Rt.Sphere),materials:[{name:"default"}],radius:1,segments:[32,16],phiLength:Math.PI*2,thetaLength:Math.PI,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},$3=(r,t)=>{const e={...bn(r,Rt.Pipe),materials:[{name:"default"}],points:[],radius:.1,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},eV=(r,t)=>{const e={...bn(r,Rt.AmbientLight),color:"#ffffff",intensity:1,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},nV=(r,t)=>{const e={...bn(r,Rt.DirectionalLight),position:[4,6,3],color:"#ffffff",intensity:3,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},iV=(r,t)=>{const e={...bn(r,Rt.HemisphereLight),position:[0,10,0],color:"#ffffff",groundColor:"#404040",intensity:3,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},sV=(r,t)=>{const e={...bn(r,Rt.SpotLight),position:[0,5,0],rotation:[90,0,0],distance:10,angle:30,penumbra:0,decay:2,color:"#ffffff",intensity:10,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},rV=(r,t)=>{const e={...bn(r,Rt.PointLight),position:[0,5,0],distance:10,decay:2,color:"#ffffff",intensity:10,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},oV=(r,t)=>{const e={...bn(r,Rt.OrthographicCamera),frustumSize:10,near:.01,far:1e4,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},aV=(r,t)=>{const e={...bn(r,Rt.PerspectiveCamera),fov:45,near:.01,far:1e4,...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},cV=(r,t)=>{const e={...bn(r,Rt.Group),...t},n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},lV=(r,t)=>{const e={...bn(r,Rt.Model),materials:[],modelCode:"",modelPath:"",...t};e.components.push({id:tM(),type:mi.Animator,name:"动画控制",enabled:!0}),e.name=`${e.name}-${e.id}`;const n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},hV=(r,t)=>{const e={...bn(r,Rt.Symbol),mode:"3d",symbolPath:"",symbolCode:"",...t};e.name=`${e.name}-${e.id}`;const n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},uV=(r,t)=>{const e={...bn(r,Rt.Text),size:[1,1],segments:[1,1],fontFamily:"Arial",fontSize:12,fontStyle:"normal",text:"文本",align:"center",fill:"#000",...t};e.name=`${e.name}-${e.id}`;const n=r.entityManager.createEntity(e);for(const i of e.components){const s=r.entityManager.createComponent(i,n);n.addComponent(s,n.components.length)}return n},J3=r=>{const t=r;return!!(t!=null&&t.code)&&!!(t!=null&&t.path)},tN={type:_s.Basic,color:"#ff0000",reflectivity:1,refractionRatio:.98,aoMapIntensity:1,lightMapIntensity:1,transparent:!1,opacity:1,depthTest:!0,depthWrite:!0,alphaTest:0,side:0,blending:1,map:{image:"",mapping:300,wrapS:1e3,wrapT:1e3,offset:[0,0],repeat:[1,1],rotation:0,center:[0,0],colorSpace:"srgb",flipY:!0},specularMap:{image:"",mapping:300,wrapS:1e3,wrapT:1e3,offset:[0,0],repeat:[1,1],rotation:0,center:[0,0],colorSpace:"srgb",flipY:!1},alphaMap:{image:"",mapping:300,wrapS:1e3,wrapT:1e3,offset:[0,0],repeat:[1,1],rotation:0,center:[0,0],colorSpace:"srgb-linear",flipY:!0},envMap:{image:"",mapping:300,wrapS:1e3,wrapT:1e3,offset:[0,0],repeat:[1,1],rotation:0,center:[0,0],colorSpace:"srgb-linear",flipY:!0},aoMap:{image:"",mapping:300,wrapS:1e3,wrapT:1e3,offset:[0,0],repeat:[1,1],rotation:0,center:[0,0],colorSpace:"srgb-linear",flipY:!1},lightMap:{image:"",mapping:300,wrapS:1e3,wrapT:1e3,offset:[0,0],repeat:[1,1],rotation:0,center:[0,0],colorSpace:"srgb-linear",flipY:!0}},eN=r=>{switch(r){case _s.Basic:return new en;case _s.Phong:return new Gr;case _s.Stand:return new lh;case _s.Shader:return new ws;default:throw new Error(`未知的材质类型: ${r}`)}},nN=r=>{const{type:t,value:e}=r;switch(t){case"number":return new Or(e);case"color":return new Or(new pt(e));case"vecto2":return new Or(new J(...e));case"vecto3":return new Or(new C(...e));case"texture":return new Or(e);default:throw new Error(`未知类型的Uniform: ${t}`)}};class iN{constructor(t){A(this,"core");A(this,"gltfLoader");A(this,"gltfExporter");A(this,"fbxLoader");A(this,"loaders");A(this,"loadings");A(this,"modelCache");this.core=t,this.gltfLoader=new xk,this.fbxLoader=new h3,this.gltfExporter=new BS,this.loaders=[],this.loadings={},this.modelCache=new Map,this.gltfLoader.setMeshoptDecoder(D3)}dispose(){this.modelCache.clear()}async getModel(t){var s;const e=`${t}`;if(this.modelCache.has(e))return this.modelCache.get(e);if(this.loadings[e]!=null)return new Promise(o=>{var a;(a=this.loadings[e])==null||a.push(o)});this.loadings[e]=[];const n=await CT(t),i=JSON.parse(n.content);return this.modelCache.set(e,i),(s=this.loadings[e])==null||s.forEach(o=>o(i)),delete this.loadings[e],i}async loadModel(t){const{name:e,file:n}=await zg(t.file);let i;try{switch(this.getModelType(e)){case Rr.OBJ:i=await this.loadObj(n,t.mtl);break;case Rr.GLTF:i=await this.loadGltf(n);break;case Rr.FBX:i=await this.loadFBX(n);break;default:i=this.createBox();break}}catch(s){console.error(s),i=this.createBox()}return i.name=q3(e),i}createBox(){const t=new Fn,e=new en({color:"red"});return new ct(t,e)}async loadGltf(t){const e=await this.gltfLoader.loadAsync(t),n=e.scene;return n.animations.push(...e.animations),n}getLoader(){return this.loaders.length?this.loaders.pop():new sN}async loadObj(t,e){const n=this.getLoader(),i=await n.loadAsync(t,e);return this.loaders.push(n),i}async loadFBX(t){return await this.fbxLoader.loadAsync(t)}getModelType(t){if(t.includes(".obj"))return Rr.OBJ;if(t.includes(".gltf"))return Rr.GLTF;if(t.includes(".glb"))return Rr.GLTF;if(t.includes(".fbx"))return Rr.FBX}}class sN{constructor(){A(this,"objLoader");A(this,"mtlLoader");this.objLoader=new R3,this.mtlLoader=new w3}async loadAsync(t,e){try{const{file:i}=await zg(e),s=await this.mtlLoader.loadAsync(i);s.preload(),this.objLoader.setMaterials(s)}catch{console.error(`加载材质文件出错:${e}`)}const n=await this.objLoader.loadAsync(t);return this.fixMaterials(n),n}fixMaterials(t){const e=B0(t);for(let n=0,i=e.length;n<i;n++){const s=e[n];s instanceof Gr&&(s.map&&(s.map.colorSpace=On,s.map.needsUpdate=!0),s.emissiveMap&&(s.emissiveMap.colorSpace=On,s.emissiveMap.needsUpdate=!0))}}}class Qo{constructor(t){A(this,"id");A(this,"core");A(this,"object3d");A(this,"selectable");A(this,"transformable");A(this,"parent");A(this,"children");A(this,"components");this.core=t,this.id=-1,this.object3d=new Bt,this.selectable=!0,this.transformable=!0,this.children=[],this.components=[]}get name(){return this.object3d.name}set name(t){this.object3d.name=t}get position(){return this.object3d.position}set position(t){this.object3d.position.copy(t)}get rotation(){return this.object3d.rotation}set rotation(t){this.object3d.rotation.copy(t)}get scale(){return this.object3d.scale}set scale(t){this.object3d.scale.copy(t)}get visible(){return this.object3d.visible}set visible(t){this.object3d.visible=t}getAttr(t){return this[t]}setAttr(t,e){if(!(t in this))return;const n=rr(this[t]),i=rr(e);this[t]=i,this.core.bus.emit("ENTITY_CHANGED",{entity:this,key:t,newValue:i,oldValue:n})}resize(){this.components.forEach(t=>t.resize())}start(){this.components.forEach(t=>t.awake())}update(t){for(let e=0,n=this.components.length;e<n;e++)this.components[e].update(t)}on(t,e){this.object3d.addEventListener(t,e)}off(t,e){this.object3d.removeEventListener(t,e)}add(t,e){var n;(n=t.parent)==null||n.remove(t),t.parent=this,qp.copy(this.object3d.matrixWorld).invert(),t.object3d.parent&&qp.multiply(t.object3d.parent.matrixWorld),t.object3d.applyMatrix4(qp),t.scale.x=fs(t.scale.x),t.scale.y=fs(t.scale.y),t.scale.z=fs(t.scale.z),this.children.splice(e,0,t),this.object3d.add(t.object3d)}remove(t){const e=this.children.indexOf(t);return e!==-1&&(delete t.parent,this.children.splice(e,1),this.object3d.remove(t.object3d),t.object3d.applyMatrix4(this.object3d.matrixWorld)),e}addComponent(t,e){t.entity=this,this.components.splice(e,0,t)}removeComponent(t){const e=this.components.indexOf(t);return e>=0&&this.components.splice(e,1),e}getComponent(t){let e=this.components.find(n=>n.name===t);return e||(e=this.components.find(n=>n.type===t),e)}dispose(){this.components.forEach(t=>t.destroy()),this.children.forEach(t=>t.dispose()),this.components=[],this.children=[]}deserialize(t){const{id:e,name:n,visible:i,selectable:s,transformable:o,position:a,rotation:c,scale:l}=t,[h,u,d]=a,[f,m,_]=c.map(Le.degToRad),[g,p,b]=l;this.id=e,this.name=n,this.visible=i,this.selectable=s,this.transformable=o,this.position.set(h,u,d),this.rotation.set(f,m,_),this.scale.set(g,p,b)}serialize(){const t=Le.RAD2DEG,e=this.children.map(h=>h.serialize()),n=this.components.map(h=>h.serialize()),{x:i,y:s,z:o}=this.rotation,a=this.position.toArray().map(h=>fs(h)),c=[i,s,o].map(h=>fs(h*t,1)),l=this.scale.toArray().map(h=>fs(h));return{id:this.id,name:this.name,type:this.type,visible:this.visible,selectable:this.selectable,transformable:this.transformable,position:a,rotation:c,scale:l,children:e,components:n}}copy(t){this.id=this.core.generateID(),this.name=t.name,this.visible=t.visible,this.selectable=t.selectable,this.transformable=t.transformable,this.position.copy(t.position),this.rotation.copy(t.rotation),this.scale.copy(t.scale);for(let e=0;e<t.children.length;e++){const i=t.children[e].clone();this.add(i,this.children.length)}for(let e=0;e<t.components.length;e++){const i=t.components[e].clone();i.id=tM(),this.addComponent(i,this.components.length)}return this}}class gh extends Qo{constructor(t){super(t)}get color(){return`#${this.object3d.color.getHexString()}`}set color(t){this.object3d.color.set(t)}get intensity(){return this.object3d.intensity}set intensity(t){this.object3d.intensity=t}deserialize(t){super.deserialize(t);const{color:e,intensity:n}=t;this.color=e,this.intensity=n}serialize(){const t=super.serialize(),{color:e,intensity:n}=this;return{...t,color:e,intensity:n}}copy(t){return super.copy(t),this.color=t.color,this.intensity=t.intensity,this}}class z0 extends gh{constructor(e){super(e);A(this,"type");A(this,"object3d");this.type=Rt.AmbientLight,this.object3d=new Mw}serialize(){return{...super.serialize()}}clone(){return new z0(this.core).copy(this)}}const rN=["color","specular","emissive"];class Gv{constructor(t,e){A(this,"entity");A(this,"data");A(this,"objects");A(this,"instance");this.entity=t,this.data=e,this.objects=[],this.createMaterial()}get material(){return this.data.material}set material(t){this.data.material=t}serialize(){return this.data}setAttr(t,e){const n=rr(this.material);this.material=e,this.entity.core.bus.emit("MATERIAL_CHANGED",{material:this,key:t,newValue:e,oldValue:n}),this.update(t)}update(t){if(!this.material){this.resetMaterial();return}if(t==="type"||t===""||!this.instance){this.instance&&wg(this.instance),this.createMaterial();return}const e=this.material;if(t.includes(".")){const[n,i]=t.split("."),s=e[n];this.setTexture(n,i,s)}else if(rN.includes(t))this.setColor(t,e[t]);else if(t==="normalScale"){const n=e[t];this.instance.normalScale.fromArray(n)}else t==="uniforms"?this.entity.core.materialManager.renderShaderMaterial(this.instance,this.material):this.instance[t]=e[t];this.instance.needsUpdate=!0}render(){this.instance&&this.applyMaterial(this.instance)}applyMaterial(t){for(let e=0;e<this.objects.length;e++){const n=this.objects[e],i=n.material;Array.isArray(i)?i.forEach((s,o)=>{s.name===t.name&&(i[o]=t)}):n.material=t}}resetMaterial(){const t=this.entity.getOldMaterial(this.data.name);t&&this.applyMaterial(t)}async createMaterial(){if(!this.data.material)return;let t;J3(this.data.material)?t=await this.getServerMaterial():t=this.data.material,this.instance=this.entity.core.materialManager.createMaterial(t),this.instance.name=this.data.name,this.render()}async getServerMaterial(){const t=this.data.material,e={code:t.code,path:t.path};try{const n=await Lx(e);return JSON.parse(n.data)}catch(n){return console.error(`获取服务器材质数据失败: ${n}`),rr(tN)}}setColor(t,e){if(!this.instance)return;this.instance[t].set(e)}async setTexture(t,e,n){if(this.instance)if(e==="image"){const i=await this.entity.core.materialManager.setTexture(n);this.instance[t]=i,this.instance.needsUpdate=!0}else{const i=this.instance[t],{mapping:s,wrapS:o,wrapT:a,offset:c,repeat:l,rotation:h,center:u,colorSpace:d,flipY:f}=n;i.mapping=s,i.wrapS=o,i.wrapT=a,i.rotation=Le.degToRad(h),i.flipY=f,i.colorSpace=d,i.offset.fromArray(c),i.repeat.fromArray(l),i.center.fromArray(u),i.needsUpdate=!0}}}class $o extends Qo{constructor(e){super(e);A(this,"materials");A(this,"olds");this.materials=[],this.olds=[]}getOldMaterial(e){return this.olds.find(n=>n.name===e)}deserialize(e){super.deserialize(e);for(let n=0;n<e.materials.length;n++){const i=e.materials[n],s=new Gv(this,i);this.materials.push(s)}this.render()}serialize(){const e=super.serialize(),n=this.materials.map(i=>i.serialize());return{...e,materials:n}}copy(e){super.copy(e);const n=e.materials.map(i=>i.serialize());for(const i of n){const s=new Gv(this,rr(i));this.materials.push(s)}return this.render(),this}async render(){N3(this.object3d);const e=I3(this.object3d,this.children.map(i=>i.object3d));e.forEach(i=>{i.traverse(s=>{s.castShadow=!0,s.receiveShadow=!0})});const n=k3(e);this.materials.forEach(i=>{i.objects=n.get(i.data.name)||[],i.render()}),this.core.bus.emit("ENTITY_RENDERED",{entity:this})}}const oN=["size","segments","radius"];class V0 extends $o{constructor(e){super(e);A(this,"type");A(this,"_size");A(this,"_segments");A(this,"radius");A(this,"mesh");this.type=Rt.Box,this._size=new C(1,1,1),this._segments=new C(1,1,1),this.radius=0,this.mesh=Gc(),this.olds=[this.mesh.material],this.object3d.add(this.mesh)}get size(){return this._size}set size(e){this._size.copy(e)}get segments(){return this._segments}set segments(e){this._segments.copy(e)}setAttr(e,n){super.setAttr(e,n),oN.includes(e)&&this.render()}deserialize(e){const{size:n=[],segments:i=[],radius:s=0}=e;this.size.fromArray(n),this.segments.fromArray(i),this.radius=s,super.deserialize(e)}serialize(){const e=super.serialize(),n=this.size.toArray(),i=this.segments.toArray();return{...e,size:n,segments:i,radius:this.radius}}clone(){return new V0(this.core).copy(this)}copy(e){const{size:n,segments:i,radius:s}=e;return this.size.copy(n),this.segments.copy(i),this.radius=s,super.copy(e),this}async render(){this.mesh.geometry.dispose(),this.mesh.geometry=V3(this.size,this.segments,this.radius),super.render()}}class uf extends Qo{constructor(t){super(t)}}class H0 extends uf{constructor(e){super(e);A(this,"type");A(this,"object3d");this.type=Rt.PerspectiveCamera,this.object3d=new rn}get fov(){return this.object3d.fov}set fov(e){this.object3d.fov=e,this.object3d.updateProjectionMatrix()}get near(){return this.object3d.near}set near(e){this.object3d.near=e,this.object3d.updateProjectionMatrix()}get far(){return this.object3d.far}set far(e){this.object3d.far=e,this.object3d.updateProjectionMatrix()}resize(){const{clientWidth:e,clientHeight:n}=this.core.container;this.object3d.aspect=e/n,this.object3d.updateProjectionMatrix(),super.resize()}deserialize(e){const{fov:n,near:i,far:s}=e;this.object3d.fov=n,this.object3d.near=i,this.object3d.far=s,this.resize(),super.deserialize(e)}serialize(){const e=super.serialize(),{fov:n,near:i,far:s}=this;return{...e,fov:n,near:i,far:s}}clone(){return new H0(this.core).copy(this)}copy(e){const{fov:n,near:i,far:s}=e;return this.object3d.fov=n,this.object3d.near=i,this.object3d.far=s,this.resize(),super.copy(e),this}}class G0 extends uf{constructor(e){super(e);A(this,"type");A(this,"object3d");A(this,"frustumSize");this.type=Rt.OrthographicCamera,this.object3d=new ch,this.frustumSize=10}get left(){return this.object3d.left}set left(e){this.object3d.left=e,this.object3d.updateProjectionMatrix()}get right(){return this.object3d.right}set right(e){this.object3d.right=e,this.object3d.updateProjectionMatrix()}get top(){return this.object3d.top}set top(e){this.object3d.top=e,this.object3d.updateProjectionMatrix()}get bottom(){return this.object3d.bottom}set bottom(e){this.object3d.bottom=e,this.object3d.updateProjectionMatrix()}get near(){return this.object3d.near}set near(e){this.object3d.near=e,this.object3d.updateProjectionMatrix()}get far(){return this.object3d.far}set far(e){this.object3d.far=e,this.object3d.updateProjectionMatrix()}setAttr(e,n){super.setAttr(e,n),e==="frustumSize"&&this.resize()}resize(){const{clientWidth:e,clientHeight:n}=this.core.container,i=e/n;this.object3d.left=-this.frustumSize*i*.5,this.object3d.right=this.frustumSize*i*.5,this.object3d.top=this.frustumSize*.5,this.object3d.bottom=-this.frustumSize*.5,this.object3d.updateProjectionMatrix(),super.resize()}deserialize(e){const{frustumSize:n,near:i,far:s}=e;this.object3d.near=i,this.object3d.far=s,this.frustumSize=n,this.resize(),super.deserialize(e)}serialize(){const e=super.serialize(),{frustumSize:n,near:i,far:s}=this;return{...e,frustumSize:n,near:i,far:s}}clone(){return new G0(this.core).copy(this)}copy(e){const{frustumSize:n,near:i,far:s}=e;return this.frustumSize=n,this.object3d.near=i,this.object3d.far=s,this.resize(),super.copy(e),this}}const aN=["radius","height","segments","thetaLength","openEnded"];class j0 extends $o{constructor(e){super(e);A(this,"type");A(this,"radius");A(this,"height");A(this,"openEnded");A(this,"thetaLength");A(this,"_segments");A(this,"mesh");this.type=Rt.Cone,this.radius=1,this.height=1,this.thetaLength=Math.PI*2,this._segments=new J(1,1),this.openEnded=!1,this.mesh=Gc(),this.olds=[this.mesh.material],this.object3d.add(this.mesh)}get segments(){return this._segments}set segments(e){this._segments.copy(e)}setAttr(e,n){super.setAttr(e,n),aN.includes(e)&&this.render()}deserialize(e){const{radius:n,height:i,segments:s,openEnded:o,thetaLength:a}=e;this.radius=n,this.height=i,this.openEnded=o,this.thetaLength=a,this.segments.fromArray(s),super.deserialize(e)}serialize(){const e=super.serialize(),{radius:n,height:i,openEnded:s,thetaLength:o}=this,a=this.segments.toArray();return{...e,radius:n,height:i,segments:a,thetaLength:o,openEnded:s}}clone(){return new j0(this.core).copy(this)}copy(e){const{radius:n,height:i,segments:s,thetaLength:o,openEnded:a}=e;return this.radius=n,this.height=i,this.openEnded=a,this.thetaLength=o,this.segments.copy(s),super.copy(e),this}async render(){const{radius:e,height:n,openEnded:i,segments:s,thetaLength:o}=this;this.mesh.geometry.dispose(),this.mesh.geometry=G3(e,n,i,o,s),super.render()}}const cN=["radiusTop","radiusBottom","height","segments","thetaLength","openEnded"];class W0 extends $o{constructor(e){super(e);A(this,"type");A(this,"radiusTop");A(this,"radiusBottom");A(this,"height");A(this,"openEnded");A(this,"thetaLength");A(this,"_segments");A(this,"mesh");this.type=Rt.Cylinder,this.radiusTop=1,this.radiusBottom=1,this.height=1,this.openEnded=!1,this.thetaLength=Math.PI*2,this._segments=new J(1,1),this.mesh=Gc(),this.olds=[this.mesh.material],this.object3d.add(this.mesh)}get segments(){return this._segments}set segments(e){this._segments.copy(e)}setAttr(e,n){super.setAttr(e,n),cN.includes(e)&&this.render()}deserialize(e){const{radiusTop:n,radiusBottom:i,height:s,segments:o,thetaLength:a,openEnded:c}=e;this.radiusTop=n,this.radiusBottom=i,this.height=s,this.openEnded=c,this.thetaLength=a,this.segments.fromArray(o),super.deserialize(e)}serialize(){const e=super.serialize(),{radiusTop:n,radiusBottom:i,height:s,openEnded:o,thetaLength:a}=this,c=this.segments.toArray();return{...e,radiusTop:n,radiusBottom:i,height:s,segments:c,thetaLength:a,openEnded:o}}clone(){return new W0(this.core).copy(this)}copy(e){const{radiusTop:n,radiusBottom:i,height:s,segments:o,thetaLength:a,openEnded:c}=e;return this.radiusTop=n,this.radiusBottom=i,this.height=s,this.openEnded=c,this.thetaLength=a,this.segments.copy(o),super.copy(e),this}async render(){const{radiusTop:e,radiusBottom:n,height:i,openEnded:s,segments:o,thetaLength:a}=this;this.mesh.geometry.dispose(),this.mesh.geometry=j3(e,n,i,s,a,o),super.render()}}class X0 extends gh{constructor(e){super(e);A(this,"type");A(this,"object3d");this.type=Rt.DirectionalLight,this.object3d=new h0,this.object3d.castShadow=!1,this.object3d.shadow.camera.top=10,this.object3d.shadow.camera.bottom=-10,this.object3d.shadow.camera.left=-10,this.object3d.shadow.camera.right=10,this.object3d.shadow.camera.near=1,this.object3d.shadow.camera.far=50,this.object3d.shadow.bias=-.001,this.object3d.shadow.mapSize.width=1024,this.object3d.shadow.mapSize.height=1024}serialize(){return{...super.serialize()}}clone(){return new X0(this.core).copy(this)}}class Y0 extends Qo{constructor(e){super(e);A(this,"type");A(this,"object3d");this.type=Rt.Group,this.object3d=new Li}deserialize(e){super.deserialize(e)}serialize(){return super.serialize()}clone(){return new Y0(this.core).copy(this)}copy(e){return super.copy(e),this}}class q0 extends gh{constructor(e){super(e);A(this,"type");A(this,"object3d");this.type=Rt.HemisphereLight,this.object3d=new AD}get groundColor(){return`#${this.object3d.groundColor.getHexString()}`}set groundColor(e){this.object3d.groundColor.set(e)}deserialize(e){super.deserialize(e);const{groundColor:n}=e;this.groundColor=n}serialize(){const e=super.serialize(),{groundColor:n}=this;return{...e,groundColor:n}}clone(){return new q0(this.core).copy(this)}copy(e){return super.copy(e),this.groundColor=e.groundColor,this}}class df extends $o{constructor(e){super(e);A(this,"type");A(this,"modelCode");A(this,"modelPath");A(this,"rendered");A(this,"model");this.type=Rt.Model,this.modelCode="",this.modelPath="",this.rendered=!1}async deserialize(e){this.modelCode=e.modelCode,this.modelPath=e.modelPath,super.deserialize(e)}serialize(){const e=super.serialize(),{modelPath:n,modelCode:i}=this;return{...e,modelPath:n,modelCode:i}}clone(){return new df(this.core).copy(this)}copy(e){return this.modelPath=e.modelPath,this.modelCode=e.modelCode,super.copy(e),this}async render(){this.rendered=!1,this.model&&(this.object3d.remove(this.model),O3(this.model));const{modelManager:e}=this.core;try{const n=await e.getModel(this.modelCode);this.model=await e.loadModel(n)}catch(n){console.error(n),this.model=e.createBox()}this.olds=F3(this.model),this.object3d.add(this.model),this.components.forEach(n=>n.rendered()),sg(this.model,this.core.render.scene),this.rendered=!0,super.render()}}const lN=["points","radius"];class K0 extends $o{constructor(e){super(e);A(this,"type");A(this,"points");A(this,"radius");A(this,"mesh");this.type=Rt.Pipe,this.points=[],this.radius=1,this.mesh=Gc(),this.olds=[this.mesh.material],this.object3d.add(this.mesh)}setAttr(e,n){super.setAttr(e,n),lN.includes(e)&&this.render()}deserialize(e){const{points:n,radius:i}=e;this.points=n,this.radius=i,super.deserialize(e)}serialize(){const e=super.serialize(),{radius:n}=this,i=this.points.map(s=>({...s,point:s.point.map(fs),before:s.before.map(fs),after:s.after.map(fs)}));return{...e,points:i,radius:n}}clone(){return new K0(this.core).copy(this)}copy(e){const{points:n,radius:i}=e;return this.points=n,this.radius=i,super.copy(e),this}async render(){const{points:e,radius:n}=this;this.mesh.geometry.dispose(),this.mesh.geometry=W3(e,n),super.render()}getPoint(e,n=new C){return this.mesh.geometry.parameters.path.getPoint(e,n),this.object3d.localToWorld(n)}getTangent(e,n=new C){return this.mesh.geometry.parameters.path.getTangent(e,n)}}const hN=["size","segments"];class Z0 extends $o{constructor(e){super(e);A(this,"type");A(this,"_size");A(this,"_segments");A(this,"mesh");this.type=Rt.Plane,this._size=new J(1,1),this._segments=new J(1,1),this.mesh=Gc(),this.olds=[this.mesh.material],this.object3d.add(this.mesh)}get size(){return this._size}set size(e){this._size.copy(e)}get segments(){return this._segments}set segments(e){this._segments.copy(e)}setAttr(e,n){super.setAttr(e,n),hN.includes(e)&&this.render()}deserialize(e){const{size:n=[],segments:i=[]}=e;this.size.fromArray(n),this.segments.fromArray(i),super.deserialize(e)}serialize(){const e=super.serialize(),n=this.size.toArray(),i=this.segments.toArray();return{...e,size:n,segments:i}}clone(){return new Z0(this.core).copy(this)}copy(e){const{size:n,segments:i}=e;return this.size.copy(n||[]),this.segments.copy(i||[]),super.copy(e),this}async render(){this.mesh.geometry.dispose(),this.mesh.geometry=z3(this.size,this.segments),super.render()}}class io{constructor(t){A(this,"core");this.core=t}mount(){}active(){}deactive(){}unmount(){}resize(){}render(t){}afterRender(t){}afterDeserialize(t){}afterSerialize(t){}}const uN=new dr,dN=new en({color:"red",depthWrite:!1,depthTest:!1});class fN extends Bt{constructor(e){super();A(this,"entity");A(this,"helper");A(this,"point");A(this,"distance");this.entity=e,this.distance=0,this.helper=new ZD(this.entity.object3d),this.point=new ct(uN,dN),this.point.scale.set(.2,.2,.2),this.point.visible=!1,this.visible=!1,this.add(this.helper,this.point)}select(){this.visible=this.entity.visible}deselect(){this.visible=!1}update(){this.visible&&(this.helper.update(),this.point.visible&&(this.entity.object3d.getWorldDirection(qs),this.entity.object3d.getWorldPosition(this.point.position),qs.multiplyScalar(this.distance),this.point.position.add(qs)))}}class pN extends Bt{constructor(e){super();A(this,"entity");A(this,"helper");this.entity=e,this.helper=new KD(this.entity.object3d),this.add(this.helper)}select(){}deselect(){}update(){this.helper.update()}}class mN extends Bt{constructor(e){super();A(this,"entity");A(this,"helper");this.entity=e,this.helper=new qD(this.entity.object3d,1),this.add(this.helper)}select(){}deselect(){}update(){this.helper.update()}}class gN extends Bt{constructor(e){super();A(this,"entity");A(this,"helper");this.entity=e,this.helper=new WD(this.entity.object3d),this.add(this.helper)}select(){}deselect(){}update(){this.helper.update()}}class _N extends Bt{constructor(e){super();A(this,"entity");A(this,"helper");this.entity=e,this.helper=new XD(this.entity.object3d),this.add(this.helper)}select(){}deselect(){}update(){this.helper.update()}}function bN(r,t){return r[13]=1,r[14]=t>>8,r[15]=t&255,r[16]=t>>8,r[17]=t&255,r}const nM=112,iM=72,sM=89,rM=115;let Kp;function yN(){const r=new Int32Array(256);for(let t=0;t<256;t++){let e=t;for(let n=0;n<8;n++)e=e&1?3988292384^e>>>1:e>>>1;r[t]=e}return r}function vN(r){let t=-1;Kp||(Kp=yN());for(let e=0;e<r.length;e++)t=Kp[(t^r[e])&255]^t>>>8;return t^-1}function xN(r){const t=r.length-1;for(let e=t;e>=4;e--)if(r[e-4]===9&&r[e-3]===nM&&r[e-2]===iM&&r[e-1]===sM&&r[e]===rM)return e-3;return 0}function wN(r,t,e=!1){const n=new Uint8Array(13);t*=39.3701,n[0]=nM,n[1]=iM,n[2]=sM,n[3]=rM,n[4]=t>>>24,n[5]=t>>>16,n[6]=t>>>8,n[7]=t&255,n[8]=n[4],n[9]=n[5],n[10]=n[6],n[11]=n[7],n[12]=1;const i=vN(n),s=new Uint8Array(4);if(s[0]=i>>>24,s[1]=i>>>16,s[2]=i>>>8,s[3]=i&255,e){const o=xN(r);return r.set(n,o),r.set(s,o+13),r}else{const o=new Uint8Array(4);o[0]=0,o[1]=0,o[2]=0,o[3]=9;const a=new Uint8Array(54);return a.set(r,0),a.set(o,33),a.set(n,37),a.set(s,50),a}}const SN="AAlwSFlz",MN="AAAJcEhZ",TN="AAAACXBI";function EN(r){let t=r.indexOf(SN);return t===-1&&(t=r.indexOf(MN)),t===-1&&(t=r.indexOf(TN)),t}const oM="[modern-screenshot]",Zr=typeof window<"u",AN=Zr&&"Worker"in window,CN=Zr&&"atob"in window,PN=Zr&&"btoa"in window;var Rx;const Q0=Zr?(Rx=window.navigator)==null?void 0:Rx.userAgent:"",aM=Q0.includes("Chrome"),Id=Q0.includes("AppleWebKit")&&!aM,$0=Q0.includes("Firefox"),RN=r=>r&&"__CONTEXT__"in r,DN=r=>r.constructor.name==="CSSFontFaceRule",LN=r=>r.constructor.name==="CSSImportRule",Ts=r=>r.nodeType===1,_h=r=>typeof r.className=="object",cM=r=>r.tagName==="image",IN=r=>r.tagName==="use",Ql=r=>Ts(r)&&typeof r.style<"u"&&!_h(r),ON=r=>r.nodeType===8,FN=r=>r.nodeType===3,Mc=r=>r.tagName==="IMG",ff=r=>r.tagName==="VIDEO",kN=r=>r.tagName==="CANVAS",NN=r=>r.tagName==="TEXTAREA",UN=r=>r.tagName==="INPUT",BN=r=>r.tagName==="STYLE",zN=r=>r.tagName==="SCRIPT",VN=r=>r.tagName==="SELECT",HN=r=>r.tagName==="SLOT",GN=r=>r.tagName==="IFRAME",jN=(...r)=>console.warn(oM,...r);function WN(r){var e;const t=(e=r==null?void 0:r.createElement)==null?void 0:e.call(r,"canvas");return t&&(t.height=t.width=1),!!t&&"toDataURL"in t&&!!t.toDataURL("image/webp").includes("image/webp")}const Sg=r=>r.startsWith("data:");function lM(r,t){if(r.match(/^[a-z]+:\/\//i))return r;if(Zr&&r.match(/^\/\//))return window.location.protocol+r;if(r.match(/^[a-z]+:/i)||!Zr)return r;const e=pf().implementation.createHTMLDocument(),n=e.createElement("base"),i=e.createElement("a");return e.head.appendChild(n),e.body.appendChild(i),t&&(n.href=t),i.href=r,i.href}function pf(r){return(r&&Ts(r)?r==null?void 0:r.ownerDocument:r)??window.document}const mf="http://www.w3.org/2000/svg";function XN(r,t,e){const n=pf(e).createElementNS(mf,"svg");return n.setAttributeNS(null,"width",r.toString()),n.setAttributeNS(null,"height",t.toString()),n.setAttributeNS(null,"viewBox",`0 0 ${r} ${t}`),n}function YN(r,t){let e=new XMLSerializer().serializeToString(r);return t&&(e=e.replace(/[\u0000-\u0008\v\f\u000E-\u001F\uD800-\uDFFF\uFFFE\uFFFF]/gu,"")),`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`}function qN(r,t){return new Promise((e,n)=>{const i=new FileReader;i.onload=()=>e(i.result),i.onerror=()=>n(i.error),i.onabort=()=>n(new Error(`Failed read blob to ${t}`)),i.readAsDataURL(r)})}const KN=r=>qN(r,"dataUrl");function ac(r,t){const e=pf(t).createElement("img");return e.decoding="sync",e.loading="eager",e.src=r,e}function $l(r,t){return new Promise(e=>{const{timeout:n,ownerDocument:i,onError:s,onWarn:o}=t??{},a=typeof r=="string"?ac(r,pf(i)):r;let c=null,l=null;function h(){e(a),c&&clearTimeout(c),l==null||l()}if(n&&(c=setTimeout(h,n)),ff(a)){const u=a.currentSrc||a.src;if(!u)return a.poster?$l(a.poster,t).then(e):h();if(a.readyState>=2)return h();const d=h,f=m=>{o==null||o("Failed video load",u,m),s==null||s(m),h()};l=()=>{a.removeEventListener("loadeddata",d),a.removeEventListener("error",f)},a.addEventListener("loadeddata",d,{once:!0}),a.addEventListener("error",f,{once:!0})}else{const u=cM(a)?a.href.baseVal:a.currentSrc||a.src;if(!u)return h();const d=async()=>{if(Mc(a)&&"decode"in a)try{await a.decode()}catch(m){o==null||o("Failed to decode image, trying to render anyway",a.dataset.originalSrc||u,m)}h()},f=m=>{o==null||o("Failed image load",a.dataset.originalSrc||u,m),h()};if(Mc(a)&&a.complete)return d();l=()=>{a.removeEventListener("load",d),a.removeEventListener("error",f)},a.addEventListener("load",d,{once:!0}),a.addEventListener("error",f,{once:!0})}})}async function ZN(r,t){Ql(r)&&(Mc(r)||ff(r)?await $l(r,t):await Promise.all(["img","video"].flatMap(e=>Array.from(r.querySelectorAll(e)).map(n=>$l(n,t)))))}const hM=function(){let t=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${e()}${t}`)}();function uM(r){return r==null?void 0:r.split(",").map(t=>t.trim().replace(/"|'/g,"").toLowerCase()).filter(Boolean)}let jv=0;function QN(r){const t=`${oM}[#${jv}]`;return jv++,{time:e=>r&&console.time(`${t} ${e}`),timeEnd:e=>r&&console.timeEnd(`${t} ${e}`),warn:(...e)=>r&&jN(...e)}}function $N(r){return{cache:r?"no-cache":"force-cache"}}async function gf(r,t){return RN(r)?r:JN(r,{...t,autoDestruct:!0})}async function JN(r,t){var f,m;const{scale:e=1,workerUrl:n,workerNumber:i=1}=t||{},s=!!(t!=null&&t.debug),o=(t==null?void 0:t.features)??!0,a=r.ownerDocument??(Zr?window.document:void 0),c=((f=r.ownerDocument)==null?void 0:f.defaultView)??(Zr?window:void 0),l=new Map,h={width:0,height:0,quality:1,type:"image/png",scale:e,backgroundColor:null,style:null,filter:null,maximumCanvasSize:0,timeout:3e4,progress:null,debug:s,fetch:{requestInit:$N((m=t==null?void 0:t.fetch)==null?void 0:m.bypassingCache),placeholderImage:"data:image/png;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",bypassingCache:!1,...t==null?void 0:t.fetch},fetchFn:null,font:{},drawImageInterval:100,workerUrl:null,workerNumber:i,onCloneNode:null,onEmbedNode:null,onCreateForeignObjectSvg:null,includeStyleProperties:null,autoDestruct:!1,...t,__CONTEXT__:!0,log:QN(s),node:r,ownerDocument:a,ownerWindow:c,dpi:e===1?null:96*e,svgStyleElement:dM(a),svgDefsElement:a==null?void 0:a.createElementNS(mf,"defs"),svgStyles:new Map,defaultComputedStyles:new Map,workers:[...Array.from({length:AN&&n&&i?i:0})].map(()=>{try{const _=new Worker(n);return _.onmessage=async g=>{var y,v,x,S;const{url:p,result:b}=g.data;b?(v=(y=l.get(p))==null?void 0:y.resolve)==null||v.call(y,b):(S=(x=l.get(p))==null?void 0:x.reject)==null||S.call(x,new Error(`Error receiving message from worker: ${p}`))},_.onmessageerror=g=>{var b,y;const{url:p}=g.data;(y=(b=l.get(p))==null?void 0:b.reject)==null||y.call(b,new Error(`Error receiving message from worker: ${p}`))},_}catch(_){return h.log.warn("Failed to new Worker",_),null}}).filter(Boolean),fontFamilies:new Map,fontCssTexts:new Map,acceptOfImage:`${[WN(a)&&"image/webp","image/svg+xml","image/*","*/*"].filter(Boolean).join(",")};q=0.8`,requests:l,drawImageCount:0,tasks:[],features:o,isEnable:_=>_==="restoreScrollPosition"?typeof o=="boolean"?!1:o[_]??!1:typeof o=="boolean"?o:o[_]??!0};h.log.time("wait until load"),await ZN(r,{timeout:h.timeout,onWarn:h.log.warn}),h.log.timeEnd("wait until load");const{width:u,height:d}=tU(r,h);return h.width=u,h.height=d,h}function dM(r){if(!r)return;const t=r.createElement("style"),e=t.ownerDocument.createTextNode(`
.______background-clip--text {
  background-clip: text;
  -webkit-background-clip: text;
}
`);return t.appendChild(e),t}function tU(r,t){let{width:e,height:n}=t;if(Ts(r)&&(!e||!n)){const i=r.getBoundingClientRect();e=e||i.width||Number(r.getAttribute("width"))||0,n=n||i.height||Number(r.getAttribute("height"))||0}return{width:e,height:n}}async function eU(r,t){const{log:e,timeout:n,drawImageCount:i,drawImageInterval:s}=t;e.time("image to canvas");const o=await $l(r,{timeout:n,onWarn:t.log.warn}),{canvas:a,context2d:c}=nU(r.ownerDocument,t),l=()=>{try{c==null||c.drawImage(o,0,0,a.width,a.height)}catch(h){t.log.warn("Failed to drawImage",h)}};if(l(),t.isEnable("fixSvgXmlDecode"))for(let h=0;h<i;h++)await new Promise(u=>{setTimeout(()=>{l(),u()},h+s)});return t.drawImageCount=0,e.timeEnd("image to canvas"),a}function nU(r,t){const{width:e,height:n,scale:i,backgroundColor:s,maximumCanvasSize:o}=t,a=r.createElement("canvas");a.width=Math.floor(e*i),a.height=Math.floor(n*i),a.style.width=`${e}px`,a.style.height=`${n}px`,o&&(a.width>o||a.height>o)&&(a.width>o&&a.height>o?a.width>a.height?(a.height*=o/a.width,a.width=o):(a.width*=o/a.height,a.height=o):a.width>o?(a.height*=o/a.width,a.width=o):(a.width*=o/a.height,a.height=o));const c=a.getContext("2d");return c&&s&&(c.fillStyle=s,c.fillRect(0,0,a.width,a.height)),{canvas:a,context2d:c}}function fM(r,t){if(r.ownerDocument)try{const s=r.toDataURL();if(s!=="data:,")return ac(s,r.ownerDocument)}catch(s){t.log.warn("Failed to clone canvas",s)}const e=r.cloneNode(!1),n=r.getContext("2d"),i=e.getContext("2d");try{return n&&i&&i.putImageData(n.getImageData(0,0,r.width,r.height),0,0),e}catch(s){t.log.warn("Failed to clone canvas",s)}return e}function iU(r,t){var e;try{if((e=r==null?void 0:r.contentDocument)!=null&&e.body)return J0(r.contentDocument.body,t)}catch(n){t.log.warn("Failed to clone iframe",n)}return r.cloneNode(!1)}function sU(r){const t=r.cloneNode(!1);return r.currentSrc&&r.currentSrc!==r.src&&(t.src=r.currentSrc,t.srcset=""),t.loading==="lazy"&&(t.loading="eager"),t}async function rU(r,t){if(r.ownerDocument&&!r.currentSrc&&r.poster)return ac(r.poster,r.ownerDocument);const e=r.cloneNode(!1);e.crossOrigin="anonymous",r.currentSrc&&r.currentSrc!==r.src&&(e.src=r.currentSrc);const n=e.ownerDocument;if(n){let i=!0;if(await $l(e,{onError:()=>i=!1,onWarn:t.log.warn}),!i)return r.poster?ac(r.poster,r.ownerDocument):e;e.currentTime=r.currentTime,await new Promise(o=>{e.addEventListener("seeked",o,{once:!0})});const s=n.createElement("canvas");s.width=r.offsetWidth,s.height=r.offsetHeight;try{const o=s.getContext("2d");o&&o.drawImage(e,0,0,s.width,s.height)}catch(o){return t.log.warn("Failed to clone video",o),r.poster?ac(r.poster,r.ownerDocument):e}return fM(s,t)}return e}function oU(r,t){return kN(r)?fM(r,t):GN(r)?iU(r,t):Mc(r)?sU(r):ff(r)?rU(r,t):r.cloneNode(!1)}function aU(r){var e;let t=r.sandbox;if(!t){const{ownerDocument:n}=r;try{n&&(t=n.createElement("iframe"),t.id=`__SANDBOX__-${hM()}`,t.width="0",t.height="0",t.style.visibility="hidden",t.style.position="fixed",n.body.appendChild(t),(e=t.contentWindow)==null||e.document.write('<!DOCTYPE html><meta charset="UTF-8"><title></title><body>'),r.sandbox=t)}catch(i){r.log.warn("Failed to getSandBox",i)}}return t}const cU=["width","height","-webkit-text-fill-color"],lU=["stroke","fill"];function pM(r,t,e){const{defaultComputedStyles:n}=e,i=r.nodeName.toLowerCase(),s=_h(r)&&i!=="svg",o=s?lU.map(_=>[_,r.getAttribute(_)]).filter(([,_])=>_!==null):[],a=[s&&"svg",i,o.map((_,g)=>`${_}=${g}`).join(","),t].filter(Boolean).join(":");if(n.has(a))return n.get(a);const c=aU(e),l=c==null?void 0:c.contentWindow;if(!l)return new Map;const h=l==null?void 0:l.document;let u,d;s?(u=h.createElementNS(mf,"svg"),d=u.ownerDocument.createElementNS(u.namespaceURI,i),o.forEach(([_,g])=>{d.setAttributeNS(null,_,g)}),u.appendChild(d)):u=d=h.createElement(i),d.textContent=" ",h.body.appendChild(u);const f=l.getComputedStyle(d,t),m=new Map;for(let _=f.length,g=0;g<_;g++){const p=f.item(g);cU.includes(p)||m.set(p,f.getPropertyValue(p))}return h.body.removeChild(u),n.set(a,m),m}function mM(r,t,e){var a;const n=new Map,i=[],s=new Map;if(e)for(const c of e)o(c);else for(let c=r.length,l=0;l<c;l++){const h=r.item(l);o(h)}for(let c=i.length,l=0;l<c;l++)(a=s.get(i[l]))==null||a.forEach((h,u)=>n.set(u,h));function o(c){const l=r.getPropertyValue(c),h=r.getPropertyPriority(c),u=c.lastIndexOf("-"),d=u>-1?c.substring(0,u):void 0;if(d){let f=s.get(d);f||(f=new Map,s.set(d,f)),f.set(c,[l,h])}t.get(c)===l&&!h||(d?i.push(d):n.set(c,[l,h]))}return n}function hU(r,t,e,n){var u,d,f,m;const{ownerWindow:i,includeStyleProperties:s,currentParentNodeStyle:o}=n,a=t.style,c=i.getComputedStyle(r),l=pM(r,null,n);o==null||o.forEach((_,g)=>{l.delete(g)});const h=mM(c,l,s);h.delete("transition-property"),h.delete("all"),h.delete("d"),h.delete("content"),e&&(h.delete("margin-top"),h.delete("margin-right"),h.delete("margin-bottom"),h.delete("margin-left"),h.delete("margin-block-start"),h.delete("margin-block-end"),h.delete("margin-inline-start"),h.delete("margin-inline-end"),h.set("box-sizing",["border-box",""])),((u=h.get("background-clip"))==null?void 0:u[0])==="text"&&t.classList.add("______background-clip--text"),aM&&(h.has("font-kerning")||h.set("font-kerning",["normal",""]),(((d=h.get("overflow-x"))==null?void 0:d[0])==="hidden"||((f=h.get("overflow-y"))==null?void 0:f[0])==="hidden")&&((m=h.get("text-overflow"))==null?void 0:m[0])==="ellipsis"&&r.scrollWidth===r.clientWidth&&h.set("text-overflow",["clip",""]));for(let _=a.length,g=0;g<_;g++)a.removeProperty(a.item(g));return h.forEach(([_,g],p)=>{a.setProperty(p,_,g)}),h}function uU(r,t){(NN(r)||UN(r)||VN(r))&&t.setAttribute("value",r.value)}const dU=[":before",":after"],fU=[":-webkit-scrollbar",":-webkit-scrollbar-button",":-webkit-scrollbar-thumb",":-webkit-scrollbar-track",":-webkit-scrollbar-track-piece",":-webkit-scrollbar-corner",":-webkit-resizer"];function pU(r,t,e,n,i){const{ownerWindow:s,svgStyleElement:o,svgStyles:a,currentNodeStyle:c}=n;if(!o||!s)return;function l(h){var y;const u=s.getComputedStyle(r,h);let d=u.getPropertyValue("content");if(!d||d==="none")return;i==null||i(d),d=d.replace(/(')|(")|(counter\(.+\))/g,"");const f=[hM()],m=pM(r,h,n);c==null||c.forEach((v,x)=>{m.delete(x)});const _=mM(u,m,n.includeStyleProperties);_.delete("content"),_.delete("-webkit-locale"),((y=_.get("background-clip"))==null?void 0:y[0])==="text"&&t.classList.add("______background-clip--text");const g=[`content: '${d}';`];if(_.forEach(([v,x],S)=>{g.push(`${S}: ${v}${x?" !important":""};`)}),g.length===1)return;try{t.className=[t.className,...f].join(" ")}catch(v){n.log.warn("Failed to copyPseudoClass",v);return}const p=g.join(`
  `);let b=a.get(p);b||(b=[],a.set(p,b)),b.push(`.${f[0]}:${h}`)}dU.forEach(l),e&&fU.forEach(l)}const Wv=new Set(["symbol"]);async function Xv(r,t,e,n,i){if(Ts(e)&&(BN(e)||zN(e))||n.filter&&!n.filter(e))return;Wv.has(t.nodeName)||Wv.has(e.nodeName)?n.currentParentNodeStyle=void 0:n.currentParentNodeStyle=n.currentNodeStyle;const s=await J0(e,n,!1,i);n.isEnable("restoreScrollPosition")&&mU(r,s),t.appendChild(s)}async function Yv(r,t,e,n){var s;const i=(Ts(r)?(s=r.shadowRoot)==null?void 0:s.firstChild:void 0)??r.firstChild;for(let o=i;o;o=o.nextSibling)if(!ON(o))if(Ts(o)&&HN(o)&&typeof o.assignedNodes=="function"){const a=o.assignedNodes();for(let c=0;c<a.length;c++)await Xv(r,t,a[c],e,n)}else await Xv(r,t,o,e,n)}function mU(r,t){if(!Ql(r)||!Ql(t))return;const{scrollTop:e,scrollLeft:n}=r;if(!e&&!n)return;const{transform:i}=t.style,s=new DOMMatrix(i),{a:o,b:a,c,d:l}=s;s.a=1,s.b=0,s.c=0,s.d=1,s.translateSelf(-n,-e),s.a=o,s.b=a,s.c=c,s.d=l,t.style.transform=s.toString()}function gU(r,t){const{backgroundColor:e,width:n,height:i,style:s}=t,o=r.style;if(e&&o.setProperty("background-color",e,"important"),n&&o.setProperty("width",`${n}px`,"important"),i&&o.setProperty("height",`${i}px`,"important"),s)for(const a in s)o[a]=s[a]}const _U=/^[\w-:]+$/;async function J0(r,t,e=!1,n){var c,l,h,u;const{ownerDocument:i,ownerWindow:s,fontFamilies:o}=t;if(i&&FN(r))return n&&/\S/.test(r.data)&&n(r.data),i.createTextNode(r.data);if(i&&s&&Ts(r)&&(Ql(r)||_h(r))){const d=await oU(r,t);if(t.isEnable("removeAbnormalAttributes")){const b=d.getAttributeNames();for(let y=b.length,v=0;v<y;v++){const x=b[v];_U.test(x)||d.removeAttribute(x)}}const f=t.currentNodeStyle=hU(r,d,e,t);e&&gU(d,t);let m=!1;if(t.isEnable("copyScrollbar")){const b=[(c=f.get("overflow-x"))==null?void 0:c[0],(l=f.get("overflow-y"))==null?void 0:l[0]];m=b.includes("scroll")||(b.includes("auto")||b.includes("overlay"))&&(r.scrollHeight>r.clientHeight||r.scrollWidth>r.clientWidth)}const _=(h=f.get("text-transform"))==null?void 0:h[0],g=uM((u=f.get("font-family"))==null?void 0:u[0]),p=g?b=>{_==="uppercase"?b=b.toUpperCase():_==="lowercase"?b=b.toLowerCase():_==="capitalize"&&(b=b[0].toUpperCase()+b.substring(1)),g.forEach(y=>{let v=o.get(y);v||o.set(y,v=new Set),b.split("").forEach(x=>v.add(x))})}:void 0;return pU(r,d,m,t,p),uU(r,d),ff(r)||await Yv(r,d,t,p),d}const a=r.cloneNode(!1);return await Yv(r,a,t),a}function bU(r){if(r.ownerDocument=void 0,r.ownerWindow=void 0,r.svgStyleElement=void 0,r.svgDefsElement=void 0,r.svgStyles.clear(),r.defaultComputedStyles.clear(),r.sandbox){try{r.sandbox.remove()}catch(t){r.log.warn("Failed to destroyContext",t)}r.sandbox=void 0}r.workers=[],r.fontFamilies.clear(),r.fontCssTexts.clear(),r.requests.clear(),r.tasks=[]}function yU(r){const{url:t,timeout:e,responseType:n,...i}=r,s=new AbortController,o=e?setTimeout(()=>s.abort(),e):void 0;return fetch(t,{signal:s.signal,...i}).then(a=>{if(!a.ok)throw new Error("Failed fetch, not 2xx response",{cause:a});switch(n){case"arrayBuffer":return a.arrayBuffer();case"dataUrl":return a.blob().then(KN);case"text":default:return a.text()}}).finally(()=>clearTimeout(o))}function Jl(r,t){const{url:e,requestType:n="text",responseType:i="text",imageDom:s}=t;let o=e;const{timeout:a,acceptOfImage:c,requests:l,fetchFn:h,fetch:{requestInit:u,bypassingCache:d,placeholderImage:f},font:m,workers:_,fontFamilies:g}=r;n==="image"&&(Id||$0)&&r.drawImageCount++;let p=l.get(e);if(!p){d&&d instanceof RegExp&&d.test(o)&&(o+=(/\?/.test(o)?"&":"?")+new Date().getTime());const b=n.startsWith("font")&&m&&m.minify,y=new Set;b&&n.split(";")[1].split(",").forEach(T=>{g.has(T)&&g.get(T).forEach(E=>y.add(E))});const v=b&&y.size,x={url:o,timeout:a,responseType:v?"arrayBuffer":i,headers:n==="image"?{accept:c}:void 0,...u};p={type:n,resolve:void 0,reject:void 0,response:null},p.response=(async()=>{if(h&&n==="image"){const S=await h(e);if(S)return S}return!Id&&e.startsWith("http")&&_.length?new Promise((S,T)=>{_[l.size&_.length-1].postMessage({rawUrl:e,...x}),p.resolve=S,p.reject=T}):yU(x)})().catch(S=>{if(l.delete(e),n==="image"&&f)return r.log.warn("Failed to fetch image base64, trying to use placeholder image",o),typeof f=="string"?f:f(s);throw S}),l.set(e,p)}return p.response}async function gM(r,t,e,n){if(!_M(r))return r;for(const[i,s]of vU(r,t))try{const o=await Jl(e,{url:s,requestType:n?"image":"text",responseType:"dataUrl"});r=r.replace(xU(i),`$1${o}$3`)}catch(o){e.log.warn("Failed to fetch css data url",i,o)}return r}function _M(r){return/url\((['"]?)([^'"]+?)\1\)/.test(r)}const bM=/url\((['"]?)([^'"]+?)\1\)/g;function vU(r,t){const e=[];return r.replace(bM,(n,i,s)=>(e.push([s,lM(s,t)]),n)),e.filter(([n])=>!Sg(n))}function xU(r){const t=r.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}const wU=["background-image","border-image-source","-webkit-border-image","-webkit-mask-image","list-style-image"];function SU(r,t){return wU.map(e=>{const n=r.getPropertyValue(e);return!n||n==="none"?null:((Id||$0)&&t.drawImageCount++,gM(n,null,t,!0).then(i=>{!i||n===i||r.setProperty(e,i,r.getPropertyPriority(e))}))}).filter(Boolean)}function MU(r,t){if(Mc(r)){const e=r.currentSrc||r.src;if(!Sg(e))return[Jl(t,{url:e,imageDom:r,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(r.srcset="",r.dataset.originalSrc=e,r.src=n||"")})];(Id||$0)&&t.drawImageCount++}else if(_h(r)&&!Sg(r.href.baseVal)){const e=r.href.baseVal;return[Jl(t,{url:e,imageDom:r,requestType:"image",responseType:"dataUrl"}).then(n=>{n&&(r.dataset.originalSrc=e,r.href.baseVal=n||"")})]}return[]}function TU(r,t){const{ownerDocument:e,svgDefsElement:n}=t,i=r.getAttribute("href")??r.getAttribute("xlink:href");if(!i)return[];const[s,o]=i.split("#");if(o){const a=`#${o}`,c=e==null?void 0:e.querySelector(`svg ${a}`);if(s&&r.setAttribute("href",a),n!=null&&n.querySelector(a))return[];if(c)return n==null||n.appendChild(c.cloneNode(!0)),[];if(s)return[Jl(t,{url:s,responseType:"text"}).then(l=>{n==null||n.insertAdjacentHTML("beforeend",l)})]}return[]}function yM(r,t){const{tasks:e}=t;Ts(r)&&((Mc(r)||cM(r))&&e.push(...MU(r,t)),IN(r)&&e.push(...TU(r,t))),Ql(r)&&e.push(...SU(r.style,t)),r.childNodes.forEach(n=>{yM(n,t)})}async function EU(r,t){const{ownerDocument:e,svgStyleElement:n,fontFamilies:i,fontCssTexts:s,tasks:o,font:a}=t;if(!(!e||!n||!i.size))if(a&&a.cssText){const c=Kv(a.cssText,t);n.appendChild(e.createTextNode(`${c}
`))}else{const c=Array.from(e.styleSheets).filter(h=>{try{return"cssRules"in h&&!!h.cssRules.length}catch(u){return t.log.warn(`Error while reading CSS rules from ${h.href}`,u),!1}});await Promise.all(c.flatMap(h=>Array.from(h.cssRules).map(async(u,d)=>{if(LN(u)){let f=d+1;const m=u.href;let _="";try{_=await Jl(t,{url:m,requestType:"text",responseType:"text"})}catch(p){t.log.warn(`Error fetch remote css import from ${m}`,p)}const g=_.replace(bM,(p,b,y)=>p.replace(y,lM(y,m)));for(const p of CU(g))try{h.insertRule(p,p.startsWith("@import")?f+=1:h.cssRules.length)}catch(b){t.log.warn("Error inserting rule from remote css import",{rule:p,error:b})}}}))),c.flatMap(h=>Array.from(h.cssRules)).filter(h=>{var u;return DN(h)&&_M(h.style.getPropertyValue("src"))&&((u=uM(h.style.getPropertyValue("font-family")))==null?void 0:u.some(d=>i.has(d)))}).forEach(h=>{const u=h,d=s.get(u.cssText);d?n.appendChild(e.createTextNode(`${d}
`)):o.push(gM(u.cssText,u.parentStyleSheet?u.parentStyleSheet.href:null,t).then(f=>{f=Kv(f,t),s.set(u.cssText,f),n.appendChild(e.createTextNode(`${f}
`))}))})}}const AU=/(\/\*[\s\S]*?\*\/)/g,qv=/((@.*?keyframes [\s\S]*?){([\s\S]*?}\s*?)})/gi;function CU(r){if(r==null)return[];const t=[];let e=r.replace(AU,"");for(;;){const s=qv.exec(e);if(!s)break;t.push(s[0])}e=e.replace(qv,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let s=n.exec(e);if(s)i.lastIndex=n.lastIndex;else if(s=i.exec(e),s)n.lastIndex=i.lastIndex;else break;t.push(s[0])}return t}const PU=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,RU=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Kv(r,t){const{font:e}=t,n=e?e==null?void 0:e.preferredFormat:void 0;return n?r.replace(RU,i=>{for(;;){const[s,,o]=PU.exec(i)||[];if(!o)return"";if(o===n)return`src: ${s};`}}):r}async function DU(r,t){const e=await gf(r,t);if(Ts(e.node)&&_h(e.node))return e.node;const{ownerDocument:n,log:i,tasks:s,svgStyleElement:o,svgDefsElement:a,svgStyles:c,font:l,progress:h,autoDestruct:u,onCloneNode:d,onEmbedNode:f,onCreateForeignObjectSvg:m}=e;i.time("clone node");const _=await J0(e.node,e,!0);if(o&&n){let v="";c.forEach((x,S)=>{v+=`${x.join(`,
`)} {
  ${S}
}
`}),o.appendChild(n.createTextNode(v))}i.timeEnd("clone node"),await(d==null?void 0:d(_)),l!==!1&&Ts(_)&&(i.time("embed web font"),await EU(_,e),i.timeEnd("embed web font")),i.time("embed node"),yM(_,e);const g=s.length;let p=0;const b=async()=>{for(;;){const v=s.pop();if(!v)break;try{await v}catch(x){e.log.warn("Failed to run task",x)}h==null||h(++p,g)}};h==null||h(p,g),await Promise.all([...Array.from({length:4})].map(b)),i.timeEnd("embed node"),await(f==null?void 0:f(_));const y=LU(_,e);return a&&y.insertBefore(a,y.children[0]),o&&y.insertBefore(o,y.children[0]),u&&bU(e),await(m==null?void 0:m(y)),y}function LU(r,t){const{width:e,height:n}=t,i=XN(e,n,r.ownerDocument),s=i.ownerDocument.createElementNS(i.namespaceURI,"foreignObject");return s.setAttributeNS(null,"x","0%"),s.setAttributeNS(null,"y","0%"),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.append(r),i.appendChild(s),i}async function IU(r,t){var o;const e=await gf(r,t),n=await DU(e),i=YN(n,e.isEnable("removeControlCharacter"));e.autoDestruct||(e.svgStyleElement=dM(e.ownerDocument),e.svgDefsElement=(o=e.ownerDocument)==null?void 0:o.createElementNS(mf,"defs"),e.svgStyles.clear());const s=ac(i,n.ownerDocument);return await eU(s,e)}async function OU(r,t){const e=await gf(r,t),{log:n,quality:i,type:s,dpi:o}=e,a=await IU(e);n.time("canvas to data url");let c=a.toDataURL(s,i);if(["image/png","image/jpeg"].includes(s)&&o&&CN&&PN){const[l,h]=c.split(",");let u=0,d=!1;if(s==="image/png"){const y=EN(h);y>=0?(u=Math.ceil((y+28)/3)*4,d=!0):u=33/3*4}else s==="image/jpeg"&&(u=18/3*4);const f=h.substring(0,u),m=h.substring(u),_=window.atob(f),g=new Uint8Array(_.length);for(let y=0;y<g.length;y++)g[y]=_.charCodeAt(y);const p=s==="image/png"?wN(g,o,d):bN(g,o),b=window.btoa(String.fromCharCode(...p));c=[l,",",b,m].join("")}return n.timeEnd("canvas to data url"),c}async function FU(r,t){return OU(await gf(r,{...t,type:"image/png"}))}class Jo extends io{constructor(e){super(e);A(this,"camera");A(this,"controls");const n=e.render.container;this.camera=hf.clone(),this.controls=new Ew(this.camera,n),this.controls.listenToKeyEvents(n),this.controls.mouseButtons.MIDDLE=Lo.ROTATE}resize(){const{clientWidth:e,clientHeight:n}=this.core.container;this.camera.aspect=e/n,this.camera.updateProjectionMatrix()}render(){this.core.render.render(this.camera)}unmount(){this.controls.stopListenToKeyEvents(),this.controls.dispose()}afterDeserialize(e){const{cameraPosition:n,cameraTarget:i}=e.scene;n&&i&&(this.camera.position.fromArray(n),this.controls.target.fromArray(i),this.controls.update())}afterSerialize(e){e.scene.cameraPosition=this.camera.position.toArray(),e.scene.cameraTarget=this.controls.target.toArray()}async toImage(){return this.core.render.render(this.camera),await FU(this.core.container)}}class _f extends io{constructor(e){super(e);A(this,"scene");A(this,"helpers");A(this,"editorPlugin");A(this,"onEntityAdd",e=>{this.addHelper(e.entity)});A(this,"onEntityRemove",e=>{this.removeHelper(e.entity)});A(this,"onEntitySelected",e=>{this.selectHelper(e.olds,e.entities)});A(this,"onEntityChanged",e=>{const{key:n,entity:i}=e,s=this.helpers[i.id];n==="visible"&&s&&(s.visible=i.visible)});A(this,"onComponentAdd",e=>{const{component:n,parent:i}=e;if(n.type===mi.OrbitControls){const s=this.getHelper(i.id);s&&(s.point.visible=!0,s.distance=n.getAttr("distance"))}});A(this,"onComponentRemove",e=>{const{component:n,parent:i}=e;if(n.type===mi.OrbitControls){const s=this.getHelper(i.id);s&&(s.point.visible=!1)}});A(this,"onComponentChange",e=>{const{component:n,key:i,newValue:s}=e;if(n.type===mi.OrbitControls&&i==="distance"){const o=this.getHelper(n.entity.id);o&&(o.distance=s)}});A(this,"addHelper",e=>{let n;e instanceof uf?n=new fN(e):e.type===Rt.DirectionalLight?n=new pN(e):e.type===Rt.HemisphereLight?n=new mN(e):e.type===Rt.SpotLight?n=new gN(e):e.type===Rt.PointLight&&(n=new _N(e)),n&&(this.scene.add(n),this.helpers[e.id]=n),e.children.forEach(i=>this.addHelper(i))});A(this,"removeHelper",e=>{const n=this.helpers[e.id];n&&(this.scene.remove(n),delete this.helpers[e.id]),e.children.forEach(i=>this.removeHelper(i))});A(this,"selectHelper",(e,n)=>{e.forEach(i=>{const s=this.helpers[i.id];s==null||s.deselect()}),n.forEach(i=>{const s=this.helpers[i.id];s==null||s.select()})});this.scene=new xc,this.editorPlugin=e.getPlugin(Jo),this.helpers={}}mount(){this.core.bus.on("ENTITY_ADDED",this.onEntityAdd),this.core.bus.on("ENTITY_REMOVED",this.onEntityRemove),this.core.bus.on("ENTITY_SELECTED",this.onEntitySelected),this.core.bus.on("ENTITY_CHANGED",this.onEntityChanged),this.core.bus.on("COMPONENT_CHANGED",this.onComponentChange),this.core.bus.on("COMPONENT_ADDED",this.onComponentAdd),this.core.bus.on("COMPONENT_REMOVED",this.onComponentRemove)}unmount(){this.core.bus.off("ENTITY_ADDED",this.onEntityAdd),this.core.bus.off("ENTITY_REMOVED",this.onEntityRemove),this.core.bus.off("ENTITY_SELECTED",this.onEntitySelected),this.core.bus.off("ENTITY_CHANGED",this.onEntityChanged),this.core.bus.off("COMPONENT_CHANGED",this.onComponentChange),this.core.bus.off("COMPONENT_ADDED",this.onComponentAdd),this.core.bus.off("COMPONENT_REMOVED",this.onComponentRemove)}render(){const{renderer:e}=this.core.render;e.autoClear=!1,Object.values(this.helpers).forEach(n=>n.update()),e.render(this.scene,this.editorPlugin.camera)}afterRender(){this.core.render.renderer.autoClear=!0}getHelper(e){return this.helpers[e]}}class kU extends io{constructor(e){super(e);A(this,"grid");A(this,"gridSize");A(this,"gridColor1");A(this,"gridColor2");this.gridSize=50,this.gridColor1="#444444",this.gridColor2="#888888",this.grid=new Li,e.getPlugin(_f).scene.add(this.grid),this.refresh()}getGridEnable(){return this.grid.visible}setGridEnable(e){this.grid.visible=e}getGridSize(){return this.gridSize}setGridSize(e){this.gridSize=e,this.dispose(),this.refresh()}getGridColor1(){return this.gridColor1}setGridColor1(e){this.gridColor1=e,this.dispose(),this.refresh()}getGridColor2(){return this.gridColor2}setGridColor2(e){this.gridColor2=e,this.dispose(),this.refresh()}refresh(){const e=new qm(this.gridSize,this.gridSize,this.gridColor1,this.gridColor1);this.grid.add(e);const n=new qm(this.gridSize,this.gridSize/5,this.gridColor2,this.gridColor2);this.grid.add(n)}dispose(){for(let e=this.grid.children.length-1;e>=0;e--){const n=this.grid.children[e];this.grid.remove(n),n.dispose()}}unmount(){this.dispose()}}const Zv=new C,Zu=new C,Cr=new C,pl=new C,Qv=new C,Pr=new jt,$v=new jt,NU=new Me,UU=["position","rotation","scale"],BU={world:"local",local:"world"},Jv="mouseDown",tx="change",ex="mouseUp";class zU extends io{constructor(e){super(e);A(this,"enabled");A(this,"controls");A(this,"helperPlugin");A(this,"editorPlugin");A(this,"parent");A(this,"parentPosition");A(this,"parentQuaternion");A(this,"parentRotation");A(this,"parentScale");A(this,"entities");A(this,"entityPositionMap");A(this,"entityQuaternionMap");A(this,"entityScaleMap");A(this,"space");A(this,"dragging");A(this,"onEntityChanged",e=>{if(!this.enabled)return;const{key:n}=e;UU.includes(n)?this.updateParent():n==="transformable"&&this.attach(this.core.selections)});A(this,"onEntityMoved",()=>{this.enabled&&this.updateParent()});A(this,"onEntitiesSelect",e=>{this.enabled&&this.attach(e.entities)});A(this,"onStart",()=>{this.enabled&&(this.dragging=!0,this.editorPlugin.controls.enabled=!1,this.core.bus.emit("TRANSACTION_START"),this.entities.forEach(e=>{this.entityPositionMap.set(e,e.object3d.position.clone()),this.entityQuaternionMap.set(e,e.object3d.quaternion.clone()),this.entityScaleMap.set(e,e.object3d.scale.clone())}),this.parentPosition.copy(this.parent.position),this.parentQuaternion.copy(this.parent.quaternion),this.parentScale.copy(this.parent.scale))});A(this,"onEnd",()=>{this.enabled&&(this.dragging=!1,this.entityPositionMap.clear(),this.entityQuaternionMap.clear(),this.entityScaleMap.clear(),this.editorPlugin.controls.enabled=!0,this.core.bus.emit("TRANSACTION_END"))});A(this,"onChange",()=>{const{position:e,quaternion:n,scale:i}=this.parent,s=this.controls.getMode();s==="translate"?this.entities.forEach(o=>this.applyPosition(o,e)):s==="rotate"?this.entities.forEach(o=>this.applyRotation(o,n)):s==="scale"&&this.entities.forEach(o=>this.applyScale(o,i))});this.enabled=!0,this.dragging=!1,this.space="world",this.entities=[],this.entityPositionMap=new Map,this.entityQuaternionMap=new Map,this.entityScaleMap=new Map,this.helperPlugin=this.core.getPlugin(_f),this.parent=new Bt,this.parentPosition=new C,this.parentQuaternion=new jt,this.parentRotation=new Me,this.parentScale=new C,this.helperPlugin.scene.add(this.parent),this.editorPlugin=e.getPlugin(Jo),this.controls=new _k(this.editorPlugin.camera,e.render.container),this.controls.addEventListener(Jv,this.onStart),this.controls.addEventListener(tx,this.onChange),this.controls.addEventListener(ex,this.onEnd),this.helperPlugin.scene.add(this.controls),e.bus.on("ENTITY_CHANGED",this.onEntityChanged),e.bus.on("ENTITY_SELECTED",this.onEntitiesSelect),e.bus.on("ENTITY_MOVED",this.onEntityMoved)}unmount(){this.controls.removeEventListener(Jv,this.onStart),this.controls.removeEventListener(tx,this.onChange),this.controls.removeEventListener(ex,this.onEnd),this.controls.dispose(),this.helperPlugin.scene.remove(this.controls),this.helperPlugin.scene.remove(this.parent),this.core.bus.off("ENTITY_CHANGED",this.onEntityChanged),this.core.bus.off("ENTITY_SELECTED",this.onEntitiesSelect),this.core.bus.off("ENTITY_MOVED",this.onEntityMoved)}setEnabled(e){this.enabled=e,this.enabled?this.attach(this.core.selections):this.attach([])}toggleSpace(){this.space=BU[this.space],this.controls.setSpace(this.space)}updateParent(){this.dragging||(this.parent.position.set(0,0,0),this.parent.rotation.set(0,0,0),this.parent.scale.set(1,1,1),this.entities.forEach(e=>{e.object3d.getWorldPosition(Zv),this.parent.position.add(Zv)}),this.parent.position.divideScalar(this.entities.length||1),this.entities.length&&(this.entities[this.entities.length-1].object3d.matrixWorld.decompose(Zu,this.parent.quaternion,this.parent.scale),this.parent.rotation.setFromQuaternion(this.parent.quaternion)))}isParentInclude(e,n){let i=!1,s=e.parent;for(;s&&!i;)i=n.includes(s),s=s.parent;return i}attach(e){this.controls.detach(),this.entities=e.filter(n=>!this.isParentInclude(n,e)&&n.transformable),this.entities.length&&(this.updateParent(),this.controls.attach(this.parent))}applyPosition(e,n){Cr.copy(n).sub(this.parentPosition);const i=this.controls.axis,s=this.entityPositionMap.get(e),o=this.entityQuaternionMap.get(e);s&&o&&(this.space==="local"&&i!="XYZ"&&(e.object3d.getWorldQuaternion(Pr),Pr.invert(),Cr.applyQuaternion(Pr)),i.includes("X")||(Cr.x=0),i.includes("Y")||(Cr.y=0),i.includes("Z")||(Cr.z=0),e.object3d.parent.matrixWorld.decompose(Zu,Pr,pl),Pr.invert(),this.space==="local"&&i!="XYZ"?Cr.applyQuaternion(o).divide(pl):Cr.applyQuaternion(Pr).divide(pl),Zu.copy(s).add(Cr),e.setAttr("position",Zu))}applyRotation(e,n){$v.copy(this.parentQuaternion).invert().multiply(n);const i=this.entityQuaternionMap.get(e);i&&(Pr.copy(i).multiply($v),e.setAttr("rotation",NU.setFromQuaternion(Pr)))}applyScale(e,n){Qv.copy(n).sub(this.parentScale);const i=this.entityScaleMap.get(e);i&&(pl.copy(i).add(Qv),e.setAttr("scale",pl))}createHelper(){const e=new QD(new xe);e.visible=!1;const n=e.material;return n.color.set("#396efe"),n.depthTest=!1,n.transparent=!0,this.helperPlugin.scene.add(e),e}}const nx=new C,ix=new C,Oa=new jt,VU=new Me,sx=new J,rx=new J,ox=new C;class dV extends io{constructor(e){super(e);A(this,"camera");A(this,"entities");A(this,"mode");A(this,"enabled");A(this,"dom");A(this,"raycaster");A(this,"plane");A(this,"normal");A(this,"point");A(this,"position");A(this,"mouse");A(this,"parent");A(this,"offset");A(this,"oldMouse");A(this,"parentPosition");A(this,"parentRotation");A(this,"parentScale");A(this,"entityPositionMap");A(this,"entityQuaternionMap");A(this,"entityScaleMap");A(this,"space");A(this,"screenPosition");A(this,"startScreenPosition");A(this,"currentScreenPosition");A(this,"scaleLength");A(this,"pointStart");A(this,"pointEnd");A(this,"startNorm");A(this,"endNorm");A(this,"pointOffset");A(this,"rotationAxis");A(this,"rotationAngle");A(this,"onMouseDown",e=>{this.enabled&&(this.dom.remove(),this.enabled=!1,e.stopPropagation(),setTimeout(()=>this.core.container.focus(),0),this.entityPositionMap.clear(),this.entityQuaternionMap.clear(),this.entityScaleMap.clear(),this.core.bus.emit("TRANSACTION_END"))});A(this,"onMouseMove",e=>{const{clientX:n,clientY:i}=e;if(this.point.set(n,i),!this.enabled)return;const{x:s,y:o}=this.point,[a,c]=Yo(this.core.container,s,o);if(this.mouse.set(a*2-1,-(c*2)+1),this.mode==="translate")this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.ray.intersectPlane(this.plane,this.position),this.parent.position.copy(this.position.sub(this.offset)),ix.copy(this.parent.position).sub(this.parentPosition),this.entities.forEach(l=>{const h=this.entityPositionMap.get(l);h&&(nx.copy(h).add(ix),l.setAttr("position",nx))});else if(this.mode==="rotate"){this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.ray.intersectPlane(this.plane,this.position),this.pointEnd.copy(this.position).sub(this.parent.position),this.pointOffset.copy(this.pointEnd).sub(this.pointStart),this.camera.getWorldDirection(this.normal),this.normal.normalize(),this.rotationAxis.copy(this.normal),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this.endNorm.cross(this.startNorm).dot(this.normal)<0?1:-1,Oa.setFromRotationMatrix(this.parent.parent.matrixWorld);const l=Oa.invert();this.rotationAxis.applyQuaternion(l),this.parent.quaternion.copy(Oa.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),this.parent.quaternion.multiply(Oa.setFromEuler(this.parentRotation)).normalize(),this.entities.forEach(h=>{const u=this.entityQuaternionMap.get(h);u&&(Oa.copy(u).premultiply(this.parent.quaternion),h.setAttr("rotation",VU.setFromQuaternion(Oa)))})}else if(this.mode==="scale"){rx.copy(this.mouse).sub(this.screenPosition);const l=rx.length()/this.scaleLength;this.entities.forEach(h=>{const u=this.entityScaleMap.get(h);u&&(ox.copy(u).multiplyScalar(l),h.setAttr("scale",ox))})}});this.space="world";const n=e.getPlugin(Jo),i=this.core.getPlugin(_f);this.camera=n.camera,this.dom=document.createElement("div"),this.dom.style.position="fixed",this.dom.style.inset="0px",this.dom.style.zIndex="10000",this.entities=[],this.mode="translate",this.enabled=!1,this.parent=new Bt,this.raycaster=new to,this.plane=new kn,this.normal=new C,this.point=new J,this.position=new C,this.mouse=new J,this.oldMouse=new J,this.offset=new C,this.screenPosition=new J,this.startScreenPosition=new J,this.currentScreenPosition=new J,this.pointStart=new C,this.pointEnd=new C,this.startNorm=new C,this.endNorm=new C,this.pointOffset=new C,this.rotationAxis=new C,this.rotationAngle=0,this.parentPosition=new C,this.parentRotation=new Me,this.parentScale=new C,this.scaleLength=0,this.entityPositionMap=new Map,this.entityQuaternionMap=new Map,this.entityScaleMap=new Map,i.scene.add(this.parent)}mount(){this.dom.addEventListener("pointerdown",this.onMouseDown,!1),document.addEventListener("pointermove",this.onMouseMove,!1)}unmount(){this.dom.removeEventListener("pointerdown",this.onMouseDown),document.removeEventListener("pointermove",this.onMouseMove),this.dom.remove()}isParentInclude(e,n){let i=!1,s=e.parent;for(;s&&!i;)i=n.includes(s),s=s.parent;return i}start(e,n){if(this.entities=e.filter(c=>!this.isParentInclude(c,e)&&c.transformable),!this.entities.length)return;this.mode=n,this.enabled=!0,this.core.container.appendChild(this.dom),this.parent.position.set(0,0,0),this.parent.rotation.set(0,0,0),this.parent.scale.set(1,1,1);for(const c of e)this.position.setFromMatrixPosition(c.object3d.matrixWorld),this.parent.position.add(this.position);this.parent.position.divideScalar(e.length||1),this.camera.getWorldDirection(this.normal),this.plane.setFromNormalAndCoplanarPoint(this.normal,this.parent.position);const{x:i,y:s}=this.point,[o,a]=Yo(this.core.container,i,s);if(this.mouse.set(o*2-1,-(a*2)+1),this.oldMouse.copy(this.mouse),this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.ray.intersectPlane(this.plane,this.position),this.mode==="translate")this.offset.copy(this.position).sub(this.parent.position);else if(this.mode==="scale"){const c=this.parent.position.clone().project(this.camera);this.screenPosition.set(c.x,c.y),sx.copy(this.oldMouse).sub(this.screenPosition),this.scaleLength=sx.length()}else this.mode==="rotate"&&this.pointStart.copy(this.position).sub(this.parent.position);this.parentPosition.copy(this.parent.position),this.parentRotation.copy(this.parent.rotation),this.parentScale.copy(this.parent.scale),this.entities.forEach(c=>{this.entityPositionMap.set(c,c.object3d.position.clone())}),this.entities.forEach(c=>{this.entityQuaternionMap.set(c,c.object3d.quaternion.clone())}),this.entities.forEach(c=>{this.entityScaleMap.set(c,c.object3d.scale.clone())}),this.core.bus.emit("TRANSACTION_START")}}class HU extends io{constructor(e){super(e);A(this,"editorPlugin");A(this,"raycaster");A(this,"mouse");A(this,"onDownPosition");A(this,"onUpPosition");A(this,"enabled");A(this,"multiple");A(this,"domSelected");A(this,"onMouseUp",e=>{const{clientX:n,clientY:i}=e,s=Yo(this.core.container,n,i);this.onUpPosition.fromArray(s),this.handleClick(),document.removeEventListener("pointerup",this.onMouseUp)});A(this,"onMouseDown",e=>{if(!this.enabled||!Zl(e))return;this.domSelected=this.isDomSelect(e);const{clientX:n,clientY:i}=e,s=Yo(this.core.container,n,i);this.onDownPosition.fromArray(s),document.addEventListener("pointerup",this.onMouseUp)});A(this,"getIntersects",(e,n)=>(this.mouse.set(e.x*2-1,-(e.y*2)+1),this.raycaster.setFromCamera(this.mouse,this.editorPlugin.camera),this.raycaster.intersectObjects(n,!1)));A(this,"onKeyDown",e=>{const n=e.key.toLowerCase();(n==="shift"||n==="control")&&(this.multiple=!0)});A(this,"onKeyUp",e=>{const n=e.key.toLowerCase();(n==="shift"||n==="control")&&(this.multiple=!1)});this.enabled=!0,this.multiple=!1,this.raycaster=new to,this.mouse=new J,this.onDownPosition=new J,this.onUpPosition=new J,this.core.container.addEventListener("pointerdown",this.onMouseDown),this.core.container.addEventListener("keydown",this.onKeyDown),this.core.container.addEventListener("keyup",this.onKeyUp),this.editorPlugin=e.getPlugin(Jo)}unmount(){this.core.container.removeEventListener("pointerdown",this.onMouseDown),this.core.container.removeEventListener("keydown",this.onKeyDown),this.core.container.removeEventListener("keyup",this.onKeyUp)}setEnabled(e){this.enabled=e}isDomSelect(e){if(e.target instanceof HTMLDivElement&&(e.target.className==="dom-2d"||e.target.className==="dom-3d"))return e.target}getSelect(){const{scene:e}=this.core.render,n=[];e.traverseVisible(s=>n.push(s));const i=this.getIntersects(this.onUpPosition,n);if(i.length>0){const{object:s}=i[0],o=this.getEntity(s);if(o!=null&&o.selectable)return o}}getDomEntity(e){return this.core.entityManager.getEntities().find(i=>i instanceof bf&&i.isDom(e))}handleClick(){if(this.onDownPosition.distanceTo(this.onUpPosition)===0){const e=this.domSelected?this.getDomEntity(this.domSelected):this.getSelect();if(e){let n=this.multiple?this.core.selections:[];n.includes(e)?n=n.filter(i=>i.id!==e.id):n=[...n,e],this.core.select(n)}else!this.multiple&&this.core.select([])}}getEntity(e){const i=this.core.entityManager.getEntities().find(s=>s.object3d===e);if(i)return i;if(e.parent)return this.getEntity(e.parent)}}const fV=new lt,pV=new lt,mV=new lt,gV=new C(0,0,1),_V=new C(1,1,1),bV=new jt,yV=new Me,vV=new C,xV=new C,wV=new C,SV=new C,MV=new C,TV=new C,EV=new C,AV=new C;class CV{constructor(t){A(this,"core");A(this,"drawPlugin");A(this,"moving");A(this,"isSquare");A(this,"mouse");A(this,"oldMouse");A(this,"plane");A(this,"normal");A(this,"position");A(this,"startPosition");A(this,"middlePosition");A(this,"endPosition");A(this,"eye");A(this,"speed");A(this,"width");A(this,"height");A(this,"depth");A(this,"center");A(this,"onKeyDown",t=>{t.key.toLowerCase()==="shift"&&(this.isSquare=!0,this.drawPlane(this.startPosition,this.position))});A(this,"onKeyUp",t=>{t.key.toLowerCase()==="shift"&&(this.isSquare=!1,this.drawPlane(this.startPosition,this.position))});A(this,"onMouseDownPhase1",t=>{if(!Zl(t))return;this.drawPlugin.editorPlugin.controls.enabled=!1,this.isSquare=!1,this.updateMouse(t);const e=this.drawPlugin.getObjects();this.raycaster.setFromCamera(this.mouse,this.camera);const n=this.raycaster.intersectObjects(e,!1);if(n.length){const i=n[0];this.normal.copy(i.normal);const s=new Gt().getNormalMatrix(i.object.matrixWorld);this.normal.applyMatrix3(s),this.position.copy(i.point)}else this.normal.set(0,1,0),this.position.set(0,0,0);this.normal.normalize(),this.plane.setFromNormalAndCoplanarPoint(this.normal,this.position),this.raycaster.ray.intersectPlane(this.plane,this.position)&&this.startPosition.copy(this.position),this.dom.addEventListener("pointerup",this.onMouseUpPhase1,!1),this.dom.addEventListener("pointermove",this.onMouseMovePhase1,!1),document.addEventListener("keydown",this.onKeyDown,!1),document.addEventListener("keyup",this.onKeyUp,!1)});A(this,"onMouseMovePhase1",t=>{this.grid.hide(),this.moving=!0,this.updateMouse(t),this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.ray.intersectPlane(this.plane,this.position),this.drawPlane(this.startPosition,this.position)});A(this,"onMouseUpPhase1",t=>{if(this.drawPlugin.editorPlugin.controls.enabled=!0,!this.moving){this.dom.removeEventListener("pointerup",this.onMouseUpPhase1),this.dom.removeEventListener("pointermove",this.onMouseMovePhase1),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp);return}this.moving=!1,this.updateMouse(t),this.oldMouse.copy(this.mouse),this.eye.copy(this.middlePosition).sub(this.camera.position),this.speed=this.eye.length()*.5,this.dom.removeEventListener("pointerdown",this.onMouseDownPhase1),this.dom.removeEventListener("pointerup",this.onMouseUpPhase1),this.dom.removeEventListener("pointermove",this.onMouseMovePhase1),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.dom.addEventListener("pointerdown",this.onMouseDownPhase2,!1),this.dom.addEventListener("pointermove",this.onMouseMovePhase2,!1),this.dom.addEventListener("pointerup",this.onMouseUpPhase2,!1)});A(this,"onMouseMovePhase2",t=>{this.updateMouse(t);const e=this.mouse.y-this.oldMouse.y+this.mouse.x-this.oldMouse.x,n=qs.copy(this.normal).multiplyScalar(e*this.speed);this.endPosition.copy(this.middlePosition).add(n),this.drawBox(this.startPosition,this.middlePosition,this.endPosition)});A(this,"onMouseDownPhase2",t=>{Zl(t)&&this.createEntity()});A(this,"onMouseUpPhase2",t=>{t.stopPropagation(),this.box.visible=!1,this.dom.removeEventListener("pointerdown",this.onMouseDownPhase2),this.dom.removeEventListener("pointermove",this.onMouseMovePhase2),this.dom.removeEventListener("pointerup",this.onMouseUpPhase2),this.continuous?this.drawPlugin.draw(this.drawPlugin.type):this.core.bus.emit("DRAW_FINISH",this.core)});this.drawPlugin=t,this.core=t.core,this.isSquare=!1,this.moving=!1,this.mouse=new J,this.oldMouse=new J,this.plane=new kn,this.normal=new C,this.position=new C,this.startPosition=new C,this.middlePosition=new C,this.endPosition=new C,this.eye=new C,this.speed=0,this.width=0,this.height=0,this.depth=0,this.center=new C}get dom(){return this.core.render.container}get raycaster(){return this.core.render.raycaster}get camera(){return this.drawPlugin.camera}get grid(){return this.drawPlugin.grid}get continuous(){return this.drawPlugin.continuous}get box(){return this.drawPlugin.box}get circle(){return this.drawPlugin.circle}get circle1(){return this.drawPlugin.circle1}get circle2(){return this.drawPlugin.circle2}start(){this.grid.show(),this.dom.addEventListener("pointerdown",this.onMouseDownPhase1,!1)}finish(){this.dom.removeEventListener("pointerdown",this.onMouseDownPhase1),this.dom.removeEventListener("pointerup",this.onMouseUpPhase1),this.dom.removeEventListener("pointermove",this.onMouseMovePhase1),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),this.dom.removeEventListener("pointerdown",this.onMouseDownPhase2),this.dom.removeEventListener("pointermove",this.onMouseMovePhase2),this.dom.removeEventListener("pointerup",this.onMouseUpPhase2)}updateMouse(t){const{clientX:e,clientY:n}=t,[i,s]=Yo(this.dom,e,n);this.mouse.set(i*2-1,-(s*2)+1)}}const ax=new C,cx=new C,lx=new C;class PV{constructor(t){A(this,"core");A(this,"drawPlugin");A(this,"dom");A(this,"camera");A(this,"helperPlugin");A(this,"mouse");A(this,"oldMouse");A(this,"raycaster");A(this,"plane");A(this,"normal");A(this,"position");A(this,"balls");A(this,"ballPool");A(this,"lines");A(this,"linePool");A(this,"ball");A(this,"line");A(this,"lastBall");A(this,"box");A(this,"finish",()=>{this.ball.visible=!1,this.reset(),this.dom.removeEventListener("pointerdown",this.onPointerDown),this.dom.removeEventListener("pointermove",this.onPointerMove),this.dom.removeEventListener("dblclick",this.onDoubleClick)});A(this,"onDoubleClick",t=>{t.stopPropagation(),this.balls.length>=2&&this.createPipe(),this.continuous?(this.reset(),this.ball.visible=!1,this.drawPlugin.draw(this.drawPlugin.type)):this.core.bus.emit("DRAW_FINISH",this.core)});A(this,"onPointerDown",t=>{Zl(t)?(this.updateMouse(t),this.oldMouse.distanceTo(this.mouse)!=0&&(this.updateIntersect(),this.createLine(),this.createBall()),this.oldMouse.copy(this.mouse)):X3(t)&&this.reset()});A(this,"onPointerMove",t=>{if(this.updateMouse(t),this.updateIntersect(),this.ball.position.copy(this.position),this.lastBall){const e=this.line.geometry.getAttribute("position"),[n,i,s]=this.lastBall.position.toArray(),[o,a,c]=this.position.toArray();e.setXYZ(0,n,i,s),e.setXYZ(1,o,a,c),e.needsUpdate=!0,this.line.visible=!0}});this.drawPlugin=t,this.core=t.core,this.dom=this.core.render.container,this.balls=[],this.ballPool=[],this.lines=[],this.linePool=[];const e=this.core.getPlugin(Jo);this.camera=e.camera,this.box=new xe,this.helperPlugin=this.core.getPlugin(_f),this.mouse=new J,this.oldMouse=new J,this.raycaster=new to,this.plane=new kn,this.normal=new C(0,1,0),this.position=new C,this.plane.setFromNormalAndCoplanarPoint(this.normal,this.position),this.ball=new ct(new dr(.1),new en({color:"red"})),this.ball.visible=!1;const n=new Qt;n.setAttribute("position",new Ot([0,0,0,0,0,0],3)),this.line=new Kt(n,new en({color:"#4170ff"})),this.line.visible=!1,this.helperPlugin.scene.add(this.ball,this.line)}get continuous(){return this.drawPlugin.continuous}start(){this.ball.visible=!0,this.dom.addEventListener("pointerdown",this.onPointerDown,!1),this.dom.addEventListener("pointermove",this.onPointerMove,!1),this.dom.addEventListener("dblclick",this.onDoubleClick,!1)}getLine(){if(this.linePool.length)return this.linePool.pop();const t=this.line.clone();return t.geometry=new Qt,t}getBall(){return this.ballPool.length?this.ballPool.pop():this.ball.clone()}getObjects(){const{scene:t}=this.core.render,e=[];return t.traverseVisible(n=>e.push(n)),e}updateMouse(t){const{clientX:e,clientY:n}=t,[i,s]=Yo(this.dom,e,n);this.mouse.set(i*2-1,-(s*2)+1)}reset(){this.line.visible=!1,delete this.lastBall,this.balls.forEach(t=>t.visible=!1),this.ballPool.push(...this.balls),this.lines.forEach(t=>t.visible=!1),this.linePool.push(...this.lines),this.balls.length=0,this.lines.length=0}updateIntersect(){const t=this.getObjects();this.raycaster.setFromCamera(this.mouse,this.camera);const e=this.raycaster.intersectObjects(t,!1);if(e.length){const n=e[0];this.position.copy(n.point)}else this.raycaster.ray.intersectPlane(this.plane,this.position)}createLine(){if(!this.lastBall)return;const t=[...this.lastBall.position.toArray(),...this.position.toArray()],e=this.getLine();e.visible=!0,e.geometry.setAttribute("position",new Ot(t,3)),this.lines.push(e),this.helperPlugin.scene.add(e)}createBall(){const t=this.getBall();t.visible=!0,t.position.copy(this.position),this.helperPlugin.scene.add(t),this.balls.push(t),this.lastBall=t}createPipe(){this.box.makeEmpty(),U3(this.balls,this.box),this.box.getCenter(this.position);const t=this.balls.map(s=>{const o=s.position.sub(this.position).toArray(),a=is.Linear;return{point:o,type:a,before:[0,0,0],after:[0,0,0]}}),e=(s,o)=>(ax.fromArray(s),cx.fromArray(o),lx.copy(cx).sub(ax).normalize().multiplyScalar(1),lx.toArray());t.forEach((s,o)=>{const a=t[o-1],c=t[o+1];o===0?s.after=e(s.point,c.point):o===t.length-1?s.before=e(s.point,a.point):(s.before=e(s.point,a.point),s.after=e(s.point,c.point))});const n={position:this.position.toArray(),points:t},i=$3(this.core,n);this.core.bus.emit("TRANSACTION_START"),this.core.addEntity(i),this.core.select([i]),this.core.bus.emit("TRANSACTION_END")}}new C;new C;new C;const Lr=new C,Fa=new C,vM=new en({color:"red",depthTest:!1}),GU=new en({color:"#4170ff",depthTest:!1}),jU=new en({color:"#ff0000",depthTest:!1});class WU extends Bt{constructor(e,n){super();A(this,"entity");A(this,"dom");A(this,"camera");A(this,"lines");A(this,"points");A(this,"controls");A(this,"cameraPosition");A(this,"raycaster");A(this,"pointer");A(this,"plane");A(this,"pickers");A(this,"currentPoint");A(this,"prePoint");A(this,"dragging");A(this,"offset");A(this,"onPointerDown",e=>{Zl(e)&&(this.dom.addEventListener("pointermove",this.onPointerMove),this.getPointer(e),this.pointerHover(),this.pointerDown(),this.prePoint=this.currentPoint)});A(this,"onPointerMove",e=>{this.dragging&&(this.getPointer(e),this.pointerMove())});A(this,"onPointerHover",e=>{this.getPointer(e),this.pointerHover()});A(this,"onPointerUp",()=>{this.dom.removeEventListener("pointermove",this.onPointerMove),this.dragging&&this.entity.core.bus.emit("TRANSACTION_END"),this.dragging=!1});A(this,"onDoubleClick",()=>{this.currentPoint===this.prePoint&&this.currentPoint instanceof hx?this.currentPoint.change():this.editPlugin.exit()});this.entity=e,this.dom=n;const i=e.core.getPlugin(Jo);this.camera=i.camera,this.dragging=!1,this.visible=!1,this.points=[],this.controls=[],this.lines=[],this.pickers=new Map,this.cameraPosition=new C,this.raycaster=new to,this.raycaster.firstHitOnly=!0,this.pointer=new J,this.plane=new kn,this.offset=new C,this.createPoints(),this.createLines()}get editPlugin(){return this.entity.core.getPlugin(qU)}createPoints(){for(let e=0;e<this.entity.points.length;e++){const n=new hx(this,e);this.points.push(n),this.add(n),this.pickers.set(n.ball,n)}}createLines(){for(let e=0;e<this.points.length-1;e++){const n=this.points[e],i=this.points[e+1],s=new XU(this,e,e+1);this.lines.push(s);const o=new ux(this,n,"after"),a=new ux(this,i,"before");this.controls.push(o,a)}}updateMatrixWorld(e){this.camera.updateMatrixWorld(),this.cameraPosition.setFromMatrixPosition(this.camera.matrixWorld),this.entity.object3d.updateMatrixWorld(),this.points.forEach(n=>n.update()),this.controls.forEach(n=>n.update()),this.lines.forEach(n=>n.update()),super.updateMatrixWorld(e)}enter(){this.visible=!0,this.dom.addEventListener("pointerdown",this.onPointerDown),this.dom.addEventListener("pointermove",this.onPointerHover),this.dom.addEventListener("pointerup",this.onPointerUp),this.dom.addEventListener("dblclick",this.onDoubleClick)}exit(){this.visible=!1,this.dom.removeEventListener("pointerdown",this.onPointerDown),this.dom.removeEventListener("pointermove",this.onPointerHover),this.dom.removeEventListener("pointerup",this.onPointerUp),this.dom.removeEventListener("dblclick",this.onDoubleClick)}getPointer(e){const{clientX:n,clientY:i}=e,[s,o]=Yo(this.dom,n,i);this.pointer.set(s*2-1,-(o*2)+1)}pointerHover(){if(this.dragging)return;this.raycaster.setFromCamera(this.pointer,this.camera);const e=Array.from(this.pickers.keys()),n=this.raycaster.intersectObjects(e,!1);if(n.length){const i=n[0];this.currentPoint=this.pickers.get(i.object)}else delete this.currentPoint}pointerDown(){this.currentPoint&&(this.currentPoint.ball.getWorldPosition(Lr),Fa.copy(this.cameraPosition).sub(Lr).normalize(),this.plane.setFromNormalAndCoplanarPoint(Fa,Lr),this.raycaster.ray.intersectPlane(this.plane,Fa),this.offset.copy(Fa).sub(Lr),this.dragging=!0,this.entity.core.bus.emit("TRANSACTION_START"))}pointerMove(){this.currentPoint&&(this.raycaster.setFromCamera(this.pointer,this.camera),this.raycaster.ray.intersectPlane(this.plane,Lr),Fa.copy(Lr).sub(this.offset),this.currentPoint.setPoint(Fa))}update(){}}class XU{constructor(t,e,n){A(this,"divisions");A(this,"helper");A(this,"start");A(this,"end");A(this,"line");A(this,"curve1");A(this,"curve2");A(this,"attribute");this.helper=t,this.start=e,this.end=n,this.divisions=50,this.curve1=new s0(new C,new C);const i=new C,s=new C,o=new C,a=new C;this.curve2=new i0(i,s,o,a);const c=(this.divisions+1)*3,l=Array.from({length:c}).fill(0);this.attribute=new Ot(l,3),this.line=new Kt(new Qt,GU),this.line.geometry.setAttribute("position",this.attribute),this.helper.add(this.line)}update(){const{start:t,end:e,helper:n}=this,{points:i,object3d:s}=n.entity,{matrixWorld:o}=s,a=i[t],c=i[e];if(a.type===is.Linear&&c.type===is.Linear){const{v1:l,v2:h}=this.curve1;l.fromArray(a.point).applyMatrix4(o),h.fromArray(c.point).applyMatrix4(o),this.curve1.getPoints(this.divisions).forEach(({x:d,y:f,z:m},_)=>this.attribute.setXYZ(_,d,f,m)),this.attribute.needsUpdate=!0}else{const{v0:l,v1:h,v2:u,v3:d}=this.curve2;l.fromArray(a.point),h.fromArray(a.after).add(l),d.fromArray(c.point),u.fromArray(c.before).add(d),l.applyMatrix4(o),h.applyMatrix4(o),u.applyMatrix4(o),d.applyMatrix4(o),this.curve2.getPoints(this.divisions).forEach(({x:m,y:_,z:g},p)=>this.attribute.setXYZ(p,m,_,g)),this.attribute.needsUpdate=!0}}}class hx extends Bt{constructor(e,n){super();A(this,"helper");A(this,"point");A(this,"ball");A(this,"size");A(this,"material");this.helper=e,this.point=n,this.size=.02,this.material=vM.clone(),this.ball=new ct(new dr,this.material),this.ball.geometry.computeBoundsTree(),this.add(this.ball)}update(){const{cameraPosition:e,currentPoint:n}=this.helper,{matrixWorld:i}=this.helper.entity.object3d,s=this.helper.entity.points[this.point];this.position.fromArray(s.point).applyMatrix4(i);const{camera:o}=this.helper,c=this.position.distanceTo(e)*Math.min(1.9*Math.tan(Math.PI*o.fov/360)/o.zoom,7);this.ball.scale.set(1,1,1).multiplyScalar(c*this.size/4),this===n?this.material.color.set("#ffff00"):this.material.color.set("#ff0000")}setPoint(e){this.position.copy(e),this.helper.entity.object3d.worldToLocal(e);const n=rr(this.helper.entity.points);n[this.point].point=e.toArray(),this.helper.entity.setAttr("points",n)}change(){const e=rr(this.helper.entity.points),n=e[this.point].type;e[this.point].type=n===is.Linear?is.Bezier:is.Linear,this.helper.entity.setAttr("points",e)}}class ux{constructor(t,e,n){A(this,"helper");A(this,"point");A(this,"mode");A(this,"size");A(this,"ball");A(this,"line");A(this,"attribute");A(this,"material");this.helper=t,this.point=e,this.mode=n,this.size=.02,this.material=vM.clone(),this.ball=new ct(new dr,this.material),this.ball.geometry.computeBoundsTree(),this.point.add(this.ball),this.attribute=new Ot([0,0,0,0,0,0],3),this.line=new Kt(new Qt,jU),this.line.geometry.setAttribute("position",this.attribute),this.point.add(this.line),this.helper.pickers.set(this.ball,this)}update(){const{cameraPosition:t,currentPoint:e}=this.helper,n=this.helper.entity.points[this.point.point],i=n[this.mode];this.ball.position.fromArray(i);const{camera:s}=this.helper;this.ball.getWorldPosition(Lr);const a=Lr.distanceTo(t)*Math.min(1.9*Math.tan(Math.PI*s.fov/360)/s.zoom,7);this.ball.scale.set(1,1,1).multiplyScalar(a*this.size/4);const[c,l,h]=this.ball.position.toArray();this.attribute.setXYZ(0,c,l,h),this.attribute.needsUpdate=!0,this===e?this.material.color.set("#ffff00"):this.material.color.set("#ff0000"),this.ball.visible=n.type===is.Bezier,this.line.visible=n.type===is.Bezier}setPoint(t){this.point.worldToLocal(t),this.ball.position.copy(t);const e=rr(this.helper.entity.points);e[this.point.point][this.mode]=t.toArray(),this.helper.entity.setAttr("points",e)}}class YU extends io{constructor(e){super(e);A(this,"scene");A(this,"gizmos");A(this,"editorPlugin");A(this,"onEntityAdd",e=>{this.addGizmo(e.entity)});A(this,"onEntityRemove",e=>{this.removeGizmo(e.entity)});A(this,"onEntityChanged",e=>{const{key:n,entity:i}=e,s=this.gizmos[i.id];n==="visible"&&s&&(s.visible=i.visible)});A(this,"addGizmo",e=>{let n;e.type===Rt.Pipe&&(n=new WU(e,this.core.container)),n&&(this.scene.add(n),this.gizmos[e.id]=n),e.children.forEach(i=>this.addGizmo(i))});A(this,"removeGizmo",e=>{const n=this.gizmos[e.id];n&&(this.scene.remove(n),delete this.gizmos[e.id]),e.children.forEach(i=>this.removeGizmo(i))});this.scene=new xc,this.editorPlugin=e.getPlugin(Jo),this.gizmos={}}mount(){this.core.bus.on("ENTITY_ADDED",this.onEntityAdd),this.core.bus.on("ENTITY_REMOVED",this.onEntityRemove),this.core.bus.on("ENTITY_CHANGED",this.onEntityChanged)}unmount(){this.core.bus.off("ENTITY_ADDED",this.onEntityAdd),this.core.bus.off("ENTITY_REMOVED",this.onEntityRemove),this.core.bus.off("ENTITY_CHANGED",this.onEntityChanged)}render(){const{renderer:e}=this.core.render;e.autoClear=!1,Object.values(this.gizmos).forEach(n=>n.update()),e.render(this.scene,this.editorPlugin.camera)}afterRender(){this.core.render.renderer.autoClear=!0}getGizmo(e){return this.gizmos[e]}}class qU extends io{constructor(e){super(e);A(this,"enabled");A(this,"gizmoPlugin");A(this,"gizmos");A(this,"selectionPlugin");A(this,"pivotPlugin");A(this,"onDoubleClick",()=>this.enter());this.enabled=!1,this.gizmos=[],this.gizmoPlugin=e.getPlugin(YU),this.selectionPlugin=e.getPlugin(HU),this.pivotPlugin=e.getPlugin(zU),this.core.container.addEventListener("dblclick",this.onDoubleClick)}unmount(){this.core.container.removeEventListener("dblclick",this.onDoubleClick)}enter(){if(!(this.enabled||!this.core.selections.length)){this.gizmos=[];for(const e of this.core.selections){const n=this.gizmoPlugin.getGizmo(e.id);n&&this.gizmos.push(n)}this.gizmos.length!==0&&(this.enabled=!0,this.selectionPlugin.setEnabled(!1),this.pivotPlugin.setEnabled(!1),this.gizmos.forEach(e=>e.enter()))}}exit(){this.enabled&&(this.enabled=!1,this.selectionPlugin.setEnabled(!0),this.pivotPlugin.setEnabled(!0),this.gizmos.forEach(e=>e.exit()),this.gizmos=[])}switch(){this.enabled?this.exit():this.enter()}}class t_ extends Qo{constructor(e){super(e);A(this,"type");A(this,"object3d");A(this,"index");A(this,"code");A(this,"ver");A(this,"author");A(this,"desc");A(this,"company");A(this,"date");A(this,"refreshCycle");A(this,"backgroundColor");A(this,"backgroundTexture");A(this,"backgroundBlurriness");A(this,"backgroundIntensity");A(this,"backgroundRotation");A(this,"background");A(this,"environmentTexture");A(this,"environmentIntensity");A(this,"environmentRotation");this.type=Rt.Scene,this.object3d=e.render.scene,this.index=0,this.name="场景",this.code="",this.desc="",this.author="",this.ver="0.0.0",this.company="",this.date="",this.refreshCycle=1e3,this.backgroundColor="#202932",this.backgroundTexture="",this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=0,this.background=new pt,this.environmentTexture="",this.environmentIntensity=1,this.environmentRotation=0}get tm(){return this.core.timeManager}get em(){return this.core.entityManager}get mm(){return this.core.modelManager}get rm(){return this.core.runtimeManager}get gridPlugin(){return this.core.getPlugin(kU)}get debug(){return this.core.render.debugManager.enable}set debug(e){this.core.render.debugManager.setEnable(e)}get fogEnable(){return!!this.core.render.scene.fog}set fogEnable(e){const{scene:n,fog:i}=this.core.render;n.fog=e?i:null}get fogColor(){return`#${this.core.render.fog.color.getHexString()}`}set fogColor(e){this.core.render.fog.color.set(e)}get fogNear(){return this.core.render.fog.near}set fogNear(e){this.core.render.fog.near=e}get fogFar(){return this.core.render.fog.far}set fogFar(e){this.core.render.fog.far=e}get gridEnable(){var e;return(e=this.gridPlugin)==null?void 0:e.getGridEnable()}set gridEnable(e){var n;(n=this.gridPlugin)==null||n.setGridEnable(e)}get gridSize(){var e;return(e=this.gridPlugin)==null?void 0:e.getGridSize()}set gridSize(e){var n;(n=this.gridPlugin)==null||n.setGridSize(e)}get gridColor1(){var e;return(e=this.gridPlugin)==null?void 0:e.getGridColor1()}set gridColor1(e){var n;(n=this.gridPlugin)==null||n.setGridColor1(e)}get gridColor2(){var e;return(e=this.gridPlugin)==null?void 0:e.getGridColor2()}set gridColor2(e){var n;(n=this.gridPlugin)==null||n.setGridColor2(e)}setAttr(e,n){if(super.setAttr(e,n),this.refresh(),e==="backgroundTexture"&&this.renderBackground(),e==="environmentTexture"&&this.renderEnvironment(),e==="environmentRotation"){const i=this.core.render.scene;sg(i,i)}}deserialize(e){const{index:n,debug:i,name:s,code:o,ver:a,author:c,company:l,desc:h,date:u,refreshCycle:d,backgroundColor:f,backgroundTexture:m,backgroundBlurriness:_,backgroundIntensity:g,backgroundRotation:p,environmentTexture:b,environmentIntensity:y,environmentRotation:v,fogEnable:x,fogColor:S,fogNear:T,fogFar:E,gridEnable:w,gridSize:M,gridColor1:P,gridColor2:L}=e;this.index=n,this.debug=i,this.name=s,this.code=o,this.ver=a,this.author=c,this.company=l,this.desc=h,this.date=u,this.refreshCycle=d,this.backgroundColor=f,this.backgroundTexture=m,this.backgroundBlurriness=_,this.backgroundIntensity=g,this.backgroundRotation=p,this.environmentTexture=b,this.environmentIntensity=y??1,this.environmentRotation=v??0,this.fogEnable=x,this.fogColor=S,this.fogNear=T,this.fogFar=E,this.gridEnable=w??!0,this.gridSize=M??50,this.gridColor1=P??"#444444",this.gridColor2=L??"#888888",super.deserialize(e),this.refresh(),this.renderBackground(),this.renderEnvironment()}serialize(){const e=super.serialize(),{index:n,code:i,desc:s,ver:o,author:a,company:c,date:l,refreshCycle:h,debug:u,backgroundColor:d,backgroundTexture:f,backgroundBlurriness:m,backgroundIntensity:_,backgroundRotation:g,environmentTexture:p,environmentIntensity:b,environmentRotation:y,fogEnable:v,fogColor:x,fogNear:S,fogFar:T,gridEnable:E,gridSize:w,gridColor1:M,gridColor2:P}=this;return{...e,index:n,code:i,desc:s,ver:o,company:c,author:a,date:l,refreshCycle:h,debug:u,backgroundColor:d,backgroundTexture:f,backgroundBlurriness:m,backgroundIntensity:_,backgroundRotation:g,environmentTexture:p,environmentIntensity:b,environmentRotation:y,fogEnable:v,fogColor:x,fogNear:S,fogFar:T,gridEnable:E,gridSize:w,gridColor1:M,gridColor2:P}}clone(){return new t_(this.core).copy(this)}refresh(){const{backgroundColor:e,backgroundBlurriness:n,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:o,environmentRotation:a}=this,{scene:c}=this.core.render;this.background.set(e),c.backgroundBlurriness=n,c.backgroundIntensity=i,c.backgroundRotation.y=Le.degToRad(s),c.environmentIntensity=o,c.environmentRotation.y=Le.degToRad(a)}async renderBackground(){const{scene:e}=this.core.render;if(this.backgroundTexture){const n=await this.core.textureManager.loadTexture(this.backgroundTexture);n.mapping=pc,e.background=n}else e.background=this.background}async renderEnvironment(){const{scene:e}=this.core.render;if(this.environmentTexture){const n=await this.core.textureManager.loadTexture(this.environmentTexture);n.mapping=pc,e.environment=n}else e.environment=null;sg(e,e)}}const KU=["radius","segments","phiLength","thetaLength"];class e_ extends $o{constructor(e){super(e);A(this,"type");A(this,"radius");A(this,"phiLength");A(this,"thetaLength");A(this,"_segments");A(this,"mesh");this.type=Rt.Sphere,this.radius=1,this._segments=new J(1,1),this.phiLength=Math.PI*2,this.thetaLength=Math.PI,this.mesh=Gc(),this.olds=[this.mesh.material],this.object3d.add(this.mesh)}get segments(){return this._segments}set segments(e){this._segments.copy(e)}setAttr(e,n){super.setAttr(e,n),KU.includes(e)&&this.render()}deserialize(e){const{radius:n,segments:i,phiLength:s,thetaLength:o}=e;this.radius=n,this.segments.fromArray(i),this.phiLength=s,this.thetaLength=o,super.deserialize(e)}serialize(){const e=super.serialize(),{radius:n,phiLength:i,thetaLength:s}=this,o=this.segments.toArray();return{...e,radius:n,segments:o,phiLength:i,thetaLength:s}}clone(){return new e_(this.core).copy(this)}copy(e){const{radius:n,segments:i,phiLength:s,thetaLength:o}=e;return this.radius=n,this.phiLength=s,this.thetaLength=o,this.segments.copy(i),super.copy(e),this}async render(){const{radius:e,segments:n,phiLength:i,thetaLength:s}=this;this.mesh.geometry.dispose(),this.mesh.geometry=H3(e,i,s,n),super.render()}}class bf extends Qo{constructor(e){super(e);A(this,"type");A(this,"dom3d");A(this,"dom2d");A(this,"mode");A(this,"symbolPath");A(this,"symbolCode");A(this,"symbol");A(this,"onAdded",()=>{this.object3d.add(this.dom3d),this.object3d.add(this.dom2d)});A(this,"onRemoved",()=>{this.object3d.remove(this.dom3d),this.object3d.remove(this.dom2d)});this.type=Rt.Symbol,this.symbolPath="",this.symbolCode="",this.mode="3d",this.dom3d=new NL(e.render,document.createElement("div")),this.dom2d=new UL(e.render,document.createElement("div")),this.dom3d.scale.set(.01,.01,.01),this.object3d.add(this.dom3d),this.object3d.add(this.dom2d),this.object3d.addEventListener("added",this.onAdded),this.object3d.addEventListener("removed",this.onRemoved)}setAttr(e,n){super.setAttr(e,n),e==="mode"&&this.render()}start(){super.start(),this.mode==="2d"?this.dom2d.start():this.dom3d.start()}resize(){var e;(e=this.symbol)==null||e.graphView.resize(),super.resize()}dispose(){this.object3d.removeEventListener("added",this.onAdded),this.object3d.removeEventListener("removed",this.onRemoved),super.dispose()}isDom(e){return this.mode==="2d"?this.dom2d.element===e:this.dom3d.element===e}deserialize(e){super.deserialize(e);const{symbolPath:n,symbolCode:i,mode:s}=e;this.symbolPath=n,this.symbolCode=i,this.mode=s,this.render()}serialize(){const e=super.serialize(),{symbolPath:n,symbolCode:i,mode:s}=this;return{...e,symbolPath:n,symbolCode:i,mode:s}}copy(e){return super.copy(e),this.symbolPath=e.symbolPath,this.symbolCode=e.symbolCode,this.render(),this}clone(){return new bf(this.core).copy(this)}async render(){const{symbolPath:e,symbolCode:n}=this,{symbolManager:i}=this.core;this.symbol&&(this.symbol.graphView.unmount(this.dom2d.container),this.symbol.graphView.unmount(this.dom3d.container)),this.dom2d.setVisible(this.mode==="2d"),this.dom3d.setVisible(this.mode==="3d");try{const s=await i.getSymbol(n,e),{width:o,height:a}=JSON.parse(s);this.dom3d.setSize(o,a),this.dom2d.setSize(o,a),this.symbol=i.createSymbol(),this.mode==="2d"?this.symbol.graphView.mount(this.dom2d.container):this.symbol.graphView.mount(this.dom3d.container),this.symbol.graphView.deserialize(s),this.dom2d.enabled=this.mode==="2d",this.dom3d.enabled=this.mode==="3d",this.symbol.graphView.resize()}catch(s){console.error(s)}}}class n_ extends gh{constructor(e){super(e);A(this,"type");A(this,"object3d");A(this,"target");this.type=Rt.SpotLight,this.object3d=new l0,this.target=new Bt,this.target.position.set(0,0,10),this.object3d.add(this.target),this.object3d.target=this.target}get distance(){return this.object3d.distance}set distance(e){this.object3d.distance=e}get angle(){return this.object3d.angle}set angle(e){this.object3d.angle=e}get penumbra(){return this.object3d.penumbra}set penumbra(e){this.object3d.penumbra=e}get decay(){return this.object3d.decay}set decay(e){this.object3d.decay=e}deserialize(e){super.deserialize(e);const{distance:n,angle:i,penumbra:s,decay:o}=e;this.distance=n,this.angle=Le.degToRad(i),this.penumbra=s,this.decay=o}serialize(){const e=super.serialize(),{distance:n,penumbra:i,decay:s}=this,o=fs(Le.radToDeg(this.angle),1);return{...e,distance:n,angle:o,penumbra:i,decay:s}}clone(){return new n_(this.core).copy(this)}}class i_ extends gh{constructor(e){super(e);A(this,"type");A(this,"object3d");this.type=Rt.PointLight,this.object3d=new yd}get distance(){return this.object3d.distance}set distance(e){this.object3d.distance=e}get decay(){return this.object3d.decay}set decay(e){this.object3d.decay=e}deserialize(e){super.deserialize(e);const{distance:n,decay:i}=e;this.distance=n,this.decay=i}serialize(){const e=super.serialize(),{distance:n,decay:i}=this;return{...e,distance:n,decay:i}}clone(){return new i_(this.core).copy(this)}}const ZU=["size","segments"],QU=["fill","text","align","fontFamily","fontSize","fontStyle"];class s_ extends Qo{constructor(e){super(e);A(this,"type");A(this,"_size");A(this,"_segments");A(this,"mesh");this.type=Rt.Text,this._size=new J(1,1),this._segments=new J(1,1),this.mesh=new EF,this.object3d.add(this.mesh)}get size(){return this._size}set size(e){this._size.copy(e)}get segments(){return this._segments}set segments(e){this._segments.copy(e)}get text(){return this.mesh.text}set text(e){this.mesh.text=e}get align(){return this.mesh.align}set align(e){this.mesh.align=e}get fill(){return this.mesh.fill}set fill(e){this.mesh.fill=e}get fontFamily(){return this.mesh.fontFamily}set fontFamily(e){this.mesh.fontFamily=e}get fontSize(){return this.mesh.fontSize}set fontSize(e){this.mesh.fontSize=e}get fontStyle(){return this.mesh.fontStyle}set fontStyle(e){this.mesh.fontStyle=e}setAttr(e,n){super.setAttr(e,n),ZU.includes(e)?this.renderSize():QU.includes(e)&&this.renderText()}deserialize(e){const{size:n=[],segments:i=[],fill:s,text:o,fontFamily:a,fontSize:c,fontStyle:l,align:h}=e;this.size.fromArray(n),this.segments.fromArray(i),this.fontFamily=a,this.fontSize=c,this.fontStyle=l,this.text=o,this.align=h,this.fill=s,super.deserialize(e),this.render()}serialize(){const e=super.serialize(),n=this.size.toArray(),i=this.segments.toArray(),{fontFamily:s,fontSize:o,fontStyle:a,text:c,align:l,fill:h}=this;return{...e,size:n,segments:i,fontFamily:s,fontSize:o,fontStyle:a,text:c,align:l,fill:h}}clone(){return new s_(this.core).copy(this)}copy(e){const{size:n,segments:i,fontFamily:s,fontSize:o,fontStyle:a,text:c,align:l,fill:h}=e;return this.size.copy(n),this.segments.copy(i),this.fontFamily=s,this.fontSize=o,this.fontStyle=a,this.text=c,this.align=l,this.fill=h,super.copy(e),this.render(),this}dispose(){this.mesh.dispose(),super.dispose()}renderSize(){const{x:e,y:n}=this.size;this.mesh.setSize(e,n),this.core.bus.emit("ENTITY_RENDERED",{entity:this})}renderText(){this.mesh.render()}render(){this.renderSize(),this.renderText(),this.core.bus.emit("ENTITY_RENDERED",{entity:this})}}class yf{constructor(t){A(this,"entity");A(this,"id");A(this,"name");A(this,"_enabled");A(this,"started");this.entity=t,this.id="",this.name="组件",this._enabled=!0,this.started=!1}get enabled(){return this._enabled}set enabled(t){this._enabled!==t&&(this._enabled=t,this._enabled?(this.onEnable(),!this.started&&this.start(),this.started=!0):this.onDisable())}getAttr(t){return this[t]}setAttr(t,e){if(!(t in this))return;const n=rr(this[t]);this[t]=e,this.entity.core.bus.emit("COMPONENT_CHANGED",{component:this,key:t,newValue:e,oldValue:n})}onEnable(){}onDisable(){}resize(){}awake(){this.enabled&&(this.onEnable(),this.start(),this.started=!0)}start(){}rendered(){}update(t){}destroy(){}deserialize(t){const{id:e,name:n,enabled:i}=t;this.id=e,this.name=n,this._enabled=i??!0}serialize(){return{id:this.id,type:this.type,name:this.name,enabled:this.enabled}}copy(t){return this.entity=t.entity,this.name=t.name,this._enabled=t.enabled,this}}class r_ extends yf{constructor(e){super(e);A(this,"type");A(this,"script");A(this,"func");A(this,"instance");this.type=mi.SimpleScript,this.script=""}onEnable(){var e,n;try{(n=(e=this.instance)==null?void 0:e.onEnable)==null||n.call(e)}catch(i){console.error(i)}}onDisable(){var e,n;try{(n=(e=this.instance)==null?void 0:e.onDisable)==null||n.call(e)}catch(i){console.error(i)}}start(){var e,n;try{const i=this.entity.core.entityManager.root;this.instance=new this.func(this.entity,i),(n=(e=this.instance)==null?void 0:e.start)==null||n.call(e)}catch(i){console.error(i)}}update(e){var n,i;try{this.enabled&&((i=(n=this.instance)==null?void 0:n.update)==null||i.call(n,e))}catch(s){console.error(s)}}destroy(){var e,n;try{this.enabled&&((n=(e=this.instance)==null?void 0:e.destroy)==null||n.call(e))}catch(i){console.error(i)}}deserialize(e){this.script=e.script;try{this.func=new Function(`${this.script} 
 return Script`)()}catch(n){console.error(n)}super.deserialize(e)}serialize(){const e=super.serialize(),{script:n}=this;return{...e,script:n}}copy(e){return this.script=e.script,super.copy(e),this}clone(){return new r_(this.entity).copy(this)}}const $U={once:Xx,repeat:Yx,pingpong:qx};class o_ extends yf{constructor(e){super(e);A(this,"type");A(this,"mixer");A(this,"clips");A(this,"current");this.type=mi.Animator,this.mixer=new jD(this.entity.object3d),this.clips=[]}rendered(){const e=this.entity;this.clips.push(...e.model.animations)}update(e){this.enabled&&this.mixer.update(e)}destroy(){const e=this.entity;e.model&&this.mixer.uncacheRoot(e.model),super.destroy()}deserialize(e){super.deserialize(e)}serialize(){return{...super.serialize()}}copy(e){return super.copy(e),this}clone(){return new o_(this.entity).copy(this)}play(e,n={speed:1,start:0,loop:"repeat"}){var c,l;const{speed:i=1,start:s=0,loop:o="repeat"}=n;(c=this.current)==null||c.stop();const a=jl.findByName(this.clips,e);a&&(this.current=this.mixer.clipAction(a),this.current.time=s,this.current.loop=$U[o],this.current.timeScale=i,(l=this.current)==null||l.play())}stop(){var e;(e=this.current)==null||e.stop()}pause(){this.current&&(this.current.paused=!0)}resume(){this.current&&(this.current.paused=!1)}}class a_ extends yf{constructor(e){super(e);A(this,"type");A(this,"controls");A(this,"camera");A(this,"distance");this.type=mi.OrbitControls,this.distance=30,Vv.copy(this.entity.rotation);const n=this.entity.core.render.container;this.camera=this.entity.object3d,this.controls=new Ew(this.camera,n),this.controls.listenToKeyEvents(n),this.controls.enabled=!1,this.entity.rotation.copy(Vv)}onEnable(){this.controls.enabled=this.enabled}onDisable(){this.controls.enabled=this.enabled}start(){this.controls.enabled=this.enabled}destroy(){this.controls.stopListenToKeyEvents(),this.controls.dispose()}deserialize(e){super.deserialize(e),this.distance=e.distance??30,this.camera.getWorldDirection(qs),this.camera.getWorldPosition(this.controls.target),qs.multiplyScalar(this.distance),this.controls.target.add(qs),this.controls.update()}serialize(){const e=super.serialize(),{distance:n}=this;return{...e,distance:n}}copy(e){return super.copy(e),this.distance=e.distance,this}clone(){return new a_(this.entity).copy(this)}updateDistance(e){this.camera.getWorldPosition(qs),this.setAttr("distance",qs.distanceTo(e))}}class c_ extends yf{constructor(e){super(e);A(this,"type");A(this,"controls");A(this,"camera");this.type=mi.PointerLockControls;const n=this.entity.core.render.container;this.camera=this.entity.object3d,this.controls=new kL(this.camera,n),this.controls.enabled=!1}get moveSpeed(){return this.controls.moveSpeed}set moveSpeed(e){this.controls.moveSpeed=e}onEnable(){this.controls.enabled=this.enabled}onDisable(){this.controls.enabled=this.enabled}start(){this.controls.enabled=this.enabled}update(e){this.enabled&&this.controls.update(e)}destroy(){this.controls.dispose()}deserialize(e){super.deserialize(e),this.moveSpeed=e.moveSpeed??100}serialize(){const e=super.serialize(),{moveSpeed:n}=this;return{...e,moveSpeed:n}}copy(e){return super.copy(e),this.moveSpeed=e.moveSpeed,this}clone(){return new c_(this.entity).copy(this)}}class JU{constructor(t){A(this,"core");A(this,"entities");A(this,"root");this.core=t,this.entities=new Map,this.root=new t_(t)}addEntity(t){this.entities.set(t.id,t),t.children.forEach(e=>this.addEntity(e))}removeEntity(t){this.entities.has(t.id)&&(this.entities.delete(t.id),t.children.forEach(e=>this.removeEntity(e)))}getEntities(t=[]){return t.length?t.map(e=>this.getEntity(e)):Array.from(this.entities.values())}getEntity(t){return this.entities.get(t)}findEntity(t){const e=Array.from(this.entities.values());for(const n of e)if(t(n))return n}resize(){this.root.resize(),this.entities.forEach(t=>t.resize())}start(){this.root.start(),this.entities.forEach(t=>t.start())}update(t){this.root.update(t),this.entities.forEach(e=>e.update(t))}deserialize(t){this.root.deserialize(t),this.createComponents(t.components,this.root),this.createEntities(t.children,this.root)}serialize(){return this.root.serialize()}dispose(){this.clear()}clear(){this.root.children.slice().forEach(t=>{this.core.removeEntity(t),t.dispose()}),this.entities.clear(),this.root.dispose()}createEntities(t,e){for(const n of t){const i=this.createEntity(n);this.core.addEntity(i,e,e.children.length),this.createComponents(n.components,i),this.createEntities(n.children,i)}}createComponents(t,e){for(const n of t){const i=this.createComponent(n,e);this.core.addComponent(i,e)}}createEntity(t){let e;switch(t.type){case Rt.Plane:e=new Z0(this.core);break;case Rt.Box:e=new V0(this.core);break;case Rt.Sphere:e=new e_(this.core);break;case Rt.Cone:e=new j0(this.core);break;case Rt.Cylinder:e=new W0(this.core);break;case Rt.Pipe:e=new K0(this.core);break;case Rt.AmbientLight:e=new z0(this.core);break;case Rt.DirectionalLight:e=new X0(this.core);break;case Rt.HemisphereLight:e=new q0(this.core);break;case Rt.SpotLight:e=new n_(this.core);break;case Rt.PointLight:e=new i_(this.core);break;case Rt.Model:e=new df(this.core);break;case Rt.Group:e=new Y0(this.core);break;case Rt.PerspectiveCamera:e=new H0(this.core);break;case Rt.OrthographicCamera:e=new G0(this.core);break;case Rt.Symbol:e=new bf(this.core);break;case Rt.Text:e=new s_(this.core);break;default:throw new Error(`创建实体出错:${t.type}`)}return e.deserialize(t),e}createComponent(t,e){let n;switch(t.type){case mi.SimpleScript:n=new r_(e);break;case mi.Animator:n=new o_(e);break;case mi.OrbitControls:n=new a_(e);break;case mi.PointerLockControls:n=new c_(e);break;default:throw new Error(`创建组件出错:${t.type}`)}return n.deserialize(t),n}}class tB{constructor(t){A(this,"core");A(this,"timer");this.core=t,this.timer=new PF}get delta(){return this.timer.getDelta()}get elapsedTime(){return this.timer.elapsedTime}update(){this.timer.update()}reset(){this.timer.reset()}dispose(){}}const $a=class $a{constructor(t){A(this,"core");A(this,"symbolCache");A(this,"loadings");this.core=t,this.symbolCache=new Map,this.loadings={}}static registerSymbol(t){$a.symbol=t}async getSymbol(t,e){var o;const n=`${t}-${e}`;if(this.symbolCache.has(n))return this.symbolCache.get(n);if(this.loadings[n]!=null)return new Promise(a=>{var c;(c=this.loadings[n])==null||c.push(a)});this.loadings[n]=[];const s=await Lx({code:t,path:e});return this.symbolCache.set(n,s.data),(o=this.loadings[n])==null||o.forEach(a=>a(s.data)),delete this.loadings[n],s.data}createSymbol(){if(!$a.symbol)throw new Error("symbol服务未注册");return new $a.symbol({isSymbol:!0})}};A($a,"symbol");let Mg=$a;class eB{constructor(t){A(this,"core");A(this,"requestId");A(this,"camera");A(this,"started");A(this,"check",()=>{this.requestId=window.requestAnimationFrame(this.check);const t=this.core.entityManager.getEntities();for(const e of t)if(e instanceof df&&!e.rendered)return;this.core.entityManager.start(),this.started=!0,window.cancelAnimationFrame(this.requestId),delete this.requestId});this.core=t,this.started=!1}start(){this.camera=this.core.entityManager.findEntity(t=>t instanceof uf),this.camera?this.requestId=window.requestAnimationFrame(this.check):console.error("场景中缺少相机")}render(t){this.started&&(this.core.entityManager.update(t),this.camera&&this.core.render.render(this.camera.object3d))}dispose(){this.requestId&&window.cancelAnimationFrame(this.requestId)}setCamera(t){this.camera=t,this.core.render.camera=t.object3d}}class nB{constructor(t){A(this,"core");this.core=t}createMaterial(t){const e=eN(t.type);switch(this.renderBaseMaterial(e,t),t.type){case _s.Basic:this.renderBasicMaterial(e,t);break;case _s.Stand:this.renderStandMaterial(e,t);break;case _s.Phong:this.renderPhongMaterial(e,t);break;case _s.Shader:this.renderShaderMaterial(e,t);break;default:throw new Error(`未知的材质类型: ${t.type}`)}return e.needsUpdate=!0,e}renderBaseMaterial(t,e){const{transparent:n,opacity:i,depthTest:s,depthWrite:o,alphaTest:a,side:c,blending:l}=e;t.transparent=n,t.opacity=i,t.depthTest=s,t.depthWrite=o,t.alphaTest=a,t.side=c,t.blending=l}async renderBasicMaterial(t,e){const{color:n,reflectivity:i,refractionRatio:s,aoMapIntensity:o,lightMapIntensity:a,map:c,specularMap:l,alphaMap:h,envMap:u,aoMap:d,lightMap:f}=e;t.color.set(n),t.reflectivity=i,t.refractionRatio=s,t.aoMapIntensity=o,t.lightMapIntensity=a,this.setBasicMaterialMap(t,"map",c),this.setBasicMaterialMap(t,"specularMap",l),this.setBasicMaterialMap(t,"alphaMap",h),this.setBasicMaterialMap(t,"envMap",u),this.setBasicMaterialMap(t,"aoMap",d),this.setBasicMaterialMap(t,"lightMap",f)}async renderPhongMaterial(t,e){const{color:n,shininess:i,specular:s,reflectivity:o,refractionRatio:a,aoMapIntensity:c,displacementScale:l,displacementBias:h,lightMapIntensity:u,emissive:d,emissiveIntensity:f,normalScale:m,normalMap:_,bumpMap:g,bumpScale:p,displacementMap:b,emissiveMap:y,map:v,specularMap:x,alphaMap:S,envMap:T,aoMap:E,lightMap:w}=e;t.color.set(n),t.emissive.set(d),t.specular.set(s),t.shininess=i,t.emissiveIntensity=f,t.reflectivity=o,t.refractionRatio=a,t.aoMapIntensity=c,t.normalScale.fromArray(m),t.bumpScale=p,t.displacementScale=l,t.displacementBias=h,t.lightMapIntensity=u,this.setPhongMaterialMap(t,"map",v),this.setPhongMaterialMap(t,"specularMap",x),this.setPhongMaterialMap(t,"bumpMap",g),this.setPhongMaterialMap(t,"normalMap",_),this.setPhongMaterialMap(t,"displacementMap",b),this.setPhongMaterialMap(t,"aoMap",E),this.setPhongMaterialMap(t,"envMap",T),this.setPhongMaterialMap(t,"emissiveMap",y),this.setPhongMaterialMap(t,"alphaMap",S),this.setPhongMaterialMap(t,"lightMap",w)}async renderStandMaterial(t,e){const{color:n,metalness:i,roughness:s,envMapIntensity:o,aoMapIntensity:a,displacementScale:c,displacementBias:l,lightMapIntensity:h,emissive:u,emissiveIntensity:d,normalScale:f,normalMap:m,bumpMap:_,bumpScale:g,displacementMap:p,emissiveMap:b,map:y,metalnessMap:v,roughnessMap:x,alphaMap:S,envMap:T,aoMap:E,lightMap:w}=e;t.color.set(n),t.emissive.set(u),t.emissiveIntensity=d,t.metalness=i,t.roughness=s,t.envMapIntensity=o,t.aoMapIntensity=a,t.normalScale.fromArray(f),t.bumpScale=g,t.displacementScale=c,t.displacementBias=l,t.lightMapIntensity=h,this.setStandMaterialMap(t,"map",y),this.setStandMaterialMap(t,"metalnessMap",v),this.setStandMaterialMap(t,"roughnessMap",x),this.setStandMaterialMap(t,"bumpMap",_),this.setStandMaterialMap(t,"normalMap",m),this.setStandMaterialMap(t,"aoMap",E),this.setStandMaterialMap(t,"displacementMap",p),this.setStandMaterialMap(t,"envMap",T),this.setStandMaterialMap(t,"emissiveMap",b),this.setStandMaterialMap(t,"alphaMap",S),this.setStandMaterialMap(t,"lightMap",w)}async renderShaderMaterial(t,e){const{uniforms:n,vertexShader:i,fragmentShader:s}=e;t.fragmentShader=s,t.vertexShader=i;for(const o of n){const{name:a,type:c}=o;c==="texture"&&(o.value=await this.setTexture({image:o.value,mapping:300,wrapS:1e3,wrapT:1e3,offset:[0,0],repeat:[1,1],rotation:0,center:[0,0],flipY:!0,colorSpace:"srgb"})),t.uniforms[a]=nN(o)}}async setBasicMaterialMap(t,e,n){n.image?(t[e]=await this.setTexture(n),t.needsUpdate=!0):t[e]=null}async setPhongMaterialMap(t,e,n){n.image?(t[e]=await this.setTexture(n),t.needsUpdate=!0):t[e]=null}async setStandMaterialMap(t,e,n){n.image?(t[e]=await this.setTexture(n),t.needsUpdate=!0):t[e]=null}async setTexture(t){if(!t.image)return null;const e=t.image,n=await this.core.textureManager.loadTexture(e),{mapping:i,wrapS:s,wrapT:o,offset:a,repeat:c,rotation:l,center:h,colorSpace:u,flipY:d}=t;return n.mapping=i,n.wrapS=s,n.wrapT=o,n.rotation=Le.degToRad(l),n.flipY=d,n.colorSpace=u,n.offset.fromArray(a),n.repeat.fromArray(c),n.center.fromArray(h),n.needsUpdate=!0,n}}class iB{constructor(t){A(this,"core");A(this,"rgbeLoader");A(this,"textureLoader");A(this,"textureCache");this.core=t,this.rgbeLoader=new M3,this.textureLoader=new Zd,this.textureCache=[]}dispose(){this.textureCache.forEach(t=>t.dispose()),this.textureCache=[]}async loadTexture(t){const e=await zg(t),s=await(Y3(e.name)==="hdr"?this.rgbeLoader:this.textureLoader).loadAsync(e.file);return this.textureCache.push(s),s}}class RV{constructor(t){A(this,"enabled");A(this,"config");A(this,"container");A(this,"render");A(this,"timeManager");A(this,"entityManager");A(this,"modelManager");A(this,"materialManager");A(this,"textureManager");A(this,"symbolManager");A(this,"runtimeManager");A(this,"bus");A(this,"requestId");A(this,"plugins");A(this,"selections");A(this,"lastSelection");A(this,"onWebGLContextLost",t=>{console.error(t),this.requestId&&cancelAnimationFrame(this.requestId),this.requestId=-1});A(this,"onWebGLContextRestore",()=>{this.requestId=window.requestAnimationFrame(this.update)});A(this,"update",()=>{if(this.requestId=window.requestAnimationFrame(this.update),!this.enabled)return;this.timeManager.update();const t=this.timeManager.delta;this.runtimeManager.render(t),this.plugins.forEach(e=>e.render(t)),this.plugins.forEach(e=>e.afterRender(t))});this.config=t,this.enabled=!0,this.container=document.createElement("div"),this.container.className="core-3d",this.container.style.position="relative",this.container.style.height="100%",this.container.style.pointerEvents="auto",this.container.tabIndex=0,this.plugins=[],this.selections=[],this.bus=JD(),this.render=new OL(this.container),this.timeManager=new tB(this),this.entityManager=new JU(this),this.textureManager=new iB(this),this.materialManager=new nB(this),this.modelManager=new iN(this),this.symbolManager=new Mg(this),this.runtimeManager=new eB(this),this.requestId=window.requestAnimationFrame(this.update),this.render.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost),this.render.canvas.addEventListener("webglcontextrestored",this.onWebGLContextRestore)}mount(t){t.appendChild(this.container),this.plugins.forEach(e=>e.mount()),this.resize()}unmount(){this.requestId&&window.cancelAnimationFrame(this.requestId),this.plugins.forEach(t=>t.unmount()),this.entityManager.dispose(),this.timeManager.dispose(),this.modelManager.dispose(),this.textureManager.dispose(),this.render.dispose(),this.container.remove(),this.bus.all.clear(),this.requestId=-1}active(){this.timeManager.reset(),this.plugins.forEach(t=>t.active()),this.enabled=!0}deactive(){this.plugins.forEach(t=>t.deactive()),this.enabled=!1}resize(){this.plugins.forEach(t=>t.resize()),this.entityManager.resize(),this.render.resize()}use(t){this.plugins.push(t)}getPlugin(t){return typeof t=="string"?this.plugins.find(i=>i.constructor.name===t):this.plugins.find(n=>n.constructor===t)}getEntity(t){return this.entityManager.getEntity(t)}addEntity(t,e,n){e||(e=this.entityManager.root),n===void 0&&(n=e.children.length),e.add(t,n),this.entityManager.addEntity(t),this.bus.emit("ENTITY_ADDED",{entity:t,parent:e,index:n})}removeEntity(t){if(!(t!=null&&t.parent))return;const e=t.parent,n=t.parent.remove(t);this.entityManager.removeEntity(t),this.bus.emit("ENTITY_REMOVED",{entity:t,parent:e,index:n})}moveEntity(t,e,n){const i=t.parent;if(!i||(e||(e=this.entityManager.root),n===void 0&&(n=e.children.length),K3(e,t)))return;const s=i.remove(t);e.add(t,n),this.bus.emit("ENTITY_MOVED",{entity:t,parent:e,index:n,oldParent:i,oldIndex:s})}addComponent(t,e,n){e||(e=this.entityManager.root),n===void 0&&(n=e.components.length),e.addComponent(t,n),this.bus.emit("COMPONENT_ADDED",{component:t,parent:e,index:n})}removeComponent(t){const e=t.entity.removeComponent(t);this.bus.emit("COMPONENT_REMOVED",{component:t,parent:t.entity,index:e})}select(t){if(this.selections.length===t.length&&this.selections.every(n=>t.some(i=>n.id===i.id)))return;const e=[...this.selections];this.selections=[...t],this.lastSelection=this.selections[this.selections.length-1],this.bus.emit("ENTITY_SELECTED",{entities:t,olds:e})}deserialize(t){window.sessionStorage.setItem("scene",t);try{const e=Z3(t);this.entityManager.deserialize(e.scene),this.plugins.forEach(n=>n.afterDeserialize(e)),this.bus.emit("DESERIALIZE",this)}catch(e){console.error(e)}}serialize(t){const e={scene:this.entityManager.serialize()};this.plugins.forEach(i=>i.afterSerialize(e));const n=Q3(e);return JSON.stringify(n,void 0,t)}generateID(){return this.entityManager.root.index++}clear(){this.entityManager.clear(),this.select([])}}function Gs(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function xM(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.__proto__=t}/*!
 * GSAP 3.12.7
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _i={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Tc={duration:.5,overwrite:!1,delay:0},l_,_n,De,ys=1e8,En=1/ys,Tg=Math.PI*2,sB=Tg/4,rB=0,wM=Math.sqrt,oB=Math.cos,aB=Math.sin,fn=function(t){return typeof t=="string"},Ge=function(t){return typeof t=="function"},hr=function(t){return typeof t=="number"},h_=function(t){return typeof t>"u"},Es=function(t){return typeof t=="object"},ti=function(t){return t!==!1},u_=function(){return typeof window<"u"},Qu=function(t){return Ge(t)||fn(t)},SM=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Pn=Array.isArray,Eg=/(?:-?\.?\d|\.)+/gi,MM=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Za=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,Zp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,TM=/[+-]=-?[.\d]+/,EM=/[^,'"\[\]\s]+/gi,cB=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Ne,hs,Ag,d_,bi={},Od={},AM,CM=function(t){return(Od=Ec(t,bi))&&ri},f_=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},th=function(t,e){return!e&&console.warn(t)},PM=function(t,e){return t&&(bi[t]=e)&&Od&&(Od[t]=e)||bi},eh=function(){return 0},lB={suppressEvents:!0,isStart:!0,kill:!1},ud={suppressEvents:!0,kill:!1},hB={suppressEvents:!0},p_={},jr=[],Cg={},RM,hi={},Qp={},dx=30,dd=[],m_="",g_=function(t){var e=t[0],n,i;if(Es(e)||Ge(e)||(t=[t]),!(n=(e._gsap||{}).harness)){for(i=dd.length;i--&&!dd[i].targetTest(e););n=dd[i]}for(i=t.length;i--;)t[i]&&(t[i]._gsap||(t[i]._gsap=new tT(t[i],n)))||t.splice(i,1);return t},Fo=function(t){return t._gsap||g_(Ni(t))[0]._gsap},DM=function(t,e,n){return(n=t[e])&&Ge(n)?t[e]():h_(n)&&t.getAttribute&&t.getAttribute(e)||n},ei=function(t,e){return(t=t.split(",")).forEach(e)||t},Ye=function(t){return Math.round(t*1e5)/1e5||0},Je=function(t){return Math.round(t*1e7)/1e7||0},cc=function(t,e){var n=e.charAt(0),i=parseFloat(e.substr(2));return t=parseFloat(t),n==="+"?t+i:n==="-"?t-i:n==="*"?t*i:t/i},uB=function(t,e){for(var n=e.length,i=0;t.indexOf(e[i])<0&&++i<n;);return i<n},Fd=function(){var t=jr.length,e=jr.slice(0),n,i;for(Cg={},jr.length=0,n=0;n<t;n++)i=e[n],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},LM=function(t,e,n,i){jr.length&&!_n&&Fd(),t.render(e,n,_n&&e<0&&(t._initted||t._startAt)),jr.length&&!_n&&Fd()},IM=function(t){var e=parseFloat(t);return(e||e===0)&&(t+"").match(EM).length<2?e:fn(t)?t.trim():t},OM=function(t){return t},yi=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},dB=function(t){return function(e,n){for(var i in n)i in e||i==="duration"&&t||i==="ease"||(e[i]=n[i])}},Ec=function(t,e){for(var n in e)t[n]=e[n];return t},fx=function r(t,e){for(var n in e)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(t[n]=Es(e[n])?r(t[n]||(t[n]={}),e[n]):e[n]);return t},kd=function(t,e){var n={},i;for(i in t)i in e||(n[i]=t[i]);return n},Nl=function(t){var e=t.parent||Ne,n=t.keyframes?dB(Pn(t.keyframes)):yi;if(ti(t.inherit))for(;e;)n(t,e.vars.defaults),e=e.parent||e._dp;return t},fB=function(t,e){for(var n=t.length,i=n===e.length;i&&n--&&t[n]===e[n];);return n<0},FM=function(t,e,n,i,s){var o=t[i],a;if(s)for(a=e[s];o&&o[s]>a;)o=o._prev;return o?(e._next=o._next,o._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[i]=e,e._prev=o,e.parent=e._dp=t,e},vf=function(t,e,n,i){n===void 0&&(n="_first"),i===void 0&&(i="_last");var s=e._prev,o=e._next;s?s._next=o:t[n]===e&&(t[n]=o),o?o._prev=s:t[i]===e&&(t[i]=s),e._next=e._prev=e.parent=null},Qr=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},ko=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},pB=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Pg=function(t,e,n,i){return t._startAt&&(_n?t._startAt.revert(ud):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,i))},mB=function r(t){return!t||t._ts&&r(t.parent)},px=function(t){return t._repeat?Ac(t._tTime,t=t.duration()+t._rDelay)*t:0},Ac=function(t,e){var n=Math.floor(t=Je(t/e));return t&&n===t?n-1:n},Nd=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},xf=function(t){return t._end=Je(t._start+(t._tDur/Math.abs(t._ts||t._rts||En)||0))},wf=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=Je(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),xf(t),n._dirty||ko(n,t)),t},kM=function(t,e){var n;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(n=Nd(t.rawTime(),e),(!e._dur||bh(0,e.totalDuration(),n)-e._tTime>En)&&e.render(n,!0)),ko(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},ms=function(t,e,n,i){return e.parent&&Qr(e),e._start=Je((hr(n)?n:n||t!==Ne?Ai(t,n,e):t._time)+e._delay),e._end=Je(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),FM(t,e,"_first","_last",t._sort?"_start":0),Rg(e)||(t._recent=e),i||kM(t,e),t._ts<0&&wf(t,t._tTime),t},NM=function(t,e){return(bi.ScrollTrigger||f_("scrollTrigger",e))&&bi.ScrollTrigger.create(e,t)},UM=function(t,e,n,i,s){if(b_(t,e,s),!t._initted)return 1;if(!n&&t._pt&&!_n&&(t._dur&&t.vars.lazy!==!1||!t._dur&&t.vars.lazy)&&RM!==ui.frame)return jr.push(t),t._lazy=[s,i],1},gB=function r(t){var e=t.parent;return e&&e._ts&&e._initted&&!e._lock&&(e.rawTime()<0||r(e))},Rg=function(t){var e=t.data;return e==="isFromStart"||e==="isStart"},_B=function(t,e,n,i){var s=t.ratio,o=e<0||!e&&(!t._start&&gB(t)&&!(!t._initted&&Rg(t))||(t._ts<0||t._dp._ts<0)&&!Rg(t))?0:1,a=t._rDelay,c=0,l,h,u;if(a&&t._repeat&&(c=bh(0,t._tDur,e),h=Ac(c,a),t._yoyo&&h&1&&(o=1-o),h!==Ac(t._tTime,a)&&(s=1-o,t.vars.repeatRefresh&&t._initted&&t.invalidate())),o!==s||_n||i||t._zTime===En||!e&&t._zTime){if(!t._initted&&UM(t,e,i,n,c))return;for(u=t._zTime,t._zTime=e||(n?En:0),n||(n=e&&!u),t.ratio=o,t._from&&(o=1-o),t._time=0,t._tTime=c,l=t._pt;l;)l.r(o,l.d),l=l._next;e<0&&Pg(t,e,n,!0),t._onUpdate&&!n&&gi(t,"onUpdate"),c&&t._repeat&&!n&&t.parent&&gi(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===o&&(o&&Qr(t,1),!n&&!_n&&(gi(t,o?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)},bB=function(t,e,n){var i;if(n>e)for(i=t._first;i&&i._start<=n;){if(i.data==="isPause"&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=n;){if(i.data==="isPause"&&i._start<e)return i;i=i._prev}},Cc=function(t,e,n,i){var s=t._repeat,o=Je(e)||0,a=t._tTime/t._tDur;return a&&!i&&(t._time*=o/t._dur),t._dur=o,t._tDur=s?s<0?1e10:Je(o*(s+1)+t._rDelay*s):o,a>0&&!i&&wf(t,t._tTime=t._tDur*a),t.parent&&xf(t),n||ko(t.parent,t),t},mx=function(t){return t instanceof Bn?ko(t):Cc(t,t._dur)},yB={_start:0,endTime:eh,totalDuration:eh},Ai=function r(t,e,n){var i=t.labels,s=t._recent||yB,o=t.duration()>=ys?s.endTime(!1):t._dur,a,c,l;return fn(e)&&(isNaN(e)||e in i)?(c=e.charAt(0),l=e.substr(-1)==="%",a=e.indexOf("="),c==="<"||c===">"?(a>=0&&(e=e.replace(/=/,"")),(c==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(e.substr(1))||0)*(l?(a<0?s:n).totalDuration()/100:1)):a<0?(e in i||(i[e]=o),i[e]):(c=parseFloat(e.charAt(a-1)+e.substr(a+1)),l&&n&&(c=c/100*(Pn(n)?n[0]:n).totalDuration()),a>1?r(t,e.substr(0,a-1),n)+c:o+c)):e==null?o:+e},Ul=function(t,e,n){var i=hr(e[1]),s=(i?2:1)+(t<2?0:1),o=e[s],a,c;if(i&&(o.duration=e[1]),o.parent=n,t){for(a=o,c=n;c&&!("immediateRender"in a);)a=c.vars.defaults||{},c=ti(c.vars.inherit)&&c.parent;o.immediateRender=ti(a.immediateRender),t<2?o.runBackwards=1:o.startAt=e[s-1]}return new $e(e[0],o,e[s+1])},so=function(t,e){return t||t===0?e(t):e},bh=function(t,e,n){return n<t?t:n>e?e:n},Mn=function(t,e){return!fn(t)||!(e=cB.exec(t))?"":e[1]},vB=function(t,e,n){return so(n,function(i){return bh(t,e,i)})},Dg=[].slice,BM=function(t,e){return t&&Es(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&Es(t[0]))&&!t.nodeType&&t!==hs},xB=function(t,e,n){return n===void 0&&(n=[]),t.forEach(function(i){var s;return fn(i)&&!e||BM(i,1)?(s=n).push.apply(s,Ni(i)):n.push(i)})||n},Ni=function(t,e,n){return De&&!e&&De.selector?De.selector(t):fn(t)&&!n&&(Ag||!Pc())?Dg.call((e||d_).querySelectorAll(t),0):Pn(t)?xB(t,n):BM(t)?Dg.call(t,0):t?[t]:[]},Lg=function(t){return t=Ni(t)[0]||th("Invalid scope")||{},function(e){var n=t.current||t.nativeElement||t;return Ni(e,n.querySelectorAll?n:n===t?th("Invalid scope")||d_.createElement("div"):t)}},zM=function(t){return t.sort(function(){return .5-Math.random()})},VM=function(t){if(Ge(t))return t;var e=Es(t)?t:{each:t},n=No(e.ease),i=e.from||0,s=parseFloat(e.base)||0,o={},a=i>0&&i<1,c=isNaN(i)||a,l=e.axis,h=i,u=i;return fn(i)?h=u={center:.5,edges:.5,end:1}[i]||0:!a&&c&&(h=i[0],u=i[1]),function(d,f,m){var _=(m||e).length,g=o[_],p,b,y,v,x,S,T,E,w;if(!g){if(w=e.grid==="auto"?0:(e.grid||[1,ys])[1],!w){for(T=-1e8;T<(T=m[w++].getBoundingClientRect().left)&&w<_;);w<_&&w--}for(g=o[_]=[],p=c?Math.min(w,_)*h-.5:i%w,b=w===ys?0:c?_*u/w-.5:i/w|0,T=0,E=ys,S=0;S<_;S++)y=S%w-p,v=b-(S/w|0),g[S]=x=l?Math.abs(l==="y"?v:y):wM(y*y+v*v),x>T&&(T=x),x<E&&(E=x);i==="random"&&zM(g),g.max=T-E,g.min=E,g.v=_=(parseFloat(e.amount)||parseFloat(e.each)*(w>_?_-1:l?l==="y"?_/w:w:Math.max(w,_/w))||0)*(i==="edges"?-1:1),g.b=_<0?s-_:s,g.u=Mn(e.amount||e.each)||0,n=n&&_<0?QM(n):n}return _=(g[d]-g.min)/g.max||0,Je(g.b+(n?n(_):_)*g.v)+g.u}},Ig=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(n){var i=Je(Math.round(parseFloat(n)/t)*t*e);return(i-i%1)/e+(hr(n)?0:Mn(n))}},HM=function(t,e){var n=Pn(t),i,s;return!n&&Es(t)&&(i=n=t.radius||ys,t.values?(t=Ni(t.values),(s=!hr(t[0]))&&(i*=i)):t=Ig(t.increment)),so(e,n?Ge(t)?function(o){return s=t(o),Math.abs(s-o)<=i?s:o}:function(o){for(var a=parseFloat(s?o.x:o),c=parseFloat(s?o.y:0),l=ys,h=0,u=t.length,d,f;u--;)s?(d=t[u].x-a,f=t[u].y-c,d=d*d+f*f):d=Math.abs(t[u]-a),d<l&&(l=d,h=u);return h=!i||l<=i?t[h]:o,s||h===o||hr(o)?h:h+Mn(o)}:Ig(t))},GM=function(t,e,n,i){return so(Pn(t)?!e:n===!0?!!(n=0):!i,function(){return Pn(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+n*.99))/n)*n*i)/i})},wB=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(i){return e.reduce(function(s,o){return o(s)},i)}},SB=function(t,e){return function(n){return t(parseFloat(n))+(e||Mn(n))}},MB=function(t,e,n){return WM(t,e,0,1,n)},jM=function(t,e,n){return so(n,function(i){return t[~~e(i)]})},TB=function r(t,e,n){var i=e-t;return Pn(t)?jM(t,r(0,t.length),e):so(n,function(s){return(i+(s-t)%i)%i+t})},EB=function r(t,e,n){var i=e-t,s=i*2;return Pn(t)?jM(t,r(0,t.length-1),e):so(n,function(o){return o=(s+(o-t)%s)%s||0,t+(o>i?s-o:o)})},nh=function(t){for(var e=0,n="",i,s,o,a;~(i=t.indexOf("random(",e));)o=t.indexOf(")",i),a=t.charAt(i+7)==="[",s=t.substr(i+7,o-i-7).match(a?EM:Eg),n+=t.substr(e,i-e)+GM(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),e=o+1;return n+t.substr(e,t.length-e)},WM=function(t,e,n,i,s){var o=e-t,a=i-n;return so(s,function(c){return n+((c-t)/o*a||0)})},AB=function r(t,e,n,i){var s=isNaN(t+e)?0:function(f){return(1-f)*t+f*e};if(!s){var o=fn(t),a={},c,l,h,u,d;if(n===!0&&(i=1)&&(n=null),o)t={p:t},e={p:e};else if(Pn(t)&&!Pn(e)){for(h=[],u=t.length,d=u-2,l=1;l<u;l++)h.push(r(t[l-1],t[l]));u--,s=function(m){m*=u;var _=Math.min(d,~~m);return h[_](m-_)},n=e}else i||(t=Ec(Pn(t)?[]:{},t));if(!h){for(c in e)__.call(a,t,c,"get",e[c]);s=function(m){return x_(m,a)||(o?t.p:t)}}}return so(n,s)},gx=function(t,e,n){var i=t.labels,s=ys,o,a,c;for(o in i)a=i[o]-e,a<0==!!n&&a&&s>(a=Math.abs(a))&&(c=o,s=a);return c},gi=function(t,e,n){var i=t.vars,s=i[e],o=De,a=t._ctx,c,l,h;if(s)return c=i[e+"Params"],l=i.callbackScope||t,n&&jr.length&&Fd(),a&&(De=a),h=c?s.apply(l,c):s.call(l),De=o,h},wl=function(t){return Qr(t),t.scrollTrigger&&t.scrollTrigger.kill(!!_n),t.progress()<1&&gi(t,"onInterrupt"),t},Qa,XM=[],YM=function(t){if(t)if(t=!t.name&&t.default||t,u_()||t.headless){var e=t.name,n=Ge(t),i=e&&!n&&t.init?function(){this._props=[]}:t,s={init:eh,render:x_,add:__,kill:GB,modifier:HB,rawVars:0},o={targetTest:0,get:0,getSetter:v_,aliases:{},register:0};if(Pc(),t!==i){if(hi[e])return;yi(i,yi(kd(t,s),o)),Ec(i.prototype,Ec(s,kd(t,o))),hi[i.prop=e]=i,t.targetTest&&(dd.push(i),p_[e]=1),e=(e==="css"?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}PM(e,i),t.register&&t.register(ri,i,ni)}else XM.push(t)},ve=255,Sl={aqua:[0,ve,ve],lime:[0,ve,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,ve],navy:[0,0,128],white:[ve,ve,ve],olive:[128,128,0],yellow:[ve,ve,0],orange:[ve,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[ve,0,0],pink:[ve,192,203],cyan:[0,ve,ve],transparent:[ve,ve,ve,0]},$p=function(t,e,n){return t+=t<0?1:t>1?-1:0,(t*6<1?e+(n-e)*t*6:t<.5?n:t*3<2?e+(n-e)*(2/3-t)*6:e)*ve+.5|0},qM=function(t,e,n){var i=t?hr(t)?[t>>16,t>>8&ve,t&ve]:0:Sl.black,s,o,a,c,l,h,u,d,f,m;if(!i){if(t.substr(-1)===","&&(t=t.substr(0,t.length-1)),Sl[t])i=Sl[t];else if(t.charAt(0)==="#"){if(t.length<6&&(s=t.charAt(1),o=t.charAt(2),a=t.charAt(3),t="#"+s+s+o+o+a+a+(t.length===5?t.charAt(4)+t.charAt(4):"")),t.length===9)return i=parseInt(t.substr(1,6),16),[i>>16,i>>8&ve,i&ve,parseInt(t.substr(7),16)/255];t=parseInt(t.substr(1),16),i=[t>>16,t>>8&ve,t&ve]}else if(t.substr(0,3)==="hsl"){if(i=m=t.match(Eg),!e)c=+i[0]%360/360,l=+i[1]/100,h=+i[2]/100,o=h<=.5?h*(l+1):h+l-h*l,s=h*2-o,i.length>3&&(i[3]*=1),i[0]=$p(c+1/3,s,o),i[1]=$p(c,s,o),i[2]=$p(c-1/3,s,o);else if(~t.indexOf("="))return i=t.match(MM),n&&i.length<4&&(i[3]=1),i}else i=t.match(Eg)||Sl.transparent;i=i.map(Number)}return e&&!m&&(s=i[0]/ve,o=i[1]/ve,a=i[2]/ve,u=Math.max(s,o,a),d=Math.min(s,o,a),h=(u+d)/2,u===d?c=l=0:(f=u-d,l=h>.5?f/(2-u-d):f/(u+d),c=u===s?(o-a)/f+(o<a?6:0):u===o?(a-s)/f+2:(s-o)/f+4,c*=60),i[0]=~~(c+.5),i[1]=~~(l*100+.5),i[2]=~~(h*100+.5)),n&&i.length<4&&(i[3]=1),i},KM=function(t){var e=[],n=[],i=-1;return t.split(Wr).forEach(function(s){var o=s.match(Za)||[];e.push.apply(e,o),n.push(i+=o.length+1)}),e.c=n,e},_x=function(t,e,n){var i="",s=(t+i).match(Wr),o=e?"hsla(":"rgba(",a=0,c,l,h,u;if(!s)return t;if(s=s.map(function(d){return(d=qM(d,e,1))&&o+(e?d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:d.join(","))+")"}),n&&(h=KM(t),c=n.c,c.join(i)!==h.c.join(i)))for(l=t.replace(Wr,"1").split(Za),u=l.length-1;a<u;a++)i+=l[a]+(~c.indexOf(a)?s.shift()||o+"0,0,0,0)":(h.length?h:s.length?s:n).shift());if(!l)for(l=t.split(Wr),u=l.length-1;a<u;a++)i+=l[a]+s[a];return i+l[u]},Wr=function(){var r="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",t;for(t in Sl)r+="|"+t+"\\b";return new RegExp(r+")","gi")}(),CB=/hsl[a]?\(/,ZM=function(t){var e=t.join(" "),n;if(Wr.lastIndex=0,Wr.test(e))return n=CB.test(e),t[1]=_x(t[1],n),t[0]=_x(t[0],n,KM(t[1])),!0},ih,ui=function(){var r=Date.now,t=500,e=33,n=r(),i=n,s=1e3/240,o=s,a=[],c,l,h,u,d,f,m=function _(g){var p=r()-i,b=g===!0,y,v,x,S;if((p>t||p<0)&&(n+=p-e),i+=p,x=i-n,y=x-o,(y>0||b)&&(S=++u.frame,d=x-u.time*1e3,u.time=x=x/1e3,o+=y+(y>=s?4:s-y),v=1),b||(c=l(_)),v)for(f=0;f<a.length;f++)a[f](x,d,S,g)};return u={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(g){return d/(1e3/(g||60))},wake:function(){AM&&(!Ag&&u_()&&(hs=Ag=window,d_=hs.document||{},bi.gsap=ri,(hs.gsapVersions||(hs.gsapVersions=[])).push(ri.version),CM(Od||hs.GreenSockGlobals||!hs.gsap&&hs||{}),XM.forEach(YM)),h=typeof requestAnimationFrame<"u"&&requestAnimationFrame,c&&u.sleep(),l=h||function(g){return setTimeout(g,o-u.time*1e3+1|0)},ih=1,m(2))},sleep:function(){(h?cancelAnimationFrame:clearTimeout)(c),ih=0,l=eh},lagSmoothing:function(g,p){t=g||1/0,e=Math.min(p||33,t)},fps:function(g){s=1e3/(g||240),o=u.time*1e3+s},add:function(g,p,b){var y=p?function(v,x,S,T){g(v,x,S,T),u.remove(y)}:g;return u.remove(g),a[b?"unshift":"push"](y),Pc(),y},remove:function(g,p){~(p=a.indexOf(g))&&a.splice(p,1)&&f>=p&&f--},_listeners:a},u}(),Pc=function(){return!ih&&ui.wake()},se={},PB=/^[\d.\-M][\d.\-,\s]/,RB=/["']/g,DB=function(t){for(var e={},n=t.substr(1,t.length-3).split(":"),i=n[0],s=1,o=n.length,a,c,l;s<o;s++)c=n[s],a=s!==o-1?c.lastIndexOf(","):c.length,l=c.substr(0,a),e[i]=isNaN(l)?l.replace(RB,"").trim():+l,i=c.substr(a+1).trim();return e},LB=function(t){var e=t.indexOf("(")+1,n=t.indexOf(")"),i=t.indexOf("(",e);return t.substring(e,~i&&i<n?t.indexOf(")",n+1):n)},IB=function(t){var e=(t+"").split("("),n=se[e[0]];return n&&e.length>1&&n.config?n.config.apply(null,~t.indexOf("{")?[DB(e[1])]:LB(t).split(",").map(IM)):se._CE&&PB.test(t)?se._CE("",t):n},QM=function(t){return function(e){return 1-t(1-e)}},$M=function r(t,e){for(var n=t._first,i;n;)n instanceof Bn?r(n,e):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==e&&(n.timeline?r(n.timeline,e):(i=n._ease,n._ease=n._yEase,n._yEase=i,n._yoyo=e)),n=n._next},No=function(t,e){return t&&(Ge(t)?t:se[t]||IB(t))||e},ta=function(t,e,n,i){n===void 0&&(n=function(c){return 1-e(1-c)}),i===void 0&&(i=function(c){return c<.5?e(c*2)/2:1-e((1-c)*2)/2});var s={easeIn:e,easeOut:n,easeInOut:i},o;return ei(t,function(a){se[a]=bi[a]=s,se[o=a.toLowerCase()]=n;for(var c in s)se[o+(c==="easeIn"?".in":c==="easeOut"?".out":".inOut")]=se[a+"."+c]=s[c]}),s},JM=function(t){return function(e){return e<.5?(1-t(1-e*2))/2:.5+t((e-.5)*2)/2}},Jp=function r(t,e,n){var i=e>=1?e:1,s=(n||(t?.3:.45))/(e<1?e:1),o=s/Tg*(Math.asin(1/i)||0),a=function(h){return h===1?1:i*Math.pow(2,-10*h)*aB((h-o)*s)+1},c=t==="out"?a:t==="in"?function(l){return 1-a(1-l)}:JM(a);return s=Tg/s,c.config=function(l,h){return r(t,l,h)},c},tm=function r(t,e){e===void 0&&(e=1.70158);var n=function(o){return o?--o*o*((e+1)*o+e)+1:0},i=t==="out"?n:t==="in"?function(s){return 1-n(1-s)}:JM(n);return i.config=function(s){return r(t,s)},i};ei("Linear,Quad,Cubic,Quart,Quint,Strong",function(r,t){var e=t<5?t+1:t;ta(r+",Power"+(e-1),t?function(n){return Math.pow(n,e)}:function(n){return n},function(n){return 1-Math.pow(1-n,e)},function(n){return n<.5?Math.pow(n*2,e)/2:1-Math.pow((1-n)*2,e)/2})});se.Linear.easeNone=se.none=se.Linear.easeIn;ta("Elastic",Jp("in"),Jp("out"),Jp());(function(r,t){var e=1/t,n=2*e,i=2.5*e,s=function(a){return a<e?r*a*a:a<n?r*Math.pow(a-1.5/t,2)+.75:a<i?r*(a-=2.25/t)*a+.9375:r*Math.pow(a-2.625/t,2)+.984375};ta("Bounce",function(o){return 1-s(1-o)},s)})(7.5625,2.75);ta("Expo",function(r){return Math.pow(2,10*(r-1))*r+r*r*r*r*r*r*(1-r)});ta("Circ",function(r){return-(wM(1-r*r)-1)});ta("Sine",function(r){return r===1?1:-oB(r*sB)+1});ta("Back",tm("in"),tm("out"),tm());se.SteppedEase=se.steps=bi.SteppedEase={config:function(t,e){t===void 0&&(t=1);var n=1/t,i=t+(e?0:1),s=e?1:0,o=1-En;return function(a){return((i*bh(0,o,a)|0)+s)*n}}};Tc.ease=se["quad.out"];ei("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(r){return m_+=r+","+r+"Params,"});var tT=function(t,e){this.id=rB++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:DM,this.set=e?e.getSetter:v_},sh=function(){function r(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Cc(this,+e.duration,1,1),this.data=e.data,De&&(this._ctx=De,De.data.push(this)),ih||ui.wake()}var t=r.prototype;return t.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},t.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},t.totalDuration=function(n){return arguments.length?(this._dirty=0,Cc(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(n,i){if(Pc(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(wf(this,n),!s._dp||s.parent||kM(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&ms(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===En||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),LM(this,n,i)),this},t.time=function(n,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+px(this))%(this._dur+this._rDelay)||(n?this._dur:0),i):this._time},t.totalProgress=function(n,i){return arguments.length?this.totalTime(this.totalDuration()*n,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},t.progress=function(n,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+px(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},t.iteration=function(n,i){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*s,i):this._repeat?Ac(this._tTime,s)+1:1},t.timeScale=function(n,i){if(!arguments.length)return this._rts===-1e-8?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?Nd(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-1e-8?0:this._rts,this.totalTime(bh(-Math.abs(this._delay),this._tDur,s),i!==!1),xf(this),pB(this)},t.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Pc(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==En&&(this._tTime-=En)))),this):this._ps},t.startTime=function(n){if(arguments.length){this._start=n;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&ms(i,this,n-this._delay),this}return this._start},t.endTime=function(n){return this._start+(ti(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(n){var i=this.parent||this._dp;return i?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Nd(i.rawTime(n),this):this._tTime:this._tTime},t.revert=function(n){n===void 0&&(n=hB);var i=_n;return _n=n,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),_n=i,this},t.globalTime=function(n){for(var i=this,s=arguments.length?n:i.rawTime();i;)s=i._start+s/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(n):s},t.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,mx(this)):this._repeat===-2?1/0:this._repeat},t.repeatDelay=function(n){if(arguments.length){var i=this._time;return this._rDelay=n,mx(this),i?this.time(i):this}return this._rDelay},t.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},t.seek=function(n,i){return this.totalTime(Ai(this,n),ti(i))},t.restart=function(n,i){return this.play().totalTime(n?-this._delay:0,ti(i)),this._dur||(this._zTime=-1e-8),this},t.play=function(n,i){return n!=null&&this.seek(n,i),this.reversed(!1).paused(!1)},t.reverse=function(n,i){return n!=null&&this.seek(n||this.totalDuration(),i),this.reversed(!0).paused(!1)},t.pause=function(n,i){return n!=null&&this.seek(n,i),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var n=this.parent||this._dp,i=this._start,s;return!!(!n||this._ts&&this._initted&&n.isActive()&&(s=n.rawTime(!0))>=i&&s<this.endTime(!0)-En)},t.eventCallback=function(n,i,s){var o=this.vars;return arguments.length>1?(i?(o[n]=i,s&&(o[n+"Params"]=s),n==="onUpdate"&&(this._onUpdate=i)):delete o[n],this):o[n]},t.then=function(n){var i=this;return new Promise(function(s){var o=Ge(n)?n:OM,a=function(){var l=i.then;i.then=null,Ge(o)&&(o=o(i))&&(o.then||o===i)&&(i.then=l),s(o),i.then=l};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},t.kill=function(){wl(this)},r}();yi(sh.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Bn=function(r){xM(t,r);function t(n,i){var s;return n===void 0&&(n={}),s=r.call(this,n)||this,s.labels={},s.smoothChildTiming=!!n.smoothChildTiming,s.autoRemoveChildren=!!n.autoRemoveChildren,s._sort=ti(n.sortChildren),Ne&&ms(n.parent||Ne,Gs(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),n.scrollTrigger&&NM(Gs(s),n.scrollTrigger),s}var e=t.prototype;return e.to=function(i,s,o){return Ul(0,arguments,this),this},e.from=function(i,s,o){return Ul(1,arguments,this),this},e.fromTo=function(i,s,o,a){return Ul(2,arguments,this),this},e.set=function(i,s,o){return s.duration=0,s.parent=this,Nl(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new $e(i,s,Ai(this,o),1),this},e.call=function(i,s,o){return ms(this,$e.delayedCall(0,i,s),o)},e.staggerTo=function(i,s,o,a,c,l,h){return o.duration=s,o.stagger=o.stagger||a,o.onComplete=l,o.onCompleteParams=h,o.parent=this,new $e(i,o,Ai(this,c)),this},e.staggerFrom=function(i,s,o,a,c,l,h){return o.runBackwards=1,Nl(o).immediateRender=ti(o.immediateRender),this.staggerTo(i,s,o,a,c,l,h)},e.staggerFromTo=function(i,s,o,a,c,l,h,u){return a.startAt=o,Nl(a).immediateRender=ti(a.immediateRender),this.staggerTo(i,s,a,c,l,h,u)},e.render=function(i,s,o){var a=this._time,c=this._dirty?this.totalDuration():this._tDur,l=this._dur,h=i<=0?0:Je(i),u=this._zTime<0!=i<0&&(this._initted||!l),d,f,m,_,g,p,b,y,v,x,S,T;if(this!==Ne&&h>c&&i>=0&&(h=c),h!==this._tTime||o||u){if(a!==this._time&&l&&(h+=this._time-a,i+=this._time-a),d=h,v=this._start,y=this._ts,p=!y,u&&(l||(a=this._zTime),(i||!s)&&(this._zTime=i)),this._repeat){if(S=this._yoyo,g=l+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(g*100+i,s,o);if(d=Je(h%g),h===c?(_=this._repeat,d=l):(x=Je(h/g),_=~~x,_&&_===x&&(d=l,_--),d>l&&(d=l)),x=Ac(this._tTime,g),!a&&this._tTime&&x!==_&&this._tTime-x*g-this._dur<=0&&(x=_),S&&_&1&&(d=l-d,T=1),_!==x&&!this._lock){var E=S&&x&1,w=E===(S&&_&1);if(_<x&&(E=!E),a=E?0:h%l?l:h,this._lock=1,this.render(a||(T?0:Je(_*g)),s,!l)._lock=0,this._tTime=h,!s&&this.parent&&gi(this,"onRepeat"),this.vars.repeatRefresh&&!T&&(this.invalidate()._lock=1),a&&a!==this._time||p!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(l=this._dur,c=this._tDur,w&&(this._lock=2,a=E?l:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!T&&this.invalidate()),this._lock=0,!this._ts&&!p)return this;$M(this,T)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(b=bB(this,Je(a),Je(d)),b&&(h-=d-(d=b._start))),this._tTime=h,this._time=d,this._act=!y,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&d&&!s&&!_&&(gi(this,"onStart"),this._tTime!==h))return this;if(d>=a&&i>=0)for(f=this._first;f;){if(m=f._next,(f._act||d>=f._start)&&f._ts&&b!==f){if(f.parent!==this)return this.render(i,s,o);if(f.render(f._ts>0?(d-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(d-f._start)*f._ts,s,o),d!==this._time||!this._ts&&!p){b=0,m&&(h+=this._zTime=-1e-8);break}}f=m}else{f=this._last;for(var M=i<0?i:d;f;){if(m=f._prev,(f._act||M<=f._end)&&f._ts&&b!==f){if(f.parent!==this)return this.render(i,s,o);if(f.render(f._ts>0?(M-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(M-f._start)*f._ts,s,o||_n&&(f._initted||f._startAt)),d!==this._time||!this._ts&&!p){b=0,m&&(h+=this._zTime=M?-1e-8:En);break}}f=m}}if(b&&!s&&(this.pause(),b.render(d>=a?0:-1e-8)._zTime=d>=a?1:-1,this._ts))return this._start=v,xf(this),this.render(i,s,o);this._onUpdate&&!s&&gi(this,"onUpdate",!0),(h===c&&this._tTime>=this.totalDuration()||!h&&a)&&(v===this._start||Math.abs(y)!==Math.abs(this._ts))&&(this._lock||((i||!l)&&(h===c&&this._ts>0||!h&&this._ts<0)&&Qr(this,1),!s&&!(i<0&&!a)&&(h||a||!c)&&(gi(this,h===c&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(h<c&&this.timeScale()>0)&&this._prom())))}return this},e.add=function(i,s){var o=this;if(hr(s)||(s=Ai(this,s,i)),!(i instanceof sh)){if(Pn(i))return i.forEach(function(a){return o.add(a,s)}),this;if(fn(i))return this.addLabel(i,s);if(Ge(i))i=$e.delayedCall(0,i);else return this}return this!==i?ms(this,i,s):this},e.getChildren=function(i,s,o,a){i===void 0&&(i=!0),s===void 0&&(s=!0),o===void 0&&(o=!0),a===void 0&&(a=-1e8);for(var c=[],l=this._first;l;)l._start>=a&&(l instanceof $e?s&&c.push(l):(o&&c.push(l),i&&c.push.apply(c,l.getChildren(!0,s,o)))),l=l._next;return c},e.getById=function(i){for(var s=this.getChildren(1,1,1),o=s.length;o--;)if(s[o].vars.id===i)return s[o]},e.remove=function(i){return fn(i)?this.removeLabel(i):Ge(i)?this.killTweensOf(i):(i.parent===this&&vf(this,i),i===this._recent&&(this._recent=this._last),ko(this))},e.totalTime=function(i,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Je(ui.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),r.prototype.totalTime.call(this,i,s),this._forcing=0,this):this._tTime},e.addLabel=function(i,s){return this.labels[i]=Ai(this,s),this},e.removeLabel=function(i){return delete this.labels[i],this},e.addPause=function(i,s,o){var a=$e.delayedCall(0,s||eh,o);return a.data="isPause",this._hasPause=1,ms(this,a,Ai(this,i))},e.removePause=function(i){var s=this._first;for(i=Ai(this,i);s;)s._start===i&&s.data==="isPause"&&Qr(s),s=s._next},e.killTweensOf=function(i,s,o){for(var a=this.getTweensOf(i,o),c=a.length;c--;)Ur!==a[c]&&a[c].kill(i,s);return this},e.getTweensOf=function(i,s){for(var o=[],a=Ni(i),c=this._first,l=hr(s),h;c;)c instanceof $e?uB(c._targets,a)&&(l?(!Ur||c._initted&&c._ts)&&c.globalTime(0)<=s&&c.globalTime(c.totalDuration())>s:!s||c.isActive())&&o.push(c):(h=c.getTweensOf(a,s)).length&&o.push.apply(o,h),c=c._next;return o},e.tweenTo=function(i,s){s=s||{};var o=this,a=Ai(o,i),c=s,l=c.startAt,h=c.onStart,u=c.onStartParams,d=c.immediateRender,f,m=$e.to(o,yi({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale())||En,onStart:function(){if(o.pause(),!f){var g=s.duration||Math.abs((a-(l&&"time"in l?l.time:o._time))/o.timeScale());m._dur!==g&&Cc(m,g,0,1).render(m._time,!0,!0),f=1}h&&h.apply(m,u||[])}},s));return d?m.render(0):m},e.tweenFromTo=function(i,s,o){return this.tweenTo(s,yi({startAt:{time:Ai(this,i)}},o))},e.recent=function(){return this._recent},e.nextLabel=function(i){return i===void 0&&(i=this._time),gx(this,Ai(this,i))},e.previousLabel=function(i){return i===void 0&&(i=this._time),gx(this,Ai(this,i),1)},e.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+En)},e.shiftChildren=function(i,s,o){o===void 0&&(o=0);for(var a=this._first,c=this.labels,l;a;)a._start>=o&&(a._start+=i,a._end+=i),a=a._next;if(s)for(l in c)c[l]>=o&&(c[l]+=i);return ko(this)},e.invalidate=function(i){var s=this._first;for(this._lock=0;s;)s.invalidate(i),s=s._next;return r.prototype.invalidate.call(this,i)},e.clear=function(i){i===void 0&&(i=!0);for(var s=this._first,o;s;)o=s._next,this.remove(s),s=o;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),ko(this)},e.totalDuration=function(i){var s=0,o=this,a=o._last,c=ys,l,h,u;if(arguments.length)return o.timeScale((o._repeat<0?o.duration():o.totalDuration())/(o.reversed()?-i:i));if(o._dirty){for(u=o.parent;a;)l=a._prev,a._dirty&&a.totalDuration(),h=a._start,h>c&&o._sort&&a._ts&&!o._lock?(o._lock=1,ms(o,a,h-a._delay,1)._lock=0):c=h,h<0&&a._ts&&(s-=h,(!u&&!o._dp||u&&u.smoothChildTiming)&&(o._start+=h/o._ts,o._time-=h,o._tTime-=h),o.shiftChildren(-h,!1,-1/0),c=0),a._end>s&&a._ts&&(s=a._end),a=l;Cc(o,o===Ne&&o._time>s?o._time:s,1,1),o._dirty=0}return o._tDur},t.updateRoot=function(i){if(Ne._ts&&(LM(Ne,Nd(i,Ne)),RM=ui.frame),ui.frame>=dx){dx+=_i.autoSleep||120;var s=Ne._first;if((!s||!s._ts)&&_i.autoSleep&&ui._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||ui.sleep()}}},t}(sh);yi(Bn.prototype,{_lock:0,_hasPause:0,_forcing:0});var OB=function(t,e,n,i,s,o,a){var c=new ni(this._pt,t,e,0,1,oT,null,s),l=0,h=0,u,d,f,m,_,g,p,b;for(c.b=n,c.e=i,n+="",i+="",(p=~i.indexOf("random("))&&(i=nh(i)),o&&(b=[n,i],o(b,t,e),n=b[0],i=b[1]),d=n.match(Zp)||[];u=Zp.exec(i);)m=u[0],_=i.substring(l,u.index),f?f=(f+1)%5:_.substr(-5)==="rgba("&&(f=1),m!==d[h++]&&(g=parseFloat(d[h-1])||0,c._pt={_next:c._pt,p:_||h===1?_:",",s:g,c:m.charAt(1)==="="?cc(g,m)-g:parseFloat(m)-g,m:f&&f<4?Math.round:0},l=Zp.lastIndex);return c.c=l<i.length?i.substring(l,i.length):"",c.fp=a,(TM.test(i)||p)&&(c.e=0),this._pt=c,c},__=function(t,e,n,i,s,o,a,c,l,h){Ge(i)&&(i=i(s||0,t,o));var u=t[e],d=n!=="get"?n:Ge(u)?l?t[e.indexOf("set")||!Ge(t["get"+e.substr(3)])?e:"get"+e.substr(3)](l):t[e]():u,f=Ge(u)?l?BB:sT:y_,m;if(fn(i)&&(~i.indexOf("random(")&&(i=nh(i)),i.charAt(1)==="="&&(m=cc(d,i)+(Mn(d)||0),(m||m===0)&&(i=m))),!h||d!==i||Og)return!isNaN(d*i)&&i!==""?(m=new ni(this._pt,t,e,+d||0,i-(d||0),typeof u=="boolean"?VB:rT,0,f),l&&(m.fp=l),a&&m.modifier(a,this,t),this._pt=m):(!u&&!(e in t)&&f_(e,i),OB.call(this,t,e,d,i,f,c||_i.stringFilter,l))},FB=function(t,e,n,i,s){if(Ge(t)&&(t=Bl(t,s,e,n,i)),!Es(t)||t.style&&t.nodeType||Pn(t)||SM(t))return fn(t)?Bl(t,s,e,n,i):t;var o={},a;for(a in t)o[a]=Bl(t[a],s,e,n,i);return o},eT=function(t,e,n,i,s,o){var a,c,l,h;if(hi[t]&&(a=new hi[t]).init(s,a.rawVars?e[t]:FB(e[t],i,s,o,n),n,i,o)!==!1&&(n._pt=c=new ni(n._pt,s,t,0,1,a.render,a,0,a.priority),n!==Qa))for(l=n._ptLookup[n._targets.indexOf(s)],h=a._props.length;h--;)l[a._props[h]]=c;return a},Ur,Og,b_=function r(t,e,n){var i=t.vars,s=i.ease,o=i.startAt,a=i.immediateRender,c=i.lazy,l=i.onUpdate,h=i.runBackwards,u=i.yoyoEase,d=i.keyframes,f=i.autoRevert,m=t._dur,_=t._startAt,g=t._targets,p=t.parent,b=p&&p.data==="nested"?p.vars.targets:g,y=t._overwrite==="auto"&&!l_,v=t.timeline,x,S,T,E,w,M,P,L,I,F,z,N,Z;if(v&&(!d||!s)&&(s="none"),t._ease=No(s,Tc.ease),t._yEase=u?QM(No(u===!0?s:u,Tc.ease)):0,u&&t._yoyo&&!t._repeat&&(u=t._yEase,t._yEase=t._ease,t._ease=u),t._from=!v&&!!i.runBackwards,!v||d&&!i.stagger){if(L=g[0]?Fo(g[0]).harness:0,N=L&&i[L.prop],x=kd(i,p_),_&&(_._zTime<0&&_.progress(1),e<0&&h&&a&&!f?_.render(-1,!0):_.revert(h&&m?ud:lB),_._lazy=0),o){if(Qr(t._startAt=$e.set(g,yi({data:"isStart",overwrite:!1,parent:p,immediateRender:!0,lazy:!_&&ti(c),startAt:null,delay:0,onUpdate:l&&function(){return gi(t,"onUpdate")},stagger:0},o))),t._startAt._dp=0,t._startAt._sat=t,e<0&&(_n||!a&&!f)&&t._startAt.revert(ud),a&&m&&e<=0&&n<=0){e&&(t._zTime=e);return}}else if(h&&m&&!_){if(e&&(a=!1),T=yi({overwrite:!1,data:"isFromStart",lazy:a&&!_&&ti(c),immediateRender:a,stagger:0,parent:p},x),N&&(T[L.prop]=N),Qr(t._startAt=$e.set(g,T)),t._startAt._dp=0,t._startAt._sat=t,e<0&&(_n?t._startAt.revert(ud):t._startAt.render(-1,!0)),t._zTime=e,!a)r(t._startAt,En,En);else if(!e)return}for(t._pt=t._ptCache=0,c=m&&ti(c)||c&&!m,S=0;S<g.length;S++){if(w=g[S],P=w._gsap||g_(g)[S]._gsap,t._ptLookup[S]=F={},Cg[P.id]&&jr.length&&Fd(),z=b===g?S:b.indexOf(w),L&&(I=new L).init(w,N||x,t,z,b)!==!1&&(t._pt=E=new ni(t._pt,w,I.name,0,1,I.render,I,0,I.priority),I._props.forEach(function(j){F[j]=E}),I.priority&&(M=1)),!L||N)for(T in x)hi[T]&&(I=eT(T,x,t,z,w,b))?I.priority&&(M=1):F[T]=E=__.call(t,w,T,"get",x[T],z,b,0,i.stringFilter);t._op&&t._op[S]&&t.kill(w,t._op[S]),y&&t._pt&&(Ur=t,Ne.killTweensOf(w,F,t.globalTime(e)),Z=!t.parent,Ur=0),t._pt&&c&&(Cg[P.id]=1)}M&&aT(t),t._onInit&&t._onInit(t)}t._onUpdate=l,t._initted=(!t._op||t._pt)&&!Z,d&&e<=0&&v.render(ys,!0,!0)},kB=function(t,e,n,i,s,o,a,c){var l=(t._pt&&t._ptCache||(t._ptCache={}))[e],h,u,d,f;if(!l)for(l=t._ptCache[e]=[],d=t._ptLookup,f=t._targets.length;f--;){if(h=d[f][e],h&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==e&&h.fp!==e;)h=h._next;if(!h)return Og=1,t.vars[e]="+=0",b_(t,a),Og=0,c?th(e+" not eligible for reset"):1;l.push(h)}for(f=l.length;f--;)u=l[f],h=u._pt||u,h.s=(i||i===0)&&!s?i:h.s+(i||0)+o*h.c,h.c=n-h.s,u.e&&(u.e=Ye(n)+Mn(u.e)),u.b&&(u.b=h.s+Mn(u.b))},NB=function(t,e){var n=t[0]?Fo(t[0]).harness:0,i=n&&n.aliases,s,o,a,c;if(!i)return e;s=Ec({},e);for(o in i)if(o in s)for(c=i[o].split(","),a=c.length;a--;)s[c[a]]=s[o];return s},UB=function(t,e,n,i){var s=e.ease||i||"power1.inOut",o,a;if(Pn(e))a=n[t]||(n[t]=[]),e.forEach(function(c,l){return a.push({t:l/(e.length-1)*100,v:c,e:s})});else for(o in e)a=n[o]||(n[o]=[]),o==="ease"||a.push({t:parseFloat(t),v:e[o],e:s})},Bl=function(t,e,n,i,s){return Ge(t)?t.call(e,n,i,s):fn(t)&&~t.indexOf("random(")?nh(t):t},nT=m_+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",iT={};ei(nT+",id,stagger,delay,duration,paused,scrollTrigger",function(r){return iT[r]=1});var $e=function(r){xM(t,r);function t(n,i,s,o){var a;typeof i=="number"&&(s.duration=i,i=s,s=null),a=r.call(this,o?i:Nl(i))||this;var c=a.vars,l=c.duration,h=c.delay,u=c.immediateRender,d=c.stagger,f=c.overwrite,m=c.keyframes,_=c.defaults,g=c.scrollTrigger,p=c.yoyoEase,b=i.parent||Ne,y=(Pn(n)||SM(n)?hr(n[0]):"length"in i)?[n]:Ni(n),v,x,S,T,E,w,M,P;if(a._targets=y.length?g_(y):th("GSAP target "+n+" not found. https://gsap.com",!_i.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,m||d||Qu(l)||Qu(h)){if(i=a.vars,v=a.timeline=new Bn({data:"nested",defaults:_||{},targets:b&&b.data==="nested"?b.vars.targets:y}),v.kill(),v.parent=v._dp=Gs(a),v._start=0,d||Qu(l)||Qu(h)){if(T=y.length,M=d&&VM(d),Es(d))for(E in d)~nT.indexOf(E)&&(P||(P={}),P[E]=d[E]);for(x=0;x<T;x++)S=kd(i,iT),S.stagger=0,p&&(S.yoyoEase=p),P&&Ec(S,P),w=y[x],S.duration=+Bl(l,Gs(a),x,w,y),S.delay=(+Bl(h,Gs(a),x,w,y)||0)-a._delay,!d&&T===1&&S.delay&&(a._delay=h=S.delay,a._start+=h,S.delay=0),v.to(w,S,M?M(x,w,y):0),v._ease=se.none;v.duration()?l=h=0:a.timeline=0}else if(m){Nl(yi(v.vars.defaults,{ease:"none"})),v._ease=No(m.ease||i.ease||"none");var L=0,I,F,z;if(Pn(m))m.forEach(function(N){return v.to(y,N,">")}),v.duration();else{S={};for(E in m)E==="ease"||E==="easeEach"||UB(E,m[E],S,m.easeEach);for(E in S)for(I=S[E].sort(function(N,Z){return N.t-Z.t}),L=0,x=0;x<I.length;x++)F=I[x],z={ease:F.e,duration:(F.t-(x?I[x-1].t:0))/100*l},z[E]=F.v,v.to(y,z,L),L+=z.duration;v.duration()<l&&v.to({},{duration:l-v.duration()})}}l||a.duration(l=v.duration())}else a.timeline=0;return f===!0&&!l_&&(Ur=Gs(a),Ne.killTweensOf(y),Ur=0),ms(b,Gs(a),s),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(u||!l&&!m&&a._start===Je(b._time)&&ti(u)&&mB(Gs(a))&&b.data!=="nested")&&(a._tTime=-1e-8,a.render(Math.max(0,-h)||0)),g&&NM(Gs(a),g),a}var e=t.prototype;return e.render=function(i,s,o){var a=this._time,c=this._tDur,l=this._dur,h=i<0,u=i>c-En&&!h?c:i<En?0:i,d,f,m,_,g,p,b,y,v;if(!l)_B(this,i,s,o);else if(u!==this._tTime||!i||o||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==h||this._lazy){if(d=u,y=this.timeline,this._repeat){if(_=l+this._rDelay,this._repeat<-1&&h)return this.totalTime(_*100+i,s,o);if(d=Je(u%_),u===c?(m=this._repeat,d=l):(g=Je(u/_),m=~~g,m&&m===g?(d=l,m--):d>l&&(d=l)),p=this._yoyo&&m&1,p&&(v=this._yEase,d=l-d),g=Ac(this._tTime,_),d===a&&!o&&this._initted&&m===g)return this._tTime=u,this;m!==g&&(y&&this._yEase&&$M(y,p),this.vars.repeatRefresh&&!p&&!this._lock&&d!==_&&this._initted&&(this._lock=o=1,this.render(Je(_*m),!0).invalidate()._lock=0))}if(!this._initted){if(UM(this,h?i:d,o,s,u))return this._tTime=0,this;if(a!==this._time&&!(o&&this.vars.repeatRefresh&&m!==g))return this;if(l!==this._dur)return this.render(i,s,o)}if(this._tTime=u,this._time=d,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=b=(v||this._ease)(d/l),this._from&&(this.ratio=b=1-b),d&&!a&&!s&&!m&&(gi(this,"onStart"),this._tTime!==u))return this;for(f=this._pt;f;)f.r(b,f.d),f=f._next;y&&y.render(i<0?i:y._dur*y._ease(d/this._dur),s,o)||this._startAt&&(this._zTime=i),this._onUpdate&&!s&&(h&&Pg(this,i,s,o),gi(this,"onUpdate")),this._repeat&&m!==g&&this.vars.onRepeat&&!s&&this.parent&&gi(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(h&&!this._onUpdate&&Pg(this,i,!0,!0),(i||!l)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&Qr(this,1),!s&&!(h&&!a)&&(u||a||p)&&(gi(this,u===c?"onComplete":"onReverseComplete",!0),this._prom&&!(u<c&&this.timeScale()>0)&&this._prom()))}return this},e.targets=function(){return this._targets},e.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),r.prototype.invalidate.call(this,i)},e.resetTo=function(i,s,o,a,c){ih||ui.wake(),this._ts||this.play();var l=Math.min(this._dur,(this._dp._time-this._start)*this._ts),h;return this._initted||b_(this,l),h=this._ease(l/this._dur),kB(this,i,s,o,a,h,l,c)?this.resetTo(i,s,o,a,1):(wf(this,0),this.parent||FM(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},e.kill=function(i,s){if(s===void 0&&(s="all"),!i&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?wl(this):this.scrollTrigger&&this.scrollTrigger.kill(!!_n),this;if(this.timeline){var o=this.timeline.totalDuration();return this.timeline.killTweensOf(i,s,Ur&&Ur.vars.overwrite!==!0)._first||wl(this),this.parent&&o!==this.timeline.totalDuration()&&Cc(this,this._dur*this.timeline._tDur/o,0,1),this}var a=this._targets,c=i?Ni(i):a,l=this._ptLookup,h=this._pt,u,d,f,m,_,g,p;if((!s||s==="all")&&fB(a,c))return s==="all"&&(this._pt=0),wl(this);for(u=this._op=this._op||[],s!=="all"&&(fn(s)&&(_={},ei(s,function(b){return _[b]=1}),s=_),s=NB(a,s)),p=a.length;p--;)if(~c.indexOf(a[p])){d=l[p],s==="all"?(u[p]=s,m=d,f={}):(f=u[p]=u[p]||{},m=s);for(_ in m)g=d&&d[_],g&&((!("kill"in g.d)||g.d.kill(_)===!0)&&vf(this,g,"_pt"),delete d[_]),f!=="all"&&(f[_]=1)}return this._initted&&!this._pt&&h&&wl(this),this},t.to=function(i,s){return new t(i,s,arguments[2])},t.from=function(i,s){return Ul(1,arguments)},t.delayedCall=function(i,s,o,a){return new t(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:s,onReverseComplete:s,onCompleteParams:o,onReverseCompleteParams:o,callbackScope:a})},t.fromTo=function(i,s,o){return Ul(2,arguments)},t.set=function(i,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new t(i,s)},t.killTweensOf=function(i,s,o){return Ne.killTweensOf(i,s,o)},t}(sh);yi($e.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});ei("staggerTo,staggerFrom,staggerFromTo",function(r){$e[r]=function(){var t=new Bn,e=Dg.call(arguments,0);return e.splice(r==="staggerFromTo"?5:4,0,0),t[r].apply(t,e)}});var y_=function(t,e,n){return t[e]=n},sT=function(t,e,n){return t[e](n)},BB=function(t,e,n,i){return t[e](i.fp,n)},zB=function(t,e,n){return t.setAttribute(e,n)},v_=function(t,e){return Ge(t[e])?sT:h_(t[e])&&t.setAttribute?zB:y_},rT=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e6)/1e6,e)},VB=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},oT=function(t,e){var n=e._pt,i="";if(!t&&e.b)i=e.b;else if(t===1&&e.e)i=e.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*t):Math.round((n.s+n.c*t)*1e4)/1e4)+i,n=n._next;i+=e.c}e.set(e.t,e.p,i,e)},x_=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},HB=function(t,e,n,i){for(var s=this._pt,o;s;)o=s._next,s.p===i&&s.modifier(t,e,n),s=o},GB=function(t){for(var e=this._pt,n,i;e;)i=e._next,e.p===t&&!e.op||e.op===t?vf(this,e,"_pt"):e.dep||(n=1),e=i;return!n},jB=function(t,e,n,i){i.mSet(t,e,i.m.call(i.tween,n,i.mt),i)},aT=function(t){for(var e=t._pt,n,i,s,o;e;){for(n=e._next,i=s;i&&i.pr>e.pr;)i=i._next;(e._prev=i?i._prev:o)?e._prev._next=e:s=e,(e._next=i)?i._prev=e:o=e,e=n}t._pt=s},ni=function(){function r(e,n,i,s,o,a,c,l,h){this.t=n,this.s=s,this.c=o,this.p=i,this.r=a||rT,this.d=c||this,this.set=l||y_,this.pr=h||0,this._next=e,e&&(e._prev=this)}var t=r.prototype;return t.modifier=function(n,i,s){this.mSet=this.mSet||this.set,this.set=jB,this.m=n,this.mt=s,this.tween=i},r}();ei(m_+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(r){return p_[r]=1});bi.TweenMax=bi.TweenLite=$e;bi.TimelineLite=bi.TimelineMax=Bn;Ne=new Bn({sortChildren:!1,defaults:Tc,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_i.stringFilter=ZM;var Uo=[],fd={},WB=[],bx=0,XB=0,em=function(t){return(fd[t]||WB).map(function(e){return e()})},Fg=function(){var t=Date.now(),e=[];t-bx>2&&(em("matchMediaInit"),Uo.forEach(function(n){var i=n.queries,s=n.conditions,o,a,c,l;for(a in i)o=hs.matchMedia(i[a]).matches,o&&(c=1),o!==s[a]&&(s[a]=o,l=1);l&&(n.revert(),c&&e.push(n))}),em("matchMediaRevert"),e.forEach(function(n){return n.onMatch(n,function(i){return n.add(null,i)})}),bx=t,em("matchMedia"))},cT=function(){function r(e,n){this.selector=n&&Lg(n),this.data=[],this._r=[],this.isReverted=!1,this.id=XB++,e&&this.add(e)}var t=r.prototype;return t.add=function(n,i,s){Ge(n)&&(s=i,i=n,n=Ge);var o=this,a=function(){var l=De,h=o.selector,u;return l&&l!==o&&l.data.push(o),s&&(o.selector=Lg(s)),De=o,u=i.apply(o,arguments),Ge(u)&&o._r.push(u),De=l,o.selector=h,o.isReverted=!1,u};return o.last=a,n===Ge?a(o,function(c){return o.add(null,c)}):n?o[n]=a:a},t.ignore=function(n){var i=De;De=null,n(this),De=i},t.getTweens=function(){var n=[];return this.data.forEach(function(i){return i instanceof r?n.push.apply(n,i.getTweens()):i instanceof $e&&!(i.parent&&i.parent.data==="nested")&&n.push(i)}),n},t.clear=function(){this._r.length=this.data.length=0},t.kill=function(n,i){var s=this;if(n?function(){for(var a=s.getTweens(),c=s.data.length,l;c--;)l=s.data[c],l.data==="isFlip"&&(l.revert(),l.getChildren(!0,!0,!1).forEach(function(h){return a.splice(a.indexOf(h),1)}));for(a.map(function(h){return{g:h._dur||h._delay||h._sat&&!h._sat.vars.immediateRender?h.globalTime(0):-1/0,t:h}}).sort(function(h,u){return u.g-h.g||-1/0}).forEach(function(h){return h.t.revert(n)}),c=s.data.length;c--;)l=s.data[c],l instanceof Bn?l.data!=="nested"&&(l.scrollTrigger&&l.scrollTrigger.revert(),l.kill()):!(l instanceof $e)&&l.revert&&l.revert(n);s._r.forEach(function(h){return h(n,s)}),s.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),i)for(var o=Uo.length;o--;)Uo[o].id===this.id&&Uo.splice(o,1)},t.revert=function(n){this.kill(n||{})},r}(),YB=function(){function r(e){this.contexts=[],this.scope=e,De&&De.data.push(this)}var t=r.prototype;return t.add=function(n,i,s){Es(n)||(n={matches:n});var o=new cT(0,s||this.scope),a=o.conditions={},c,l,h;De&&!o.selector&&(o.selector=De.selector),this.contexts.push(o),i=o.add("onMatch",i),o.queries=n;for(l in n)l==="all"?h=1:(c=hs.matchMedia(n[l]),c&&(Uo.indexOf(o)<0&&Uo.push(o),(a[l]=c.matches)&&(h=1),c.addListener?c.addListener(Fg):c.addEventListener("change",Fg)));return h&&i(o,function(u){return o.add(null,u)}),this},t.revert=function(n){this.kill(n||{})},t.kill=function(n){this.contexts.forEach(function(i){return i.kill(n,!0)})},r}(),Ud={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach(function(i){return YM(i)})},timeline:function(t){return new Bn(t)},getTweensOf:function(t,e){return Ne.getTweensOf(t,e)},getProperty:function(t,e,n,i){fn(t)&&(t=Ni(t)[0]);var s=Fo(t||{}).get,o=n?OM:IM;return n==="native"&&(n=""),t&&(e?o((hi[e]&&hi[e].get||s)(t,e,n,i)):function(a,c,l){return o((hi[a]&&hi[a].get||s)(t,a,c,l))})},quickSetter:function(t,e,n){if(t=Ni(t),t.length>1){var i=t.map(function(h){return ri.quickSetter(h,e,n)}),s=i.length;return function(h){for(var u=s;u--;)i[u](h)}}t=t[0]||{};var o=hi[e],a=Fo(t),c=a.harness&&(a.harness.aliases||{})[e]||e,l=o?function(h){var u=new o;Qa._pt=0,u.init(t,n?h+n:h,Qa,0,[t]),u.render(1,u),Qa._pt&&x_(1,Qa)}:a.set(t,c);return o?l:function(h){return l(t,c,n?h+n:h,a,1)}},quickTo:function(t,e,n){var i,s=ri.to(t,yi((i={},i[e]="+=0.1",i.paused=!0,i.stagger=0,i),n||{})),o=function(c,l,h){return s.resetTo(e,c,l,h)};return o.tween=s,o},isTweening:function(t){return Ne.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=No(t.ease,Tc.ease)),fx(Tc,t||{})},config:function(t){return fx(_i,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,i=t.plugins,s=t.defaults,o=t.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!hi[a]&&!bi[a]&&th(e+" effect requires "+a+" plugin.")}),Qp[e]=function(a,c,l){return n(Ni(a),yi(c||{},s),l)},o&&(Bn.prototype[e]=function(a,c,l){return this.add(Qp[e](a,Es(c)?c:(l=c)&&{},this),l)})},registerEase:function(t,e){se[t]=No(e)},parseEase:function(t,e){return arguments.length?No(t,e):se},getById:function(t){return Ne.getById(t)},exportRoot:function(t,e){t===void 0&&(t={});var n=new Bn(t),i,s;for(n.smoothChildTiming=ti(t.smoothChildTiming),Ne.remove(n),n._dp=0,n._time=n._tTime=Ne._time,i=Ne._first;i;)s=i._next,(e||!(!i._dur&&i instanceof $e&&i.vars.onComplete===i._targets[0]))&&ms(n,i,i._start-i._delay),i=s;return ms(Ne,n,0),n},context:function(t,e){return t?new cT(t,e):De},matchMedia:function(t){return new YB(t)},matchMediaRefresh:function(){return Uo.forEach(function(t){var e=t.conditions,n,i;for(i in e)e[i]&&(e[i]=!1,n=1);n&&t.revert()})||Fg()},addEventListener:function(t,e){var n=fd[t]||(fd[t]=[]);~n.indexOf(e)||n.push(e)},removeEventListener:function(t,e){var n=fd[t],i=n&&n.indexOf(e);i>=0&&n.splice(i,1)},utils:{wrap:TB,wrapYoyo:EB,distribute:VM,random:GM,snap:HM,normalize:MB,getUnit:Mn,clamp:vB,splitColor:qM,toArray:Ni,selector:Lg,mapRange:WM,pipe:wB,unitize:SB,interpolate:AB,shuffle:zM},install:CM,effects:Qp,ticker:ui,updateRoot:Bn.updateRoot,plugins:hi,globalTimeline:Ne,core:{PropTween:ni,globals:PM,Tween:$e,Timeline:Bn,Animation:sh,getCache:Fo,_removeLinkedListItem:vf,reverting:function(){return _n},context:function(t){return t&&De&&(De.data.push(t),t._ctx=De),De},suppressOverwrites:function(t){return l_=t}}};ei("to,from,fromTo,delayedCall,set,killTweensOf",function(r){return Ud[r]=$e[r]});ui.add(Bn.updateRoot);Qa=Ud.to({},{duration:0});var qB=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},KB=function(t,e){var n=t._targets,i,s,o;for(i in e)for(s=n.length;s--;)o=t._ptLookup[s][i],o&&(o=o.d)&&(o._pt&&(o=qB(o,i)),o&&o.modifier&&o.modifier(e[i],t,n[s],i))},nm=function(t,e){return{name:t,rawVars:1,init:function(i,s,o){o._onInit=function(a){var c,l;if(fn(s)&&(c={},ei(s,function(h){return c[h]=1}),s=c),e){c={};for(l in s)c[l]=e(s[l]);s=c}KB(a,s)}}}},ri=Ud.registerPlugin({name:"attr",init:function(t,e,n,i,s){var o,a,c;this.tween=n;for(o in e)c=t.getAttribute(o)||"",a=this.add(t,"setAttribute",(c||0)+"",e[o],i,s,0,0,o),a.op=o,a.b=c,this._props.push(o)},render:function(t,e){for(var n=e._pt;n;)_n?n.set(n.t,n.p,n.b,n):n.r(t,n.d),n=n._next}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n],0,0,0,0,0,1)}},nm("roundProps",Ig),nm("modifiers"),nm("snap",HM))||Ud;$e.version=Bn.version=ri.version="3.12.7";AM=1;u_()&&Pc();se.Power0;se.Power1;se.Power2;se.Power3;se.Power4;se.Linear;se.Quad;se.Cubic;se.Quart;se.Quint;se.Strong;se.Elastic;se.Back;se.SteppedEase;se.Bounce;se.Sine;se.Expo;se.Circ;/*!
 * CSSPlugin 3.12.7
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var yx,Br,lc,w_,Do,vx,S_,ZB=function(){return typeof window<"u"},ur={},wo=180/Math.PI,hc=Math.PI/180,ka=Math.atan2,xx=1e8,M_=/([A-Z])/g,QB=/(left|right|width|margin|padding|x)/i,$B=/[\s,\(]\S/,bs={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},kg=function(t,e){return e.set(e.t,e.p,Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},JB=function(t,e){return e.set(e.t,e.p,t===1?e.e:Math.round((e.s+e.c*t)*1e4)/1e4+e.u,e)},tz=function(t,e){return e.set(e.t,e.p,t?Math.round((e.s+e.c*t)*1e4)/1e4+e.u:e.b,e)},ez=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},lT=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},hT=function(t,e){return e.set(e.t,e.p,t!==1?e.b:e.e,e)},nz=function(t,e,n){return t.style[e]=n},iz=function(t,e,n){return t.style.setProperty(e,n)},sz=function(t,e,n){return t._gsap[e]=n},rz=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},oz=function(t,e,n,i,s){var o=t._gsap;o.scaleX=o.scaleY=n,o.renderTransform(s,o)},az=function(t,e,n,i,s){var o=t._gsap;o[e]=n,o.renderTransform(s,o)},Be="transform",ii=Be+"Origin",cz=function r(t,e){var n=this,i=this.target,s=i.style,o=i._gsap;if(t in ur&&s){if(this.tfm=this.tfm||{},t!=="transform")t=bs[t]||t,~t.indexOf(",")?t.split(",").forEach(function(a){return n.tfm[a]=Xs(i,a)}):this.tfm[t]=o.x?o[t]:Xs(i,t),t===ii&&(this.tfm.zOrigin=o.zOrigin);else return bs.transform.split(",").forEach(function(a){return r.call(n,a,e)});if(this.props.indexOf(Be)>=0)return;o.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(ii,e,"")),t=Be}(s||e)&&this.props.push(t,e,s[t])},uT=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},lz=function(){var t=this.props,e=this.target,n=e.style,i=e._gsap,s,o;for(s=0;s<t.length;s+=3)t[s+1]?t[s+1]===2?e[t[s]](t[s+2]):e[t[s]]=t[s+2]:t[s+2]?n[t[s]]=t[s+2]:n.removeProperty(t[s].substr(0,2)==="--"?t[s]:t[s].replace(M_,"-$1").toLowerCase());if(this.tfm){for(o in this.tfm)i[o]=this.tfm[o];i.svg&&(i.renderTransform(),e.setAttribute("data-svg-origin",this.svgo||"")),s=S_(),(!s||!s.isStart)&&!n[Be]&&(uT(n),i.zOrigin&&n[ii]&&(n[ii]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},dT=function(t,e){var n={target:t,props:[],revert:lz,save:cz};return t._gsap||ri.core.getCache(t),e&&t.style&&t.nodeType&&e.split(",").forEach(function(i){return n.save(i)}),n},fT,Ng=function(t,e){var n=Br.createElementNS?Br.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):Br.createElement(t);return n&&n.style?n:Br.createElement(t)},vs=function r(t,e,n){var i=getComputedStyle(t);return i[e]||i.getPropertyValue(e.replace(M_,"-$1").toLowerCase())||i.getPropertyValue(e)||!n&&r(t,Rc(e)||e,1)||""},wx="O,Moz,ms,Ms,Webkit".split(","),Rc=function(t,e,n){var i=e||Do,s=i.style,o=5;if(t in s&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);o--&&!(wx[o]+t in s););return o<0?null:(o===3?"ms":o>=0?wx[o]:"")+t},Ug=function(){ZB()&&window.document&&(yx=window,Br=yx.document,lc=Br.documentElement,Do=Ng("div")||{style:{}},Ng("div"),Be=Rc(Be),ii=Be+"Origin",Do.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",fT=!!Rc("perspective"),S_=ri.core.reverting,w_=1)},Sx=function(t){var e=t.ownerSVGElement,n=Ng("svg",e&&e.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=t.cloneNode(!0),s;i.style.display="block",n.appendChild(i),lc.appendChild(n);try{s=i.getBBox()}catch{}return n.removeChild(i),lc.removeChild(n),s},Mx=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},pT=function(t){var e,n;try{e=t.getBBox()}catch{e=Sx(t),n=1}return e&&(e.width||e.height)||n||(e=Sx(t)),e&&!e.width&&!e.x&&!e.y?{x:+Mx(t,["x","cx","x1"])||0,y:+Mx(t,["y","cy","y1"])||0,width:0,height:0}:e},mT=function(t){return!!(t.getCTM&&(!t.parentNode||t.ownerSVGElement)&&pT(t))},qo=function(t,e){if(e){var n=t.style,i;e in ur&&e!==ii&&(e=Be),n.removeProperty?(i=e.substr(0,2),(i==="ms"||e.substr(0,6)==="webkit")&&(e="-"+e),n.removeProperty(i==="--"?e:e.replace(M_,"-$1").toLowerCase())):n.removeAttribute(e)}},zr=function(t,e,n,i,s,o){var a=new ni(t._pt,e,n,0,1,o?hT:lT);return t._pt=a,a.b=i,a.e=s,t._props.push(n),a},Tx={deg:1,rad:1,turn:1},hz={grid:1,flex:1},$r=function r(t,e,n,i){var s=parseFloat(n)||0,o=(n+"").trim().substr((s+"").length)||"px",a=Do.style,c=QB.test(e),l=t.tagName.toLowerCase()==="svg",h=(l?"client":"offset")+(c?"Width":"Height"),u=100,d=i==="px",f=i==="%",m,_,g,p;if(i===o||!s||Tx[i]||Tx[o])return s;if(o!=="px"&&!d&&(s=r(t,e,n,"px")),p=t.getCTM&&mT(t),(f||o==="%")&&(ur[e]||~e.indexOf("adius")))return m=p?t.getBBox()[c?"width":"height"]:t[h],Ye(f?s/m*u:s/100*m);if(a[c?"width":"height"]=u+(d?o:i),_=i!=="rem"&&~e.indexOf("adius")||i==="em"&&t.appendChild&&!l?t:t.parentNode,p&&(_=(t.ownerSVGElement||{}).parentNode),(!_||_===Br||!_.appendChild)&&(_=Br.body),g=_._gsap,g&&f&&g.width&&c&&g.time===ui.time&&!g.uncache)return Ye(s/g.width*u);if(f&&(e==="height"||e==="width")){var b=t.style[e];t.style[e]=u+i,m=t[h],b?t.style[e]=b:qo(t,e)}else(f||o==="%")&&!hz[vs(_,"display")]&&(a.position=vs(t,"position")),_===t&&(a.position="static"),_.appendChild(Do),m=Do[h],_.removeChild(Do),a.position="absolute";return c&&f&&(g=Fo(_),g.time=ui.time,g.width=_[h]),Ye(d?m*s/u:m&&s?u/m*s:0)},Xs=function(t,e,n,i){var s;return w_||Ug(),e in bs&&e!=="transform"&&(e=bs[e],~e.indexOf(",")&&(e=e.split(",")[0])),ur[e]&&e!=="transform"?(s=oh(t,i),s=e!=="transformOrigin"?s[e]:s.svg?s.origin:zd(vs(t,ii))+" "+s.zOrigin+"px"):(s=t.style[e],(!s||s==="auto"||i||~(s+"").indexOf("calc("))&&(s=Bd[e]&&Bd[e](t,e,n)||vs(t,e)||DM(t,e)||(e==="opacity"?1:0))),n&&!~(s+"").trim().indexOf(" ")?$r(t,e,s,n)+n:s},uz=function(t,e,n,i){if(!n||n==="none"){var s=Rc(e,t,1),o=s&&vs(t,s,1);o&&o!==n?(e=s,n=o):e==="borderColor"&&(n=vs(t,"borderTopColor"))}var a=new ni(this._pt,t.style,e,0,1,oT),c=0,l=0,h,u,d,f,m,_,g,p,b,y,v,x;if(a.b=n,a.e=i,n+="",i+="",i==="auto"&&(_=t.style[e],t.style[e]=i,i=vs(t,e)||i,_?t.style[e]=_:qo(t,e)),h=[n,i],ZM(h),n=h[0],i=h[1],d=n.match(Za)||[],x=i.match(Za)||[],x.length){for(;u=Za.exec(i);)g=u[0],b=i.substring(c,u.index),m?m=(m+1)%5:(b.substr(-5)==="rgba("||b.substr(-5)==="hsla(")&&(m=1),g!==(_=d[l++]||"")&&(f=parseFloat(_)||0,v=_.substr((f+"").length),g.charAt(1)==="="&&(g=cc(f,g)+v),p=parseFloat(g),y=g.substr((p+"").length),c=Za.lastIndex-y.length,y||(y=y||_i.units[e]||v,c===i.length&&(i+=y,a.e+=y)),v!==y&&(f=$r(t,e,_,y)||0),a._pt={_next:a._pt,p:b||l===1?b:",",s:f,c:p-f,m:m&&m<4||e==="zIndex"?Math.round:0});a.c=c<i.length?i.substring(c,i.length):""}else a.r=e==="display"&&i==="none"?hT:lT;return TM.test(i)&&(a.e=0),this._pt=a,a},Ex={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},dz=function(t){var e=t.split(" "),n=e[0],i=e[1]||"50%";return(n==="top"||n==="bottom"||i==="left"||i==="right")&&(t=n,n=i,i=t),e[0]=Ex[n]||n,e[1]=Ex[i]||i,e.join(" ")},fz=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n=e.t,i=n.style,s=e.u,o=n._gsap,a,c,l;if(s==="all"||s===!0)i.cssText="",c=1;else for(s=s.split(","),l=s.length;--l>-1;)a=s[l],ur[a]&&(c=1,a=a==="transformOrigin"?ii:Be),qo(n,a);c&&(qo(n,Be),o&&(o.svg&&n.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",oh(n,1),o.uncache=1,uT(i)))}},Bd={clearProps:function(t,e,n,i,s){if(s.data!=="isFromStart"){var o=t._pt=new ni(t._pt,e,n,0,0,fz);return o.u=i,o.pr=-10,o.tween=s,t._props.push(n),1}}},rh=[1,0,0,1,0,0],gT={},_T=function(t){return t==="matrix(1, 0, 0, 1, 0, 0)"||t==="none"||!t},Ax=function(t){var e=vs(t,Be);return _T(e)?rh:e.substr(7).match(MM).map(Ye)},T_=function(t,e){var n=t._gsap||Fo(t),i=t.style,s=Ax(t),o,a,c,l;return n.svg&&t.getAttribute("transform")?(c=t.transform.baseVal.consolidate().matrix,s=[c.a,c.b,c.c,c.d,c.e,c.f],s.join(",")==="1,0,0,1,0,0"?rh:s):(s===rh&&!t.offsetParent&&t!==lc&&!n.svg&&(c=i.display,i.display="block",o=t.parentNode,(!o||!t.offsetParent&&!t.getBoundingClientRect().width)&&(l=1,a=t.nextElementSibling,lc.appendChild(t)),s=Ax(t),c?i.display=c:qo(t,"display"),l&&(a?o.insertBefore(t,a):o?o.appendChild(t):lc.removeChild(t))),e&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},Bg=function(t,e,n,i,s,o){var a=t._gsap,c=s||T_(t,!0),l=a.xOrigin||0,h=a.yOrigin||0,u=a.xOffset||0,d=a.yOffset||0,f=c[0],m=c[1],_=c[2],g=c[3],p=c[4],b=c[5],y=e.split(" "),v=parseFloat(y[0])||0,x=parseFloat(y[1])||0,S,T,E,w;n?c!==rh&&(T=f*g-m*_)&&(E=v*(g/T)+x*(-_/T)+(_*b-g*p)/T,w=v*(-m/T)+x*(f/T)-(f*b-m*p)/T,v=E,x=w):(S=pT(t),v=S.x+(~y[0].indexOf("%")?v/100*S.width:v),x=S.y+(~(y[1]||y[0]).indexOf("%")?x/100*S.height:x)),i||i!==!1&&a.smooth?(p=v-l,b=x-h,a.xOffset=u+(p*f+b*_)-p,a.yOffset=d+(p*m+b*g)-b):a.xOffset=a.yOffset=0,a.xOrigin=v,a.yOrigin=x,a.smooth=!!i,a.origin=e,a.originIsAbsolute=!!n,t.style[ii]="0px 0px",o&&(zr(o,a,"xOrigin",l,v),zr(o,a,"yOrigin",h,x),zr(o,a,"xOffset",u,a.xOffset),zr(o,a,"yOffset",d,a.yOffset)),t.setAttribute("data-svg-origin",v+" "+x)},oh=function(t,e){var n=t._gsap||new tT(t);if("x"in n&&!e&&!n.uncache)return n;var i=t.style,s=n.scaleX<0,o="px",a="deg",c=getComputedStyle(t),l=vs(t,ii)||"0",h,u,d,f,m,_,g,p,b,y,v,x,S,T,E,w,M,P,L,I,F,z,N,Z,j,et,tt,at,dt,St,O,it;return h=u=d=_=g=p=b=y=v=0,f=m=1,n.svg=!!(t.getCTM&&mT(t)),c.translate&&((c.translate!=="none"||c.scale!=="none"||c.rotate!=="none")&&(i[Be]=(c.translate!=="none"?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(c.rotate!=="none"?"rotate("+c.rotate+") ":"")+(c.scale!=="none"?"scale("+c.scale.split(" ").join(",")+") ":"")+(c[Be]!=="none"?c[Be]:"")),i.scale=i.rotate=i.translate="none"),T=T_(t,n.svg),n.svg&&(n.uncache?(j=t.getBBox(),l=n.xOrigin-j.x+"px "+(n.yOrigin-j.y)+"px",Z=""):Z=!e&&t.getAttribute("data-svg-origin"),Bg(t,Z||l,!!Z||n.originIsAbsolute,n.smooth!==!1,T)),x=n.xOrigin||0,S=n.yOrigin||0,T!==rh&&(P=T[0],L=T[1],I=T[2],F=T[3],h=z=T[4],u=N=T[5],T.length===6?(f=Math.sqrt(P*P+L*L),m=Math.sqrt(F*F+I*I),_=P||L?ka(L,P)*wo:0,b=I||F?ka(I,F)*wo+_:0,b&&(m*=Math.abs(Math.cos(b*hc))),n.svg&&(h-=x-(x*P+S*I),u-=S-(x*L+S*F))):(it=T[6],St=T[7],tt=T[8],at=T[9],dt=T[10],O=T[11],h=T[12],u=T[13],d=T[14],E=ka(it,dt),g=E*wo,E&&(w=Math.cos(-E),M=Math.sin(-E),Z=z*w+tt*M,j=N*w+at*M,et=it*w+dt*M,tt=z*-M+tt*w,at=N*-M+at*w,dt=it*-M+dt*w,O=St*-M+O*w,z=Z,N=j,it=et),E=ka(-I,dt),p=E*wo,E&&(w=Math.cos(-E),M=Math.sin(-E),Z=P*w-tt*M,j=L*w-at*M,et=I*w-dt*M,O=F*M+O*w,P=Z,L=j,I=et),E=ka(L,P),_=E*wo,E&&(w=Math.cos(E),M=Math.sin(E),Z=P*w+L*M,j=z*w+N*M,L=L*w-P*M,N=N*w-z*M,P=Z,z=j),g&&Math.abs(g)+Math.abs(_)>359.9&&(g=_=0,p=180-p),f=Ye(Math.sqrt(P*P+L*L+I*I)),m=Ye(Math.sqrt(N*N+it*it)),E=ka(z,N),b=Math.abs(E)>2e-4?E*wo:0,v=O?1/(O<0?-O:O):0),n.svg&&(Z=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!_T(vs(t,Be)),Z&&t.setAttribute("transform",Z))),Math.abs(b)>90&&Math.abs(b)<270&&(s?(f*=-1,b+=_<=0?180:-180,_+=_<=0?180:-180):(m*=-1,b+=b<=0?180:-180)),e=e||n.uncache,n.x=h-((n.xPercent=h&&(!e&&n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-h)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+o,n.y=u-((n.yPercent=u&&(!e&&n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-u)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+o,n.z=d+o,n.scaleX=Ye(f),n.scaleY=Ye(m),n.rotation=Ye(_)+a,n.rotationX=Ye(g)+a,n.rotationY=Ye(p)+a,n.skewX=b+a,n.skewY=y+a,n.transformPerspective=v+o,(n.zOrigin=parseFloat(l.split(" ")[2])||!e&&n.zOrigin||0)&&(i[ii]=zd(l)),n.xOffset=n.yOffset=0,n.force3D=_i.force3D,n.renderTransform=n.svg?mz:fT?bT:pz,n.uncache=0,n},zd=function(t){return(t=t.split(" "))[0]+" "+t[1]},im=function(t,e,n){var i=Mn(e);return Ye(parseFloat(e)+parseFloat($r(t,"x",n+"px",i)))+i},pz=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,bT(t,e)},yo="0deg",ml="0px",vo=") ",bT=function(t,e){var n=e||this,i=n.xPercent,s=n.yPercent,o=n.x,a=n.y,c=n.z,l=n.rotation,h=n.rotationY,u=n.rotationX,d=n.skewX,f=n.skewY,m=n.scaleX,_=n.scaleY,g=n.transformPerspective,p=n.force3D,b=n.target,y=n.zOrigin,v="",x=p==="auto"&&t&&t!==1||p===!0;if(y&&(u!==yo||h!==yo)){var S=parseFloat(h)*hc,T=Math.sin(S),E=Math.cos(S),w;S=parseFloat(u)*hc,w=Math.cos(S),o=im(b,o,T*w*-y),a=im(b,a,-Math.sin(S)*-y),c=im(b,c,E*w*-y+y)}g!==ml&&(v+="perspective("+g+vo),(i||s)&&(v+="translate("+i+"%, "+s+"%) "),(x||o!==ml||a!==ml||c!==ml)&&(v+=c!==ml||x?"translate3d("+o+", "+a+", "+c+") ":"translate("+o+", "+a+vo),l!==yo&&(v+="rotate("+l+vo),h!==yo&&(v+="rotateY("+h+vo),u!==yo&&(v+="rotateX("+u+vo),(d!==yo||f!==yo)&&(v+="skew("+d+", "+f+vo),(m!==1||_!==1)&&(v+="scale("+m+", "+_+vo),b.style[Be]=v||"translate(0, 0)"},mz=function(t,e){var n=e||this,i=n.xPercent,s=n.yPercent,o=n.x,a=n.y,c=n.rotation,l=n.skewX,h=n.skewY,u=n.scaleX,d=n.scaleY,f=n.target,m=n.xOrigin,_=n.yOrigin,g=n.xOffset,p=n.yOffset,b=n.forceCSS,y=parseFloat(o),v=parseFloat(a),x,S,T,E,w;c=parseFloat(c),l=parseFloat(l),h=parseFloat(h),h&&(h=parseFloat(h),l+=h,c+=h),c||l?(c*=hc,l*=hc,x=Math.cos(c)*u,S=Math.sin(c)*u,T=Math.sin(c-l)*-d,E=Math.cos(c-l)*d,l&&(h*=hc,w=Math.tan(l-h),w=Math.sqrt(1+w*w),T*=w,E*=w,h&&(w=Math.tan(h),w=Math.sqrt(1+w*w),x*=w,S*=w)),x=Ye(x),S=Ye(S),T=Ye(T),E=Ye(E)):(x=u,E=d,S=T=0),(y&&!~(o+"").indexOf("px")||v&&!~(a+"").indexOf("px"))&&(y=$r(f,"x",o,"px"),v=$r(f,"y",a,"px")),(m||_||g||p)&&(y=Ye(y+m-(m*x+_*T)+g),v=Ye(v+_-(m*S+_*E)+p)),(i||s)&&(w=f.getBBox(),y=Ye(y+i/100*w.width),v=Ye(v+s/100*w.height)),w="matrix("+x+","+S+","+T+","+E+","+y+","+v+")",f.setAttribute("transform",w),b&&(f.style[Be]=w)},gz=function(t,e,n,i,s){var o=360,a=fn(s),c=parseFloat(s)*(a&&~s.indexOf("rad")?wo:1),l=c-i,h=i+l+"deg",u,d;return a&&(u=s.split("_")[1],u==="short"&&(l%=o,l!==l%(o/2)&&(l+=l<0?o:-360)),u==="cw"&&l<0?l=(l+o*xx)%o-~~(l/o)*o:u==="ccw"&&l>0&&(l=(l-o*xx)%o-~~(l/o)*o)),t._pt=d=new ni(t._pt,e,n,i,l,JB),d.e=h,d.u="deg",t._props.push(n),d},Cx=function(t,e){for(var n in e)t[n]=e[n];return t},_z=function(t,e,n){var i=Cx({},n._gsap),s="perspective,force3D,transformOrigin,svgOrigin",o=n.style,a,c,l,h,u,d,f,m;i.svg?(l=n.getAttribute("transform"),n.setAttribute("transform",""),o[Be]=e,a=oh(n,1),qo(n,Be),n.setAttribute("transform",l)):(l=getComputedStyle(n)[Be],o[Be]=e,a=oh(n,1),o[Be]=l);for(c in ur)l=i[c],h=a[c],l!==h&&s.indexOf(c)<0&&(f=Mn(l),m=Mn(h),u=f!==m?$r(n,c,l,m):parseFloat(l),d=parseFloat(h),t._pt=new ni(t._pt,a,c,u,d-u,kg),t._pt.u=m||0,t._props.push(c));Cx(a,i)};ei("padding,margin,Width,Radius",function(r,t){var e="Top",n="Right",i="Bottom",s="Left",o=(t<3?[e,n,i,s]:[e+s,e+n,i+n,i+s]).map(function(a){return t<2?r+a:"border"+a+r});Bd[t>1?"border"+r:r]=function(a,c,l,h,u){var d,f;if(arguments.length<4)return d=o.map(function(m){return Xs(a,m,l)}),f=d.join(" "),f.split(d[0]).length===5?d[0]:f;d=(h+"").split(" "),f={},o.forEach(function(m,_){return f[m]=d[_]=d[_]||d[(_-1)/2|0]}),a.init(c,f,u)}});var yT={name:"css",register:Ug,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,i,s){var o=this._props,a=t.style,c=n.vars.startAt,l,h,u,d,f,m,_,g,p,b,y,v,x,S,T,E;w_||Ug(),this.styles=this.styles||dT(t),E=this.styles.props,this.tween=n;for(_ in e)if(_!=="autoRound"&&(h=e[_],!(hi[_]&&eT(_,e,n,i,t,s)))){if(f=typeof h,m=Bd[_],f==="function"&&(h=h.call(n,i,t,s),f=typeof h),f==="string"&&~h.indexOf("random(")&&(h=nh(h)),m)m(this,t,_,h,n)&&(T=1);else if(_.substr(0,2)==="--")l=(getComputedStyle(t).getPropertyValue(_)+"").trim(),h+="",Wr.lastIndex=0,Wr.test(l)||(g=Mn(l),p=Mn(h)),p?g!==p&&(l=$r(t,_,l,p)+p):g&&(h+=g),this.add(a,"setProperty",l,h,i,s,0,0,_),o.push(_),E.push(_,0,a[_]);else if(f!=="undefined"){if(c&&_ in c?(l=typeof c[_]=="function"?c[_].call(n,i,t,s):c[_],fn(l)&&~l.indexOf("random(")&&(l=nh(l)),Mn(l+"")||l==="auto"||(l+=_i.units[_]||Mn(Xs(t,_))||""),(l+"").charAt(1)==="="&&(l=Xs(t,_))):l=Xs(t,_),d=parseFloat(l),b=f==="string"&&h.charAt(1)==="="&&h.substr(0,2),b&&(h=h.substr(2)),u=parseFloat(h),_ in bs&&(_==="autoAlpha"&&(d===1&&Xs(t,"visibility")==="hidden"&&u&&(d=0),E.push("visibility",0,a.visibility),zr(this,a,"visibility",d?"inherit":"hidden",u?"inherit":"hidden",!u)),_!=="scale"&&_!=="transform"&&(_=bs[_],~_.indexOf(",")&&(_=_.split(",")[0]))),y=_ in ur,y){if(this.styles.save(_),v||(x=t._gsap,x.renderTransform&&!e.parseTransform||oh(t,e.parseTransform),S=e.smoothOrigin!==!1&&x.smooth,v=this._pt=new ni(this._pt,a,Be,0,1,x.renderTransform,x,0,-1),v.dep=1),_==="scale")this._pt=new ni(this._pt,x,"scaleY",x.scaleY,(b?cc(x.scaleY,b+u):u)-x.scaleY||0,kg),this._pt.u=0,o.push("scaleY",_),_+="X";else if(_==="transformOrigin"){E.push(ii,0,a[ii]),h=dz(h),x.svg?Bg(t,h,0,S,0,this):(p=parseFloat(h.split(" ")[2])||0,p!==x.zOrigin&&zr(this,x,"zOrigin",x.zOrigin,p),zr(this,a,_,zd(l),zd(h)));continue}else if(_==="svgOrigin"){Bg(t,h,1,S,0,this);continue}else if(_ in gT){gz(this,x,_,d,b?cc(d,b+h):h);continue}else if(_==="smoothOrigin"){zr(this,x,"smooth",x.smooth,h);continue}else if(_==="force3D"){x[_]=h;continue}else if(_==="transform"){_z(this,h,t);continue}}else _ in a||(_=Rc(_)||_);if(y||(u||u===0)&&(d||d===0)&&!$B.test(h)&&_ in a)g=(l+"").substr((d+"").length),u||(u=0),p=Mn(h)||(_ in _i.units?_i.units[_]:g),g!==p&&(d=$r(t,_,l,p)),this._pt=new ni(this._pt,y?x:a,_,d,(b?cc(d,b+u):u)-d,!y&&(p==="px"||_==="zIndex")&&e.autoRound!==!1?ez:kg),this._pt.u=p||0,g!==p&&p!=="%"&&(this._pt.b=l,this._pt.r=tz);else if(_ in a)uz.call(this,t,_,l,b?b+h:h);else if(_ in t)this.add(t,_,l||t[_],b?b+h:h,i,s);else if(_!=="parseTransform"){f_(_,h);continue}y||(_ in a?E.push(_,0,a[_]):typeof t[_]=="function"?E.push(_,2,t[_]()):E.push(_,1,l||t[_])),o.push(_)}}T&&aT(this)},render:function(t,e){if(e.tween._time||!S_())for(var n=e._pt;n;)n.r(t,n.d),n=n._next;else e.styles.revert()},get:Xs,aliases:bs,getSetter:function(t,e,n){var i=bs[e];return i&&i.indexOf(",")<0&&(e=i),e in ur&&e!==ii&&(t._gsap.x||Xs(t,"x"))?n&&vx===n?e==="scale"?rz:sz:(vx=n||{})&&(e==="scale"?oz:az):t.style&&!h_(t.style[e])?nz:~e.indexOf("-")?iz:v_(t,e)},core:{_removeProperty:qo,_getMatrix:T_}};ri.utils.checkPrefix=Rc;ri.core.getStyleSaver=dT;(function(r,t,e,n){var i=ei(r+","+t+","+e,function(s){ur[s]=1});ei(t,function(s){_i.units[s]="deg",gT[s]=1}),bs[i[13]]=r+","+t,ei(n,function(s){var o=s.split(":");bs[o[1]]=i[o[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");ei("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(r){_i.units[r]="px"});ri.registerPlugin(yT);var E_=ri.registerPlugin(yT)||ri;E_.core.Tween;const Na=new C,gl=new C,Px=new lt,bz=new jt,sm=new jt,DV=(r,t,e)=>{const{animation:n=!1,distance:i=1,duration:s=2,onComplete:o,onUpdate:a}=e||{animation:!1,distance:1,duration:2};t.object3d.getWorldPosition(Na),r.object3d.parent.worldToLocal(Na),gl.copy(r.position),Na.sub(gl);const c=Na.length();Na.normalize().multiplyScalar(c-i),gl.add(Na);const{x:l,y:h,z:u}=gl;if(Px.lookAt(r.position,gl,r.object3d.up),bz.copy(r.object3d.quaternion),sm.setFromRotationMatrix(Px),n){const d=E_.to(r.position,{x:l,y:h,z:u,duration:s,onUpdate:()=>{a==null||a(),r.object3d.quaternion.slerp(sm,d.ratio)},onComplete:o})}else r.position.set(l,h,u),r.object3d.quaternion.copy(sm)},LV=(r,t,e)=>{const{duration:n=5}=e||{duration:5},i=new C,s=new C,o=E_.to(r,{duration:n,ease:"none",onUpdate:()=>{t.getPoint(o.ratio,r.position),t.getTangent(o.ratio,i),s.copy(r.position).add(i),r.object3d.lookAt(s)}});return o},IV=r=>{const[t,e]=F_.useState({width:0,height:0,maxWidth:0,maxHeight:0});return F_.useEffect(()=>{const n=new ResizeObserver(s=>{const o=s[0],{scrollWidth:a,scrollHeight:c,clientWidth:l,clientHeight:h}=o.target;e({width:l,height:h,maxWidth:a,maxHeight:c})}),i=r.current;return n.observe(i),()=>{n.unobserve(i),n.disconnect()}},[r]),t};export{MV as $,Le as A,xe as B,pt as C,An as D,Me as E,CV as F,bV as G,gV as H,fV as I,_V as J,mV as K,vV as L,ct as M,xV as N,Bt as O,io as P,jt as Q,to as R,Lz as S,qs as T,wV as U,C as V,SV as W,Ot as X,fs as Y,yV as Z,Zz as _,Mz as a,TV as a0,EV as a1,AV as a2,pV as a3,Qz as a4,Iz as a5,$z as a6,Jz as a7,tV as a8,uV as a9,cV as aA,sV as aB,rV as aC,qU as aD,uf as aE,dV as aF,L3 as aG,Yz as aH,JD as aI,YU as aJ,kU as aK,IV as aL,Mg as aM,LV as aN,DV as aO,E_ as aP,_f as aa,zU as ab,HU as ac,Rt as ad,Qt as ae,zo as af,Kt as ag,Oz as ah,PV as ai,O3 as aj,I3 as ak,QD as al,RV as am,Mw as an,h0 as ao,Cz as ap,Ez as aq,AT as ar,Pz as as,Az as at,Rz as au,eV as av,nV as aw,iV as ax,aV as ay,oV as az,wz as b,J as c,Sz as d,ch as e,Ln as f,ET as g,ie as h,en as i,Jh as j,On as k,YR as l,mi as m,Wz as n,tM as o,Xz as p,kn as q,Jo as r,Yo as s,U3 as t,Tz as u,Kz as v,lV as w,qz as x,Vv as y,hV as z};
