import{r as f,j as m,bN as N}from"./index-Bb-7Eb0M.js";import{j as k,k as M,l as B}from"./texture-manager-D3Pmpn-e.js";import"./status-menu-C68dynYX.js";import{T as E}from"./index-C8ak_ehR.js";import{CurveEditor as T}from"./index-B1gLoyno.js";import{M as b}from"./index-4nTUrSXL.js";import{R as P,C as w}from"./row-oUhK5knE.js";import{S as Y}from"./index-CI8PfZ9W.js";import"./BaseInput-B7ce96x8.js";import"./useVariants-tvJGGS15.js";import"./useSize-C_rNTEhI.js";import"./SearchOutlined-C6AoyiIt.js";const $=l=>{const{style:c,attribute:n,value:e,onChange:r}=l,[a,t]=f.useState(0),[s,o]=f.useState(!1);f.useEffect(()=>{t(e)},[e]);const i=g=>{t(g||0),o(!0)},p=()=>{s&&(o(!1),r(a))},v=g=>{o(!1),t(g||0),r(g)};return m.jsx(E,{style:{borderRadius:"4px",width:"100%",...c},disabled:n==null?void 0:n.disabled,min:n==null?void 0:n.min,max:n==null?void 0:n.max,precision:n==null?void 0:n.precision,step:n==null?void 0:n.step,value:a,onChange:i,onPressEnter:p,onBlur:p,onStep:v})},D=l=>{const{style:c,attribute:n,min:e,max:r,onChange:a}=l,[t,s]=f.useState(0),[o,i]=f.useState(0),[p,v]=f.useState(!1);f.useEffect(()=>{s(e)},[e]),f.useEffect(()=>{i(r)},[r]);const g=d=>{s(d||0),v(!0)},h=()=>{p&&(v(!1),a(t,o))},j=d=>{v(!1),s(d||0),a(d||0,o)},y=d=>{i(d||0),v(!0)},x=()=>{p&&(v(!1),a(t,o))},I=d=>{v(!1),i(d||0),a(t,d||0)};return m.jsxs(N,{direction:"vertical",style:{width:"100%"},children:[m.jsx(E,{style:{borderRadius:"4px",width:"100%",...c},disabled:n==null?void 0:n.disabled,prefix:"min",min:n==null?void 0:n.min,max:n==null?void 0:n.max,precision:n==null?void 0:n.precision,step:n==null?void 0:n.step,value:t,onChange:g,onPressEnter:h,onBlur:h,onStep:j}),m.jsx(E,{style:{borderRadius:"4px",width:"100%",...c},prefix:"max",disabled:n==null?void 0:n.disabled,min:n==null?void 0:n.min,max:n==null?void 0:n.max,precision:n==null?void 0:n.precision,step:n==null?void 0:n.step,value:o,onChange:y,onPressEnter:x,onBlur:x,onStep:I})]})},C=120,S=32,W=l=>{const{value:c,onChange:n}=l,[e,r]=f.useState(""),[a,t]=f.useState(!1),s=f.useRef(null);f.useEffect(()=>{r(z(c))},[c]);const o=()=>{var v;const p=(v=s.current)==null?void 0:v.getCurves();n(p??[]),t(!1)},i=()=>{t(!1)};return m.jsxs("div",{style:{maxWidth:`${C}px`,overflow:"hidden",cursor:"pointer",background:"#ddeaf814",display:"flex"},children:[m.jsx("svg",{width:C,height:S,viewBox:`0 0 ${C} ${S}`,stroke:"#f76b15",onClick:()=>t(!0),children:m.jsx("path",{d:e,stroke:"#f76b15",fill:"#ddeaf802"})}),m.jsx(b,{title:"曲线编辑",width:848,open:a,onOk:o,onCancel:i,children:m.jsx(T,{ref:s,curves:c})})]})},z=l=>{const c=s=>l.find(o=>o.v0[0]<=s&&s<=o.v3[0]);if(l.length===0)return"";let n=0,e=1;for(let s=0;s<l.length;s++){const{v0:o,v1:i,v2:p,v3:v}=l[s];n=Math.min(o[1],i[1],p[1],v[1],n),e=Math.max(o[1],i[1],p[1],v[1],e)}const r=s=>S-(s-n)/(e-n)*S;let a=["M",l[0].v0[0],r(l[0].v0[1])];const t=1/100;for(let s=t;s<=1;s+=t){const o=c(s);if(!o)break;const i=O(o,s);a=a.concat(["L",s*C,r(i)])}return a.join(" ")},G=(l,c)=>{const{v0:n,v1:e,v2:r,v3:a}=l,t=1-c,s=c*c,o=t*t,i=o*t,p=s*c;return i*n[1]+3*o*c*e[1]+3*t*s*r[1]+p*a[1]},L=(l,c)=>{const{v0:n,v1:e,v2:r,v3:a}=l,t=1-c,s=c*c,o=t*t,i=o*t,p=s*c;return i*n[0]+3*o*c*e[0]+3*t*s*r[0]+p*a[0]},O=(l,c)=>{let n=0,e=1,r=.5;const a=50,t=1e-6;for(let o=0;o<a;o++){const i=L(l,r);if(Math.abs(i-c)<t)break;i<c?n=r:e=r,r=(n+e)/2}return G(l,r)},X=[{label:"常量",value:"constant"},{label:"范围",value:"range"},{label:"曲线",value:"curve"}],en=l=>{const{style:c,attribute:n,value:e,onChange:r}=l,[a,t]=f.useState("constant"),[s,o]=f.useState(0),[i,p]=f.useState(0),[v,g]=f.useState(0),[h,j]=f.useState([]);f.useEffect(()=>{if(!e)return;const u=e.serialize();t(u.type),u.type==="constant"?o(u.value):u.type==="range"?(p(u.a),g(u.b)):u.type==="curve"&&j(u.curves)},[e]);const y=u=>{t(u),u==="constant"?e.function=new k(0):u==="range"?e.function=new M(0,1):u==="curve"&&(e.function=new B([{v0:[0,0],v1:[.1,.1],v2:[.9,.9],v3:[1,1]}])),r(e)},x=u=>{e.function.setConstant(u),r(e)},I=(u,R)=>{e.function.setRange(u,R),r(e)},d=u=>{e.function.setCurves(u),r(e)};return m.jsxs(P,{gutter:4,wrap:!1,children:[m.jsxs(w,{flex:"auto",children:[a==="constant"&&m.jsx($,{style:c,attribute:n,value:s,onChange:x}),a==="range"&&m.jsx(D,{style:c,attribute:n,min:i,max:v,onChange:I}),a==="curve"&&m.jsx(W,{value:h,onChange:d})]}),m.jsx(w,{children:m.jsx(Y,{options:X,value:a,onChange:y})})]})};export{en as GeneratorNumberWrap};
