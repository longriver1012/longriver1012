import{bU as N,r as l,j as i,bV as L,bW as O}from"./index-Bb-7Eb0M.js";import"./texture-manager-D3Pmpn-e.js";import{V as a,A as G}from"./status-menu-C68dynYX.js";import{InputWrap as w}from"./index-D6quy6V5.js";import{InputNumberWrap as I}from"./index-ZSUS44nd.js";import{CheckboxWrap as V}from"./index-i7Lqg-SS.js";import{ColorPickerWrap as k}from"./index-CSR68ux3.js";import{SelectWrap as W}from"./index-5Z8jFJMZ.js";import{Vector2Wrap as P}from"./index-DA2p2fxg.js";import{Vector3Wrap as U}from"./index-Cwp-6jAs.js";import{ScriptWrap as D}from"./index-DAlX92dG.js";import{TextureSelect as $}from"./index-Dd-glBUQ.js";import{Uniforms as H}from"./index-D_O4p-g_.js";import{VertexShader as B}from"./index-Dj1nOewu.js";import{FragmentShader as F}from"./index-BrELyWFC.js";import{GeneratorNumberWrap as X}from"./index-CSXu_FXZ.js";import{GeneratorColorWrap as Y}from"./index-BxbFb1rD.js";import{GeneratorVector3Wrap as Z}from"./index-BqCf0yAL.js";import{TimelineWrap as z}from"./index-BIfUOIZf.js";import{AudioWrap as q}from"./index-DL_28fvl.js";import{LUTSelect as J}from"./index-JbxcUSE3.js";import{BlueprintWrap as K}from"./index-D25Am8R6.js";const Q=o=>{const{items:t,event:e}=o;N.show(t,e)},wt=()=>{N.hide()},tt=(o,t)=>{const[e,n]=l.useState(o.item);return l.useEffect(()=>{o.item&&(o.item.listen(t),t(o.item.getter()))},[]),o.update=s=>{e==null||e.unlisten(t),n(s),s&&(s.listen(t),t(s.getter()))},o.destroy=()=>{e==null||e.unlisten(t)},e};var j=(o=>(o.GRAPH="graph",o.ATTR_COMPONENT="attrComponent",o.HIERARCHY="hierarchy",o))(j||{});const et="_container_377r3_1",st="_title_377r3_9",it="_icon_377r3_14",nt="_active_377r3_19",rt="_body_377r3_23",u={container:et,title:st,icon:it,active:nt,body:rt};class ot{constructor(t){this.parent=t,this.container=document.createElement("div"),this.container.className="attribute-item-label",this.label=document.createElement("div"),this.label.className="attribute-item-label-name",this.container.appendChild(this.label)}hide(){delete this.item}show(t){const{attribute:e,tip:n}=t,{label:s,hiddenLabel:c}=e;this.item=t,this.label.textContent=s,this.label.title=n||s,this.container.style.display=c?"none":"flex"}dispose(){delete this.item}}const at=o=>{const{root:t}=o,[e,n]=l.useState(),s=tt(t,n),c=l.useMemo(()=>(s==null?void 0:s.attribute.type)??"string",[s]),r=p=>s==null?void 0:s.setter(p);switch(c){case a.STRING:return i.jsx(w,{attribute:s,value:e,onChange:r});case a.NUMBER:return i.jsx(I,{attribute:s,value:e,onChange:r});case a.BOOLEAN:return i.jsx(V,{attribute:s,value:e,onChange:r});case a.COLOR:return i.jsx(k,{attribute:s,value:e,onChange:r});case a.ENUM:return i.jsx(W,{attribute:s,value:e,onChange:r});case a.VECTOR2:return i.jsx(P,{attribute:s,value:e,onChange:r});case a.VECTOR3:return i.jsx(U,{attribute:s,value:e,onChange:r});case a.SCRIPT:return i.jsx(D,{attribute:s,value:e,onChange:r});case a.TEXTURE:return i.jsx($,{attribute:s,value:e,onChange:r});case a.UNIFORMS:return i.jsx(H,{value:e,onChange:r});case a.VERTEX_SHADER:return i.jsx(B,{value:e,onChange:r});case a.FRAGEMENT_SHADER:return i.jsx(F,{value:e,onChange:r});case a.GENERATOR_NUMBER:return i.jsx(X,{attribute:s,value:e,onChange:r});case a.GENERATOR_COLOR:return i.jsx(Y,{attribute:s,value:e,onChange:r});case a.GENERATOR_VECTOR3:return i.jsx(Z,{attribute:s,value:e,onChange:r});case a.TIME_LINE:return i.jsx(z,{attribute:s,value:e});case a.AUDIO:return i.jsx(q,{attribute:s,value:e,onChange:r});case a.LUT:return i.jsx(J,{attribute:s,value:e,onChange:r});case a.BLUEPRINT:return i.jsx(K,{attribute:s,value:e});default:return null}};class ct{constructor(t){this.parent=t,this.container=document.createElement("div"),this.container.className="attribute-item-value",this.root=L(this.container),this.root.render(i.jsx(O,{children:i.jsx(at,{root:this})})),this.parent.body.appendChild(this.container)}hide(){var t;(t=this.destroy)==null||t.call(this),this.container.style.display="none",delete this.item}show(t){var e;this.item=t,(e=this.update)==null||e.call(this,t),this.container.className="attribute-item-value",this.container.style.display="flex"}dispose(){var t;(t=this.destroy)==null||t.call(this),setTimeout(()=>this.root.unmount(),0),this.container.remove(),delete this.item}}class lt{constructor(t){this.refresh=()=>{var e;this.container.style.display=(e=this.item)!=null&&e.visible?"flex":"none"},this.parent=t,this.container=document.createElement("div"),this.container.className="attribute-item",this.label=new ot(this),this.body=document.createElement("div"),this.body.className="attribute-item-value-container",this.container.appendChild(this.label.container),this.container.appendChild(this.body),this.components={}}get visible(){return this.container.style.display==="flex"}hide(){var t;this.label.hide(),Object.values(this.components).forEach(e=>e.hide()),this.container.style.display="none",(t=this.item)==null||t.unlisten(this.refresh),delete this.item}show(t){const{attribute:e,visible:n}=t,{type:s}=e;this.item=t,this.label.show(t),Object.values(this.components).forEach(r=>r.hide());const c=this.getAttribute(s);c==null||c.show(t),this.container.style.display=n?"flex":"none",this.item.listen(this.refresh)}dispose(){var t;(t=this.item)==null||t.unlisten(this.refresh),delete this.item,this.label.dispose(),Object.values(this.components).forEach(e=>e.dispose()),this.container.remove()}getAttribute(t){let e=this.components[t];if(!e)try{e=new ct(this),this.components[t]=e}catch(n){console.error(n)}return e}}class ht{constructor(t){this.onClick=()=>{this.body.style.display==="none"?this.open():this.close()},this.onContextMenu=n=>{var c;if(((c=this.group)==null?void 0:c.type)!==G.Component)return;n.preventDefault();const s=this.group.editor.contextMenuManager.getContextMenu(j.ATTR_COMPONENT);s.length!==0&&(this.group.editor.contextMenuManager.meta={group:this.group},Q({event:n,items:s}))},this.parent=t,this.container=document.createElement("div"),this.container.className="attribute-group-container",this.head=document.createElement("div"),this.head.className="attribute-group",this.head.addEventListener("click",this.onClick),this.label=document.createElement("div"),this.label.className="attribute-group-name",this.label.addEventListener("contextmenu",this.onContextMenu),this.head.appendChild(this.label);const e=document.createElement("div");this.head.appendChild(e),this.suffix=document.createElement("div"),this.suffix.className="attribute-group-close",e.appendChild(this.suffix),this.body=document.createElement("div"),this.container.appendChild(this.head),this.container.appendChild(this.body),this.attributes=[]}hide(){this.attributes.forEach(t=>t.hide()),this.container.style.display="none"}show(t){const{group:e,groupName:n,attributes:s}=t,c=s.filter(r=>r.visible).length;this.group=t,this.label.textContent=n,this.container.style.display=c?"block":"none",this.parent.activeGroups.has(e)?this.open():this.close()}open(){if(this.body.style.display="block",this.suffix.className="attribute-group-close",!this.group)return;const{attributes:t}=this.group,e=t.length-this.attributes.length;for(let n=0;n<e;n++){const s=new lt(this);this.body.appendChild(s.container),this.attributes.push(s)}this.attributes.forEach(n=>n.hide()),t.forEach((n,s)=>this.attributes[s].show(n)),this.parent.addActiveGroup(this.group.group)}close(){this.body.style.display="none",this.suffix.className="attribute-group-close attribute-group-rotate",this.group&&this.parent.removeActiveGroup(this.group.group)}dispose(){this.head.removeEventListener("click",this.onClick),this.label.removeEventListener("contextmenu",this.onContextMenu),this.attributes.forEach(t=>t.dispose()),this.container.remove(),this.attributes=[],delete this.group}}class m{constructor(t,e){this.editor=t,this.groups=[],this.activeGroups=new Set(["base"]),this.container=e}update(t){const e=t.length-this.groups.length;for(let n=0;n<e;n++){const s=new ht(this);this.container.appendChild(s.container),this.groups.push(s)}this.groups.forEach(n=>n.hide()),t.forEach((n,s)=>this.groups[s].show(n))}setActiveGroups(t){t.forEach(e=>this.activeGroups.add(e))}addActiveGroup(t){this.activeGroups.add(t)}removeActiveGroup(t){this.activeGroups.delete(t)}dispose(){this.groups.forEach(t=>t.dispose()),this.groups=[]}}const ut=o=>{const{editor:t}=o,e=l.useRef(null),n=l.useRef(null),s=l.useRef(null),c=l.useRef(null),[r,p]=l.useState(1),[R,T]=l.useState(!1),[_,f]=l.useState(!1),[S,M]=l.useState(!1);return l.useEffect(()=>{const E=new m(t,e.current),v=new m(t,n.current),b=new m(t,s.current),g=new m(t,c.current),d=()=>{const h=t.attrManager.viewAttr.refresh();E.update(h),p(1)},y=()=>{const h=t.attrManager.nodeAttr.refresh(),A=t.attrManager.materialAttr.refresh();v.update(h),b.update(A),p(h.length?2:1),T(!!h.length),f(!!A.length)},x=()=>{const h=t.attrManager.materialAttr.refresh();b.update(h),p(3),f(!!h.length)},C=()=>{const h=t.attrManager.clipAttr.refresh();g.update(h),p(4),M(!!h.length)};return t.bus.on("DESERIALIZATED",d),t.bus.on("SCENE_SELECT",d),t.bus.on("NODE_SELECT",y),t.bus.on("MATERIAL_CHANGE",x),t.bus.on("CLIP_SELECT",C),()=>{t.bus.off("DESERIALIZATED",d),t.bus.off("SCENE_SELECT",d),t.bus.off("NODE_SELECT",y),t.bus.off("MATERIAL_CHANGE",x),t.bus.off("CLIP_SELECT",C),E.dispose(),v.dispose(),b.dispose(),g.dispose()}},[t]),i.jsxs("div",{className:u.container,children:[i.jsxs("div",{className:u.title,children:[i.jsx("div",{className:`iconfont icon-scene ${u.icon} ${r===1?u.active:""}`,onClick:()=>p(1)}),i.jsx("div",{className:`iconfont icon-inspector ${u.icon} ${r===2?u.active:""}`,style:{display:R?"block":"none"},onClick:()=>p(2)}),i.jsx("div",{className:`iconfont icon-material ${u.icon} ${r===3?u.active:""}`,style:{display:_?"block":"none"},onClick:()=>p(3)}),i.jsx("div",{className:`iconfont icon-animation ${u.icon} ${r===4?u.active:""}`,style:{display:S?"block":"none"},onClick:()=>p(4)})]}),i.jsxs("div",{className:u.body,children:[i.jsx("div",{ref:e,style:{display:r===1?"block":"none"}}),i.jsx("div",{ref:n,style:{display:r===2?"block":"none"}}),i.jsx("div",{ref:s,style:{display:r===3?"block":"none"}}),i.jsx("div",{ref:c,style:{display:r===4?"block":"none"}})]})]})},It=Object.freeze(Object.defineProperty({__proto__:null,PropertyBar:ut},Symbol.toStringTag,{value:"Module"}));export{j as M,ut as P,wt as h,It as i,Q as s};
