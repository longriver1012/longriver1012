var ge=Object.defineProperty;var me=(a,t,e)=>t in a?ge(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var l=(a,t,e)=>me(a,typeof t!="symbol"?t+"":t,e);import{a as m,b as S,g as D,S as ye,E as Ae,T as K,c as te,d as Z,e as M,P as ue,M as C,f as de,h as Ee,i as z}from"./texture-manager-D3Pmpn-e.js";import"./index-Bb-7Eb0M.js";const x=a=>{switch(a){case m.SimpleScript:return{id:D(),enabled:!0,name:S[m.SimpleScript],type:m.SimpleScript,script:ye};case m.Animator:return{id:D(),enabled:!0,name:S[m.Animator],type:m.Animator};case m.OrbitControls:return{id:D(),enabled:!0,name:S[m.OrbitControls],type:m.OrbitControls};case m.PointerLockControls:return{id:D(),enabled:!0,name:S[m.PointerLockControls],type:m.PointerLockControls};case m.PlayableDirector:return{id:D(),enabled:!0,name:S[m.PlayableDirector],type:m.PlayableDirector};case m.Blueprint:return{id:D(),enabled:!0,name:S[m.Blueprint],type:m.Blueprint};default:throw new Error(`未知组件类型: ${a}`)}};class f{constructor(t,e,r){l(this,"editor");l(this,"attribute");l(this,"callbacks");l(this,"targets");l(this,"target");l(this,"key");l(this,"bindCallback");this.editor=t,this.attribute=e,this.targets=r,this.target=r[r.length-1],this.key=e.key,this.callbacks=[]}setTargets(t){this.targets=t,this.target=t[t.length-1]}listen(t){this.callbacks.includes(t)||this.callbacks.push(t)}unlisten(t){const e=this.callbacks.indexOf(t);e>=0&&this.callbacks.splice(e,1)}update(){this.callbacks.forEach(t=>t(this.getter()))}getter(){return this.attribute.getter(this.target)}setter(t){this.editor.historyManager.beginTransaction();for(const e of this.targets)this.attribute.setter(e,t);this.editor.historyManager.endTransaction()}get visible(){const{visible:t}=this.attribute;return typeof t=="function"?t(this.target):t??!0}get group(){return this.attribute.group}get groupName(){return this.attribute.groupName}get disabled(){const{disabled:t}=this.attribute;return typeof t=="function"?t(this.target):t}get text(){return this.attribute.text}get options(){const{options:t}=this.attribute;return typeof t=="function"?t(this.target):t}get min(){const{min:t}=this.attribute;return typeof t=="function"?t(this.target):t}get max(){const{max:t}=this.attribute;return typeof t=="function"?t(this.target):t}get precision(){return this.attribute.precision}get step(){return this.attribute.step}get tip(){return this.attribute.tip}get assetType(){return this.attribute.assetType}get disableAlpha(){return this.attribute.disableAlpha}}const s={BASE:{key:"base",name:"基础"},COMPONENTS:{key:"components",name:"组件"},CONTROL:{key:"control",name:"控制"},BACKGROUND:{key:"background",name:"背景"},ENVIRONMENT:{key:"environment",name:"环境"},FOG:{key:"fog",name:"雾"},SHADOW:{key:"shadow",name:"阴影"},EFFECT:{key:"effect",name:"后处理"},EFFECT_FXAA:{key:"effect_fxaa",name:"FXAA"},EFFECT_SMAA:{key:"effect_smaa",name:"SMAA"},EFFECT_BLOOM:{key:"effect_bloom",name:"辉光"},EFFECT_OUTLINE:{key:"effect_outline",name:"描边"},EFFECT_SSAO:{key:"effect_ssao",name:"SSAO"},EFFECT_VIGNETTE:{key:"effect_vignette",name:"晕影"},EFFECT_BRIGHTNESS_CONTRAST:{key:"effect_brightness_contrast",name:"亮度/对比度"},EFFECT_HUE_SATURATION:{key:"effect_hue_saturation",name:"色相/饱和度"},EFFECT_LUT:{key:"effect_lut",name:"LUT"},EFFECT_DEPTH_OF_FIELD:{key:"effect_depth_of_field",name:"景深"},EFFECT_TONEMAPPING:{key:"effect_vtonemapping",name:"色调映射"},GRID:{key:"grid",name:"网格"},TRANSFORM:{key:"transform",name:"变换"},TEXT:{key:"text",name:"文本"},PARTICLE:{key:"particle",name:"粒子"},PARTICLE_SHAPE:{key:"particle_shape",name:"粒子发射形状"},PARTICLE_FORCE_OVER_LIFE:{key:"particle_force-over-life",name:"生命周期力场"},PARTICLE_COLOR_OVER_LIFE:{key:"particle_color-over-life",name:"生命周期颜色"},PARTICLE_SIZE_OVER_LIFE:{key:"particle_size-over-life",name:"生命周期大小"},PARTICLE_ROTATION_OVER_LIFE:{key:"particle_rotation-over-life",name:"生命周期旋转"},PARTICLE_FRAME_OVER_LIFE:{key:"particle_frame-over-life",name:"生命周期纹理动画"},PARTICLE_NOISE:{key:"particle_noise",name:"生命周期噪声"},DIFFUSE_MAP:{key:"diffuse_map",name:"漫反射"},SPECULAR_MAP:{key:"specular_map",name:"高光"},METALLNESS_MAP:{key:"metalness_map",name:"金属度"},ROUGHNESS_MAP:{key:"roughness_map",name:"粗糙度"},NORMAL_MAP:{key:"normal_map",name:"法线"},AO_MAP:{key:"ao_map",name:"环境光遮蔽"},ENV_MAP:{key:"env_map",name:"环境光"},EMISSIVE_MAP:{key:"emissive_map",name:"自发光"},ALPHA_MAP:{key:"alpha_map",name:"透明度"},BUMP_MAP:{key:"bump_map",name:"凹凸贴图"},DISPLACEMENT_MAP:{key:"displacement_map",name:"置换贴图"},LIGHT_MAP:{key:"light_map",name:"光照贴图"},ANISOTROPY_MAP:{key:"anisotropy_map",name:"各项异性"},CLEARCOAT_MAP:{key:"clearcoat_map",name:"清漆"},CLEARCOAT_NORMAL_MAP:{key:"clearcoat_normal_map",name:"清漆法线"},CLEARCOAT_ROUGHNESS_MAP:{key:"clearcoat_roughness_map",name:"清漆粗糙度"},IRIDESCENE_MAP:{key:"iridescence_map",name:"虹彩"},IRIDESCENE_THICKNESS_MAP:{key:"iridescence_thickness_map",name:"虹彩厚度"},SHEEN_COLOR_MAP:{key:"sheen_color_Map",name:"光泽"},SHEEN_ROUGHNESS_MAP:{key:"sheen_roughness_Map",name:"光泽粗糙度"},SPECULAR_COLOR_MAP:{key:"specular_color_map",name:"高光反射颜色"},SPECULAR_INTENSITY_MAP:{key:"specular_intensity_map",name:"高光反射强度"},TRANSMISSION_MAP:{key:"transmission_map",name:"透光"},THICKNESS_MAP:{key:"thicknessMap",name:"厚度"},CUSTOM_SHADER:{key:"custom_shader",name:"自定义材质"},AUDIO:{key:"audio",name:"音频"}},o={STRING:"string",NUMBER:"number",BOOLEAN:"boolean",ENUM:"enum",COLOR:"color",VECTOR2:"vector2",VECTOR3:"vector3",SCRIPT:"script",TEXTURE:"texture",LUT:"lut",UNIFORMS:"uniforms",VERTEX_SHADER:"vertex-shader",FRAGEMENT_SHADER:"fragement-shader",GENERATOR_NUMBER:"generator-number",GENERATOR_VECTOR3:"generator-vector3",GENERATOR_COLOR:"generator-color",TIME_LINE:"timeline",AUDIO:"audio",BLUEPRINT:"blueprint"},Me=["Arial","Arial Black","Arial Narrow","Algerian","Bookman Old Style","Bahnschrift Light","Baskerville Old Face","Bauhaus 93","Bell MT","Cursive","Century","Century Gothic","Comic Sans MS","Courier","Courier New","Calibri","Calibri Light","fantasy","Georgia","Gabriola","Garamond","Informal Roman","Impact","Lucida Bright","Lucida Console","Lucida Sans Unicode","monospace","Microsoft Uighur","Monotype Corsiva","MS Sans Serif","MS Serif","Palatino Linotype","serif","sans-serif","Tahoma","Times","Times New Roman","Trebuchet MS","Verdana","等线","等线 Light","仿宋","华文中宋","华文仿宋","华文宋体","华文彩云","华文新魏","华文楷体","华文琥珀","华文细黑","华文行楷","华文隶书","宋体","幼圆","微软雅黑","黑体","新宋体","方正姚体","方正舒体","楷体","隶书"].map(a=>({label:a,value:a})),Ce=[{label:"常规",value:"normal"},{label:"粗体",value:"bold"},{label:"斜体",value:"italic"},{label:"粗斜体",value:"italic bold"}];var w=(a=>(a.Default="Default",a.Component="Component",a))(w||{});const T=Math.PI/180,B=180/Math.PI,ve=1,Se=32,be=a=>a*B,ke=a=>a*T,q=a=>a.getAttr("shapeType")!="Point",Ne=a=>a.getAttr("shapeType")==="Cone",H=a=>a.getAttr("shapeType")==="Box",G=a=>["Sphere","Cone","Circle"].includes(a.getAttr("shapeType"));class fe{constructor(t){l(this,"editor");l(this,"commonAttrs");l(this,"planeAttrs");l(this,"boxAttrs");l(this,"coneAttrs");l(this,"cylinderAttrs");l(this,"sphereAttrs");l(this,"pipeAttrs");l(this,"ambientLightAttrs");l(this,"directionalLightAttrs");l(this,"hemisphereLightAttrs");l(this,"spotLightAttrs");l(this,"pointLightAttrs");l(this,"perspectiveCameraAttrs");l(this,"orthographicCameraAttrs");l(this,"modelAttrs");l(this,"symbolAttrs");l(this,"textAttrs");l(this,"particleAttrs");l(this,"audioAttrs");l(this,"positionalAudioAttrs");l(this,"activeGroups");this.editor=t,this.activeGroups=[s.BASE.key],this.commonAttrs=[{label:"可见",key:"visible",type:o.BOOLEAN,group:s.CONTROL.key,groupName:s.CONTROL.name,getter:e=>e.getAttr("visible"),setter:(e,r)=>e.setAttr("visible",r)},{label:"可变换",key:"transformable",type:o.BOOLEAN,group:s.CONTROL.key,groupName:s.CONTROL.name,getter:e=>e.getAttr("transformable"),setter:(e,r)=>e.setAttr("transformable",r)},{label:"可选中",key:"selectable",type:o.BOOLEAN,group:s.CONTROL.key,groupName:s.CONTROL.name,getter:e=>e.getAttr("selectable"),setter:(e,r)=>e.setAttr("selectable",r)},{label:"投射阴影",key:"castShadow",type:o.BOOLEAN,group:s.CONTROL.key,groupName:s.CONTROL.name,getter:e=>e.getAttr("castShadow"),setter:(e,r)=>e.setAttr("castShadow",r)},{label:"接收阴影",key:"receiveShadow",type:o.BOOLEAN,group:s.CONTROL.key,groupName:s.CONTROL.name,getter:e=>e.getAttr("receiveShadow"),setter:(e,r)=>e.setAttr("receiveShadow",r)},{label:"名称",key:"name",type:o.STRING,group:s.BASE.key,min:ve,max:Se,groupName:s.BASE.name,getter:e=>e.getAttr("name"),setter:(e,r)=>e.setAttr("name",r)},{label:"类型",key:"type",type:o.STRING,group:s.BASE.key,groupName:s.BASE.name,disabled:!0,getter:e=>Ae[e.type]||"",setter:()=>{}},{label:"ID",key:"id",disabled:!0,type:o.STRING,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("id"),setter:()=>{}},{label:"位置",key:"position",type:o.VECTOR3,group:s.TRANSFORM.key,groupName:s.TRANSFORM.name,precision:3,getter:e=>e.position.toArray(),setter:(e,r)=>this.setVector3(e,"position",r)},{label:"旋转",key:"rotation",type:o.VECTOR3,group:s.TRANSFORM.key,groupName:s.TRANSFORM.name,precision:1,getter:({rotation:{x:e,y:r,z:i}})=>[e,r,i].map(n=>n*B),setter:(e,r)=>this.setEuler(e,r)},{label:"缩放",key:"scale",type:o.VECTOR3,group:s.TRANSFORM.key,groupName:s.TRANSFORM.name,precision:3,getter:e=>e.scale.toArray(),setter:(e,r)=>this.setVector3(e,"scale",r)}],this.planeAttrs=[{label:"尺寸",key:"size",type:o.VECTOR2,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,getter:e=>e.size.toArray(),setter:(e,r)=>this.setVector2(e,"size",r)},{label:"分段",key:"segments",type:o.VECTOR2,group:s.BASE.key,groupName:s.BASE.name,min:1,precision:0,max:100,getter:e=>e.segments.toArray(),setter:(e,r)=>this.setVector2(e,"segments",r)}],this.boxAttrs=[{label:"尺寸",key:"size",type:o.VECTOR3,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,getter:e=>e.size.toArray(),setter:(e,r)=>this.setVector3(e,"size",r)},{label:"分段",key:"segments",type:o.VECTOR3,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:1,max:100,getter:e=>e.segments.toArray(),setter:(e,r)=>this.setVector3(e,"segments",r)},{label:"圆角半径",key:"radius",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:0,step:.1,getter:e=>e.getAttr("radius"),setter:(e,r)=>e.setAttr("radius",r)}],this.coneAttrs=[{label:"半径",key:"radius",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("radius"),setter:(e,r)=>e.setAttr("radius",r)},{label:"高度",key:"height",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("height"),setter:(e,r)=>e.setAttr("height",r)},{label:"水平角度",key:"thetaLength",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:0,max:360,getter:e=>e.thetaLength*B,setter:(e,r)=>e.setAttr("thetaLength",r*T)},{label:"底部开口",key:"openEnded",type:o.BOOLEAN,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("openEnded"),setter:(e,r)=>e.setAttr("openEnded",r)},{label:"分段",key:"segments",type:o.VECTOR2,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:3,max:100,getter:e=>e.segments.toArray(),setter:(e,r)=>this.setVector2(e,"segments",r)}],this.cylinderAttrs=[{label:"顶部半径",key:"radiusTop",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("radiusTop"),setter:(e,r)=>e.setAttr("radiusTop",r)},{label:"底部半径",key:"radiusBottom",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("radiusBottom"),setter:(e,r)=>e.setAttr("radiusBottom",r)},{label:"高度",key:"height",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("height"),setter:(e,r)=>e.setAttr("height",r)},{label:"水平角度",key:"thetaLength",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:0,max:360,getter:e=>e.thetaLength*B,setter:(e,r)=>e.setAttr("thetaLength",r*T)},{label:"底部开口",key:"openEnded",type:o.BOOLEAN,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("openEnded"),setter:(e,r)=>e.setAttr("openEnded",r)},{label:"分段",key:"segments",type:o.VECTOR2,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:3,max:100,getter:e=>e.segments.toArray(),setter:(e,r)=>this.setVector2(e,"segments",r)}],this.sphereAttrs=[{label:"半径",key:"radius",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("radius"),setter:(e,r)=>e.setAttr("radius",r)},{label:"水平角度",key:"phiLength",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:0,max:360,getter:e=>e.phiLength*B,setter:(e,r)=>e.setAttr("phiLength",r*T)},{label:"垂直角度",key:"thetaLength",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:0,max:180,getter:e=>e.thetaLength*B,setter:(e,r)=>e.setAttr("thetaLength",r*T)},{label:"分段",key:"segments",type:o.VECTOR2,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:3,max:100,getter:e=>e.segments.toArray(),setter:(e,r)=>this.setVector2(e,"segments",r)}],this.pipeAttrs=[{label:"半径",key:"radius",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("radius"),setter:(e,r)=>e.setAttr("radius",r)},{label:"长度分段",key:"tubularSegments",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:10,step:1,getter:e=>e.getAttr("tubularSegments"),setter:(e,r)=>e.setAttr("tubularSegments",r)},{label:"半径分段",key:"radialSegments",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:0,min:2,step:1,getter:e=>e.getAttr("radialSegments"),setter:(e,r)=>e.setAttr("radialSegments",r)}],this.ambientLightAttrs=[{label:"颜色",key:"color",type:o.COLOR,disableAlpha:!0,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("color"),setter:(e,r)=>e.setAttr("color",r)},{label:"强度",key:"intensity",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:0,step:.1,getter:e=>e.getAttr("intensity"),setter:(e,r)=>e.setAttr("intensity",r)}],this.directionalLightAttrs=[...this.ambientLightAttrs,{label:"阴影近平面",key:"shadowCameraNear",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:2,step:.1,getter:e=>e.getAttr("shadowCameraNear"),setter:(e,r)=>e.setAttr("shadowCameraNear",r)},{label:"阴影远平面",key:"shadowCameraFar",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:2,step:.1,getter:e=>e.getAttr("shadowCameraFar"),setter:(e,r)=>e.setAttr("shadowCameraFar",r)},{label:"阴影范围",key:"shadowCameraSize",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:2,min:.1,step:.1,getter:e=>e.getAttr("shadowCameraSize"),setter:(e,r)=>e.setAttr("shadowCameraSize",r)},{label:"阴影偏移",key:"shadowBias",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:5,step:1e-5,getter:e=>e.getAttr("shadowBias"),setter:(e,r)=>e.setAttr("shadowBias",r)},{label:"阴影尺寸",key:"shadowMapSize",type:o.ENUM,group:s.SHADOW.key,groupName:s.SHADOW.name,options:[{label:"256",value:256},{label:"512",value:512},{label:"1024",value:1024},{label:"2048",value:2048},{label:"4096",value:4096},{label:"8192",value:8192}],getter:e=>e.getAttr("shadowMapSize"),setter:(e,r)=>e.setAttr("shadowMapSize",r)}],this.hemisphereLightAttrs=[...this.ambientLightAttrs,{label:"底部颜色",key:"groundColor",type:o.COLOR,disableAlpha:!0,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("groundColor"),setter:(e,r)=>e.setAttr("groundColor",r)}],this.spotLightAttrs=[...this.ambientLightAttrs,{label:"最远距离",key:"distance",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:0,step:.1,getter:e=>e.getAttr("distance"),setter:(e,r)=>e.setAttr("distance",r)},{label:"范围角度",key:"angle",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:1,min:0,max:90,getter:e=>e.getAttr("angle")*B,setter:(e,r)=>{const i=r;e.setAttr("angle",i*T)}},{label:"半影衰减",key:"penumbra",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:0,max:1,step:.1,getter:e=>e.getAttr("penumbra"),setter:(e,r)=>e.setAttr("penumbra",r)},{label:"光照衰减",key:"decay",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:0,step:.1,getter:e=>e.getAttr("decay"),setter:(e,r)=>e.setAttr("decay",r)},{label:"阴影近平面",key:"shadowCameraNear",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:2,step:.1,min:.1,getter:e=>e.getAttr("shadowCameraNear"),setter:(e,r)=>e.setAttr("shadowCameraNear",r)},{label:"阴影远平面",key:"shadowCameraFar",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:2,step:.1,getter:e=>e.getAttr("shadowCameraFar"),setter:(e,r)=>e.setAttr("shadowCameraFar",r)},{label:"阴影偏移",key:"shadowBias",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:5,step:1e-5,getter:e=>e.getAttr("shadowBias"),setter:(e,r)=>e.setAttr("shadowBias",r)},{label:"阴影尺寸",key:"shadowMapSize",type:o.ENUM,group:s.SHADOW.key,groupName:s.SHADOW.name,options:[{label:"256",value:256},{label:"512",value:512},{label:"1024",value:1024},{label:"2048",value:2048},{label:"4096",value:4096}],getter:e=>e.getAttr("shadowMapSize"),setter:(e,r)=>e.setAttr("shadowMapSize",r)}],this.pointLightAttrs=[...this.ambientLightAttrs,{label:"最远距离",key:"distance",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:0,step:.1,getter:e=>e.getAttr("distance"),setter:(e,r)=>e.setAttr("distance",r)},{label:"光照衰减",key:"decay",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:0,step:.1,getter:e=>e.getAttr("decay"),setter:(e,r)=>e.setAttr("decay",r)},{label:"阴影近平面",key:"shadowCameraNear",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:2,step:.1,min:.1,getter:e=>e.getAttr("shadowCameraNear"),setter:(e,r)=>e.setAttr("shadowCameraNear",r)},{label:"阴影远平面",key:"shadowCameraFar",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:2,step:.1,getter:e=>e.getAttr("shadowCameraFar"),setter:(e,r)=>e.setAttr("shadowCameraFar",r)},{label:"阴影偏移",key:"shadowBias",type:o.NUMBER,group:s.SHADOW.key,groupName:s.SHADOW.name,precision:5,step:1e-5,getter:e=>e.getAttr("shadowBias"),setter:(e,r)=>e.setAttr("shadowBias",r)},{label:"阴影尺寸",key:"shadowMapSize",type:o.ENUM,group:s.SHADOW.key,groupName:s.SHADOW.name,options:[{label:"256",value:256},{label:"512",value:512},{label:"1024",value:1024},{label:"2048",value:2048},{label:"4096",value:4096}],getter:e=>e.getAttr("shadowMapSize"),setter:(e,r)=>e.setAttr("shadowMapSize",r)}],this.perspectiveCameraAttrs=[{label:"视角",key:"fov",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:1,min:.1,step:.1,getter:e=>e.getAttr("fov"),setter:(e,r)=>e.setAttr("fov",r)},{label:"近平面",key:"near",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("near"),setter:(e,r)=>e.setAttr("near",r)},{label:"远平面",key:"far",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("far"),setter:(e,r)=>e.setAttr("far",r)}],this.orthographicCameraAttrs=[{label:"正交尺寸",key:"frustumSize",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:1,min:.1,step:.1,getter:e=>e.getAttr("frustumSize"),setter:(e,r)=>e.setAttr("frustumSize",r)},{label:"近平面",key:"near",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.getAttr("near"),setter:(e,r)=>e.setAttr("near",r)},{label:"远平面",key:"far",step:.1,type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,getter:e=>e.getAttr("far"),setter:(e,r)=>e.setAttr("far",r)}],this.modelAttrs=[{label:"模型ID",key:"modelCode",type:o.STRING,disabled:!0,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("modelCode"),setter:(e,r)=>e.setAttr("modelCode",r)}],this.symbolAttrs=[{label:"图符路径",key:"symbolPath",type:o.STRING,disabled:!0,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("symbolPath"),setter:(e,r)=>e.setAttr("symbolPath",r)},{label:"显示模式",key:"mode",type:o.ENUM,options:[{label:"2D",value:"2d"},{label:"3D",value:"3d"}],group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("mode"),setter:(e,r)=>e.setAttr("mode",r)}],this.textAttrs=[{label:"尺寸",key:"size",type:o.VECTOR2,group:s.BASE.key,groupName:s.BASE.name,precision:2,min:.01,step:.1,getter:e=>e.size.toArray(),setter:(e,r)=>this.setVector2(e,"size",r)},{label:"文本",key:"text",type:o.STRING,group:s.TEXT.key,groupName:s.TEXT.name,getter:e=>e.getAttr("text"),setter:(e,r)=>e.setAttr("text",r)},{label:"颜色",key:"fill",type:o.COLOR,group:s.TEXT.key,groupName:s.TEXT.name,getter:e=>e.getAttr("fill"),setter:(e,r)=>e.setAttr("fill",r)},{label:"字体",key:"fontFamily",type:o.ENUM,group:s.TEXT.key,groupName:s.TEXT.name,options:Me,getter:e=>e.getAttr("fontFamily"),setter:(e,r)=>e.setAttr("fontFamily",r)},{label:"字体大小",key:"fontSize",type:o.NUMBER,group:s.TEXT.key,groupName:s.TEXT.name,min:12,precision:0,getter:e=>e.getAttr("fontSize"),setter:(e,r)=>e.setAttr("fontSize",r)},{label:"字体样式",key:"fontStyle",type:o.ENUM,group:s.TEXT.key,groupName:s.TEXT.name,options:Ce,getter:e=>e.getAttr("fontStyle"),setter:(e,r)=>e.setAttr("fontStyle",r)},{label:"对齐方式",key:"align",type:o.ENUM,group:s.TEXT.key,groupName:s.TEXT.name,options:[{label:"左对齐",value:"left"},{label:"居中",value:"center"},{label:"右对齐",value:"right"}],getter:e=>e.getAttr("align"),setter:(e,r)=>e.setAttr("align",r)}],this.particleAttrs=[{label:"持续时间",key:"duration",type:o.NUMBER,group:s.PARTICLE.key,groupName:s.PARTICLE.name,min:0,precision:2,getter:e=>e.getAttr("duration"),setter:(e,r)=>e.setAttr("duration",r)},{label:"循环",key:"looping",type:o.BOOLEAN,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("looping"),setter:(e,r)=>e.setAttr("looping",r)},{label:"延迟时间",key:"delay",type:o.NUMBER,min:0,precision:2,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("delay"),setter:(e,r)=>e.setAttr("delay",r)},{label:"渲染模式",key:"renderMode",type:o.ENUM,options:[{label:"网格",value:0},{label:"公告板",value:1},{label:"水平公告板",value:2},{label:"垂直公告板",value:3},{label:"拉伸公告板",value:4}],group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("renderMode"),setter:(e,r)=>e.setAttr("renderMode",r)},{label:"随时间发射速率",key:"emissionOverTime",type:o.GENERATOR_NUMBER,min:0,step:1,precision:0,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("emissionOverTime"),setter:(e,r)=>e.setAttr("emissionOverTime",r)},{label:"初始生命",key:"startLife",type:o.GENERATOR_NUMBER,min:0,step:1,precision:1,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("startLife"),setter:(e,r)=>e.setAttr("startLife",r)},{label:"初始颜色",key:"startColor",type:o.GENERATOR_COLOR,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("startColor"),setter:(e,r)=>e.setAttr("startColor",r)},{label:"3D尺寸",key:"size3d",type:o.BOOLEAN,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("size3d"),setter:(e,r)=>e.setAttr("size3d",r)},{label:"初始尺寸",key:"startSize",type:o.GENERATOR_NUMBER,group:s.PARTICLE.key,groupName:s.PARTICLE.name,visible:e=>!e.getAttr("size3d"),getter:e=>e.getAttr("startSize"),setter:(e,r)=>e.setAttr("startSize",r)},{label:"初始尺寸",key:"startSize3d",type:o.GENERATOR_VECTOR3,group:s.PARTICLE.key,groupName:s.PARTICLE.name,visible:e=>!!e.getAttr("size3d"),getter:e=>e.getAttr("startSize3d"),setter:(e,r)=>e.setAttr("startSize3d",r)},{label:"初始旋转",key:"startRotation",type:o.GENERATOR_VECTOR3,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("startRotation"),setter:(e,r)=>e.setAttr("startRotation",r)},{label:"初始速度",key:"startSpeed",type:o.GENERATOR_NUMBER,min:0,step:1,precision:1,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.getAttr("startSpeed"),setter:(e,r)=>e.setAttr("startSpeed",r)},{label:"纹理表",key:"uvTiles",type:o.VECTOR2,min:0,step:1,precision:0,group:s.PARTICLE.key,groupName:s.PARTICLE.name,getter:e=>e.uvTiles.toArray(),setter:(e,r)=>this.setVector2(e,"uvTiles",r)},{label:"型状",key:"shapeType",type:o.ENUM,options:[{label:"点",value:"Point"},{label:"圆",value:"Circle"},{label:"立方体",value:"Box"},{label:"球形",value:"Sphere"},{label:"圆锥",value:"Cone"},{label:"网格",value:"Mesh"}],group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,getter:e=>e.getAttr("shapeType"),setter:(e,r)=>e.setAttr("shapeType",r)},{label:"模式",key:"shapeMode",type:o.ENUM,options:[{label:"随机",value:0},{label:"循环",value:1},{label:"乒乓",value:2}],group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,getter:e=>e.getAttr("shapeMode"),setter:(e,r)=>e.setAttr("shapeMode",r)},{label:"发射半径",key:"shapeRadius",type:o.NUMBER,min:.1,step:1,precision:1,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,visible:G,getter:e=>e.getAttr("shapeRadius"),setter:(e,r)=>e.setAttr("shapeRadius",r)},{label:"开口半径",key:"shapeTopRadius",type:o.NUMBER,min:0,max:90,step:.1,precision:1,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,visible:Ne,getter:e=>e.getAttr("shapeTopRadius"),setter:(e,r)=>e.setAttr("shapeTopRadius",r)},{label:"发射周角",key:"shapeArc",type:o.NUMBER,min:.1,max:360,step:1,precision:1,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,visible:G,getter:e=>be(e.getAttr("shapeArc")),setter:(e,r)=>e.setAttr("shapeArc",ke(r))},{label:"宽度",key:"shapeWdith",type:o.NUMBER,min:.1,step:.1,precision:1,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,visible:H,getter:e=>e.getAttr("shapeWdith"),setter:(e,r)=>e.setAttr("shapeWdith",r)},{label:"高度",key:"shapeHeight",type:o.NUMBER,min:.1,step:.1,precision:1,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,visible:H,getter:e=>e.getAttr("shapeHeight"),setter:(e,r)=>e.setAttr("shapeHeight",r)},{label:"深度",key:"shapeDepth",type:o.NUMBER,min:.1,step:.1,precision:1,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,visible:H,getter:e=>e.getAttr("shapeDepth"),setter:(e,r)=>e.setAttr("shapeDepth",r)},{label:"发射范围",key:"shapeThickness",type:o.NUMBER,min:0,max:1,step:.1,precision:1,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,visible:G,getter:e=>e.getAttr("shapeThickness"),setter:(e,r)=>e.setAttr("shapeThickness",r)},{label:"扩散",key:"shapeSpread",type:o.NUMBER,min:0,step:.1,precision:1,visible:q,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,getter:e=>e.getAttr("shapeSpread"),setter:(e,r)=>e.setAttr("shapeSpread",r)},{label:"速度",key:"shapeSpeed",type:o.GENERATOR_NUMBER,min:0,step:.1,precision:1,group:s.PARTICLE_SHAPE.key,groupName:s.PARTICLE_SHAPE.name,visible:q,getter:e=>e.getAttr("shapeSpeed"),setter:(e,r)=>e.setAttr("shapeSpeed",r)}],this.audioAttrs=[{label:"音频",key:"audio",type:o.AUDIO,group:s.AUDIO.key,groupName:s.AUDIO.name,getter:e=>e.getAttr("audio"),setter:(e,r)=>e.setAttr("audio",r)},{label:"自动播放",key:"autoplay",type:o.BOOLEAN,group:s.AUDIO.key,groupName:s.AUDIO.name,getter:e=>e.getAttr("autoplay"),setter:(e,r)=>e.setAttr("autoplay",r)},{label:"循环播放",key:"loop",type:o.BOOLEAN,group:s.AUDIO.key,groupName:s.AUDIO.name,getter:e=>e.getAttr("loop"),setter:(e,r)=>e.setAttr("loop",r)},{label:"音量",key:"volume",type:o.NUMBER,group:s.AUDIO.key,groupName:s.AUDIO.name,min:0,step:.1,precision:2,getter:e=>e.getAttr("volume"),setter:(e,r)=>e.setAttr("volume",r)}],this.positionalAudioAttrs=[...this.audioAttrs,{label:"距离模型",key:"distanceModel",type:o.ENUM,group:s.AUDIO.key,groupName:s.AUDIO.name,tip:`linear：线性衰减（音量 = 1 - 距离 × 衰减系数）
inverse：反向衰减（音量 = 1 / 距离 × 衰减系数）
exponential：指数衰减（音量 = e^(-距离 × 衰减系数)）`,options:[{label:"线性衰减",value:"linear"},{label:"反向衰减",value:"inverse"},{label:"指数衰减",value:"exponential"}],getter:e=>e.getAttr("distanceModel"),setter:(e,r)=>e.setAttr("distanceModel",r)},{label:"参考距离",key:"refDistance",type:o.NUMBER,group:s.AUDIO.key,groupName:s.AUDIO.name,min:0,step:.1,precision:2,tip:"声音的参考距离。当听者与声源的距离等于此值时，音量保持原始大小（无衰减）。通常设为声源的“自然大小”（如人物说话距离为 1 米）。",getter:e=>e.getAttr("refDistance"),setter:(e,r)=>e.setAttr("refDistance",r)},{label:"衰减强度因子",key:"rolloffFactor",type:o.NUMBER,group:s.AUDIO.key,groupName:s.AUDIO.name,min:0,step:.1,precision:2,tip:"衰减强度因子。值越大，声音随距离衰减越快（如 2 表示快速衰减，0.5 表示缓慢衰减）。",getter:e=>e.getAttr("rolloffFactor"),setter:(e,r)=>e.setAttr("rolloffFactor",r)},{label:"最大有效距离",key:"maxDistance",type:o.NUMBER,group:s.AUDIO.key,groupName:s.AUDIO.name,min:0,step:.1,precision:2,tip:"最大有效距离。超过此距离后音量不再衰减（保持最小音量）。设为 Infinity 可禁用此效果。",getter:e=>e.getAttr("maxDistance"),setter:(e,r)=>e.setAttr("maxDistance",r)}]}setVector2(t,e,r,i){const n=t.getAttr(e).toArray(),[c,p,h]=r;switch(h){case"x":n[0]=i?i(c):c;break;case"y":n[1]=i?i(p):p;break;default:n[0]=i?i(c):c,n[1]=i?i(p):p;break}t.setAttr(e,K.fromArray(n))}setVector3(t,e,r){const i=t.getAttr(e).toArray(),[n,c,p,h]=r;switch(h){case"x":i[0]=n;break;case"y":i[1]=c;break;case"z":i[2]=p;break;default:i[0]=n,i[1]=c,i[2]=p;break}t.setAttr(e,te.fromArray(i))}setEuler(t,e){const r=t.rotation.toArray(),[i,n,c,p]=e;switch(p){case"x":r[0]=i*T;break;case"y":r[1]=n*T;break;case"z":r[2]=c*T;break;default:r[0]=i*T,r[1]=n*T,r[2]=c*T;break}Z.fromArray(r),t.setAttr("rotation",Z)}}const Te=[M.AmbientLight,M.DirectionalLight,M.HemisphereLight],Re=["rotation","scale"];class ht{constructor(t){l(this,"editor");l(this,"commonAttrs");l(this,"customAttrs");l(this,"groups");l(this,"activeGroups");l(this,"getGroups",t=>{const e=[];for(const r of t.components)switch(r.type){case m.SimpleScript:e.push({editor:this.editor,type:w.Component,group:`component-${r.id}`,groupName:S[m.SimpleScript],attributes:this.getScriptComponentAttrs(r),meta:{component:r}});break;case m.OrbitControls:e.push({editor:this.editor,type:w.Component,group:`component-${r.id}`,groupName:S[m.OrbitControls],attributes:this.getOrbitControlsComponentAttrs(r),meta:{component:r}});break;case m.PointerLockControls:e.push({editor:this.editor,type:w.Component,group:`component-${r.id}`,groupName:S[m.PointerLockControls],attributes:this.getPointerLockControlsComponentAttrs(r),meta:{component:r}});break;case m.PlayableDirector:e.push({editor:this.editor,type:w.Component,group:`component-${r.id}`,groupName:S[m.PlayableDirector],attributes:this.getPlayableDirectorComponentAttrs(r),meta:{component:r}});break;case m.Blueprint:e.push({editor:this.editor,type:w.Component,group:`component-${r.id}`,groupName:S[m.Blueprint],attributes:this.getBlueprintComponentAttrs(r),meta:{component:r}});break}if(t instanceof ue)for(const r of t.object3d.behaviours)switch(r.type){case"force-over-life":e.push({editor:this.editor,group:s.PARTICLE_FORCE_OVER_LIFE.key,groupName:s.PARTICLE_FORCE_OVER_LIFE.name,attributes:this.getParticleForceOverLiftAttrs(t)});break;case"color-over-life":e.push({editor:this.editor,group:s.PARTICLE_COLOR_OVER_LIFE.key,groupName:s.PARTICLE_COLOR_OVER_LIFE.name,attributes:this.getParticleColorOverLiftAttrs(t)});break;case"size-over-life":e.push({editor:this.editor,group:s.PARTICLE_SIZE_OVER_LIFE.key,groupName:s.PARTICLE_SIZE_OVER_LIFE.name,attributes:this.getParticleSizeOverLiftAttrs(t)});break;case"rotation-over-life":e.push({editor:this.editor,group:s.PARTICLE_ROTATION_OVER_LIFE.key,groupName:s.PARTICLE_ROTATION_OVER_LIFE.name,attributes:this.getParticleRotationOverLiftAttrs(t)});break;case"frame-over-life":e.push({editor:this.editor,group:s.PARTICLE_FRAME_OVER_LIFE.key,groupName:s.PARTICLE_FRAME_OVER_LIFE.name,attributes:this.getParticleFrameOverLiftAttrs(t)});break;case"noise":e.push({editor:this.editor,group:s.PARTICLE_NOISE.key,groupName:s.PARTICLE_NOISE.name,attributes:this.getParticleNoiseAttrs(t)});break}return e});this.editor=t,this.activeGroups=[s.BASE.key],this.groups=[];const{commonAttrs:e,planeAttrs:r,boxAttrs:i,coneAttrs:n,cylinderAttrs:c,sphereAttrs:p,pipeAttrs:h,ambientLightAttrs:y,directionalLightAttrs:u,hemisphereLightAttrs:k,spotLightAttrs:N,pointLightAttrs:v,perspectiveCameraAttrs:R,orthographicCameraAttrs:P,modelAttrs:U,symbolAttrs:$,textAttrs:g,particleAttrs:d,audioAttrs:pe,positionalAudioAttrs:he}=new fe(this.editor);this.commonAttrs=this.createAttributes(e),this.customAttrs=new Map([[M.Plane,this.createAttributes(r)],[M.Box,this.createAttributes(i)],[M.Cone,this.createAttributes(n)],[M.Cylinder,this.createAttributes(c)],[M.Sphere,this.createAttributes(p)],[M.Pipe,this.createAttributes(h)],[M.AmbientLight,this.createAttributes(y)],[M.DirectionalLight,this.createAttributes(u)],[M.HemisphereLight,this.createAttributes(k)],[M.SpotLight,this.createAttributes(N)],[M.PointLight,this.createAttributes(v)],[M.PerspectiveCamera,this.createAttributes(R)],[M.OrthographicCamera,this.createAttributes(P)],[M.Model,this.createAttributes(U)],[M.Symbol,this.createAttributes($)],[M.Text,this.createAttributes(g)],[M.Particle,this.createAttributes(d)],[M.Audio,this.createAttributes(pe)],[M.PositionalAudio,this.createAttributes(he)]])}refresh(){this.groups.length=0;const t=this.editor.selectionManager.getLastSelection();if(!t)return this.groups;const e=[...this.editor.selectionManager.getSelection()],r=[...this.getAttributes(t)];for(const i of r){const n=this.groups.find(c=>c.group===i.group);if(n)n.attributes.push(i);else{const{group:c,groupName:p}=i;this.groups.push({editor:this.editor,group:c,groupName:p,type:w.Default,attributes:[i]})}}return this.groups.push(...this.getGroups(t)),this.groups.forEach(i=>i.attributes.forEach(n=>n.setTargets(e))),this.groups}update(){for(const t of this.groups)for(const e of t.attributes)e.update()}dispose(){this.groups=[]}createAttributes(t){return t.map(e=>new f(this.editor,e,[]))}getAttributes(t){const e=this.customAttrs.get(t.type)||[];let r=[...this.commonAttrs];return Te.includes(t.type)&&(r=r.filter(i=>!Re.includes(i.key))),[...r,...e]}getScriptComponentAttrs(t){const e=[];return e.push({label:"组件名称",key:"component-name",type:o.STRING,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("name"),setter:(r,i)=>t.setAttr("name",i)},{label:"启用",key:"enabled",type:o.BOOLEAN,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("enabled"),setter:(r,i)=>t.setAttr("enabled",i)},{label:"脚本",key:"component-script",type:o.SCRIPT,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("script"),setter:(r,i)=>t.setAttr("script",i)}),e.map(r=>new f(this.editor,r,[]))}getOrbitControlsComponentAttrs(t){const e=[];return e.push({label:"组件名称",key:"component-name",type:o.STRING,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("name"),setter:(r,i)=>t.setAttr("name",i)},{label:"启用",key:"enabled",type:o.BOOLEAN,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("enabled"),setter:(r,i)=>t.setAttr("enabled",i)},{label:"目标位置",key:"target",type:o.VECTOR3,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,precision:3,getter:()=>t.target.toArray(),setter:(r,i)=>this.setVector3(t,"target",i)}),e.map(r=>new f(this.editor,r,[]))}getPointerLockControlsComponentAttrs(t){const e=[];return e.push({label:"组件名称",key:"component-name",type:o.STRING,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("name"),setter:(r,i)=>t.setAttr("name",i)},{label:"启用",key:"enabled",type:o.BOOLEAN,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("enabled"),setter:(r,i)=>t.setAttr("enabled",i)},{label:"移动速度",key:"moveSpeed",type:o.NUMBER,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,min:.01,precision:2,getter:()=>t.getAttr("moveSpeed"),setter:(r,i)=>t.setAttr("moveSpeed",i)}),e.map(r=>new f(this.editor,r,[]))}getPlayableDirectorComponentAttrs(t){const e=[];return e.push({label:"组件名称",key:"component-name",type:o.STRING,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("name"),setter:(r,i)=>t.setAttr("name",i)},{label:"启用",key:"enabled",type:o.BOOLEAN,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("enabled"),setter:(r,i)=>t.setAttr("enabled",i)},{label:"时间轴",key:"playableTimeline",type:o.TIME_LINE,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("playableTimeline"),setter:(r,i)=>t.setAttr("playableTimeline",i)}),e.map(r=>new f(this.editor,r,[]))}getBlueprintComponentAttrs(t){const e=[];return e.push({label:"组件名称",key:"component-name",type:o.STRING,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("name"),setter:(r,i)=>t.setAttr("name",i)},{label:"启用",key:"enabled",type:o.BOOLEAN,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("enabled"),setter:(r,i)=>t.setAttr("enabled",i)},{label:"蓝图",key:"graph",type:o.BLUEPRINT,group:s.COMPONENTS.key,groupName:s.COMPONENTS.name,getter:()=>t.getAttr("graph"),setter:(r,i)=>t.setAttr("graph",i)}),e.map(r=>new f(this.editor,r,[]))}getParticleForceOverLiftAttrs(t){const e=[];return e.push({label:"启用",key:"forceOverLifeEnabled",type:o.BOOLEAN,group:s.PARTICLE_FORCE_OVER_LIFE.key,groupName:s.PARTICLE_FORCE_OVER_LIFE.name,getter:()=>t.getAttr("forceOverLifeEnabled"),setter:(r,i)=>t.setAttr("forceOverLifeEnabled",i)},{label:"力场",key:"forceOverLifeForce",type:o.GENERATOR_VECTOR3,group:s.PARTICLE_FORCE_OVER_LIFE.key,groupName:s.PARTICLE_FORCE_OVER_LIFE.name,getter:r=>r.getAttr("forceOverLifeForce"),setter:(r,i)=>r.setAttr("forceOverLifeForce",i)}),e.map(r=>new f(this.editor,r,[]))}getParticleColorOverLiftAttrs(t){const e=[];return e.push({label:"启用",key:"colorOverLifeEnabled",type:o.BOOLEAN,group:s.PARTICLE_COLOR_OVER_LIFE.key,groupName:s.PARTICLE_COLOR_OVER_LIFE.name,getter:()=>t.getAttr("colorOverLifeEnabled"),setter:(r,i)=>t.setAttr("colorOverLifeEnabled",i)},{label:"颜色",key:"colorOverLifeColor",type:o.GENERATOR_COLOR,group:s.PARTICLE_COLOR_OVER_LIFE.key,groupName:s.PARTICLE_COLOR_OVER_LIFE.name,getter:r=>r.getAttr("colorOverLifeColor"),setter:(r,i)=>r.setAttr("colorOverLifeColor",i)}),e.map(r=>new f(this.editor,r,[]))}getParticleSizeOverLiftAttrs(t){const e=[];return e.push({label:"启用",key:"sizeOverLifeEnabled",type:o.BOOLEAN,group:s.PARTICLE_SIZE_OVER_LIFE.key,groupName:s.PARTICLE_SIZE_OVER_LIFE.name,getter:()=>t.getAttr("sizeOverLifeEnabled"),setter:(r,i)=>t.setAttr("sizeOverLifeEnabled",i)},{label:"3D尺寸",key:"sizeOverLifeIs3d",type:o.BOOLEAN,group:s.PARTICLE_SIZE_OVER_LIFE.key,groupName:s.PARTICLE_SIZE_OVER_LIFE.name,getter:r=>r.getAttr("sizeOverLifeIs3d"),setter:(r,i)=>r.setAttr("sizeOverLifeIs3d",i)},{label:"大小",key:"sizeOverLifeSize",type:o.GENERATOR_NUMBER,group:s.PARTICLE_SIZE_OVER_LIFE.key,groupName:s.PARTICLE_SIZE_OVER_LIFE.name,visible:r=>!r.getAttr("sizeOverLifeIs3d"),getter:r=>r.getAttr("sizeOverLifeSize"),setter:(r,i)=>r.setAttr("sizeOverLifeSize",i)},{label:"大小",key:"sizeOverLifeSize3d",type:o.GENERATOR_VECTOR3,group:s.PARTICLE_SIZE_OVER_LIFE.key,groupName:s.PARTICLE_SIZE_OVER_LIFE.name,visible:r=>!!r.getAttr("sizeOverLifeIs3d"),getter:r=>r.getAttr("sizeOverLifeSize3d"),setter:(r,i)=>r.setAttr("sizeOverLifeSize3d",i)}),e.map(r=>new f(this.editor,r,[]))}getParticleRotationOverLiftAttrs(t){const e=[];return e.push({label:"启用",key:"rotationOverLifeEnabled",type:o.BOOLEAN,group:s.PARTICLE_ROTATION_OVER_LIFE.key,groupName:s.PARTICLE_ROTATION_OVER_LIFE.name,getter:()=>t.getAttr("rotationOverLifeEnabled"),setter:(r,i)=>t.setAttr("rotationOverLifeEnabled",i)},{label:"旋转",key:"rotationOverLifeRotation",type:o.GENERATOR_VECTOR3,group:s.PARTICLE_ROTATION_OVER_LIFE.key,groupName:s.PARTICLE_ROTATION_OVER_LIFE.name,getter:r=>r.getAttr("rotationOverLifeRotation"),setter:(r,i)=>r.setAttr("rotationOverLifeRotation",i)}),e.map(r=>new f(this.editor,r,[]))}getParticleFrameOverLiftAttrs(t){const e=[];return e.push({label:"启用",key:"frameOverLifeEnabled",type:o.BOOLEAN,group:s.PARTICLE_FRAME_OVER_LIFE.key,groupName:s.PARTICLE_FRAME_OVER_LIFE.name,getter:()=>t.getAttr("frameOverLifeEnabled"),setter:(r,i)=>t.setAttr("frameOverLifeEnabled",i)},{label:"范围",key:"frameOverLifeRange",type:o.VECTOR2,min:0,step:1,precision:0,group:s.PARTICLE_FRAME_OVER_LIFE.key,groupName:s.PARTICLE_FRAME_OVER_LIFE.name,getter:r=>r.frameOverLifeRange.toArray(),setter:(r,i)=>this.setVector2(r,"frameOverLifeRange",i)},{label:"动画速率",key:"frameOverLifeFrame",type:o.GENERATOR_NUMBER,group:s.PARTICLE_FRAME_OVER_LIFE.key,groupName:s.PARTICLE_FRAME_OVER_LIFE.name,getter:r=>r.getAttr("frameOverLifeFrame"),setter:(r,i)=>r.setAttr("frameOverLifeFrame",i)}),e.map(r=>new f(this.editor,r,[]))}getParticleNoiseAttrs(t){const e=[];return e.push({label:"启用",key:"noiseEnabled",type:o.BOOLEAN,group:s.PARTICLE_NOISE.key,groupName:s.PARTICLE_NOISE.name,getter:()=>t.getAttr("noiseEnabled"),setter:(r,i)=>t.setAttr("noiseEnabled",i)},{label:"频率",key:"noiseFrequency",type:o.GENERATOR_NUMBER,min:0,step:.1,precision:1,group:s.PARTICLE_NOISE.key,groupName:s.PARTICLE_NOISE.name,getter:r=>r.getAttr("noiseFrequency"),setter:(r,i)=>r.setAttr("noiseFrequency",i)},{label:"强度",key:"noisePower",type:o.GENERATOR_NUMBER,min:0,step:.1,precision:1,group:s.PARTICLE_NOISE.key,groupName:s.PARTICLE_NOISE.name,getter:r=>r.getAttr("noisePower"),setter:(r,i)=>r.setAttr("noisePower",i)},{label:"位移程度",key:"noisePositionAmount",type:o.GENERATOR_NUMBER,min:0,step:.1,precision:1,group:s.PARTICLE_NOISE.key,groupName:s.PARTICLE_NOISE.name,getter:r=>r.getAttr("noisePositionAmount"),setter:(r,i)=>r.setAttr("noisePositionAmount",i)},{label:"旋转程度",key:"noiseRotationAmount",type:o.GENERATOR_NUMBER,min:0,step:.1,precision:1,group:s.PARTICLE_NOISE.key,groupName:s.PARTICLE_NOISE.name,getter:r=>r.getAttr("noiseRotationAmount"),setter:(r,i)=>r.setAttr("noiseRotationAmount",i)}),e.map(r=>new f(this.editor,r,[]))}setVector2(t,e,r,i){const n=t.getAttr(e).toArray(),[c,p,h]=r;switch(h){case"x":n[0]=i?i(c):c;break;case"y":n[1]=i?i(p):p;break;default:n[0]=i?i(c):c,n[1]=i?i(p):p;break}t.setAttr(e,K.fromArray(n))}setVector3(t,e,r){const i=t.getAttr(e).toArray(),[n,c,p,h]=r;switch(h){case"x":i[0]=n;break;case"y":i[1]=c;break;case"z":i[2]=p;break;default:i[0]=n,i[1]=c,i[2]=p;break}t.setAttr(e,te.fromArray(i))}}const Pe=Math.PI/180,Oe=180/Math.PI,Le=[{label:"正面",value:0},{label:"背面",value:1},{label:"双面",value:2}],_e=[{label:"无",value:0},{label:"正常",value:1},{label:"相加",value:2},{label:"相减",value:3},{label:"相乘",value:4}],xe=[{label:"UV映射",value:300},{label:"等距反射映射",value:303},{label:"等距折射映射",value:304}],j=[{label:"重复",value:1e3},{label:"扩展边缘",value:1001},{label:"镜像重复",value:1002}],Q=[{label:"最近邻过滤",value:1003},{label:"双线性过滤",value:1006},{label:"三次线性过滤",value:1008}],Ie=[{label:"无",value:""},{label:"RGB色彩空间",value:"srgb"},{label:"线性RGB色彩空间",value:"srgb-linear"}],we=[{label:"通道0",value:0},{label:"通道1",value:1},{label:"通道2",value:2},{label:"通道3",value:3}],Be=[C.Basic,C.Phong],De=[C.Standard,C.Physical],Ue=[C.Phong,C.Standard,C.Physical],Fe=[C.Basic,C.Phong,C.Standard,C.Physical],A=a=>a.type===C.Physical,F=a=>De.includes(a.type),J=a=>a.type===C.Phong,W=a=>a.type===C.Shader,ze=a=>a.type!==C.Shader,I=a=>Fe.includes(a.type),X=a=>Be.includes(a.type),L=a=>Ue.includes(a.type);class gt{constructor(t){l(this,"editor");l(this,"commonAttrs");l(this,"activeGroups");this.editor=t,this.activeGroups=[s.BASE.key],this.commonAttrs=[{label:"ID",key:"id",type:o.STRING,group:s.BASE.key,groupName:s.BASE.name,disabled:!0,getter:e=>e.getAttr("id"),setter:(e,r)=>e.setAttr("id",r)},{label:"类型",key:"type",type:o.STRING,group:s.BASE.key,groupName:s.BASE.name,disabled:!0,getter:e=>e.getAttr("type"),setter:(e,r)=>e.setAttr("type",r)},{label:"名称",key:"name",type:o.STRING,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("name"),setter:(e,r)=>e.setAttr("name",r)},{label:"透明性",key:"transparent",type:o.BOOLEAN,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("transparent"),setter:(e,r)=>e.setAttr("transparent",r)},{label:"透明度",key:"opacity",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,min:0,max:1,step:.1,precision:1,getter:e=>e.getAttr("opacity"),setter:(e,r)=>e.setAttr("opacity",r)},{label:"透明测试",key:"alphaTest",type:o.NUMBER,group:s.BASE.key,groupName:s.BASE.name,min:0,max:1,step:.1,precision:1,getter:e=>e.getAttr("alphaTest"),setter:(e,r)=>e.setAttr("alphaTest",r)},{label:"深度测试",key:"depthTest",type:o.BOOLEAN,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("depthTest"),setter:(e,r)=>e.setAttr("depthTest",r)},{label:"深度写入",key:"depthWrite",type:o.BOOLEAN,group:s.BASE.key,groupName:s.BASE.name,getter:e=>e.getAttr("depthWrite"),setter:(e,r)=>e.setAttr("depthWrite",r)},{label:"面",key:"side",type:o.ENUM,group:s.BASE.key,groupName:s.BASE.name,options:Le,getter:e=>e.getAttr("side"),setter:(e,r)=>e.setAttr("side",r)},{label:"混合",key:"blending",type:o.ENUM,group:s.BASE.key,groupName:s.BASE.name,options:_e,getter:e=>e.getAttr("blending"),setter:(e,r)=>e.setAttr("blending",r)},{label:"颜色",key:"color",type:o.COLOR,disableAlpha:!0,group:s.DIFFUSE_MAP.key,groupName:s.DIFFUSE_MAP.name,visible:I,getter:e=>e.getAttr("color"),setter:(e,r)=>e.setAttr("color",r)},...this.createMap("map",s.DIFFUSE_MAP,ze),{label:"高光",key:"specular",type:o.COLOR,disableAlpha:!0,visible:J,group:s.SPECULAR_MAP.key,groupName:s.SPECULAR_MAP.name,getter:e=>e.getAttr("specular"),setter:(e,r)=>e.setAttr("specular",r)},{label:"光泽度",key:"shininess",type:o.NUMBER,min:0,precision:2,step:1,visible:J,group:s.SPECULAR_MAP.key,groupName:s.SPECULAR_MAP.name,getter:e=>e.getAttr("shininess"),setter:(e,r)=>e.setAttr("shininess",r)},...this.createMap("specularMap",s.SPECULAR_MAP,X),{label:"金属度",key:"metalness",min:0,step:.1,precision:2,type:o.NUMBER,group:s.METALLNESS_MAP.key,groupName:s.METALLNESS_MAP.name,visible:F,getter:e=>e.getAttr("metalness"),setter:(e,r)=>e.setAttr("metalness",r)},...this.createMap("metalnessMap",s.METALLNESS_MAP,F),{label:"粗糙度",key:"roughness",min:0,step:.1,precision:2,type:o.NUMBER,group:s.ROUGHNESS_MAP.key,groupName:s.ROUGHNESS_MAP.name,visible:F,getter:e=>e.getAttr("roughness"),setter:(e,r)=>e.setAttr("roughness",r)},...this.createMap("roughnessMap",s.ROUGHNESS_MAP,F),{label:"法线强度",key:"normalScale",min:-1,max:1,step:.1,precision:2,type:o.VECTOR2,group:s.NORMAL_MAP.key,groupName:s.NORMAL_MAP.name,visible:L,getter:e=>e.getAttr("normalScale"),setter:(e,r)=>e.setAttr("normalScale",r)},...this.createMap("normalMap",s.NORMAL_MAP,L),{label:"环境光遮蔽强度",key:"aoMapIntensity",min:0,step:.1,precision:2,type:o.NUMBER,group:s.AO_MAP.key,groupName:s.AO_MAP.name,visible:I,getter:e=>e.getAttr("aoMapIntensity"),setter:(e,r)=>e.setAttr("aoMapIntensity",r)},...this.createMap("aoMap",s.AO_MAP,I),{label:"反射率",key:"reflectivity",min:0,step:.1,precision:2,type:o.NUMBER,group:s.ENV_MAP.key,groupName:s.ENV_MAP.name,visible:X,getter:e=>e.getAttr("reflectivity"),setter:(e,r)=>e.setAttr("reflectivity",r)},{label:"折射率",key:"refractionRatio",min:0,step:.1,precision:2,type:o.NUMBER,group:s.ENV_MAP.key,groupName:s.ENV_MAP.name,visible:X,getter:e=>e.getAttr("refractionRatio"),setter:(e,r)=>e.setAttr("refractionRatio",r)},{label:"环境光强度",key:"envMapIntensity",min:0,step:.1,precision:2,type:o.NUMBER,group:s.ENV_MAP.key,groupName:s.ENV_MAP.name,visible:F,getter:e=>e.getAttr("envMapIntensity"),setter:(e,r)=>e.setAttr("envMapIntensity",r)},...this.createMap("envMap",s.ENV_MAP,I),{label:"自发光",key:"emissive",type:o.COLOR,group:s.EMISSIVE_MAP.key,groupName:s.EMISSIVE_MAP.name,visible:L,getter:e=>e.getAttr("emissive"),setter:(e,r)=>e.setAttr("emissive",r)},{label:"自发光强度",key:"emissiveIntensity",min:0,step:.1,precision:2,type:o.NUMBER,group:s.EMISSIVE_MAP.key,groupName:s.EMISSIVE_MAP.name,visible:L,getter:e=>e.getAttr("emissiveIntensity"),setter:(e,r)=>e.setAttr("emissiveIntensity",r)},...this.createMap("emissiveMap",s.EMISSIVE_MAP,L),...this.createMap("alphaMap",s.ALPHA_MAP,I),{label:"凹凸贴图强度",key:"bumpScale",min:0,step:.1,precision:2,type:o.NUMBER,group:s.BUMP_MAP.key,groupName:s.BUMP_MAP.name,visible:L,getter:e=>e.getAttr("bumpScale"),setter:(e,r)=>e.setAttr("bumpScale",r)},...this.createMap("bumpMap",s.BUMP_MAP,L),{label:"置换贴图强度",key:"displacementScale",min:0,step:.1,precision:2,type:o.NUMBER,group:s.DISPLACEMENT_MAP.key,groupName:s.DISPLACEMENT_MAP.name,visible:L,getter:e=>e.getAttr("displacementScale"),setter:(e,r)=>e.setAttr("displacementScale",r)},{label:"置换贴图偏移",key:"displacementBias",step:.1,precision:2,type:o.NUMBER,group:s.DISPLACEMENT_MAP.key,groupName:s.DISPLACEMENT_MAP.name,visible:L,getter:e=>e.getAttr("displacementBias"),setter:(e,r)=>e.setAttr("displacementBias",r)},...this.createMap("displacementMap",s.DISPLACEMENT_MAP,L),{label:"光照贴图强度",key:"lightMapIntensity",min:0,step:.1,precision:2,type:o.NUMBER,group:s.LIGHT_MAP.key,groupName:s.LIGHT_MAP.name,visible:I,getter:e=>e.getAttr("lightMapIntensity"),setter:(e,r)=>e.setAttr("lightMapIntensity",r)},...this.createMap("lightMap",s.LIGHT_MAP,I),{label:"各向异性强度",key:"anisotropy",min:0,step:.1,precision:2,type:o.NUMBER,group:s.ANISOTROPY_MAP.key,groupName:s.ANISOTROPY_MAP.name,visible:A,getter:e=>e.getAttr("anisotropy"),setter:(e,r)=>e.setAttr("anisotropy",r)},{label:"各向异性旋转",key:"anisotropyRotation",step:.1,precision:2,type:o.NUMBER,group:s.ANISOTROPY_MAP.key,groupName:s.ANISOTROPY_MAP.name,visible:A,getter:e=>e.getAttr("anisotropyRotation"),setter:(e,r)=>e.setAttr("anisotropyRotation",r)},...this.createMap("anisotropyMap",s.ANISOTROPY_MAP,A),{label:"衰减颜色",key:"attenuationColor",type:o.COLOR,group:s.CLEARCOAT_MAP.key,groupName:s.CLEARCOAT_MAP.name,visible:A,tip:"白光到达衰减距离后因吸收而变成的颜色。默认值为 white (0xffffff)",getter:e=>e.getAttr("attenuationColor"),setter:(e,r)=>e.setAttr("attenuationColor",r)},{label:"衰减距离",key:"attenuationDistance",type:o.NUMBER,min:.001,step:.1,precision:3,tip:"介质的密度，表示光在与粒子相互作用之前在介质中传播的平均距离。该值以世界空间单位给出，并且必须大于零。默认值为 Infinity。",group:s.CLEARCOAT_MAP.key,groupName:s.CLEARCOAT_MAP.name,visible:A,getter:e=>e.getAttr("attenuationDistance"),setter:(e,r)=>e.setAttr("attenuationDistance",r)},{label:"清漆强度",key:"clearcoat",type:o.NUMBER,min:0,step:.1,precision:2,group:s.CLEARCOAT_MAP.key,groupName:s.CLEARCOAT_MAP.name,visible:A,getter:e=>e.getAttr("clearcoat"),setter:(e,r)=>e.setAttr("clearcoat",r)},...this.createMap("clearcoatMap",s.CLEARCOAT_MAP,A),{label:"清漆法线强度",key:"clearcoatNormalScale",type:o.VECTOR2,step:.1,precision:2,group:s.CLEARCOAT_NORMAL_MAP.key,groupName:s.CLEARCOAT_NORMAL_MAP.name,visible:A,getter:e=>e.getAttr("clearcoatNormalScale"),setter:(e,r)=>e.setAttr("clearcoatNormalScale",r)},...this.createMap("clearcoatNormalMap",s.CLEARCOAT_NORMAL_MAP,A),{label:"清漆粗糙度",key:"clearcoatRoughness",type:o.NUMBER,min:0,step:.1,precision:2,group:s.CLEARCOAT_ROUGHNESS_MAP.key,groupName:s.CLEARCOAT_ROUGHNESS_MAP.name,visible:A,getter:e=>e.getAttr("clearcoatRoughness"),setter:(e,r)=>e.setAttr("clearcoatRoughness",r)},...this.createMap("clearcoatRoughnessMap",s.CLEARCOAT_ROUGHNESS_MAP,A),{label:"虹彩强度",key:"iridescence",type:o.NUMBER,min:0,step:.1,precision:2,group:s.IRIDESCENE_MAP.key,groupName:s.IRIDESCENE_MAP.name,visible:A,getter:e=>e.getAttr("iridescence"),setter:(e,r)=>e.setAttr("iridescence",r)},{label:"虹彩色移强度",key:"iridescenceIOR",type:o.NUMBER,min:1,max:2.333,step:.1,precision:3,group:s.IRIDESCENE_MAP.key,groupName:s.IRIDESCENE_MAP.name,visible:A,getter:e=>e.getAttr("iridescenceIOR"),setter:(e,r)=>e.setAttr("iridescenceIOR",r)},...this.createMap("iridescenceMap",s.IRIDESCENE_MAP,A),{label:"虹彩厚度",key:"iridescenceThicknessRange",type:o.VECTOR2,min:0,step:1,precision:1,group:s.IRIDESCENE_THICKNESS_MAP.key,groupName:s.IRIDESCENE_THICKNESS_MAP.name,visible:A,getter:e=>e.getAttr("iridescenceThicknessRange"),setter:(e,r)=>e.setAttr("iridescenceThicknessRange",r)},...this.createMap("iridescenceThicknessMap",s.IRIDESCENE_THICKNESS_MAP,A),{label:"光泽强度",key:"sheen",type:o.NUMBER,min:0,step:.1,precision:2,group:s.SHEEN_COLOR_MAP.key,groupName:s.SHEEN_COLOR_MAP.name,visible:A,getter:e=>e.getAttr("sheen"),setter:(e,r)=>e.setAttr("sheen",r)},{label:"光泽颜色",key:"sheenColor",type:o.COLOR,group:s.SHEEN_COLOR_MAP.key,groupName:s.SHEEN_COLOR_MAP.name,visible:A,getter:e=>e.getAttr("sheenColor"),setter:(e,r)=>e.setAttr("sheenColor",r)},...this.createMap("sheenColorMap",s.SHEEN_COLOR_MAP,A),{label:"光泽粗糙度",key:"sheenRoughness",type:o.NUMBER,min:0,step:.1,precision:2,group:s.SHEEN_ROUGHNESS_MAP.key,groupName:s.SHEEN_ROUGHNESS_MAP.name,visible:A,getter:e=>e.getAttr("sheenRoughness"),setter:(e,r)=>e.setAttr("sheenRoughness",r)},...this.createMap("sheenRoughnessMap",s.SHEEN_ROUGHNESS_MAP,A),{label:"高光反射颜色",key:"specularColor",type:o.COLOR,group:s.SPECULAR_COLOR_MAP.key,groupName:s.SPECULAR_COLOR_MAP.name,visible:A,getter:e=>e.getAttr("specularColor"),setter:(e,r)=>e.setAttr("specularColor",r)},...this.createMap("specularColorMap",s.SPECULAR_COLOR_MAP,A),{label:"高光反射强度",key:"specularIntensity",type:o.NUMBER,min:0,step:.1,precision:2,group:s.SPECULAR_INTENSITY_MAP.key,groupName:s.SPECULAR_INTENSITY_MAP.name,visible:A,getter:e=>e.getAttr("specularIntensity"),setter:(e,r)=>e.setAttr("specularIntensity",r)},...this.createMap("specularIntensityMap",s.SPECULAR_INTENSITY_MAP,A),{label:"色散",key:"dispersion",type:o.NUMBER,min:0,step:.1,precision:2,group:s.TRANSMISSION_MAP.key,groupName:s.TRANSMISSION_MAP.name,visible:A,getter:e=>e.getAttr("dispersion"),setter:(e,r)=>e.setAttr("dispersion",r)},{label:"折射率",key:"ior",type:o.NUMBER,min:1,max:2.333,step:.1,precision:3,group:s.TRANSMISSION_MAP.key,groupName:s.TRANSMISSION_MAP.name,visible:A,getter:e=>e.getAttr("ior"),setter:(e,r)=>e.setAttr("ior",r)},{label:"反射率",key:"reflectivity",type:o.NUMBER,min:0,max:1,step:.1,precision:2,tip:"当metalness为1.0时，此属性无效",group:s.TRANSMISSION_MAP.key,groupName:s.TRANSMISSION_MAP.name,visible:A,getter:e=>e.getAttr("reflectivity"),setter:(e,r)=>e.setAttr("reflectivity",r)},{label:"透光率",key:"transmission",type:o.NUMBER,min:0,max:1,step:.1,precision:2,tip:"当透光率不为0的时候, opacity透明度应设置为1",group:s.TRANSMISSION_MAP.key,groupName:s.TRANSMISSION_MAP.name,visible:A,getter:e=>e.getAttr("transmission"),setter:(e,r)=>e.setAttr("transmission",r)},...this.createMap("transmissionMap",s.TRANSMISSION_MAP,A),{label:"厚度",key:"thickness",type:o.NUMBER,min:0,max:1,step:.1,precision:2,tip:"表面下体积的厚度。该值在网格的坐标空间中给出。如果该值为 0，则材料为薄壁。否则，材质将成为体积边界。默认值为 0。",group:s.THICKNESS_MAP.key,groupName:s.THICKNESS_MAP.name,visible:A,getter:e=>e.getAttr("thickness"),setter:(e,r)=>e.setAttr("thickness",r)},...this.createMap("thicknessMap",s.THICKNESS_MAP,A),{label:"Uniforms",key:"uniforms",type:o.UNIFORMS,group:s.CUSTOM_SHADER.key,groupName:s.CUSTOM_SHADER.name,visible:W,getter:e=>e.getAttr("uniforms"),setter:(e,r)=>e.setAttr("uniforms",r)},{label:"顶点着色器",key:"vertexShader",type:o.VERTEX_SHADER,group:s.CUSTOM_SHADER.key,groupName:s.CUSTOM_SHADER.name,visible:W,getter:e=>e.getAttr("vertexShader"),setter:(e,r)=>e.setAttr("vertexShader",r)},{label:"片元着色器",key:"fragmentShader",type:o.FRAGEMENT_SHADER,group:s.CUSTOM_SHADER.key,groupName:s.CUSTOM_SHADER.name,visible:W,getter:e=>e.getAttr("fragmentShader"),setter:(e,r)=>e.setAttr("fragmentShader",r)}]}getRotation(t,e){return t.getAttr(e)*Oe}setRotation(t,e,r){t.setAttr(e,r*Pe)}createMap(t,e,r){const i=`${t}.image`,n=`${t}.mapping`,c=`${t}.wrapS`,p=`${t}.wrapT`,h=`${t}.magFilter`,y=`${t}.minFilter`,u=`${t}.offset`,k=`${t}.repeat`,N=`${t}.center`,v=`${t}.rotation`,R=`${t}.flipY`,P=`${t}.colorSpace`,U=`${t}.channel`;return[{label:"贴图",key:i,type:o.TEXTURE,group:e.key,groupName:e.name,visible:r,getter:g=>g.getAttr(i),setter:(g,d)=>g.setAttr(i,d)},{label:"映射方式",key:n,type:o.ENUM,group:e.key,groupName:e.name,options:xe,visible:r,getter:g=>g.getAttr(n),setter:(g,d)=>g.setAttr(n,d)},{label:"水平包裹模式",key:c,type:o.ENUM,group:e.key,groupName:e.name,options:j,visible:r,getter:g=>g.getAttr(c),setter:(g,d)=>g.setAttr(c,d)},{label:"垂直包裹模式",key:p,type:o.ENUM,group:e.key,groupName:e.name,options:j,visible:r,getter:g=>g.getAttr(p),setter:(g,d)=>g.setAttr(p,d)},{label:"放大过滤器",key:h,type:o.ENUM,group:e.key,groupName:e.name,options:Q,visible:r,tip:"当纹理被放大渲染时，放大过滤器 (magFilter) 决定了如何对纹理像素进行采样",getter:g=>g.getAttr(h),setter:(g,d)=>g.setAttr(h,d)},{label:"缩小过滤器",key:y,type:o.ENUM,group:e.key,groupName:e.name,options:Q,visible:r,tip:"当纹理被缩小渲染时，缩小过滤器 (minFilter) 决定了如何从Mipmap链中选择合适的纹理层级并进行采样",getter:g=>g.getAttr(y),setter:(g,d)=>g.setAttr(y,d)},{label:"贴图偏移",key:u,step:.1,precision:2,type:o.VECTOR2,group:e.key,groupName:e.name,visible:r,getter:g=>this.getVector2(g,u),setter:(g,d)=>this.setVector2(g,u,d)},{label:"贴图缩放",key:k,step:.1,precision:2,type:o.VECTOR2,group:e.key,groupName:e.name,visible:r,getter:g=>this.getVector2(g,k),setter:(g,d)=>this.setVector2(g,k,d)},{label:"贴图中心",key:N,min:0,max:1,step:.1,precision:2,type:o.VECTOR2,group:e.key,groupName:e.name,visible:r,getter:g=>this.getVector2(g,N),setter:(g,d)=>this.setVector2(g,N,d)},{label:"贴图旋转",key:v,step:1,precision:1,type:o.NUMBER,group:e.key,groupName:e.name,visible:r,getter:g=>this.getRotation(g,v),setter:(g,d)=>this.setRotation(g,v,d)},{label:"Y轴反转",key:R,type:o.BOOLEAN,group:e.key,groupName:e.name,visible:r,getter:g=>g.getAttr(R),setter:(g,d)=>g.setAttr(R,d)},{label:"色彩空间",key:P,type:o.ENUM,group:e.key,groupName:e.name,options:Ie,visible:r,getter:g=>g.getAttr(P),setter:(g,d)=>g.setAttr(P,d)},{label:"通道",key:U,type:o.ENUM,group:e.key,groupName:e.name,options:we,visible:r,getter:g=>g.getAttr(U),setter:(g,d)=>g.setAttr(U,d)}]}getVector2(t,e){return t.getAttr(e).toArray()}setVector2(t,e,r,i){const n=t.getAttr(e).toArray(),[c,p,h]=r;switch(h){case"x":n[0]=i?i(c):c;break;case"y":n[1]=i?i(p):p;break;default:n[0]=i?i(c):c,n[1]=i?i(p):p;break}t.setAttr(e,K.fromArray(n))}}const Ve="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1755177359605'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='4757'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%2042.688c23.616%200%2042.688%2019.072%2042.688%2042.624v31.488c0%2032.32%2024.32%2058.88%2055.296%2068.16a342.08%20342.08%200%200%201%20229.12%20229.12c9.216%2030.912%2035.84%2055.232%2068.096%2055.232h31.488a42.688%2042.688%200%200%201%200%2085.376h-31.488c-32.256%200-58.88%2024.32-68.096%2055.232a342.08%20342.08%200%200%201-229.12%20229.12c-30.976%209.28-55.232%2035.84-55.296%2068.16v31.488a42.688%2042.688%200%200%201-85.312%200v-31.488c0-32.256-24.32-58.88-55.296-68.096a342.08%20342.08%200%200%201-229.12-229.12c-9.28-30.976-35.84-55.296-68.096-55.296h-31.488a42.688%2042.688%200%200%201%200-85.376h31.424c32.32%200%2058.88-24.32%2068.16-55.232a342.08%20342.08%200%200%201%20229.12-229.12c30.976-9.28%2055.296-35.84%2055.296-68.16v-31.424c0-23.616%2019.072-42.688%2042.624-42.688zM512%20256a256%20256%200%201%200%200%20512%20256%20256%200%200%200%200-512z%20m0%20170.688a85.312%2085.312%200%201%201%200%20170.624%2085.312%2085.312%200%200%201%200-170.624z'%20p-id='4758'%20fill='%23ffffff'%3e%3c/path%3e%3c/svg%3e",He="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1755176964080'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2672'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M571.01312%20523.776l311.3472-311.35232c15.7184-15.71328%2015.7184-41.6256%200-57.344l-1.69472-1.69984c-15.7184-15.71328-41.6256-15.71328-57.34912%200l-311.3472%20311.77728-311.35232-311.77728c-15.7184-15.71328-41.63072-15.71328-57.344%200l-1.69984%201.69984a40.0128%2040.0128%200%200%200%200%2057.344L452.92544%20523.776l-311.35232%20311.35744c-15.71328%2015.71328-15.71328%2041.63072%200%2057.33888l1.69984%201.69984c15.71328%2015.7184%2041.6256%2015.7184%2057.344%200l311.35232-311.35232%20311.3472%20311.35232c15.72352%2015.7184%2041.63072%2015.7184%2057.34912%200l1.69472-1.69984c15.7184-15.70816%2015.7184-41.6256%200-57.33888l-311.3472-311.35744z'%20p-id='2673'%20fill='%23ffffff'%3e%3c/path%3e%3c/svg%3e",Ge="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1754109978654'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2728'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M998.4%20649.309091L754.036364%20202.472727c-25.6-48.872727-74.472727-79.127273-128-79.127272s-100.072727%2030.254545-128%2079.127272L256%20649.309091c-25.6%2048.872727-25.6%20107.054545%200%20155.927273%2025.6%2048.872727%2074.472727%2079.127273%20128%2079.127272h486.4c53.527273%200%20100.072727-30.254545%20128-79.127272%2025.6-48.872727%2025.6-107.054545%200-155.927273z%20m-128%20146.618182H384c-23.272727%200-41.890909-11.636364-53.527273-32.581818-11.636364-20.945455-11.636364-46.545455%200-67.49091l242.036364-449.163636c11.636364-20.945455%2032.581818-32.581818%2053.527273-32.581818%2023.272727%200%2041.890909%2011.636364%2053.527272%2032.581818l242.036364%20449.163636c11.636364%2020.945455%2011.636364%2046.545455%200%2067.49091-9.309091%2018.618182-27.927273%2032.581818-51.2%2032.581818zM55.854545%20356.072727h216.436364c20.945455%200%2039.563636-18.618182%2039.563636-39.563636%200-20.945455-18.618182-39.563636-39.563636-39.563636H55.854545c-20.945455%200-39.563636%2018.618182-39.563636%2039.563636%200%2023.272727%2018.618182%2039.563636%2039.563636%2039.563636zM183.854545%20553.890909H53.527273c-20.945455%200-37.236364%2018.618182-37.236364%2039.563636%200%2020.945455%2016.290909%2039.563636%2037.236364%2039.563637h128c20.945455%200%2037.236364-18.618182%2037.236363-39.563637%202.327273-20.945455-16.290909-39.563636-34.909091-39.563636zM121.018182%20777.309091h-69.818182c-20.945455%200-34.909091%2020.945455-34.909091%2048.872727s16.290909%2048.872727%2034.909091%2048.872727h69.818182c20.945455%200%2034.909091-20.945455%2034.909091-48.872727s-13.963636-48.872727-34.909091-48.872727z'%20fill='%23ffffff'%20p-id='2729'%3e%3c/path%3e%3c/svg%3e",We="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1754109950350'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2434'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M958.708971%2097.671507c0.00921-12.554944-5.593392-24.446785-15.255449-32.392758-9.657964-7.956206-22.350031-11.120268-34.594913-8.610098L384.945279%20163.701362c-19.360953%203.955078-33.280987%2021.072945-33.296337%2040.941458l-0.329505%20477.604632c-29.119201-16.737196-63.945381-25.944905-101.395318-25.944905-0.056282%200-0.102331%200-0.157589%200-47.749514%200-92.990904%2015.038508-127.398552%2043.521213-36.777625%2030.447453-57.051367%2067.602677-57.07695%20111.974257-0.055259%2088.38398%2082.674954%20156.37449%20184.41615%20156.37449%200.055259%200%200.101307%200%200.157589%200%2047.759747%200%2090.443895-11.95938%20124.856659-40.442084%2036.782741-30.443359%2054.519708-69.159126%2054.519708-113.514333l0%200.61603%200%200.309038%200%200.152473%202.845815-407.194002%20442.041672-89.829911%200.473791%20247.498884c-29.042453-16.597003-63.071478-23.818475-100.354616-23.818475-0.055259%200-0.11154%200-0.167822%200-47.749514%200-92.990904%2013.145391-127.398552%2041.624003-36.786835%2030.442336-57.0616%2068.539003-57.087183%20112.914676-0.056282%2088.38398%2082.679048%20157.331281%20184.434569%20157.331281%200.046049%200%200.081864%200%200.12689%200%2097.022731%200%20176.962388-63.573921%20184.16237-146.287761%200.069585-0.984421%200.25378-5.492084%200.112564-16.951067L958.708971%2097.671507zM324.453556%20863.391069c-19.568684%2016.198937-46.053895%2021.61632-74.589812%2021.61632-0.030699%200-0.066515%200-0.097214%200-54.95052%200-101.354386-31.69077-101.329826-73.255421%200.010233-18.933211%209.520841-35.062564%2026.76969-49.341778%2019.563568-16.194844%2046.039569-22.942525%2074.560136-22.942525%200.029676%200%200.066515%200%200.097214%200%2054.970986%200%20101.390201%2033.026184%20101.364619%2074.600045C351.213014%20832.993758%20341.707522%20849.111854%20324.453556%20863.391069zM434.70559%20333.51391l0.065492-94.66708%20440.756399-90.041736-0.065492%2094.842065L434.70559%20333.51391zM774.160815%20770.655991c-0.024559%200-0.050142%200-0.075725%200-54.960753%200-101.370759-33.585933-101.344153-75.1557%200.00921-18.934235%209.520841-34.117029%2026.773783-48.39215%2019.563568-16.194844%2046.039569-21.991874%2074.570369-21.991874%200.034792%200%200.070608%200%200.106424%200%2052.344159%200%20102.06149%2027.308973%20102.06149%2066.25089l0%2011.796674C865.85826%20742.070956%20826.472228%20770.655991%20774.160815%20770.655991z'%20fill='%23ffffff'%20p-id='2435'%3e%3c/path%3e%3c/svg%3e",Xe="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1754109982690'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2871'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M711.111111%2048.355556v212.195555h205.937778z%20m0%200'%20fill='%23ffffff'%20p-id='2872'%3e%3c/path%3e%3cpath%20d='M625.777778%2048.355556H220.728889a113.777778%20113.777778%200%200%200-113.777778%20113.777777v698.026667a113.777778%20113.777778%200%200%200%20113.777778%20113.777778H802.133333a113.777778%20113.777778%200%200%200%20113.777778-113.777778V341.333333H625.777778z%20m42.666666%20526.791111A42.666667%2042.666667%200%200%201%20729.315556%20512l96.711111%2096.711111a46.08%2046.08%200%200%201%2011.946666%2030.151111c0%2011.946667-6.257778%2018.204444-11.946666%2030.151111l-96.711111%2096.711111a42.666667%2042.666667%200%200%201-60.302223-60.302222l66.56-66.56z%20m-314.595555%20139.377777a40.391111%2040.391111%200%200%201%200%2060.302223%2040.391111%2040.391111%200%200%201-60.302222%200l-96.711111-96.711111a46.08%2046.08%200%200%201-11.946667-30.151112c0-11.946667%206.257778-18.204444%2011.946667-30.151111l96.711111-96.711111a40.391111%2040.391111%200%200%201%2060.302222%200%2040.391111%2040.391111%200%200%201%200%2060.302222L284.444444%20647.964444z%20m248.604444-254.293333L499.484444%20853.333333a39.822222%2039.822222%200%200%201-48.355555%2030.151111%2045.511111%2045.511111%200%200%201-30.151111-48.355555l102.4-393.102222a46.08%2046.08%200%200%201%2048.355555-36.408889c24.462222%200%2036.408889%2030.151111%2030.151111%2056.888889z%20m0%200'%20fill='%23ffffff'%20p-id='2873'%3e%3c/path%3e%3c/svg%3e",Ye="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1754109969062'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2581'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M512%20256c-168%200-329.6%20106.4-384%20256%2054.4%20149.6%20216%20256%20384%20256%20167.2%200%20330.4-106.4%20384.8-256-55.2-149.6-217.6-256-384.8-256z%20m0%20416c-88%200-160-72-160-160s72-160%20160-160%20160%2072%20160%20160-72%20160-160%20160z%20m96-160c0%2052.8-43.2%2096-96%2096s-96-43.2-96-96%2043.2-96%2096-96%2096%2043.2%2096%2096z'%20fill='%23ffffff'%20p-id='2582'%3e%3c/path%3e%3c/svg%3e",Ke="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1754621900938'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2476'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='18'%20height='18'%3e%3cpath%20d='M864%20508.501333v7.04a39.125333%2039.125333%200%200%201-11.349333%2027.349334l-309.76%20309.76a39.125333%2039.125333%200%200%201-27.392%2011.349333h-7.04a39.125333%2039.125333%200%200%201-27.349334-11.349333l-309.76-309.76a39.125333%2039.125333%200%200%201-11.349333-27.392v-7.04a39.125333%2039.125333%200%200%201%2011.349333-27.349334l309.76-309.76a39.125333%2039.125333%200%200%201%2027.392-11.349333h7.04c10.24%200.042667%2020.053333%204.096%2027.349334%2011.349333l309.76%20309.76c7.253333%207.253333%2011.306667%2017.109333%2011.349333%2027.392z'%20fill='%23ffffff'%20p-id='2477'%3e%3c/path%3e%3c/svg%3e",$e={activation:"#009821",animation:"#245589",audio:"#ffa200",script:"#0ff",frame:"#ff0"},re=new Image,se=new Image,ie=new Image,ae=new Image,oe=new Image;re.src=Ye;se.src=Ge;ie.src=We;ae.src=Xe;oe.src=Ke;const Ze={activation:re,animation:se,audio:ie,script:ae,frame:oe},ne=new Image;ne.src=Ve;const le=new Image;le.src=He;class qe{constructor(t,e,r){l(this,"hierarchy");l(this,"track");l(this,"x");l(this,"y");this.hierarchy=t,this.track=r,this.x=0,this.y=e}get entity(){var t;return((t=this.track.getEntity())==null?void 0:t.name)??""}draw(){const{context:t,canvas:e}=this.hierarchy,r=this.hierarchy.mapLogicalToCanvasY(this.y);t.save(),t.fillStyle="#40444a",t.fillRect(0,r,e.width,E),this.drawRect(0,r,4),this.drawIcon(8,r,15),this.drawLabel(28,r,e.width-28-24),this.drawDropper(e.width-22,r+8),t.restore()}drawRect(t,e,r){const{context:i}=this.hierarchy;i.save(),i.fillStyle=$e[this.track.type],i.fillRect(t,e,r,E),i.restore()}drawIcon(t,e,r){const{context:i}=this.hierarchy;i.save(),i.drawImage(Ze[this.track.type],t,e+E*.5-r*.5,r,r),i.restore()}drawLabel(t,e,r){const{context:i}=this.hierarchy;i.save(),i.fillStyle="#282828",i.fillRect(t,e+4,r+20,E-8),i.textBaseline="middle",i.textAlign="left",i.font="normal 12px sans-serif",i.fillStyle="#fff",this.drawTextWithEllipsis(this.entity,t+6,e+15,r+4),i.restore()}drawDropper(t,e){const{context:r}=this.hierarchy;r.save(),this.entity?r.drawImage(le,t,e,16,16):r.drawImage(ne,t,e,16,16),r.restore()}drawTextWithEllipsis(t,e,r,i){const{context:n}=this.hierarchy,c="...",p=n.measureText(c).width;let h=n.measureText(t).width;if(h<=i){n.fillText(t,e,r);return}let y=t.length;for(;h>=i-p-10&&y>0;)y--,t=t.substring(0,y),h=n.measureText(t).width;n.fillText(t+c,e,r)}isInArea(t){return this.y<=t&&t<=this.y+E}getMenus(){const{core:t}=this.track.parent.parent.entity;return[{text:"删除",action:()=>{t.removeTrack(this.track)}},{text:"选中实体",action:()=>{const e=t.entityManager.getEntity(this.track.entity);e&&t.select([e])}}]}}function b(a){return a?parseFloat(a):0}class je{constructor(t){l(this,"hierarchy");l(this,"onPointerMove",t=>{});l(this,"onClick",t=>{const{button:e,clientX:r,clientY:i}=t;if(e!=0)return;const n=this.hierarchy.mapViewportToCanvasCoordinates({x:r,y:i}),c=this.hierarchy.mapCanvasToLogicalY(n.y),{core:p}=this.hierarchy.editor.editor;for(let h=0;h<this.hierarchy.tracks.length;h++){const y=this.hierarchy.tracks[h],{track:u}=y;if(c>=y.y&&c<=y.y+E){if(this.hierarchy.editor.editor.timelineManager.selectTrack(u),n.x>=178&&n.x<=194)t.stopPropagation(),u.entity?this.hierarchy.editor.editor.timelineManager.deleteEntity(u):this.hierarchy.editor.editor.timelineManager.startSelectEntity(u);else{const k=p.entityManager.getEntity(u.entity);k&&p.select([k])}break}}});this.hierarchy=t,this.hierarchy.canvas.addEventListener("pointermove",this.onPointerMove),this.hierarchy.canvas.addEventListener("click",this.onClick)}dispose(){this.hierarchy.canvas.removeEventListener("pointermove",this.onPointerMove),this.hierarchy.canvas.removeEventListener("click",this.onClick)}}class Qe{constructor(t,e){l(this,"editor");l(this,"canvas");l(this,"context");l(this,"canvasStyle");l(this,"pointerController");l(this,"tracks");l(this,"knotDragging");l(this,"planeDragging");l(this,"onContextMenu",t=>{t.preventDefault(),t.stopPropagation();const{timeline:e}=this.editor;if(!e){this.editor.editor.bus.emit("MESSAGE",{message:"请先选择有动画导演组件的物体",type:"info"});return}const r=this.mapViewportToCanvasCoordinates({x:t.clientX,y:t.clientY}),i=this.mapCanvasToLogicalY(r.y),n=this.tracks.find(c=>c.isInArea(i));if(n){const c=n.getMenus();this.editor.editor.bus.emit("CONTEXT_MENU",{event:t,items:c})}else{const c=[{text:"激活轨道",action:()=>this.editor.editor.timelineManager.createTrack(e,"activation")},{text:"动画轨道",action:()=>this.editor.editor.timelineManager.createTrack(e,"animation")},{text:"音频轨道",action:()=>this.editor.editor.timelineManager.createTrack(e,"audio")},{text:"脚本轨道",action:()=>this.editor.editor.timelineManager.createTrack(e,"script")},{text:"关键帧轨道",action:()=>this.editor.editor.timelineManager.createTrack(e,"frame")}];this.editor.editor.bus.emit("CONTEXT_MENU",{event:t,items:c})}});this.editor=t,this.canvas=e,this.context=e.getContext("2d"),this.canvasStyle=getComputedStyle(e),this.pointerController=new je(this),this.tracks=[],this.knotDragging=!1,this.planeDragging=!1,this.canvas.addEventListener("contextmenu",this.onContextMenu)}get yMin(){return this.editor.yMin}set yMin(t){this.editor.yMin=t}get yMax(){return this.editor.yMax}set yMax(t){this.editor.yMax=t}resize(t){this.canvas.height=t}render(){this.canvas.style.cursor=this.knotDragging||this.planeDragging?"move":"inherit",this.tracks.forEach(t=>t.draw())}clear(){this.context.save();const t=this.canvas.width,e=this.canvas.height;this.context.fillStyle="#222222",this.context.fillRect(0,0,t,e),this.context.restore()}mapLogicalToCanvasY(t){return(t-this.yMin)*this.canvas.height/(this.yMax-this.yMin)}mapCanvasToLogicalY(t){return this.yMin+t*(this.yMax-this.yMin)/this.canvas.height}mapViewportToCanvasCoordinates(t){const e=this.canvasStyle,r=this.canvas.getBoundingClientRect(),i=b(e.paddingLeft),n=b(e.paddingRight),c=b(e.paddingTop),p=b(e.paddingBottom),h=b(e.borderLeftWidth),y=b(e.borderTopWidth),u=this.canvas.clientWidth-i-n,k=this.canvas.clientHeight-c-p,N=t.x-r.left-h-i,v=t.y-r.top-y-c,R=N/u*this.canvas.width,P=v/k*this.canvas.height;return{x:R,y:P}}setTimeline(t){if(this.tracks=[],!!t)for(let e=0;e<t.tracks.length;e++){const r=t.tracks[e],i=V+E*e+V*e,n=new qe(this,i,r);this.tracks.push(n)}}dispose(){this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.pointerController.dispose()}}function ee(a){let t=String(a);return t.length>10&&(t=a.toPrecision(6)),t}Promise.resolve();class _{static clone(t){return{x:t.x,y:t.y}}static computeDistance(t,e){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}static computeCenter(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}static mapPointIndex(t,e,r){if(r==null)return;const i=t[r];return _.findPoint(e,i)}static findPoint(t,e){if(!e)return;const r=t.indexOf(e);return r>=0?r:void 0}static makeXValsStrictMonotonic(t){for(let e=1;e<t.length;e++)t[e].x<=t[e-1].x&&(t[e].x=t[e-1].x+1e-6)}static dumpPoints(t){for(let e=0;e<t.length;e++)console.log("["+e+"] = ("+t[e].x+", "+t[e].y+")")}static encodeCoordinateList(t){let e="";for(const r of t)e.length>0&&(e+=", "),e+="["+ee(r.x)+", "+ee(r.y)+"]";return e}static decodeCoordinateList(t){const e=JSON.parse("["+t+"]"),r=Array(e.length);for(let i=0;i<e.length;i++){const n=e[i];if(!Array.isArray(n)||n.length!=2||typeof n[0]!="number"||typeof n[1]!="number")throw new Error("Invalid syntax in element "+i+".");r[i]={x:n[0],y:n[1]}}return r}}class Je{constructor(t){l(this,"ruler");l(this,"pointers");l(this,"dragStartLPos");l(this,"dragStartCPos");l(this,"dragCount");l(this,"zooming",!1);l(this,"zoomLCenter");l(this,"zoomStartDist");l(this,"zoomStartFactorX");l(this,"zoomStartFactorY");l(this,"zoomX");l(this,"zoomY");l(this,"onPointerdown",t=>{const{altKey:e,ctrlKey:r,shiftKey:i,metaKey:n,pointerType:c,button:p}=t;e||r||n||i||c=="mouse"&&![0,1].includes(p)||(this.trackPointer(t),this.switchMode(),t.preventDefault())});l(this,"onPointerUp",t=>{this.pointers.has(t.pointerId)&&(this.releasePointer(t.pointerId),this.switchMode(),t.preventDefault())});l(this,"onPointerMove",t=>{if(!this.pointers.has(t.pointerId)){this.updatePotentialKnot(t);return}this.trackPointer(t),this.pointers.size==1?this.drag():this.pointers.size==2&&this.zooming&&this.zoom(),t.preventDefault()});l(this,"onWheel",t=>{t.preventDefault();const e=t.deltaMode==0&&Math.abs(t.deltaY)<50||t.deltaX!=0;if(e&&!t.ctrlKey){this.moveByWheel(t);return}if(t.deltaY==0)return;const r=e?1.05:Math.SQRT2,i=t.deltaY>0?1/r:r;let n;t.shiftKey?n=O.y:t.altKey?n=O.x:t.ctrlKey&&!e?n=O.xy:n=this.ruler.editor.zoomMode;let c,p;switch(n){case O.x:{c=i,p=1;break}case O.y:{c=1,p=i;break}default:c=i,p=i}const h=this.getCanvasCoordinatesFromEvent(t);this.ruler.zoom(c,p,h),this.ruler.editor.refresh()});this.ruler=t,this.pointers=new Map,this.dragCount=0,this.zoomLCenter={x:0,y:0},this.zoomStartDist=0,this.zoomStartFactorX=0,this.zoomStartFactorY=0,this.zoomX=!1,this.zoomY=!1,t.canvas.addEventListener("pointerdown",this.onPointerdown),t.canvas.addEventListener("pointerup",this.onPointerUp),t.canvas.addEventListener("pointercancel",this.onPointerUp),t.canvas.addEventListener("pointermove",this.onPointerMove),t.canvas.addEventListener("wheel",this.onWheel)}get canvas(){return this.ruler.canvas}trackPointer(t){const e=t.pointerId;this.pointers.has(e)||this.canvas.setPointerCapture(e),this.pointers.set(e,t)}releaseAllPointers(){for(;this.pointers.size>0;){const t=this.pointers.keys().next().value;t&&this.releasePointer(t)}}releasePointer(t){this.pointers.delete(t),this.canvas.releasePointerCapture(t)}getCanvasCoordinates(){if(this.pointers.size<1)throw new Error("No active pointers.");const t=this.pointers.values().next().value;return this.getCanvasCoordinatesFromEvent(t)}getCanvasCoordinatesFromEvent(t){return this.ruler.mapViewportToCanvasCoordinates({x:t.clientX,y:t.clientY})}switchMode(){this.stopDragging(),this.stopZooming(),this.pointers.size==1?(this.startDragging(),this.canvas.focus()):this.pointers.size==2&&this.startZooming()}stopDragging(){(this.ruler.knotDragging||this.ruler.planeDragging)&&this.ruler.editor.refresh(),this.dragStartLPos=void 0,this.dragStartCPos=void 0,this.ruler.knotDragging=!1,this.ruler.planeDragging=!1}stopZooming(){this.zooming=!1}startDragging(){const t=this.getCanvasCoordinates(),e=this.ruler.mapCanvasToLogicalCoordinates(t),r=void 0;this.ruler.knotDragging=r!=null,this.ruler.planeDragging=r==null,this.dragStartLPos=e,this.dragStartCPos=t,this.dragCount=0,this.ruler.editor.refresh()}startZooming(){const t=this.pointers.values(),e=t.next().value,r=t.next().value,i=this.getCanvasCoordinatesFromEvent(e),n=this.getCanvasCoordinatesFromEvent(r),c=_.computeCenter(i,n),p=Math.abs(i.x-n.x),h=Math.abs(i.y-n.y);this.zoomLCenter=this.ruler.mapCanvasToLogicalCoordinates(c),this.zoomStartDist=_.computeDistance(i,n),this.zoomStartFactorX=this.ruler.getZoomFactor(!0),this.zoomStartFactorY=this.ruler.getZoomFactor(!1);const y=Math.tan(Math.PI/8);this.zoomX=p>y*h,this.zoomY=h>y*p,this.zooming=!0}drag(){const t=this.getCanvasCoordinates();this.ruler.knotDragging||this.ruler.planeDragging&&this.dragStartLPos&&(this.ruler.moveCoordinatePlane(t,this.dragStartLPos),this.ruler.editor.refresh())}zoom(){const t=this.pointers.values(),e=t.next().value,r=t.next().value,i=this.getCanvasCoordinatesFromEvent(e),n=this.getCanvasCoordinatesFromEvent(r),c=_.computeCenter(i,n),h=_.computeDistance(i,n)/this.zoomStartDist;this.zoomX&&(this.ruler.xMax=this.ruler.xMin+this.canvas.width/(this.zoomStartFactorX*h)),this.zoomY&&(this.ruler.yMax=this.ruler.yMin+this.canvas.height/(this.zoomStartFactorY*h)),this.ruler.moveCoordinatePlane(c,this.zoomLCenter),this.ruler.editor.refresh()}moveByWheel(t){const e=t.deltaMode==1?15:t.deltaMode==2?100:1,r=e*t.deltaX,i=e*t.deltaY;r==0&&i==0||(this.ruler.moveCoordinatePlaneRelPx(r,-i),this.ruler.editor.refresh())}updatePotentialKnot(t){}dispose(){this.canvas.removeEventListener("pointerdown",this.onPointerdown),this.canvas.removeEventListener("pointerup",this.onPointerUp),this.canvas.removeEventListener("pointercancel",this.onPointerUp),this.canvas.removeEventListener("pointermove",this.onPointerMove),this.canvas.removeEventListener("wheel",this.onWheel),this.releaseAllPointers()}}class et{constructor(t,e){l(this,"editor");l(this,"canvas");l(this,"context");l(this,"canvasStyle");l(this,"yMin");l(this,"yMax");l(this,"knotDragging");l(this,"planeDragging");l(this,"pointerController");this.editor=t,this.canvas=e,this.context=e.getContext("2d"),this.canvasStyle=getComputedStyle(e),this.yMin=0,this.yMax=1,this.knotDragging=!1,this.planeDragging=!1,this.pointerController=new Je(this)}get xMin(){return this.editor.xMin}set xMin(t){this.editor.xMin=t}get xMax(){return this.editor.xMax}set xMax(t){this.editor.xMax=t}resize(t,e){this.canvas.width=t,this.canvas.height=e}render(){this.canvas.style.cursor=this.knotDragging||this.planeDragging?"move":"inherit",this.draw()}clear(){this.context.save();const t=this.canvas.width,e=this.canvas.height;this.context.fillStyle="#353535ff",this.context.fillRect(0,0,t,e),this.context.restore()}getZoomFactor(t){const{xMax:e,xMin:r,yMax:i,yMin:n}=this;return t?this.canvas.width/(e-r):this.canvas.height/(i-n)}mapLogicalToCanvasX(t){return(t-this.xMin)*this.canvas.width/(this.xMax-this.xMin)}mapLogicalToCanvasY(t){return this.canvas.height-(t-this.yMin)*this.canvas.height/(this.yMax-this.yMin)}mapCanvasToLogicalX(t){return this.xMin+t*(this.xMax-this.xMin)/this.canvas.width}mapCanvasToLogicalY(t){return this.yMin+(this.canvas.height-t)*(this.yMax-this.yMin)/this.canvas.height}mapCanvasToLogicalCoordinates(t){return{x:this.mapCanvasToLogicalX(t.x),y:this.mapCanvasToLogicalY(t.y)}}mapLogicalToCanvasCoordinates(t){return{x:this.mapLogicalToCanvasX(t.x),y:this.mapLogicalToCanvasY(t.y)}}mapViewportToCanvasCoordinates(t){const e=this.canvasStyle,r=this.canvas.getBoundingClientRect(),i=b(e.paddingLeft),n=b(e.paddingRight),c=b(e.paddingTop),p=b(e.paddingBottom),h=b(e.borderLeftWidth),y=b(e.borderTopWidth),u=this.canvas.clientWidth-i-n,k=this.canvas.clientHeight-c-p,N=t.x-r.left-h-i,v=t.y-r.top-y-c,R=N/u*this.canvas.width,P=v/k*this.canvas.height;return{x:R,y:P}}moveCoordinatePlane(t,e){const{xMin:r,xMax:i,yMin:n,yMax:c}=this,p=i-r,h=c-n,y=this.canvas.width,u=this.canvas.height;this.xMin=e.x-t.x*p/y,this.xMax=this.xMin+p,this.yMin=e.y-(u-t.y)*h/u,this.yMax=this.yMin+h}moveCoordinatePlaneRelPx(t,e){const r=this.xMax-this.xMin,i=this.yMax-this.yMin,n=this.canvas.width,c=this.canvas.height;this.xMin=this.xMin+t/n*r,this.xMax=this.xMin+r,this.yMin=this.yMin+e/c*i,this.yMax=this.yMin+i}draw(){const t=this.getParams();if(!t)return;const e=t.span/10;let r=t.pos,i=0;for(;;){const n=r*t.space,c=this.mapLogicalToCanvasX(n);if(c>this.canvas.width)break;this.drawLine(c),this.drawLabel(c,n,t.decPow);for(let p=1;p<10;p++){const y=(r+p*e)*t.space,u=this.mapLogicalToCanvasX(y);this.drawSegment(u,p===5?12:8)}if(r+=t.span,i++>100)break}}getParams(){const e=this.xMin,r=60/this.getZoomFactor(!0),i=Math.ceil(Math.log(r/5)/Math.LN10);if((e==0?-99:Math.log(Math.abs(e))/Math.LN10)-i>10)return;const c=Math.pow(10,i),p=r/c,h=p>2.001?5:p>1.001?2:1,y=Math.floor(e/c),u=h*Math.floor(y/h);return{space:c,span:h,pos:u,decPow:i}}drawLine(t){const{context:e}=this;e.save(),e.fillStyle="#fff",e.fillRect(Math.floor(t),16,1,16),e.restore()}drawSegment(t,e){const{context:r}=this;r.save(),r.fillStyle="#ffffff7e",r.fillRect(Math.floor(t),32-e,1,e),r.restore()}drawLabel(t,e,r){const{context:i}=this;i.save(),i.textBaseline="bottom",i.textAlign="center",i.font="12px",i.fillStyle="#fff";const n=t,c=12,p=this.formatLabel(e,r);i.fillText(p,n,c),i.restore()}formatLabel(t,e){let r=e<=7&&e>=-6?t.toFixed(Math.max(0,-e)):t.toExponential();return r.length>10&&(r=t.toPrecision(6)),r}zoom(t,e,r){const i=e??t,n=r||{x:this.canvas.width/2,y:this.canvas.height/2},c=this.mapCanvasToLogicalCoordinates(n);this.xMax=this.xMin+(this.xMax-this.xMin)/t,this.yMax=this.yMin+(this.yMax-this.yMin)/i,this.moveCoordinatePlane(n,c)}dispose(){this.pointerController.dispose()}}class ce{constructor(t,e){l(this,"track");l(this,"clip");this.track=t,this.clip=e}get name(){return this.clip.name}get start(){return this.clip.start}get duration(){return this.clip.duration}get end(){return this.start+this.duration}draw(){var y;const{context:t}=this.track.view,e=this.track.view.mapLogicalToCanvasCoordinates({x:this.start,y:this.track.y}),r=this.track.view.mapLogicalToCanvasX(this.start+this.duration);let i=e.x,n=e.x,c=r,p=r;if(this.clip.parent.blend==="blend"){const u=this.track.clips.filter(v=>v!=this),k=u.find(v=>v.start<this.start&&this.start<v.end),N=u.find(v=>v.start<this.end&&this.end<v.end);k&&(n=this.track.view.mapLogicalToCanvasX(k.end)),N&&(p=this.track.view.mapLogicalToCanvasX(N.start))}i=Math.floor(i),n=Math.floor(n),c=Math.floor(c),p=Math.floor(p),t.save();const h=((y=this.track.view.clickClip)==null?void 0:y.clip)===this.clip;t.fillStyle=h?"#686d7a":"#40444a",t.beginPath(),t.moveTo(i,e.y),t.lineTo(n,e.y+E),t.lineTo(c,e.y+E),t.lineTo(p,e.y),t.closePath(),t.fill(),i!=n&&(t.beginPath(),t.moveTo(i,e.y),t.lineTo(n,e.y+E),t.lineTo(n,e.y),t.lineTo(i,e.y),t.closePath(),t.fillStyle="#494e54",t.strokeStyle="#323232",t.fill(),t.stroke()),c!=p&&(t.beginPath(),t.moveTo(c,e.y+E),t.lineTo(p,e.y),t.lineTo(p,e.y+E),t.lineTo(c,e.y+E),t.closePath(),t.fillStyle="#494e54",t.strokeStyle="#323232",t.fill(),t.stroke()),h&&(this.track.selectArea=[i,n,c,p,e.y]),this.drawLabel((e.x+r)*.5,e.y),t.restore()}drawLabel(t,e){const{context:r}=this.track.view;r.save(),r.textBaseline="middle",r.textAlign="center",r.font="normal 10px sans-serif",r.fillStyle="#fff",r.fillText(this.name,t,e+E*.5),r.restore()}isInArea(t){return t.x>=this.start&&t.x<=this.end}getMenus(){return[{text:"删除",action:()=>{this.clip.parent.parent.parent.entity.core.removeClip(this.clip)}}]}}class tt{constructor(t,e,r){l(this,"view");l(this,"track");l(this,"clips");l(this,"x");l(this,"y");l(this,"selectArea");this.view=t,this.clips=[],this.x=0,this.y=e,this.track=r,this.selectArea=[]}addClip(t){this.clips.push(t)}draw(){const{context:t,canvas:e}=this.view;t.save();const r=this.view.mapLogicalToCanvasY(this.y);if(t.fillStyle="#3232327c",t.fillRect(0,r,e.width,E),t.restore(),this.selectArea.length=0,this.clips.forEach(i=>i.draw()),this.selectArea.length){const[i,n,c,p,h]=this.selectArea;t.save(),t.strokeStyle="#ffffff",t.lineWidth=1.5,t.beginPath(),t.moveTo(i,h),t.lineTo(n,h+E),t.lineTo(c,h+E),t.lineTo(p,h),t.closePath(),t.stroke(),t.restore()}}isInArea(t){return t.y>=this.y&&t.y<=this.y+E}getClip(t){for(let e=0;e<this.clips.length;e++){const r=this.clips[e];if(r.isInArea(t))return r}}getMenus(t){return[{text:"删除",action:()=>{this.track.parent.parent.entity.core.removeTrack(this.track)}},{text:`添加${at[this.track.type]}片段`,action:()=>{const e=this.track.createClip();e.start=t.x,e.duration=this.track.type==="frame"?0:3,this.track.parent.parent.entity.core.addClip(e,this.track)}}]}}class rt{constructor(t){l(this,"view");this.view=t}get canvas(){return this.view.canvas}draw(){const t=this.getParams();if(!t)return;const e=t.span/10;let r=t.pos,i=0;for(;;){const n=r*t.space,c=this.view.mapLogicalToCanvasX(n);if(c>this.canvas.width)break;this.drawLine(c);const h=(r+5*e)*t.space,y=this.view.mapLogicalToCanvasX(h);if(this.drawLine(y),r+=t.span,i++>100)break}}getParams(){const e=this.view.xMin,r=60/this.view.getZoomFactor(!0),i=Math.ceil(Math.log(r/5)/Math.LN10);if((e==0?-99:Math.log(Math.abs(e))/Math.LN10)-i>10)return;const c=Math.pow(10,i),p=r/c,h=p>2.001?5:p>1.001?2:1,y=Math.floor(e/c),u=h*Math.floor(y/h);return{space:c,span:h,pos:u,decPow:i}}drawLine(t){const{context:e,canvas:r}=this.view;e.save(),e.fillStyle="#ffffff5b",e.fillRect(Math.floor(t),0,1,r.height),e.restore()}}class st{constructor(t){l(this,"view");l(this,"pointers");l(this,"dragStartLPos");l(this,"dragStartCPos");l(this,"dragStartClipPos");l(this,"dragCount");l(this,"zooming",!1);l(this,"zoomLCenter");l(this,"zoomStartDist");l(this,"zoomStartFactorX");l(this,"zoomStartFactorY");l(this,"zoomX");l(this,"zoomY");l(this,"onPointerdown",t=>{const{altKey:e,ctrlKey:r,shiftKey:i,metaKey:n,pointerType:c,button:p}=t;e||r||n||i||c=="mouse"&&![0,1].includes(p)||(this.trackPointer(t),this.switchMode(),t.preventDefault())});l(this,"onPointerUp",t=>{this.pointers.has(t.pointerId)&&(this.releasePointer(t.pointerId),this.switchMode(),t.preventDefault())});l(this,"onPointerMove",t=>{if(!this.pointers.has(t.pointerId)){this.updatePotentialKnot(t);return}this.trackPointer(t),this.pointers.size==1?this.drag():this.pointers.size==2&&this.zooming&&this.zoom(),t.preventDefault()});l(this,"onWheel",t=>{t.preventDefault();const e=t.deltaMode==0&&Math.abs(t.deltaY)<50||t.deltaX!=0;if(e&&!t.ctrlKey){this.moveByWheel(t);return}if(t.deltaY==0)return;const r=e?1.05:Math.SQRT2,i=t.deltaY>0?1/r:r;let n;t.shiftKey?n=O.y:t.altKey?n=O.x:t.ctrlKey&&!e?n=O.xy:n=this.view.editor.zoomMode;let c,p;switch(n){case O.x:{c=i,p=1;break}case O.y:{c=1,p=i;break}default:c=i,p=i}const h=this.getCanvasCoordinatesFromEvent(t);this.view.zoom(c,p,h),this.view.editor.refresh()});this.view=t,this.pointers=new Map,this.dragCount=0,this.zoomLCenter={x:0,y:0},this.zoomStartDist=0,this.zoomStartFactorX=0,this.zoomStartFactorY=0,this.zoomX=!1,this.zoomY=!1,this.dragStartClipPos=0,t.canvas.addEventListener("pointerdown",this.onPointerdown),t.canvas.addEventListener("pointerup",this.onPointerUp),t.canvas.addEventListener("pointercancel",this.onPointerUp),t.canvas.addEventListener("pointermove",this.onPointerMove),t.canvas.addEventListener("wheel",this.onWheel)}get canvas(){return this.view.canvas}trackPointer(t){const e=t.pointerId;this.pointers.has(e)||this.canvas.setPointerCapture(e),this.pointers.set(e,t)}releaseAllPointers(){for(;this.pointers.size>0;){const t=this.pointers.keys().next().value;t&&this.releasePointer(t)}}releasePointer(t){this.pointers.delete(t),this.canvas.releasePointerCapture(t)}getCanvasCoordinates(){if(this.pointers.size<1)throw new Error("No active pointers.");const t=this.pointers.values().next().value;return this.getCanvasCoordinatesFromEvent(t)}getCanvasCoordinatesFromEvent(t){return this.view.mapViewportToCanvasCoordinates({x:t.clientX,y:t.clientY})}switchMode(){this.stopDragging(),this.stopZooming(),this.pointers.size==1?(this.startDragging(),this.canvas.focus()):this.pointers.size==2&&this.startZooming()}stopDragging(){(this.view.clipDragging||this.view.planeDragging)&&this.view.editor.refresh(),this.view.dragClip&&this.view.endDragClip(this.view.dragClip),this.dragStartLPos=void 0,this.dragStartCPos=void 0,this.view.clipDragging=!1,this.view.planeDragging=!1,this.view.dragClip=void 0,this.dragStartClipPos=0}stopZooming(){this.zooming=!1}startDragging(){const t=this.getCanvasCoordinates(),e=this.view.mapCanvasToLogicalCoordinates(t),r=this.view.findNearestClip(t);r&&this.view.selectClip(r),r&&this.view.startDragClip(r),this.view.dragClip=r,this.view.clipDragging=r!=null,this.view.planeDragging=r==null,this.dragStartLPos=e,this.dragStartCPos=t,this.dragStartClipPos=(r==null?void 0:r.start)??0,this.dragCount=0,this.view.editor.refresh()}startZooming(){const t=this.pointers.values(),e=t.next().value,r=t.next().value,i=this.getCanvasCoordinatesFromEvent(e),n=this.getCanvasCoordinatesFromEvent(r),c=_.computeCenter(i,n),p=Math.abs(i.x-n.x),h=Math.abs(i.y-n.y);this.zoomLCenter=this.view.mapCanvasToLogicalCoordinates(c),this.zoomStartDist=_.computeDistance(i,n),this.zoomStartFactorX=this.view.getZoomFactor(!0),this.zoomStartFactorY=this.view.getZoomFactor(!1);const y=Math.tan(Math.PI/8);this.zoomX=p>y*h,this.zoomY=h>y*p,this.zooming=!0}drag(){const t=this.getCanvasCoordinates();if(this.view.clipDragging&&this.view.dragClip&&this.dragStartLPos){const r=this.view.mapCanvasToLogicalCoordinates(t).x-this.dragStartLPos.x;this.view.draggingClip(this.view.dragClip,this.dragStartClipPos,r),this.view.editor.refresh()}else this.view.planeDragging&&this.dragStartLPos&&(this.view.moveCoordinatePlane(t,this.dragStartLPos),this.view.editor.refresh())}zoom(){const t=this.pointers.values(),e=t.next().value,r=t.next().value,i=this.getCanvasCoordinatesFromEvent(e),n=this.getCanvasCoordinatesFromEvent(r),c=_.computeCenter(i,n),h=_.computeDistance(i,n)/this.zoomStartDist;this.zoomX&&(this.view.xMax=this.view.xMin+this.canvas.width/(this.zoomStartFactorX*h)),this.zoomY&&(this.view.yMax=this.view.yMin+this.canvas.height/(this.zoomStartFactorY*h)),this.view.moveCoordinatePlane(c,this.zoomLCenter),this.view.editor.refresh()}moveByWheel(t){const e=t.deltaMode==1?15:t.deltaMode==2?100:1,r=e*t.deltaX,i=e*t.deltaY;r==0&&i==0||(this.view.moveCoordinatePlaneRelPx(r,-i),this.view.editor.refresh())}updatePotentialKnot(t){const e=this.getCanvasCoordinatesFromEvent(t),r=this.view.findNearestClip(e);this.view.dragClip!=r&&(this.view.hoverClip=r,this.view.editor.refresh())}dispose(){this.canvas.removeEventListener("pointerdown",this.onPointerdown),this.canvas.removeEventListener("pointerup",this.onPointerUp),this.canvas.removeEventListener("pointercancel",this.onPointerUp),this.canvas.removeEventListener("pointermove",this.onPointerMove),this.canvas.removeEventListener("wheel",this.onWheel),this.releaseAllPointers()}}class it extends ce{constructor(t,e){super(t,e)}get start(){return this.clip.start}draw(){const{context:t}=this.track.view,e=this.track.view.mapLogicalToCanvasCoordinates({x:this.start,y:this.track.y});e.x=Math.floor(e.x),t.save(),t.fillStyle="#ffffff",t.fillRect(e.x,e.y,1,E);const r=e.x,i=e.y+E*.5,n=6;t.beginPath(),t.moveTo(r,i-n),t.lineTo(r-n,i),t.lineTo(r,i+n),t.lineTo(r+n,i),t.closePath(),t.fill(),t.restore()}isInArea(t){return Math.abs(t.x-this.start)<=.1}getMenus(){return[{text:"删除",action:()=>{this.clip.parent.parent.parent.entity.core.removeClip(this.clip)}}]}}const at={activation:"激活",animation:"动画",audio:"音频",script:"脚本",frame:"关键帧"};class ot{constructor(t,e){l(this,"editor");l(this,"canvas");l(this,"context");l(this,"canvasStyle");l(this,"clipDragging");l(this,"planeDragging");l(this,"pointerController");l(this,"grid");l(this,"tracks");l(this,"clickClip");l(this,"dragClip");l(this,"hoverClip");l(this,"onContextMenu",t=>{t.preventDefault(),t.stopPropagation();const e=this.mapViewportToCanvasCoordinates({x:t.clientX,y:t.clientY}),r=this.mapCanvasToLogicalCoordinates(e);for(let i=0;i<this.tracks.length;i++){const n=this.tracks[i];if(n.isInArea(r)){const c=n.getClip(r);if(c){const p=c.getMenus();this.editor.editor.bus.emit("CONTEXT_MENU",{event:t,items:p})}else{const p=n.getMenus(r);this.editor.editor.bus.emit("CONTEXT_MENU",{event:t,items:p})}}}});this.editor=t,this.canvas=e,this.context=e.getContext("2d"),this.canvasStyle=getComputedStyle(e),this.clipDragging=!1,this.planeDragging=!1,this.grid=new rt(this),this.pointerController=new st(this),this.tracks=[],this.canvas.addEventListener("contextmenu",this.onContextMenu)}get xMin(){return this.editor.xMin}set xMin(t){this.editor.xMin=t}get xMax(){return this.editor.xMax}set xMax(t){this.editor.xMax=t}get yMin(){return this.editor.yMin}set yMin(t){this.editor.yMin=t}get yMax(){return this.editor.yMax}set yMax(t){this.editor.yMax=t}get zoomMode(){return this.editor.zoomMode}resize(t,e){this.canvas.width=t,this.canvas.height=e}render(){this.canvas.style.cursor=this.clipDragging||this.planeDragging?"move":"inherit",this.grid.draw(),this.tracks.forEach(t=>t.draw())}clear(){this.context.save();const t=this.canvas.width,e=this.canvas.height;this.context.fillStyle="#222222",this.context.fillRect(0,0,t,e),this.context.restore()}getZoomFactor(t){const{xMax:e,xMin:r,yMax:i,yMin:n}=this;return t?this.canvas.width/(e-r):this.canvas.height/(i-n)}mapLogicalToCanvasX(t){return(t-this.xMin)*this.canvas.width/(this.xMax-this.xMin)}mapLogicalToCanvasY(t){return(t-this.yMin)*this.canvas.height/(this.yMax-this.yMin)}mapCanvasToLogicalX(t){return this.xMin+t*(this.xMax-this.xMin)/this.canvas.width}mapCanvasToLogicalY(t){return this.yMin+t*(this.yMax-this.yMin)/this.canvas.height}mapCanvasToLogicalCoordinates(t){return{x:this.mapCanvasToLogicalX(t.x),y:this.mapCanvasToLogicalY(t.y)}}mapLogicalToCanvasCoordinates(t){return{x:this.mapLogicalToCanvasX(t.x),y:this.mapLogicalToCanvasY(t.y)}}mapViewportToCanvasCoordinates(t){const e=this.canvasStyle,r=this.canvas.getBoundingClientRect(),i=b(e.paddingLeft),n=b(e.paddingRight),c=b(e.paddingTop),p=b(e.paddingBottom),h=b(e.borderLeftWidth),y=b(e.borderTopWidth),u=this.canvas.clientWidth-i-n,k=this.canvas.clientHeight-c-p,N=t.x-r.left-h-i,v=t.y-r.top-y-c,R=N/u*this.canvas.width,P=v/k*this.canvas.height;return{x:R,y:P}}moveCoordinatePlane(t,e){const{xMin:r,xMax:i,yMin:n,yMax:c}=this,p=i-r,h=c-n,y=this.canvas.width,u=this.canvas.height;this.xMin=e.x-t.x*p/y,this.xMax=this.xMin+p,this.yMin=e.y-t.y*h/u,this.yMax=this.yMin+h}moveCoordinatePlaneRelPx(t,e){const r=this.xMax-this.xMin,i=this.yMax-this.yMin,n=this.canvas.width,c=this.canvas.height;this.xMin=this.xMin+t/n*r,this.xMax=this.xMin+r,this.yMin=this.yMin+e/c*i,this.yMax=this.yMin+i}zoom(t,e,r){const i=e??t,n=r||{x:this.canvas.width/2,y:this.canvas.height/2},c=this.mapCanvasToLogicalCoordinates(n);this.xMax=this.xMin+(this.xMax-this.xMin)/t,this.yMax=this.yMin+(this.yMax-this.yMin)/i,this.moveCoordinatePlane(n,c)}setTimeline(t){if(this.tracks=[],!!t)for(let e=0;e<t.tracks.length;e++){const r=t.tracks[e],i=V+E*e+V*e,n=new tt(this,i,r);for(let c=0;c<r.clips.length;c++){const p=r.clips[c];if(p.type==="frame"){const h=new it(n,p);n.addClip(h)}else{const h=new ce(n,p);n.addClip(h)}}this.tracks.push(n)}}findNearestTrack(t){const e=this.mapCanvasToLogicalCoordinates(t);for(let r=0;r<this.tracks.length;r++){const i=this.tracks[r];if(i.isInArea(e))return i}}findNearestClip(t){const e=this.mapCanvasToLogicalCoordinates(t);for(let r=0;r<this.tracks.length;r++){const i=this.tracks[r];if(i.isInArea(e))for(let n=0;n<i.clips.length;n++){const c=i.clips[n];if(c.isInArea(e))return c}}}selectClip(t){this.clickClip=t,this.editor.editor.timelineManager.selectClip(t==null?void 0:t.clip)}startDragClip(t){this.editor.editor.timelineManager.startDragClip(t.clip)}draggingClip(t,e,r){this.editor.editor.timelineManager.dragClip(t.clip,e+r)}endDragClip(t){this.editor.editor.timelineManager.endDragClip(t.clip)}dispose(){this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.pointerController.dispose()}}class nt{constructor(t){l(this,"editor");this.editor=t}get time(){var t;return((t=this.editor.timeline)==null?void 0:t.time)??0}render(){this.drawTop(),this.drawBottom()}drawTop(){const{context:t}=this.editor.ruler;t.save();const e=this.editor.ruler.mapLogicalToCanvasX(this.time);t.fillStyle="#fff",t.beginPath(),t.moveTo(e-8,0),t.lineTo(e+8,0),t.lineTo(e+8,E*2/3),t.lineTo(e,E),t.lineTo(e-8,E*2/3),t.lineTo(e-8,0),t.fill(),t.restore()}drawBottom(){const{canvas:t,context:e}=this.editor.view;e.save();const r=this.editor.ruler.mapLogicalToCanvasX(this.time);e.fillStyle="#fff",e.fillRect(Math.floor(r),0,1,t.height),e.restore()}}var O=(a=>(a[a.x=0]="x",a[a.y=1]="y",a[a.xy=2]="xy",a))(O||{});const Y=32,E=32,V=4;class mt{constructor(t){l(this,"editor");l(this,"timelineManager");l(this,"xMin");l(this,"xMax");l(this,"yMin");l(this,"yMax");l(this,"playing");l(this,"zoomMode");l(this,"view");l(this,"ruler");l(this,"hierarchy");l(this,"cursor");l(this,"timeline");l(this,"requestId");l(this,"timer");l(this,"render",()=>{if(this.playing=!1,this.ruler.clear(),this.view.clear(),this.hierarchy.clear(),this.ruler.render(),this.view.render(),this.hierarchy.render(),this.cursor.render(),this.timeline){const{time:t,duration:e}=this.timeline;this.timelineManager.timeLabel.textContent=`时间: ${t.toFixed(1)}s / ${e.toFixed(1)}s`}});l(this,"update",()=>{var e;if(!this.timeline)return;if(this.timeline.time>=this.timeline.duration){this.pause();return}this.requestId=requestAnimationFrame(this.update),this.timer.update();const t=this.timer.getDelta();(e=this.timeline)==null||e.update(t),this.render()});this.timelineManager=t,this.editor=t.editor,this.xMin=0,this.xMax=70,this.yMin=0,this.yMax=264,this.playing=!1,this.zoomMode=0,this.hierarchy=new Qe(this,t.canvas0),this.ruler=new et(this,t.canvas1),this.view=new ot(this,t.canvas2),this.cursor=new nt(this),this.timer=new de}resize(t,e){this.yMax=this.yMin+e-Y,this.ruler.resize(t,E),this.view.resize(t,e-Y),this.hierarchy.resize(e-Y),this.refresh()}setTimeline(t){this.timeline=t,this.view.setTimeline(t),this.hierarchy.setTimeline(t),this.refresh()}refresh(){this.playing||(requestAnimationFrame(this.render),this.playing=!0)}play(){var t;this.timer.reset(),this.requestId=requestAnimationFrame(this.update),(t=this.timeline)==null||t.play()}pause(){var t;this.requestId&&cancelAnimationFrame(this.requestId),this.requestId=-1,(t=this.timeline)==null||t.pause()}start(){var t;this.timer.reset(),this.requestId=requestAnimationFrame(this.update),(t=this.timeline)==null||t.restart()}stop(){var t;this.requestId&&cancelAnimationFrame(this.requestId),this.requestId=-1,(t=this.timeline)==null||t.stop()}dispose(){this.ruler.dispose(),this.view.dispose(),this.hierarchy.dispose()}}const yt=[{key:"copy",label:"拷贝",action:a=>{a.copyManager.copy()},visible:a=>a.selectionManager.getSelection().length>0},{key:"cut",label:"剪切",action:a=>{a.copyManager.cut()},visible:a=>a.selectionManager.getSelection().length>0},{key:"paste",label:"粘贴",action:a=>{a.copyManager.paste()},visible:a=>a.copyManager.canPaste()},{key:"delete",label:"删除",action:a=>{const t=a.selectionManager.getSelection();a.historyManager.beginTransaction(),a.core.select([]),t.forEach(e=>a.core.removeEntity(e)),a.historyManager.endTransaction()},visible:a=>a.selectionManager.getSelection().length>0},{key:"select",label:"选择层级",action:a=>{const t=a.selectionManager.getSelection().slice();for(let e=0;e<t.length;e++)t[e].traverse(r=>!t.includes(r)&&t.push(r));a.core.select(t)},visible:a=>a.selectionManager.getSelection().length>0},{key:"material",label:"材质",action:()=>{},visible:a=>a.core.lastSelection instanceof Ee,children:[{key:"copy-material",label:"拷贝",action:a=>{a.copyManager.copyMaterial()},visible:()=>!0},{key:"paste-material",label:"粘贴",action:a=>{a.copyManager.pasteMaterial()},visible:a=>a.copyManager.canPasteMaterial()},{key:"replace-material",label:"替换",action:()=>{},visible:a=>a.selectionManager.getSelection().length>0,children:[{key:"basic-material",label:"基础材质",action:a=>{a.materialManager.changeMaterial(C.Basic)},visible:()=>!0},{key:"phong-material",label:"Phong材质",action:a=>{a.materialManager.changeMaterial(C.Phong)},visible:()=>!0},{key:"standard-material",label:"标准材质",action:a=>{a.materialManager.changeMaterial(C.Standard)},visible:()=>!0},{key:"physical-material",label:"物理材质",action:a=>{a.materialManager.changeMaterial(C.Physical)},visible:()=>!0},{key:"shader-material",label:"自定义材质",action:a=>{a.materialManager.changeMaterial(C.Shader)},visible:()=>!0}]}]},{key:"component",label:"组件",action:()=>{},visible:()=>!0,children:[{key:"component_script",label:S[m.SimpleScript],action:a=>{const t=x(m.SimpleScript),e=[...a.selectionManager.getSelection()];e.length===0&&e.push(a.selectionManager.getView()),a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:()=>!0},{key:"component_playable_director",label:S[m.PlayableDirector],action:a=>{const t=x(m.PlayableDirector),e=[...a.selectionManager.getSelection()];e.length===0&&e.push(a.selectionManager.getView()),a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:()=>!0},{key:"component_orbit_controls",label:S[m.OrbitControls],action:a=>{const t=x(m.OrbitControls),e=a.selectionManager.getSelection();a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:a=>{const t=a.selectionManager.getSelection(),e=t.filter(r=>r instanceof z);return e.length>0&&e.length===t.length}},{key:"compoent_pointer_lock_controls",label:S[m.PointerLockControls],action:a=>{const t=x(m.PointerLockControls),e=a.selectionManager.getSelection();a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:a=>{const t=a.selectionManager.getSelection(),e=t.filter(r=>r instanceof z);return e.length>0&&e.length===t.length}},{key:"compoent_blueprint",label:S[m.Blueprint],action:a=>{const t=x(m.Blueprint),e=[...a.selectionManager.getSelection()];e.length===0&&e.push(a.selectionManager.getView()),a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:()=>!0}]}],At=[{key:"copy",label:"拷贝",action:a=>{a.copyManager.copy()},visible:a=>a.selectionManager.getSelection().length>0},{key:"cut",label:"剪切",action:a=>{a.copyManager.cut()},visible:a=>a.selectionManager.getSelection().length>0},{key:"paste",label:"粘贴",action:a=>{a.copyManager.paste()},visible:a=>a.copyManager.canPaste()},{key:"delete",label:"删除",action:a=>{const t=a.selectionManager.getSelection();a.historyManager.beginTransaction(),a.core.select([]),t.forEach(e=>a.core.removeEntity(e)),a.historyManager.endTransaction()},visible:a=>a.selectionManager.getSelection().length>0},{key:"component",label:"组件",action:()=>{},visible:()=>!0,children:[{key:"component_script",label:"脚本",action:a=>{const t=x(m.SimpleScript),e=[...a.selectionManager.getSelection()];e.length===0&&e.push(a.selectionManager.getView()),a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:()=>!0},{key:"component_orbit_controls",label:"轨道控制",action:a=>{const t=x(m.OrbitControls),e=a.selectionManager.getSelection();a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:a=>{const t=a.selectionManager.getSelection(),e=t.filter(r=>r instanceof z);return e.length>0&&e.length===t.length}},{key:"compoent_pointer_lock_controls",label:S[m.PointerLockControls],action:a=>{const t=x(m.PointerLockControls),e=a.selectionManager.getSelection();a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:a=>{const t=a.selectionManager.getSelection(),e=t.filter(r=>r instanceof z);return e.length>0&&e.length===t.length}},{key:"compoent_blueprint",label:S[m.Blueprint],action:a=>{const t=x(m.Blueprint),e=a.selectionManager.getSelection();a.historyManager.beginTransaction(),e.forEach(r=>{const{entityManager:i}=a.core,n=i.createComponent(t,r);a.core.addComponent(n,r)}),a.historyManager.endTransaction()},visible:()=>!0}]}];export{w as A,gt as M,ht as N,yt as S,mt as T,o as V,s as a,f as b,x as c,At as d};
